
<!doctype html>
<html lang="es" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../02.Tablas/">
      
      
        <link rel="next" href="../../05.Power_BI/00.Introduccion/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.12">
    
    
      
        <title>03. ETL - COMFENALCO</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.2afb09e1.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/mkdocs_pagetree_plugin.css">
    
      <link rel="stylesheet" href="../../css/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="23abf7" data-md-color-accent="light-blue">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#proposito-del-paquete" class="md-skip">
          Saltar a contenido
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Cabecera">
    <a href="../.." title="COMFENALCO" class="md-header__button md-logo" aria-label="COMFENALCO" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            COMFENALCO
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              03. ETL
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Búsqueda" placeholder="Búsqueda" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Buscar">
        
        <button type="reset" class="md-search__icon md-icon" title="Limpiar" aria-label="Limpiar" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Inicializando búsqueda
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navegación" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="COMFENALCO" class="md-nav__button md-logo" aria-label="COMFENALCO" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    COMFENALCO
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" >
        
          
          <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    00. INICIO
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            00. INICIO
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    INTRODUCCIÓN
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../instalacion/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    INSTALACIÓN Y CONFIGURACIÓN
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Conexiones_BD/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    CONEXIÓN A BASE DE DATOS
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../buenaspracticas/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    BUENAS PRÁCTICAS
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    01. SCRIPTS SQL
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            01. SCRIPTS SQL
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../01.scripts/00.Inicio/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Introducción
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../01.scripts/00.Eliminar_todo/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    00. Eliminar Todo
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../01.scripts/01.Transversal/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    01. Transversal
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../01.scripts/02.Cedesarrollo/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    02. Cedesarrollo
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../01.scripts/03.Proteccion/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    03. Proteccion
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../01.scripts/04.Colegio/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    04. Colegio
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../01.scripts/05.Tablas_Stage_Area/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    05. Tablas Stage Area
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    02. ESTRUCTURA SHAREPOINT
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            02. ESTRUCTURA SHAREPOINT
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../04.sharepoint/estructura_sharepoint/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Estructura carpeta Sharepoint
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../04.sharepoint/estructura_archivos_actualizacion/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Estructura Archivos Actualizacion
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    03. BI COMFENALCO
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            03. BI COMFENALCO
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../02.Paquetes_SSIS/00.params/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Introduccion
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../02.Paquetes_SSIS/00-SCRAPING/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    00. WEB SCRAPING
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../02.Paquetes_SSIS/01.TRANSVERSAL_DIMENSIONES/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    01. TRANSVERSAL_DIMENSIONES
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../02.Paquetes_SSIS/02-TRANSVERSAL_FACT/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    02. TRANSVERSAL_FACT
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../02.Paquetes_SSIS/03-COLEGIO_DIMENSIONES/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    03. COLEGIO_DIMENSIONES
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../02.Paquetes_SSIS/04-COLEGIO_FACT/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    04. COLEGIO_FACT
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../02.Paquetes_SSIS/05-CEDESARROLLO_DIMENSIONES/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    05. CEDESARROLLO_DIMENSIONES
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../02.Paquetes_SSIS/06-CEDESARROLLO_FACT/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    06. CEDESARROLLO_FACT
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../02.Paquetes_SSIS/07-PROTECCION_DIMENSIONES/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    07. PROTECCION_DIMENSIONES
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../02.Paquetes_SSIS/08-PROTECCION_FACT/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    08. PROTECCION_FACT
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../02.Paquetes_SSIS/09-ETLS_CUBO/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    09. ETLS_CUBO
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    04. COMFENALCO EDUCACION
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            04. COMFENALCO EDUCACION
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1" >
        
          
          <label class="md-nav__link" for="__nav_5_1" id="__nav_5_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    01 SCRIPTS
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1">
            <span class="md-nav__icon md-icon"></span>
            01 SCRIPTS
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../00.etl/00.etl_00.Introduccion/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Introducción
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1_2" >
        
          
          <label class="md-nav__link" for="__nav_5_1_2" id="__nav_5_1_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    01. Q10
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_1_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1_2">
            <span class="md-nav__icon md-icon"></span>
            01. Q10
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1_2_1" >
        
          
          <label class="md-nav__link" for="__nav_5_1_2_1" id="__nav_5_1_2_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    0.1. Educación Tecnica
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_5_1_2_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1_2_1">
            <span class="md-nav__icon md-icon"></span>
            0.1. Educación Tecnica
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../00.etl/00.etl_01.q10_01.educaciontecnica/01.Docentes_Cedesarrollo/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    0.1. Docentes Cedesarrollo.py
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../00.etl/00.etl_01.q10_01.educaciontecnica/02.Disenio_curricular/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    0.2. Diseño Curricular.py
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../00.etl/00.etl_01.q10_01.educaciontecnica/03.Listado_matriculas/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    0.3. Listado Matrículas.py
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../00.etl/00.etl_01.q10_01.educaciontecnica/04.Ingresos/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    0.4. Ingresos.py
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../00.etl/00.etl_01.q10_01.educaciontecnica/05.Historico_notas_Cedesarrollo/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    0.5. Histórico notas.py
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../00.etl/00.etl_01.q10_01.educaciontecnica/06.Egresados_graduados_Cedesarrollo/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    0.6. Egresados.py
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../00.etl/00.etl_01.q10_01.educaciontecnica/07.Desertores/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    0.7. Desertores.py
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1_2_2" >
        
          
          <label class="md-nav__link" for="__nav_5_1_2_2" id="__nav_5_1_2_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    0.2. Educación Continua
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_5_1_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1_2_2">
            <span class="md-nav__icon md-icon"></span>
            0.2. Educación Continua
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../00.etl/00.etl_01.q10_02.educacioncontinua/01.Docentes_desarrollo_empresarial/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    0.1. Docentes Desarrollo Empresarial
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../00.etl/00.etl_01.q10_02.educacioncontinua/02.Preinscritos/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    0.2. Preinscritos
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../00.etl/00.etl_01.q10_02.educacioncontinua/03.Listado_matriculas_emp/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    0.3. Listado Matrículas Empresarial
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../00.etl/00.etl_01.q10_02.educacioncontinua/04.Consolidado_inasistencias/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    0.4. Consolidado Inasistencias
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../00.etl/00.etl_01.q10_02.educacioncontinua/05.Estudiantes_inasistencias/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    0.5. Estudiantes Inasistencias
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../00.etl/00.etl_01.q10_02.educacioncontinua/06.Egresados_graduados_empresarial/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    0.6. Egresados Graduados Empresarial
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1_2_3" >
        
          
          <label class="md-nav__link" for="__nav_5_1_2_3" id="__nav_5_1_2_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Sharepoint
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_5_1_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1_2_3">
            <span class="md-nav__icon md-icon"></span>
            Sharepoint
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../00.etl/00.etl_01.q10_02.Sharepoint/cede_01_procesar_docentes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    cede_01 procesar_docentes
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../00.etl/00.etl_01.q10_02.Sharepoint/cede_02_procesar_Dise%C3%B1o_Curricular/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    cede_02 procesar_Diseño_Curricular
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../00.etl/00.etl_01.q10_02.Sharepoint/cede_03_procesar_listado_matriculas/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    cede_03 procesar_listado_matriculas
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../00.etl/00.etl_01.q10_02.Sharepoint/cede_04_procesar_cede_Ingresos/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    cede_04 procesar_Ingresos
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../00.etl/00.etl_01.q10_02.Sharepoint/cede_05_cede_Historico_Notas/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    cede_05 cede_Historico_Notas
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../00.etl/00.etl_01.q10_02.Sharepoint/cede_06_cede_Egresados_Graduados/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    cede_06 cede_Egresados_Graduados
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../00.etl/00.etl_01.q10_02.Sharepoint/cede_07_Cancelados_Desertores/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    cede_07 Cancelados Desertores
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../00.etl/00.etl_01.q10_02.Sharepoint/emp_01_Docentes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    emp_01 Docentes Empresarial
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../00.etl/00.etl_01.q10_02.Sharepoint/emp_02_listado_matriculas/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    emp_02 Listado Matrículas
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../00.etl/00.etl_01.q10_02.Sharepoint/emp_03_preinscritos/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    emp_03 Preinscritos Empresarial
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../00.etl/00.etl_01.q10_02.Sharepoint/emp_04_egresados_Graduados/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    emp_04 Egresados Graduados
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../00.etl/00.etl_01.q10_02.Sharepoint/emp_05_Estudiantes_inasistencias/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    emp_05 Estudiantes Inasistencias
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../00.etl/00.etl_01.q10_02.Sharepoint/emp_06_consolidado_Inasistencias/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    emp_06 Consolidado Inasistencias
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1_3" >
        
          
          <label class="md-nav__link" for="__nav_5_1_3" id="__nav_5_1_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    02. C4C
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_1_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1_3">
            <span class="md-nav__icon md-icon"></span>
            02. C4C
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../00.etl/00.etl_02.C4C/01.C4C_webscraping_v4_Actualizable/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    3.1. Webscraping Actualizable
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../00.etl/00.etl_02.C4C/02.C4C_webscraping_v4_Historico/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    3.2. Webscraping Histórico
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1_4" >
        
          
          <label class="md-nav__link" for="__nav_5_1_4" id="__nav_5_1_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Utils
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_1_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1_4">
            <span class="md-nav__icon md-icon"></span>
            Utils
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../00.etl/Utils/Funciones/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Funciones.py
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../00.etl/Utils/download/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Download.py
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../00.etl/Utils/Funciones_DM/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Funciones_DM.py
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../00.etl/Utils/c4c_from_sharepoint/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    c4c_from_sharepoint
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../00.etl/Utils/dim_Estudiantes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    dim_Estudiantes
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../00.etl/Utils/dim_periodo_academico/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    dim_periodo_academico
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../00.etl/Utils/fact_facturacion/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    fact_facturacion
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../00.etl/Utils/fact_graduados/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    fact_graduados
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../00.etl/Utils/fact_cotizacion/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    fact_cotizacion
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../00.etl/Utils/fact_listado_matriculas/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    fact_listado_matriculas
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" checked>
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    05. CUBO
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            05. CUBO
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../00.Introduccion/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Introducción
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../01.Origen/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    01. ORIGEN Y MEDIDAS
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../02.Tablas/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    02. TABLAS
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    03. ETL
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    03. ETL
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Tabla de contenidos">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Tabla de contenidos
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#proposito-del-paquete" class="md-nav__link">
    <span class="md-ellipsis">
      Propósito del Paquete
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#descripcion-del-paquete-ssis-09-etls_cubo" class="md-nav__link">
    <span class="md-ellipsis">
      Descripción del Paquete SSIS "09-ETLS_CUBO"
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Descripción del Paquete SSIS &#34;09-ETLS_CUBO&#34;">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-preparacion-del-entorno-analitico" class="md-nav__link">
    <span class="md-ellipsis">
      1. Preparación del Entorno Analítico
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-construccion-del-staging-de-afiliaciones-stg_fact_afiliaciones" class="md-nav__link">
    <span class="md-ellipsis">
      2. Construcción del Staging de Afiliaciones (STG_FACT_AFILIACIONES)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-consolidacion-en-la-tabla-de-hechos-principal-fact_actividades" class="md-nav__link">
    <span class="md-ellipsis">
      3. Consolidación en la Tabla de Hechos Principal (FACT_ACTIVIDADES)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#diagramas" class="md-nav__link">
    <span class="md-ellipsis">
      Diagramas
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Diagramas">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-diagrama-de-flujo-general" class="md-nav__link">
    <span class="md-ellipsis">
      1. Diagrama de Flujo General
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-modelo-de-datos-simplificado-foco-en-fact_actividades" class="md-nav__link">
    <span class="md-ellipsis">
      2. Modelo de Datos Simplificado (Foco en FACT_ACTIVIDADES)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#componentes" class="md-nav__link">
    <span class="md-ellipsis">
      Componentes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Componentes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#truncar-tablas-cubo" class="md-nav__link">
    <span class="md-ellipsis">
      Truncar Tablas Cubo
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dim_tiempo_mensual" class="md-nav__link">
    <span class="md-ellipsis">
      DIM_TIEMPO_MENSUAL
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#afiliacion-mensual-empresas" class="md-nav__link">
    <span class="md-ellipsis">
      Afiliación mensual Empresas
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#almacenar-max-afiliados" class="md-nav__link">
    <span class="md-ellipsis">
      Almacenar MAX afiliados
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fact_actividadescontenedor-de-bucles-forafiliacion-mensual-afiliados" class="md-nav__link">
    <span class="md-ellipsis">
      FACT_ACTIVIDADES\Contenedor de bucles For\Afiliacion mensual Afiliados
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fact_actividadesalmacenar-max-beneficiarios" class="md-nav__link">
    <span class="md-ellipsis">
      FACT_ACTIVIDADES\Almacenar MAX beneficiarios
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fact_actividadescontenedor-de-bucles-for-1afiliacion-mensual-beneficiarios" class="md-nav__link">
    <span class="md-ellipsis">
      FACT_ACTIVIDADES\Contenedor de bucles For 1\Afiliación mensual Beneficiarios
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fact_actividades-fact_actividades_pqrs" class="md-nav__link">
    <span class="md-ellipsis">
      FACT_ACTIVIDADES\ FACT_ACTIVIDADES_PQRS
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fact_actividades_nps" class="md-nav__link">
    <span class="md-ellipsis">
      FACT_ACTIVIDADES_NPS
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fact_actividades_proteccion" class="md-nav__link">
    <span class="md-ellipsis">
      FACT_ACTIVIDADES_PROTECCION
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fact_actividades_cedesarrollo" class="md-nav__link">
    <span class="md-ellipsis">
      FACT_ACTIVIDADES_CEDESARROLLO
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#actividades-cedesarrollomatricula-mensual-educacion-tecnica" class="md-nav__link">
    <span class="md-ellipsis">
      Actividades Cedesarrollo\Matricula Mensual Educacion Tecnica
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#actividades-cedesarrollofacturacion-tecnica-y-continua" class="md-nav__link">
    <span class="md-ellipsis">
      Actividades Cedesarrollo\Facturacion Tecnica y Continua
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#actividades-colegiofact_actividades_colegio" class="md-nav__link">
    <span class="md-ellipsis">
      Actividades Colegio\FACT_ACTIVIDADES_COLEGIO
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#actividades-colegiomatricula-mensual-colegio" class="md-nav__link">
    <span class="md-ellipsis">
      Actividades Colegio\Matricula Mensual Colegio
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#almacenar-max-actividades" class="md-nav__link">
    <span class="md-ellipsis">
      Almacenar MAX ACTIVIDADES
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#contenedor-de-bucles-para-actividadesactividad-afiliacion" class="md-nav__link">
    <span class="md-ellipsis">
      Contenedor de bucles para Actividades\Actividad Afiliacion
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#almacenar-max-aportes" class="md-nav__link">
    <span class="md-ellipsis">
      Almacenar MAX Aportes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#contenedor-de-bucles-for-1-1aportes-totales" class="md-nav__link">
    <span class="md-ellipsis">
      Contenedor de bucles For 1 1\Aportes Totales
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fact_personal_cubo" class="md-nav__link">
    <span class="md-ellipsis">
      FACT_PERSONAL_CUBO
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fact_evaluacion_docente_cubo" class="md-nav__link">
    <span class="md-ellipsis">
      FACT_EVALUACION_DOCENTE_CUBO
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fact_financiera_cubo" class="md-nav__link">
    <span class="md-ellipsis">
      FACT_FINANCIERA_CUBO
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#procesar-fact_unidadescobertura-proyectada" class="md-nav__link">
    <span class="md-ellipsis">
      Procesar FACT_UNIDADES\Cobertura Proyectada
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#procesar-fact_unidadessaber-11-individual" class="md-nav__link">
    <span class="md-ellipsis">
      Procesar FACT_UNIDADES\Saber 11 Individual
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#procesar-fact_unidadessaber-11-colegio" class="md-nav__link">
    <span class="md-ellipsis">
      Procesar FACT_UNIDADES\Saber 11 Colegio
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#procesar-fact_unidadesdesercion-aipi-y-jec" class="md-nav__link">
    <span class="md-ellipsis">
      Procesar FACT_UNIDADES\Desercion AIPI y JEC
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#procesar-fact_unidadesevaluacion-curricular-cedesarrollo" class="md-nav__link">
    <span class="md-ellipsis">
      Procesar FACT_UNIDADES\Evaluacion Curricular Cedesarrollo
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#procesar-fact_unidadesdocumentos-completos-cedesarrollo" class="md-nav__link">
    <span class="md-ellipsis">
      Procesar FACT_UNIDADES\Documentos Completos Cedesarrollo
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fact_mineriamineria_colegiotruncar-tabla" class="md-nav__link">
    <span class="md-ellipsis">
      FACT_MINERIA\MINERIA_COLEGIO\Truncar Tabla
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fact_mineriamineria_colegioproceso-matricula-temporal" class="md-nav__link">
    <span class="md-ellipsis">
      FACT_MINERIA\MINERIA_COLEGIO\Proceso Matrícula (Temporal)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fact_mineriamineria_colegiogestion-matriculas" class="md-nav__link">
    <span class="md-ellipsis">
      FACT_MINERIA\MINERIA_COLEGIO\Gestion Matriculas
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fact_mineriamineria_colegiopagos-matriculas" class="md-nav__link">
    <span class="md-ellipsis">
      FACT_MINERIA\MINERIA_COLEGIO\Pagos Matriculas
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fact_mineriamineria_colegiopqrs-colegio" class="md-nav__link">
    <span class="md-ellipsis">
      FACT_MINERIA\MINERIA_COLEGIO\PQRs Colegio
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fact_mineriamineria_educacion_tecnica_y_continuainscripcion" class="md-nav__link">
    <span class="md-ellipsis">
      FACT_MINERIA\MINERIA_EDUCACION_TECNICA_Y_CONTINUA\Inscripcion
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fact_mineriamineria_educacion_tecnica_y_continuaadmision" class="md-nav__link">
    <span class="md-ellipsis">
      FACT_MINERIA\MINERIA_EDUCACION_TECNICA_Y_CONTINUA\Admision
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fact_mineriamineria_educacion_tecnica_y_continuapago" class="md-nav__link">
    <span class="md-ellipsis">
      FACT_MINERIA\MINERIA_EDUCACION_TECNICA_Y_CONTINUA\Pago
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fact_mineriamineria_educacion_tecnica_y_continuapqrs" class="md-nav__link">
    <span class="md-ellipsis">
      FACT_MINERIA\MINERIA_EDUCACION_TECNICA_Y_CONTINUA\PQRs
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    06. POWER BI
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            06. POWER BI
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../05.Power_BI/00.Introduccion/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Introducción
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../05.Power_BI/01.Dashboard/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    01. DASHBOARD
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Tabla de contenidos">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Tabla de contenidos
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#proposito-del-paquete" class="md-nav__link">
    <span class="md-ellipsis">
      Propósito del Paquete
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#descripcion-del-paquete-ssis-09-etls_cubo" class="md-nav__link">
    <span class="md-ellipsis">
      Descripción del Paquete SSIS "09-ETLS_CUBO"
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Descripción del Paquete SSIS &#34;09-ETLS_CUBO&#34;">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-preparacion-del-entorno-analitico" class="md-nav__link">
    <span class="md-ellipsis">
      1. Preparación del Entorno Analítico
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-construccion-del-staging-de-afiliaciones-stg_fact_afiliaciones" class="md-nav__link">
    <span class="md-ellipsis">
      2. Construcción del Staging de Afiliaciones (STG_FACT_AFILIACIONES)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-consolidacion-en-la-tabla-de-hechos-principal-fact_actividades" class="md-nav__link">
    <span class="md-ellipsis">
      3. Consolidación en la Tabla de Hechos Principal (FACT_ACTIVIDADES)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#diagramas" class="md-nav__link">
    <span class="md-ellipsis">
      Diagramas
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Diagramas">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-diagrama-de-flujo-general" class="md-nav__link">
    <span class="md-ellipsis">
      1. Diagrama de Flujo General
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-modelo-de-datos-simplificado-foco-en-fact_actividades" class="md-nav__link">
    <span class="md-ellipsis">
      2. Modelo de Datos Simplificado (Foco en FACT_ACTIVIDADES)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#componentes" class="md-nav__link">
    <span class="md-ellipsis">
      Componentes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Componentes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#truncar-tablas-cubo" class="md-nav__link">
    <span class="md-ellipsis">
      Truncar Tablas Cubo
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dim_tiempo_mensual" class="md-nav__link">
    <span class="md-ellipsis">
      DIM_TIEMPO_MENSUAL
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#afiliacion-mensual-empresas" class="md-nav__link">
    <span class="md-ellipsis">
      Afiliación mensual Empresas
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#almacenar-max-afiliados" class="md-nav__link">
    <span class="md-ellipsis">
      Almacenar MAX afiliados
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fact_actividadescontenedor-de-bucles-forafiliacion-mensual-afiliados" class="md-nav__link">
    <span class="md-ellipsis">
      FACT_ACTIVIDADES\Contenedor de bucles For\Afiliacion mensual Afiliados
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fact_actividadesalmacenar-max-beneficiarios" class="md-nav__link">
    <span class="md-ellipsis">
      FACT_ACTIVIDADES\Almacenar MAX beneficiarios
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fact_actividadescontenedor-de-bucles-for-1afiliacion-mensual-beneficiarios" class="md-nav__link">
    <span class="md-ellipsis">
      FACT_ACTIVIDADES\Contenedor de bucles For 1\Afiliación mensual Beneficiarios
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fact_actividades-fact_actividades_pqrs" class="md-nav__link">
    <span class="md-ellipsis">
      FACT_ACTIVIDADES\ FACT_ACTIVIDADES_PQRS
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fact_actividades_nps" class="md-nav__link">
    <span class="md-ellipsis">
      FACT_ACTIVIDADES_NPS
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fact_actividades_proteccion" class="md-nav__link">
    <span class="md-ellipsis">
      FACT_ACTIVIDADES_PROTECCION
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fact_actividades_cedesarrollo" class="md-nav__link">
    <span class="md-ellipsis">
      FACT_ACTIVIDADES_CEDESARROLLO
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#actividades-cedesarrollomatricula-mensual-educacion-tecnica" class="md-nav__link">
    <span class="md-ellipsis">
      Actividades Cedesarrollo\Matricula Mensual Educacion Tecnica
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#actividades-cedesarrollofacturacion-tecnica-y-continua" class="md-nav__link">
    <span class="md-ellipsis">
      Actividades Cedesarrollo\Facturacion Tecnica y Continua
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#actividades-colegiofact_actividades_colegio" class="md-nav__link">
    <span class="md-ellipsis">
      Actividades Colegio\FACT_ACTIVIDADES_COLEGIO
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#actividades-colegiomatricula-mensual-colegio" class="md-nav__link">
    <span class="md-ellipsis">
      Actividades Colegio\Matricula Mensual Colegio
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#almacenar-max-actividades" class="md-nav__link">
    <span class="md-ellipsis">
      Almacenar MAX ACTIVIDADES
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#contenedor-de-bucles-para-actividadesactividad-afiliacion" class="md-nav__link">
    <span class="md-ellipsis">
      Contenedor de bucles para Actividades\Actividad Afiliacion
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#almacenar-max-aportes" class="md-nav__link">
    <span class="md-ellipsis">
      Almacenar MAX Aportes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#contenedor-de-bucles-for-1-1aportes-totales" class="md-nav__link">
    <span class="md-ellipsis">
      Contenedor de bucles For 1 1\Aportes Totales
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fact_personal_cubo" class="md-nav__link">
    <span class="md-ellipsis">
      FACT_PERSONAL_CUBO
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fact_evaluacion_docente_cubo" class="md-nav__link">
    <span class="md-ellipsis">
      FACT_EVALUACION_DOCENTE_CUBO
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fact_financiera_cubo" class="md-nav__link">
    <span class="md-ellipsis">
      FACT_FINANCIERA_CUBO
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#procesar-fact_unidadescobertura-proyectada" class="md-nav__link">
    <span class="md-ellipsis">
      Procesar FACT_UNIDADES\Cobertura Proyectada
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#procesar-fact_unidadessaber-11-individual" class="md-nav__link">
    <span class="md-ellipsis">
      Procesar FACT_UNIDADES\Saber 11 Individual
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#procesar-fact_unidadessaber-11-colegio" class="md-nav__link">
    <span class="md-ellipsis">
      Procesar FACT_UNIDADES\Saber 11 Colegio
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#procesar-fact_unidadesdesercion-aipi-y-jec" class="md-nav__link">
    <span class="md-ellipsis">
      Procesar FACT_UNIDADES\Desercion AIPI y JEC
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#procesar-fact_unidadesevaluacion-curricular-cedesarrollo" class="md-nav__link">
    <span class="md-ellipsis">
      Procesar FACT_UNIDADES\Evaluacion Curricular Cedesarrollo
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#procesar-fact_unidadesdocumentos-completos-cedesarrollo" class="md-nav__link">
    <span class="md-ellipsis">
      Procesar FACT_UNIDADES\Documentos Completos Cedesarrollo
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fact_mineriamineria_colegiotruncar-tabla" class="md-nav__link">
    <span class="md-ellipsis">
      FACT_MINERIA\MINERIA_COLEGIO\Truncar Tabla
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fact_mineriamineria_colegioproceso-matricula-temporal" class="md-nav__link">
    <span class="md-ellipsis">
      FACT_MINERIA\MINERIA_COLEGIO\Proceso Matrícula (Temporal)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fact_mineriamineria_colegiogestion-matriculas" class="md-nav__link">
    <span class="md-ellipsis">
      FACT_MINERIA\MINERIA_COLEGIO\Gestion Matriculas
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fact_mineriamineria_colegiopagos-matriculas" class="md-nav__link">
    <span class="md-ellipsis">
      FACT_MINERIA\MINERIA_COLEGIO\Pagos Matriculas
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fact_mineriamineria_colegiopqrs-colegio" class="md-nav__link">
    <span class="md-ellipsis">
      FACT_MINERIA\MINERIA_COLEGIO\PQRs Colegio
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fact_mineriamineria_educacion_tecnica_y_continuainscripcion" class="md-nav__link">
    <span class="md-ellipsis">
      FACT_MINERIA\MINERIA_EDUCACION_TECNICA_Y_CONTINUA\Inscripcion
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fact_mineriamineria_educacion_tecnica_y_continuaadmision" class="md-nav__link">
    <span class="md-ellipsis">
      FACT_MINERIA\MINERIA_EDUCACION_TECNICA_Y_CONTINUA\Admision
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fact_mineriamineria_educacion_tecnica_y_continuapago" class="md-nav__link">
    <span class="md-ellipsis">
      FACT_MINERIA\MINERIA_EDUCACION_TECNICA_Y_CONTINUA\Pago
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fact_mineriamineria_educacion_tecnica_y_continuapqrs" class="md-nav__link">
    <span class="md-ellipsis">
      FACT_MINERIA\MINERIA_EDUCACION_TECNICA_Y_CONTINUA\PQRs
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



  <h1>03. ETL</h1>

<!-- markdownlint-disable -->

<p>El paquete SSIS <strong><code>09-ETLS_CUBO</code></strong> está diseñado para extraer, transformar y cargar (ETL) datos de diversas áreas operativas de Comfenalco en el Data Warehouse <strong><code>DWH_COMFENALCO</code></strong>. Su objetivo principal es consolidar información detallada sobre afiliaciones, interacciones (PQRS, NPS) y actividades específicas de diferentes unidades de negocio (Protección, Cedesarrollo, Colegio) en tablas centrales como <strong><code>FACT_ACTIVIDADES</code></strong> y <strong><code>STG_FACT_AFILIACIONES</code></strong>, facilitando así el análisis integral y la generación de inteligencia de negocio.</p>
<hr />
<h2 id="proposito-del-paquete">Propósito del Paquete<a class="headerlink" href="#proposito-del-paquete" title="Permanent link">&para;</a></h2>
<p>Integrar datos operativos dispersos para construir una visión unificada y mensualizada de las actividades y afiliaciones. Esto permite realizar análisis transversales, seguimiento de indicadores clave, caracterización de poblaciones y soporte a decisiones estratégicas en las distintas áreas de servicio de la organización.</p>
<h2 id="descripcion-del-paquete-ssis-09-etls_cubo">Descripción del Paquete SSIS "09-ETLS_CUBO"<a class="headerlink" href="#descripcion-del-paquete-ssis-09-etls_cubo" title="Permanent link">&para;</a></h2>
<p>El paquete sigue un flujo estructurado para garantizar la calidad y consistencia de los datos cargados en el Data Warehouse:</p>
<h3 id="1-preparacion-del-entorno-analitico">1. Preparación del Entorno Analítico<a class="headerlink" href="#1-preparacion-del-entorno-analitico" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>Truncar Tablas de Destino y Staging</strong>:
  Se ejecutan tareas SQL (<code>Truncar Tablas Cubo</code>) para limpiar tablas clave antes de la carga, incluyendo:</li>
<li><code>FACT_UNIDADES</code>, <code>FACT_ACTIVIDADES</code>, <code>FACT_EVALUACION_DOCENTE</code>, <code>FACT_FINANCIERA</code>, <code>FACT_PERSONAL</code>, <code>FACT_MINERIA</code></li>
<li><code>DIM_TIEMPO_MENSUAL</code></li>
<li><code>STG_FACT_AFILIACIONES</code>
  Esto asegura que no haya datos residuales de ejecuciones anteriores y optimiza la carga.</li>
<li><strong>Cargar Dimensión de Tiempo Mensual</strong>:
  Se puebla la tabla <code>DIM_TIEMPO_MENSUAL</code> (<code>DIM_TIEMPO_MENSUAL</code>) extrayendo y transformando datos de la dimensión de tiempo general (<code>DIM_TIEMPO</code>), asegurando una granularidad mensual consistente para los análisis.</li>
</ul>
<h3 id="2-construccion-del-staging-de-afiliaciones-stg_fact_afiliaciones">2. Construcción del Staging de Afiliaciones (<code>STG_FACT_AFILIACIONES</code>)<a class="headerlink" href="#2-construccion-del-staging-de-afiliaciones-stg_fact_afiliaciones" title="Permanent link">&para;</a></h3>
<p>Esta tabla temporal es crucial para enriquecer posteriormente la tabla <code>FACT_ACTIVIDADES</code>. Se carga en etapas:</p>
<ul>
<li><strong>Afiliación Mensual Empresas</strong>:
  Se extraen datos de <code>DIM_EMPRESAS</code>, se ajustan las fechas de afiliación/retiro a los límites de <code>DIM_TIEMPO_MENSUAL</code> y se cargan las empresas vigentes en <code>STG_FACT_AFILIACIONES</code>.</li>
<li><strong>Afiliación Mensual Afiliados</strong>:
  Dentro de un bucle (<code>Contenedor de bucles For</code>), se procesan los afiliados (<code>DIM_AFILIADOS</code>) en lotes de 100,000 (controlado por <code>User::MaxIterationAfil</code>). Para cada afiliado vigente, se genera un registro por cada mes de actividad en los últimos 3 años, calculando edad y asociando la empresa aportante, cargándose en <code>STG_FACT_AFILIACIONES</code>.</li>
<li><strong>Afiliación Mensual Beneficiarios</strong>:
  Similar al proceso de afiliados, se procesan los beneficiarios (<code>DIM_BENEFICIARIOS</code>) en lotes de 100,000 (controlado por <code>User::MaxIterationBene</code> dentro de <code>Contenedor de bucles For 1</code>). Se genera un registro mensual por beneficiario vigente, se calcula la edad, se intenta asignar categoría del afiliado asociado (o por defecto 'D') y se carga en <code>STG_FACT_AFILIACIONES</code>.</li>
</ul>
<h3 id="3-consolidacion-en-la-tabla-de-hechos-principal-fact_actividades">3. Consolidación en la Tabla de Hechos Principal (<code>FACT_ACTIVIDADES</code>)<a class="headerlink" href="#3-consolidacion-en-la-tabla-de-hechos-principal-fact_actividades" title="Permanent link">&para;</a></h3>
<p>Diversos flujos de datos cargan información específica de diferentes áreas, enriqueciéndola con datos de <code>STG_FACT_AFILIACIONES</code> y otras dimensiones:</p>
<ul>
<li><strong>PQRS (<code>FACT_ACTIVIDADES_PQRS</code>)</strong>:
  Unifica PQRS de afiliados, beneficiarios, empresas y no aportantes desde <code>FACT_PQRS</code>. Calcula edad, asigna categoría (o valor por defecto) y normaliza la fecha a nivel mensual antes de cargar en <code>FACT_ACTIVIDADES</code>.</li>
<li><strong>NPS (<code>FACT_ACTIVIDADES_NPS</code>)</strong>:
  Carga datos de encuestas NPS (<code>FACT_ENCUESTAS</code>), enriqueciéndolos con información demográfica y de afiliación obtenida cruzando con dimensiones y <code>STG_FACT_AFILIACIONES</code>.</li>
<li><strong>Protección (<code>FACT_ACTIVIDADES_PROTECCION</code>)</strong>:
  Consolida actividades del área de Protección (Ventas, Caracterización, Deserción, Entrega de Material) desde tablas del esquema <code>Proteccion</code>. Unifica, enriquece con datos poblacionales y afiliatorios (<code>STG_FACT_AFILIACIONES</code>), y carga en <code>FACT_ACTIVIDADES</code>.</li>
<li><strong>Cedesarrollo (<code>FACT_ACTIVIDADES_CEDESARROLLO</code>, <code>Matricula Mensual Educacion Tecnica</code>, <code>Facturacion Tecnica y Continua</code>)</strong>:
  Integra múltiples hechos de Cedesarrollo (Graduados, Inasistencias, Matrículas, Cotizaciones, Facturación, etc.) desde tablas del esquema <code>Cedesarrollo</code>. Normaliza a nivel mensual, enriquece con datos demográficos (<code>STG_FACT_AFILIACIONES</code>) y carga en <code>FACT_ACTIVIDADES</code>. Incluye flujos específicos para matrícula técnica y facturación.</li>
<li><strong>Colegio (<code>FACT_ACTIVIDADES_COLEGIO</code>)</strong>:
  Consolida una amplia gama de actividades escolares (Matrícula, Facturación, Transporte, Biblioteca, Enfermería, Psicorientación, Retiros) desde diversas fuentes del dominio Colegio. Enriquece con datos de afiliación y poblacionales antes de cargar en <code>FACT_ACTIVIDADES</code>.</li>
</ul>
<h2 id="diagramas">Diagramas<a class="headerlink" href="#diagramas" title="Permanent link">&para;</a></h2>
<h3 id="1-diagrama-de-flujo-general">1. <strong>Diagrama de Flujo General</strong><a class="headerlink" href="#1-diagrama-de-flujo-general" title="Permanent link">&para;</a></h3>
<pre class="mermaid"><code>graph TD
  subgraph Preparación
    A[Truncar Tablas Cubo] --&gt; B[Cargar DIM_TIEMPO_MENSUAL]
  end

  subgraph Staging Afiliaciones
    C[Afiliación Empresas] --&gt; F[STG_FACT_AFILIACIONES]
    D[Afiliación Afiliados Bucle] --&gt; F
    E[Afiliación Beneficiarios Bucle] --&gt; F
  end

  subgraph Carga FACT_ACTIVIDADES
    G[Carga PQRS] --&gt; Z[FACT_ACTIVIDADES]
    H[Carga NPS] --&gt; Z
    I[Carga Protección] --&gt; Z
    J[Carga Cedesarrollo] --&gt; Z
    K[Carga Colegio] --&gt; Z
  end

  B --&gt; C
  B --&gt; D
  B --&gt; E
  F --&gt; G
  F --&gt; H
  F --&gt; I
  F --&gt; J
  F --&gt; K

  %% Dependencias adicionales (simplificado)
  B --&gt; G
  B --&gt; H
  B --&gt; I
  B --&gt; J
</code></pre>
<h3 id="2-modelo-de-datos-simplificado-foco-en-fact_actividades">2. <strong>Modelo de Datos Simplificado (Foco en FACT_ACTIVIDADES)</strong><a class="headerlink" href="#2-modelo-de-datos-simplificado-foco-en-fact_actividades" title="Permanent link">&para;</a></h3>
<pre class="mermaid"><code>erDiagram
  FACT_ACTIVIDADES {
    int ID_Actividad PK
    int ID_FECHA FK
    string PARTNER
    int ID_AFILIADO FK
    int ID_BENEFICIARIO FK
    int ID_EMPRESA FK
    int ID_UNIDAD FK
    string ACTIVIDAD
    int ID_CATEGORIA
    int EDAD
    int ID_GENERO FK
    decimal VALOR_PAGADO
    int CALIFICACION_NPS
    string FUENTE_PRINCIPAL
    string TIPO_POBLACION
    string ESTADOREGISTRO
    string PARTNER_AFILIADO
    string PARTNER_EMPRESA
    int DISCAPACIDAD
    int ID_CURSO FK
    int ID_PROGRAMA FK
    int ID_TARIFA FK
    string ESTADO_PQR
    string CAUSA_PQR
    string SERVICIO_TRANSPORTE
    int ID_GRADO
    int ANIO_ACADEMICO
    %% Otros campos específicos de cada actividad
  }

  DIM_TIEMPO_MENSUAL {
    int ID_FECHA PK
    date FECHA
    string DESC_MES
    int ID_ANIO
    %% Otros atributos temporales
  }

  STG_FACT_AFILIACIONES {
    string PARTNER
    int ID_FECHA
    int ID_AFILIADO
    int ID_BENEFICIARIO
    int ID_EMPRESA
    int ID_CATEGORIA
    int EDAD
    int ID_GENERO
    date FECHA_NACIMIENTO
    int DISCAPACIDAD
    string PARTNER_AFILIADO
    string PARTNER_EMPRESA
    string TIPO_POBLACION
    string ACTIVIDAD
    %% Otros campos de afiliación
  }

  DIM_AFILIADOS {
    int ID_AFILIADO PK
    string PARTNER
    int ID_CATEGORIA
    int ID_GENERO
    %% Otros atributos
  }

  DIM_BENEFICIARIOS {
    int ID_BENEFICIARIO PK
    string PARTNER
    int ID_AFILIADO FK
    %% Otros atributos
  }

  DIM_EMPRESAS {
    int ID_EMPRESA PK
    string PARTNER
    %% Otros atributos
  }

  DIM_UNIDAD {
    int ID_UNIDAD PK
    string NOMBRE_UNIDAD
  }

  FACT_ACTIVIDADES ||--o{ DIM_TIEMPO_MENSUAL : "tiene fecha"
  FACT_ACTIVIDADES ||--o{ DIM_AFILIADOS : "relacionado con"
  FACT_ACTIVIDADES ||--o{ DIM_BENEFICIARIOS : "relacionado con"
  FACT_ACTIVIDADES ||--o{ DIM_EMPRESAS : "relacionado con"
  FACT_ACTIVIDADES ||--o{ DIM_UNIDAD : "pertenece a"
  FACT_ACTIVIDADES ||--o{ STG_FACT_AFILIACIONES : "enriquecido por" 

</code></pre>
<h2 id="componentes">Componentes<a class="headerlink" href="#componentes" title="Permanent link">&para;</a></h2>
<h3 id="truncar-tablas-cubo"><strong>Truncar Tablas Cubo</strong><a class="headerlink" href="#truncar-tablas-cubo" title="Permanent link">&para;</a></h3>
<p>El componente <strong><code>Truncar Tablas Cubo</code></strong> forma parte del paquete SSIS <strong><code>09-ETLS_CUBO</code></strong> y está diseñado para truncar tablas específicas dentro del Data Warehouse <strong><code>DWH_COMFENALCO</code></strong> y otras áreas asociadas. Este proceso de truncado se realiza para limpiar las tablas de hechos y staging antes de realizar la carga de nuevos datos, garantizando que las tablas estén listas para recibir la información más actualizada.</p>
<hr />
<h4 id="descripcion-general"><strong>Descripción General</strong><a class="headerlink" href="#descripcion-general" title="Permanent link">&para;</a></h4>
<p>El componente <strong><code>Truncar Tablas Cubo</code></strong> es una tarea de ejecución de SQL que elimina todos los datos de las tablas de hechos y staging. Este proceso es crítico para mantener la integridad de los datos, eliminando información obsoleta o errónea antes de realizar cargas de nuevos registros.</p>
<hr />
<h4 id="ubicacion-en-el-paquete"><strong>Ubicación en el Paquete</strong><a class="headerlink" href="#ubicacion-en-el-paquete" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>Paquete</strong>: <strong><code>09-ETLS_CUBO</code></strong></li>
<li><strong>Tarea</strong>: <strong><code>Truncar Tablas Cubo</code></strong></li>
<li><strong>Componente</strong>: <strong><code>Microsoft.ExecuteSQLTask</code></strong></li>
</ul>
<hr />
<h4 id="proposito"><strong>Propósito</strong><a class="headerlink" href="#proposito" title="Permanent link">&para;</a></h4>
<p>El propósito de este componente es truncar las siguientes tablas para eliminar los registros previos antes de proceder con la inserción de datos nuevos:</p>
<ul>
<li>
<p><strong>Tablas a truncar</strong>:</p>
<ul>
<li><strong><code>FACT_UNIDADES</code></strong></li>
<li><strong><code>FACT_ACTIVIDADES</code></strong></li>
<li><strong><code>FACT_EVALUACION_DOCENTE</code></strong></li>
<li><strong><code>FACT_FINANCIERA</code></strong></li>
<li><strong><code>FACT_PERSONAL</code></strong></li>
<li><strong><code>FACT_MINERIA</code></strong></li>
<li><strong><code>DIM_TIEMPO_MENSUAL</code></strong></li>
<li><strong><code>STG_FACT_AFILIACIONES</code></strong></li>
</ul>
</li>
</ul>
<hr />
<h4 id="detalles-de-implementacion"><strong>Detalles de Implementación</strong><a class="headerlink" href="#detalles-de-implementacion" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>Componente SSIS</strong>: <strong><code>Microsoft.ExecuteSQLTask</code></strong></li>
<li><strong>Conexión</strong>: La tarea está configurada para utilizar la conexión <strong><code>{29BC876E-1EAF-4F6F-8F38-39B8E881EEB6}</code></strong>, que corresponde al <strong><code>DWH_COMFENALCO</code></strong>.</li>
</ul>
<hr />
<h4 id="logica-de-negocio"><strong>Lógica de Negocio</strong><a class="headerlink" href="#logica-de-negocio" title="Permanent link">&para;</a></h4>
<p>El SQL ejecutado dentro de este componente realiza un <strong><code>TRUNCATE TABLE</code></strong> en las tablas especificadas, eliminando todos los datos sin realizar un registro en el log de transacciones. Esto mejora la eficiencia en la limpieza de datos cuando se necesita realizar un proceso de carga completa en el cubo.</p>
<hr />
<h4 id="relacion-con-otros-componentes"><strong>Relación con Otros Componentes</strong><a class="headerlink" href="#relacion-con-otros-componentes" title="Permanent link">&para;</a></h4>
<p>Este componente se ejecuta típicamente antes de cargar los datos en el cubo o en las tablas de hechos. Tras el truncado, otros componentes de carga como el que inserta las nuevas filas en las tablas de hechos o staging se encargan de rellenar las tablas con la información más reciente.</p>
<hr />
<h4 id="script-sql"><strong>Script SQL</strong><a class="headerlink" href="#script-sql" title="Permanent link">&para;</a></h4>
<p>El script SQL ejecutado por este componente es el siguiente:</p>
<div class="highlight"><pre><span></span><code><span class="k">TRUNCATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Transversal</span><span class="p">].[</span><span class="n">FACT_UNIDADES</span><span class="p">];</span>
<span class="k">TRUNCATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Transversal</span><span class="p">].[</span><span class="n">FACT_ACTIVIDADES</span><span class="p">];</span>
<span class="k">TRUNCATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Transversal</span><span class="p">].[</span><span class="n">FACT_EVALUACION_DOCENTE</span><span class="p">];</span>
<span class="k">TRUNCATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Transversal</span><span class="p">].[</span><span class="n">FACT_FINANCIERA</span><span class="p">];</span>
<span class="k">TRUNCATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Transversal</span><span class="p">].[</span><span class="n">FACT_PERSONAL</span><span class="p">];</span>
<span class="k">TRUNCATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Transversal</span><span class="p">].[</span><span class="n">FACT_MINERIA</span><span class="p">];</span>
<span class="k">TRUNCATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Transversal</span><span class="p">].[</span><span class="n">DIM_TIEMPO_MENSUAL</span><span class="p">];</span>
<span class="k">TRUNCATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="p">[</span><span class="n">STAGE_AREA</span><span class="p">].[</span><span class="n">Transversal</span><span class="p">].[</span><span class="n">STG_FACT_AFILIACIONES</span><span class="p">];</span>
</code></pre></div>
<h3 id="dim_tiempo_mensual"><strong>DIM_TIEMPO_MENSUAL</strong><a class="headerlink" href="#dim_tiempo_mensual" title="Permanent link">&para;</a></h3>
<p>El componente <strong><code>DIM_TIEMPO_MENSUAL</code></strong> forma parte del paquete SSIS <strong><code>09-ETLS_CUBO</code></strong> y está diseñado para cargar los datos de la dimensión temporal a nivel mensual en la tabla <strong><code>DIM_TIEMPO_MENSUAL</code></strong> del Data Warehouse <strong><code>DWH_COMFENALCO</code></strong>. Su principal función es extraer datos desde la tabla de tiempo de la base de datos de origen y cargar esos datos en el destino correspondiente para su posterior análisis en el cubo OLAP.</p>
<hr />
<h4 id="descripcion-general_1"><strong>Descripción General</strong><a class="headerlink" href="#descripcion-general_1" title="Permanent link">&para;</a></h4>
<p>El componente <strong><code>DIM_TIEMPO_MENSUAL</code></strong> es una tarea de flujo de datos (Data Flow Task) que realiza la extracción y transformación de los datos de tiempo. Utiliza la instrucción SQL para extraer las fechas y los valores asociados (mes, trimestre, semestre, etc.), transformarlos según sea necesario, y luego cargarlos en la tabla <strong><code>DIM_TIEMPO_MENSUAL</code></strong>.</p>
<hr />
<h4 id="ubicacion-en-el-paquete_1"><strong>Ubicación en el Paquete</strong><a class="headerlink" href="#ubicacion-en-el-paquete_1" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>Paquete</strong>: <strong><code>09-ETLS_CUBO</code></strong></li>
<li><strong>Tarea</strong>: <strong><code>DIM_TIEMPO_MENSUAL</code></strong></li>
<li><strong>Componente</strong>: <strong><code>Microsoft.Pipeline</code></strong> (Data Flow Task)</li>
</ul>
<hr />
<h4 id="proposito_1"><strong>Propósito</strong><a class="headerlink" href="#proposito_1" title="Permanent link">&para;</a></h4>
<p>El propósito del componente <strong><code>DIM_TIEMPO_MENSUAL</code></strong> es extraer datos de la tabla <strong><code>DIM_TIEMPO</code></strong> del <strong><code>DWH_COMFENALCO</code></strong>, transformar la información y cargarla en la tabla de destino <strong><code>DIM_TIEMPO_MENSUAL</code></strong>. Los datos que se extraen incluyen información relacionada con las fechas, tales como el mes, trimestre, semestre y año.</p>
<hr />
<h4 id="detalles-de-implementacion_1"><strong>Detalles de Implementación</strong><a class="headerlink" href="#detalles-de-implementacion_1" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p><strong>Origen de Datos</strong>:
  Los datos se extraen de la tabla <strong><code>[DWH_COMFENALCO].[Dwh].[DIM_TIEMPO]</code></strong>, utilizando una consulta SQL para obtener las fechas y sus descripciones.</p>
</li>
<li>
<p><strong>Destino de Carga</strong>:
  Los datos extraídos se cargan en la tabla <strong><code>[DWH_COMFENALCO].[Transversal].[DIM_TIEMPO_MENSUAL]</code></strong>.</p>
</li>
<li>
<p><strong>Conexión</strong>:
  Utiliza la conexión <strong><code>{29BC876E-1EAF-4F6F-8F38-39B8E881EEB6}:external</code></strong> para conectar con la base de datos <strong><code>DWH_COMFENALCO</code></strong>.</p>
</li>
</ul>
<hr />
<h4 id="logica-de-negocio_1"><strong>Lógica de Negocio</strong><a class="headerlink" href="#logica-de-negocio_1" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p><strong>Transformación</strong>:
  Los datos son extraídos con una consulta SQL que obtiene las fechas del primer día de cada mes y otros atributos relacionados como el ID de semana, mes, trimestre, semestre, año, etc.</p>
</li>
<li>
<p><strong>Carga de Datos</strong>:
  Los datos transformados se cargan en la tabla de destino utilizando <strong>ADO.NET Destination</strong>, lo que permite una carga eficiente de datos a través de la conexión OLE DB.</p>
</li>
</ul>
<hr />
<h4 id="relacion-con-otros-componentes_1"><strong>Relación con Otros Componentes</strong><a class="headerlink" href="#relacion-con-otros-componentes_1" title="Permanent link">&para;</a></h4>
<ul>
<li>Este componente se ejecuta después de que los datos han sido transformados en otras tareas y se asegura de que los datos de la dimensión de tiempo estén disponibles en la tabla <strong><code>DIM_TIEMPO_MENSUAL</code></strong> para ser utilizados en los cubos OLAP y otros análisis.</li>
</ul>
<hr />
<h4 id="script-sql-de-extraccion"><strong>Script SQL de Extracción</strong><a class="headerlink" href="#script-sql-de-extraccion" title="Permanent link">&para;</a></h4>
<p>La instrucción SQL utilizada para extraer los datos es la siguiente (incluida en el componente <strong>Origen de ADO NET</strong>):</p>
<div class="highlight"><pre><span></span><code><span class="k">WITH</span><span class="w"> </span><span class="n">FechasPrimerDiaMes</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="k">SELECT</span><span class="w"> </span>
<span class="w">        </span><span class="p">[</span><span class="n">ID_FECHA</span><span class="p">],</span>
<span class="w">        </span><span class="p">[</span><span class="n">FECHA</span><span class="p">],</span>
<span class="w">        </span><span class="p">[</span><span class="n">DESC_FECHA</span><span class="p">],</span>
<span class="w">        </span><span class="p">[</span><span class="n">ID_SEMANA</span><span class="p">],</span>
<span class="w">        </span><span class="p">[</span><span class="n">DESC_SEMANA</span><span class="p">],</span>
<span class="w">        </span><span class="p">[</span><span class="n">ID_NO_MES</span><span class="p">],</span>
<span class="w">        </span><span class="p">[</span><span class="n">DESC_NO_MES</span><span class="p">],</span>
<span class="w">        </span><span class="p">[</span><span class="n">ID_MES</span><span class="p">],</span>
<span class="w">        </span><span class="p">[</span><span class="n">DESC_MES</span><span class="p">],</span>
<span class="w">        </span><span class="p">[</span><span class="n">DESC_MES_CORTA</span><span class="p">],</span>
<span class="w">        </span><span class="p">[</span><span class="n">ID_BIMESTRE</span><span class="p">],</span>
<span class="w">        </span><span class="p">[</span><span class="n">DESC_BIMESTRE</span><span class="p">],</span>
<span class="w">        </span><span class="p">[</span><span class="n">ID_TRIMESTRE</span><span class="p">],</span>
<span class="w">        </span><span class="p">[</span><span class="n">DESC_TRIMESTRE</span><span class="p">],</span>
<span class="w">        </span><span class="p">[</span><span class="n">ID_CUATRIMESTRE</span><span class="p">],</span>
<span class="w">        </span><span class="p">[</span><span class="n">DESC_CUATRIMESTRE</span><span class="p">],</span>
<span class="w">        </span><span class="p">[</span><span class="n">ID_SEMESTRE</span><span class="p">],</span>
<span class="w">        </span><span class="p">[</span><span class="n">DESC_SEMESTRE</span><span class="p">],</span>
<span class="w">        </span><span class="p">[</span><span class="n">ID_ANIO</span><span class="p">],</span>
<span class="w">        </span><span class="p">[</span><span class="n">ID_ANIO_ANT</span><span class="p">],</span>
<span class="w">        </span><span class="p">[</span><span class="n">NUM_DIA_SEMANA</span><span class="p">],</span>
<span class="w">        </span><span class="p">[</span><span class="n">FESTIVO</span><span class="p">],</span>
<span class="w">        </span><span class="p">[</span><span class="n">FECHA_CORTA</span><span class="p">]</span>
<span class="w">    </span><span class="k">FROM</span><span class="w"> </span>
<span class="w">        </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Dwh</span><span class="p">].[</span><span class="n">DIM_TIEMPO</span><span class="p">]</span>
<span class="w">    </span><span class="k">WHERE</span><span class="w"> </span>
<span class="w">        </span><span class="n">DATEPART</span><span class="p">(</span><span class="k">DAY</span><span class="p">,</span><span class="w"> </span><span class="n">FECHA</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span>
<span class="w">        </span><span class="k">AND</span><span class="w"> </span><span class="n">ID_ANIO</span><span class="w"> </span><span class="k">BETWEEN</span><span class="w"> </span><span class="n">DATEPART</span><span class="p">(</span><span class="k">YEAR</span><span class="p">,</span><span class="w"> </span><span class="n">GETDATE</span><span class="p">())</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">DATEPART</span><span class="p">(</span><span class="k">YEAR</span><span class="p">,</span><span class="w"> </span><span class="n">GETDATE</span><span class="p">())</span>
<span class="p">)</span>
<span class="k">SELECT</span><span class="w"> </span>
<span class="w">    </span><span class="p">[</span><span class="n">ID_FECHA</span><span class="p">],</span>
<span class="w">    </span><span class="p">[</span><span class="n">FECHA</span><span class="p">],</span>
<span class="w">    </span><span class="p">[</span><span class="n">DESC_FECHA</span><span class="p">],</span>
<span class="w">    </span><span class="p">[</span><span class="n">ID_SEMANA</span><span class="p">],</span>
<span class="w">    </span><span class="p">[</span><span class="n">DESC_SEMANA</span><span class="p">],</span>
<span class="w">    </span><span class="p">[</span><span class="n">ID_NO_MES</span><span class="p">],</span>
<span class="w">    </span><span class="p">[</span><span class="n">DESC_NO_MES</span><span class="p">],</span>
<span class="w">    </span><span class="p">[</span><span class="n">ID_MES</span><span class="p">],</span>
<span class="w">    </span><span class="p">[</span><span class="n">DESC_MES</span><span class="p">],</span>
<span class="w">    </span><span class="p">[</span><span class="n">DESC_MES_CORTA</span><span class="p">],</span>
<span class="w">    </span><span class="p">[</span><span class="n">ID_BIMESTRE</span><span class="p">],</span>
<span class="w">    </span><span class="p">[</span><span class="n">DESC_BIMESTRE</span><span class="p">],</span>
<span class="w">    </span><span class="p">[</span><span class="n">ID_TRIMESTRE</span><span class="p">],</span>
<span class="w">    </span><span class="p">[</span><span class="n">DESC_TRIMESTRE</span><span class="p">],</span>
<span class="w">    </span><span class="p">[</span><span class="n">ID_CUATRIMESTRE</span><span class="p">],</span>
<span class="w">    </span><span class="p">[</span><span class="n">DESC_CUATRIMESTRE</span><span class="p">],</span>
<span class="w">    </span><span class="p">[</span><span class="n">ID_SEMESTRE</span><span class="p">],</span>
<span class="w">    </span><span class="p">[</span><span class="n">DESC_SEMESTRE</span><span class="p">],</span>
<span class="w">    </span><span class="p">[</span><span class="n">ID_ANIO</span><span class="p">],</span>
<span class="w">    </span><span class="p">[</span><span class="n">ID_ANIO_ANT</span><span class="p">],</span>
<span class="w">    </span><span class="p">[</span><span class="n">NUM_DIA_SEMANA</span><span class="p">],</span>
<span class="w">    </span><span class="p">[</span><span class="n">FESTIVO</span><span class="p">],</span>
<span class="w">    </span><span class="p">[</span><span class="n">FECHA_CORTA</span><span class="p">],</span>
<span class="w">    </span><span class="s1">&#39;[DWH_COMFENALCO].[Dwh].[DIM_TIEMPO]&#39;</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="p">[</span><span class="n">FUENTE_PRINCIPAL</span><span class="p">]</span>
<span class="k">FROM</span><span class="w"> </span>
<span class="w">    </span><span class="n">FechasPrimerDiaMes</span>
<span class="k">WHERE</span><span class="w"> </span><span class="p">[</span><span class="n">FECHA</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="s1">&#39;2024-05-01&#39;</span>
<span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="p">[</span><span class="n">FECHA</span><span class="p">];</span>
</code></pre></div>
<p>Nota: El script anterior incluye el periodo de tiempo definido en el alcance del proyecto que corresponde de enero de 2022 a mayo de 2024. Para periodos de información posterior, se cuenta con una actualización compartida en las mesas de trabajo para traer información de las últimas tres vigencias hasta el mes pasado y corresponde al equipo de Analítica de Comfenalco Cartagena realizar el respectivo ajuste.</p>
<h3 id="afiliacion-mensual-empresas"><strong>Afiliación mensual Empresas</strong><a class="headerlink" href="#afiliacion-mensual-empresas" title="Permanent link">&para;</a></h3>
<p>El componente <strong><code>Afiliación mensual Empresas</code></strong> forma parte del paquete SSIS <strong><code>FACT_ACTIVIDADES</code></strong> y está diseñado para procesar y cargar información de afiliación mensual de empresas en el Data Warehouse <strong><code>DWH_COMFENALCO</code></strong>. Esta tarea se encarga de extraer los datos de las empresas y su afiliación desde las tablas de origen, realizar las transformaciones necesarias, y luego cargar estos datos en la tabla de destino correspondiente en la base de datos.</p>
<hr />
<h4 id="descripcion-general_2"><strong>Descripción General</strong><a class="headerlink" href="#descripcion-general_2" title="Permanent link">&para;</a></h4>
<p>El componente <strong><code>Afiliación mensual Empresas</code></strong> es una tarea de flujo de datos (Data Flow Task) que maneja el proceso de extracción, transformación y carga (ETL) de datos relacionados con las afiliaciones mensuales de empresas. Los datos extraídos incluyen información detallada de las empresas y su afiliación, como el estado, fecha de afiliación, fecha de retiro, y otros atributos relevantes.</p>
<hr />
<h4 id="ubicacion-en-el-paquete_2"><strong>Ubicación en el Paquete</strong><a class="headerlink" href="#ubicacion-en-el-paquete_2" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>Paquete</strong>: <strong><code>FACT_ACTIVIDADES</code></strong></li>
<li><strong>Tarea</strong>: <strong><code>Afiliación mensual Empresas</code></strong></li>
<li><strong>Componente</strong>: <strong><code>Microsoft.Pipeline</code></strong></li>
</ul>
<hr />
<h4 id="proposito_2"><strong>Propósito</strong><a class="headerlink" href="#proposito_2" title="Permanent link">&para;</a></h4>
<p>El propósito de este componente es procesar la información de afiliación mensual de empresas, extraerla de las fuentes correspondientes, transformarla según las reglas de negocio definidas y cargarla en la tabla de destino <strong><code>STG_FACT_AFILIACIONES</code></strong> en la base de datos <strong><code>DWH_COMFENALCO</code></strong>.</p>
<hr />
<h4 id="detalles-de-implementacion_2"><strong>Detalles de Implementación</strong><a class="headerlink" href="#detalles-de-implementacion_2" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>Componente SSIS</strong>: <strong><code>Microsoft.Pipeline</code></strong></li>
<li><strong>Conexión</strong>: Utiliza la conexión <strong><code>STAGE_AREA</code></strong>, gestionada a través del administrador de conexiones de SSIS.</li>
</ul>
<hr />
<h4 id="logica-de-negocio_2"><strong>Lógica de Negocio</strong><a class="headerlink" href="#logica-de-negocio_2" title="Permanent link">&para;</a></h4>
<p>Este componente realiza las siguientes operaciones principales:</p>
<ol>
<li><strong>Extracción de Datos</strong>: Se extraen los datos de la tabla <strong><code>DIM_EMPRESAS</code></strong> en el esquema <strong><code>Aportes</code></strong> de <strong><code>DWH_COMFENALCO</code></strong>.</li>
<li>
<p><strong>Transformación de Datos</strong>:</p>
<ul>
<li>Las fechas de afiliación y retiro se ajustan a las fechas mínimas y máximas en la tabla <strong><code>DIM_TIEMPO_MENSUAL</code></strong>.</li>
<li>Se asegura de que solo se consideren las empresas cuyo estado sea <strong><code>VIGEN</code></strong> y cuyo estado de registro sea <strong><code>CURRENT</code></strong>.</li>
</ul>
</li>
<li>
<p><strong>Carga de Datos</strong>: Los datos transformados se cargan en la tabla <strong><code>STG_FACT_AFILIACIONES</code></strong> en el esquema <strong><code>Transversal</code></strong>.</p>
</li>
</ol>
<hr />
<h4 id="relacion-con-otros-componentes_2"><strong>Relación con Otros Componentes</strong><a class="headerlink" href="#relacion-con-otros-componentes_2" title="Permanent link">&para;</a></h4>
<p>Este componente depende de la tabla <strong><code>DIM_EMPRESAS</code></strong> en el esquema <strong><code>Aportes</code></strong> y de la tabla <strong><code>DIM_TIEMPO_MENSUAL</code></strong> en el esquema <strong><code>Transversal</code></strong> para obtener la información de fechas. Además, los datos procesados se cargan en la tabla de destino <strong><code>STG_FACT_AFILIACIONES</code></strong>.</p>
<hr />
<h4 id="script-sql_1"><strong>Script SQL</strong><a class="headerlink" href="#script-sql_1" title="Permanent link">&para;</a></h4>
<p>El componente ejecuta una consulta SQL compleja para extraer, transformar y cargar los datos. El script SQL utilizado es el siguiente:</p>
<div class="highlight"><pre><span></span><code><span class="k">WITH</span><span class="w"> </span><span class="n">MinFecha</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="k">MIN</span><span class="p">(</span><span class="n">FECHA</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">MinFecha</span>
<span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Transversal</span><span class="p">].[</span><span class="n">DIM_TIEMPO_MENSUAL</span><span class="p">]</span>
<span class="p">),</span>
<span class="n">MaxFecha</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="k">MAX</span><span class="p">(</span><span class="n">FECHA</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">MaxFecha</span>
<span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Transversal</span><span class="p">].[</span><span class="n">DIM_TIEMPO_MENSUAL</span><span class="p">]</span>
<span class="p">),</span>
<span class="c1">-- CTE para seleccionar los registros de la empresa</span>
<span class="n">Empresas</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="k">SELECT</span>
<span class="w">        </span><span class="p">[</span><span class="n">ID_EMPRESA</span><span class="p">],</span>
<span class="w">        </span><span class="p">[</span><span class="n">PARTNER</span><span class="p">],</span>
<span class="w">        </span><span class="k">CAST</span><span class="p">([</span><span class="n">FECHA_AFILIACION</span><span class="p">]</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="nb">DATE</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">[</span><span class="n">FECHA_AFILIACION</span><span class="p">],</span>
<span class="w">        </span><span class="p">[</span><span class="n">FECHA_FUNDACION</span><span class="p">],</span>
<span class="w">        </span><span class="k">CAST</span><span class="p">([</span><span class="n">FECHA_RETIRO</span><span class="p">]</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="nb">DATE</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">[</span><span class="n">FECHA_RETIRO</span><span class="p">],</span>
<span class="w">        </span><span class="p">[</span><span class="n">ESTADO</span><span class="p">],</span>
<span class="w">        </span><span class="p">[</span><span class="n">ESTADOREGISTRO</span><span class="p">],</span>
<span class="w">        </span><span class="p">[</span><span class="n">COD_CIUDAD</span><span class="p">]</span>
<span class="w">    </span><span class="k">FROM</span><span class="w"> </span>
<span class="w">        </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Aportes</span><span class="p">].[</span><span class="n">DIM_EMPRESAS</span><span class="p">]</span>
<span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="p">[</span><span class="n">ESTADO</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;VIGEN&#39;</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="p">[</span><span class="n">ESTADOREGISTRO</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;CURRENT&#39;</span><span class="w"> </span>
<span class="p">),</span>
<span class="n">EmpresasOptimizado</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="k">SELECT</span><span class="w"> </span>
<span class="w">        </span><span class="p">[</span><span class="n">ID_EMPRESA</span><span class="p">],</span>
<span class="w">        </span><span class="p">[</span><span class="n">PARTNER</span><span class="p">],</span>
<span class="w">        </span><span class="p">[</span><span class="n">FECHA_FUNDACION</span><span class="p">],</span>
<span class="w">        </span><span class="k">CASE</span><span class="w"> </span>
<span class="w">            </span><span class="k">WHEN</span><span class="w"> </span><span class="p">[</span><span class="n">FECHA_AFILIACION</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="n">MinFecha</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">MinFecha</span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="k">COALESCE</span><span class="p">(</span><span class="k">CAST</span><span class="p">((</span><span class="k">SELECT</span><span class="w"> </span><span class="n">MinFecha</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">MinFecha</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="nb">DATE</span><span class="p">),</span><span class="w"> </span><span class="k">CAST</span><span class="p">(</span><span class="n">GETDATE</span><span class="p">()</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="nb">DATE</span><span class="p">))</span>
<span class="w">            </span><span class="k">ELSE</span><span class="w"> </span><span class="p">[</span><span class="n">FECHA_AFILIACION</span><span class="p">]</span>
<span class="w">        </span><span class="k">END</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">[</span><span class="n">FECHA_AFILIACION</span><span class="p">],</span>
<span class="w">        </span><span class="k">CASE</span><span class="w"> </span>
<span class="w">            </span><span class="k">WHEN</span><span class="w"> </span><span class="p">[</span><span class="n">FECHA_RETIRO</span><span class="p">]</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="n">MaxFecha</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">MaxFecha</span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="k">COALESCE</span><span class="p">(</span><span class="k">CAST</span><span class="p">((</span><span class="k">SELECT</span><span class="w"> </span><span class="n">MaxFecha</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">MaxFecha</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="nb">DATE</span><span class="p">),</span><span class="w"> </span><span class="k">CAST</span><span class="p">(</span><span class="n">GETDATE</span><span class="p">()</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="nb">DATE</span><span class="p">))</span>
<span class="w">            </span><span class="k">ELSE</span><span class="w"> </span><span class="p">[</span><span class="n">FECHA_RETIRO</span><span class="p">]</span>
<span class="w">        </span><span class="k">END</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">[</span><span class="n">FECHA_RETIRO</span><span class="p">],</span>
<span class="w">        </span><span class="p">[</span><span class="n">ESTADOREGISTRO</span><span class="p">],</span>
<span class="w">        </span><span class="p">[</span><span class="n">ESTADO</span><span class="p">],</span>
<span class="w">        </span><span class="p">[</span><span class="n">COD_CIUDAD</span><span class="p">]</span>
<span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">Empresas</span>
<span class="p">),</span>
<span class="c1">-- Seleccionar los registros por mes y hacer el join con DIM_TIEMPO_MENSUAL</span>
<span class="n">EmpresasPorMes</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="k">SELECT</span><span class="w"> </span>
<span class="w">        </span><span class="n">e</span><span class="p">.[</span><span class="n">ID_EMPRESA</span><span class="p">],</span>
<span class="w">        </span><span class="n">e</span><span class="p">.[</span><span class="n">PARTNER</span><span class="p">],</span>
<span class="w">        </span><span class="n">e</span><span class="p">.[</span><span class="n">FECHA_AFILIACION</span><span class="p">],</span>
<span class="w">        </span><span class="n">e</span><span class="p">.[</span><span class="n">FECHA_FUNDACION</span><span class="p">],</span>
<span class="w">        </span><span class="n">e</span><span class="p">.[</span><span class="n">FECHA_RETIRO</span><span class="p">],</span>
<span class="w">        </span><span class="n">e</span><span class="p">.[</span><span class="n">ESTADOREGISTRO</span><span class="p">],</span>
<span class="w">        </span><span class="n">e</span><span class="p">.[</span><span class="n">ESTADO</span><span class="p">],</span>
<span class="w">        </span><span class="n">e</span><span class="p">.[</span><span class="n">COD_CIUDAD</span><span class="p">],</span>
<span class="w">        </span><span class="n">ds</span><span class="p">.</span><span class="n">FECHA_CORTA</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">FECHA_MENSUAL</span><span class="p">,</span>
<span class="w">        </span><span class="n">ds</span><span class="p">.</span><span class="n">ID_FECHA</span><span class="p">,</span>
<span class="w">        </span><span class="mi">5</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_UNIDAD</span>
<span class="w">    </span><span class="k">FROM</span><span class="w"> </span>
<span class="w">        </span><span class="n">EmpresasOptimizado</span><span class="w"> </span><span class="n">e</span>
<span class="w">    </span><span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span>
<span class="w">        </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Transversal</span><span class="p">].[</span><span class="n">DIM_TIEMPO_MENSUAL</span><span class="p">]</span><span class="w"> </span><span class="n">ds</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">ds</span><span class="p">.</span><span class="n">FECHA_CORTA</span><span class="w"> </span><span class="k">BETWEEN</span><span class="w"> </span><span class="n">e</span><span class="p">.[</span><span class="n">FECHA_AFILIACION</span><span class="p">]</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="k">COALESCE</span><span class="p">(</span><span class="n">e</span><span class="p">.[</span><span class="n">FECHA_RETIRO</span><span class="p">],</span><span class="w"> </span><span class="n">GETDATE</span><span class="p">())</span>
<span class="p">)</span>
<span class="k">SELECT</span><span class="w"> </span>
<span class="w">    </span><span class="n">em</span><span class="p">.[</span><span class="n">PARTNER</span><span class="p">],</span>
<span class="w">    </span><span class="n">em</span><span class="p">.[</span><span class="n">ID_EMPRESA</span><span class="p">],</span>
<span class="w">    </span><span class="o">-</span><span class="mi">1</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_AFILIADO</span><span class="p">,</span>
<span class="w">    </span><span class="o">-</span><span class="mi">1</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_TIPO_AFILIADO</span><span class="p">,</span>
<span class="w">    </span><span class="k">NULL</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">TIPO_AFILIADO</span><span class="p">,</span>
<span class="w">    </span><span class="mi">5</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_CATEGORIA</span><span class="p">,</span><span class="w"> </span>
<span class="w">    </span><span class="n">em</span><span class="p">.[</span><span class="n">FECHA_AFILIACION</span><span class="p">],</span>
<span class="w">    </span><span class="n">em</span><span class="p">.[</span><span class="n">FECHA_RETIRO</span><span class="p">],</span>
<span class="w">    </span><span class="o">-</span><span class="mi">1</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_GENERO</span><span class="p">,</span>
<span class="w">    </span><span class="o">-</span><span class="mi">1</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_ESTADO_CIVIL</span><span class="p">,</span>
<span class="w">    </span><span class="o">-</span><span class="mi">1</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_PERTENENCIA_ETNICA</span><span class="p">,</span>
<span class="w">    </span><span class="o">-</span><span class="mi">1</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_FACTOR_VULNERABILIDAD</span><span class="p">,</span>
<span class="w">    </span><span class="k">NULL</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ESTRATO</span><span class="p">,</span>
<span class="w">    </span><span class="n">em</span><span class="p">.[</span><span class="n">COD_CIUDAD</span><span class="p">]</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_CIUDAD</span><span class="p">,</span>
<span class="w">    </span><span class="k">NULL</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">SALARIO_BASICO</span><span class="p">,</span>
<span class="w">    </span><span class="n">em</span><span class="p">.[</span><span class="n">FECHA_MENSUAL</span><span class="p">],</span>
<span class="w">    </span><span class="n">em</span><span class="p">.[</span><span class="n">ID_FECHA</span><span class="p">],</span>
<span class="w">    </span><span class="n">em</span><span class="p">.[</span><span class="n">ID_UNIDAD</span><span class="p">],</span>
<span class="w">    </span><span class="n">em</span><span class="p">.[</span><span class="n">ESTADOREGISTRO</span><span class="p">],</span>
<span class="w">    </span><span class="o">-</span><span class="mi">1</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">PARTNER_AFILIADO</span><span class="p">,</span>
<span class="w">    </span><span class="n">em</span><span class="p">.[</span><span class="n">PARTNER</span><span class="p">]</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">PARTNER_EMPRESA</span><span class="p">,</span>
<span class="w">    </span><span class="s1">&#39;EMPRESA&#39;</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">TIPO_POBLACION</span><span class="p">,</span>
<span class="w">    </span><span class="s1">&#39;AFILIACION&#39;</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ACTIVIDAD</span><span class="p">,</span>
<span class="w">    </span><span class="s1">&#39;[DWH_COMFENALCO].[Aportes].[DIM_EMPRESAS]&#39;</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="p">[</span><span class="n">FUENTE_PRINCIPAL</span><span class="p">]</span>
<span class="k">FROM</span><span class="w"> </span>
<span class="w">    </span><span class="n">EmpresasPorMes</span><span class="w"> </span><span class="n">em</span>
<span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span>
<span class="w">    </span><span class="n">em</span><span class="p">.[</span><span class="n">ID_EMPRESA</span><span class="p">],</span><span class="w"> </span><span class="n">em</span><span class="p">.[</span><span class="n">FECHA_MENSUAL</span><span class="p">];</span>
</code></pre></div>
<h3 id="almacenar-max-afiliados"><strong>Almacenar MAX afiliados</strong><a class="headerlink" href="#almacenar-max-afiliados" title="Permanent link">&para;</a></h3>
<p>El componente <strong><code>Almacenar MAX afiliados</code></strong> es una tarea en el paquete SSIS <strong><code>FACT_ACTIVIDADES</code></strong> que se encarga de almacenar el número máximo de iteraciones para procesar los afiliados, basado en el total de registros que cumplen con ciertos criterios. Esta tarea calcula cuántos lotes de 100,000 registros se necesitarán para procesar todos los afiliados activos en el sistema.</p>
<hr />
<h4 id="descripcion-general_3"><strong>Descripción General</strong><a class="headerlink" href="#descripcion-general_3" title="Permanent link">&para;</a></h4>
<p>El componente <strong><code>Almacenar MAX afiliados</code></strong> ejecuta una consulta SQL para contar el número de registros activos de afiliados en la tabla <strong><code>DIM_AFILIADOS</code></strong>, considerando únicamente aquellos registros cuyo estado es <strong><code>CURRENT</code></strong> y que tienen una fecha válida de afiliación. El resultado de la consulta se utiliza para calcular el número de iteraciones necesarias para procesar a todos los afiliados en lotes de 100,000.</p>
<hr />
<h4 id="ubicacion-en-el-paquete_3"><strong>Ubicación en el Paquete</strong><a class="headerlink" href="#ubicacion-en-el-paquete_3" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>Paquete</strong>: <strong><code>FACT_ACTIVIDADES</code></strong></li>
<li><strong>Tarea</strong>: <strong><code>Almacenar MAX afiliados</code></strong></li>
<li><strong>Componente</strong>: <strong><code>Microsoft.ExecuteSQLTask</code></strong></li>
</ul>
<hr />
<h4 id="proposito_3"><strong>Propósito</strong><a class="headerlink" href="#proposito_3" title="Permanent link">&para;</a></h4>
<p>El propósito de este componente es calcular y almacenar el número máximo de iteraciones necesarias para procesar los afiliados en lotes de 100,000 registros. Este valor se almacena en una variable de SSIS, <strong><code>User::MaxIterationAfil</code></strong>, para ser utilizado posteriormente en el flujo de trabajo.</p>
<hr />
<h4 id="detalles-de-implementacion_3"><strong>Detalles de Implementación</strong><a class="headerlink" href="#detalles-de-implementacion_3" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>Componente SSIS</strong>: <strong><code>Microsoft.ExecuteSQLTask</code></strong></li>
<li><strong>Conexión</strong>: Utiliza la conexión <strong><code>DWH_COMFENALCO</code></strong> gestionada a través del administrador de conexiones de SSIS.</li>
</ul>
<hr />
<h4 id="logica-de-negocio_3"><strong>Lógica de Negocio</strong><a class="headerlink" href="#logica-de-negocio_3" title="Permanent link">&para;</a></h4>
<p>Este componente ejecuta una consulta SQL que:</p>
<ol>
<li><strong>Cuenta los registros de afiliados</strong> en la tabla <strong><code>DIM_AFILIADOS</code></strong> donde el estado es <strong><code>CURRENT</code></strong> y la fecha de afiliación es válida.</li>
<li><strong>Valida la fecha de retiro</strong> para asegurar que sea válida o nula.</li>
<li><strong>Calcula el número de lotes</strong>: Se divide el total de registros entre 100,000 y se le suma 1, lo que representa el número máximo de iteraciones necesarias para procesar todos los registros.</li>
</ol>
<p>El resultado de esta operación se almacena en la variable <strong><code>User::MaxIterationAfil</code></strong>, que posteriormente se utiliza en el proceso para realizar las iteraciones necesarias.</p>
<hr />
<h4 id="script-sql_2"><strong>Script SQL</strong><a class="headerlink" href="#script-sql_2" title="Permanent link">&para;</a></h4>
<p>La consulta SQL utilizada es la siguiente:</p>
<div class="highlight"><pre><span></span><code><span class="k">select</span><span class="w"> </span><span class="n">FLOOR</span><span class="p">(</span><span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">100000</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">num</span>
<span class="k">FROM</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Aportes</span><span class="p">].[</span><span class="n">DIM_AFILIADOS</span><span class="p">]</span>
<span class="k">WHERE</span><span class="w"> </span><span class="p">[</span><span class="n">ESTADOREGISTRO</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;CURRENT&#39;</span><span class="w"> </span>
<span class="w">  </span><span class="k">AND</span><span class="w"> </span><span class="n">ISDATE</span><span class="p">([</span><span class="n">FECHA_AFILIACION</span><span class="p">])</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span>
<span class="w">  </span><span class="k">AND</span><span class="w"> </span><span class="p">(</span><span class="n">ISDATE</span><span class="p">([</span><span class="n">FECHA_RETIRO</span><span class="p">])</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">OR</span><span class="w"> </span><span class="p">[</span><span class="n">FECHA_RETIRO</span><span class="p">]</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="k">NULL</span><span class="p">)</span>
</code></pre></div>
<ul>
<li><strong><code>COUNT(*)</code></strong>: Cuenta el total de registros en la tabla <strong><code>DIM_AFILIADOS</code></strong> donde se cumplen las condiciones de afiliación activa y fechas válidas.</li>
<li><strong><code>FLOOR(COUNT(*) / 100000.0) + 1</code></strong>: Calcula el número de lotes de 100,000 registros. La función <strong><code>FLOOR</code></strong> asegura que el cálculo redondee hacia abajo el número de lotes, y se le suma 1 para garantizar que al menos un lote se procese.</li>
</ul>
<p>El valor calculado se almacena en la variable <strong><code>User::MaxIterationAfil</code></strong> para su uso posterior en el flujo de datos.</p>
<hr />
<h3 id="fact_actividadescontenedor-de-bucles-forafiliacion-mensual-afiliados"><strong>FACT_ACTIVIDADES\Contenedor de bucles For\Afiliacion mensual Afiliados</strong><a class="headerlink" href="#fact_actividadescontenedor-de-bucles-forafiliacion-mensual-afiliados" title="Permanent link">&para;</a></h3>
<p>El componente <strong><code>FACT_ACTIVIDADES\Contenedor de bucles For\Afiliacion mensual Afiliados</code></strong> es una <strong>tarea de flujo de datos</strong> dentro del paquete SSIS <strong><code>09‑ETLS_CUBO</code></strong>. Su función es generar y cargar, de forma incremental y particionada, la afiliación mensual de los afiliados en la tabla de staging <strong><code>[DWH_COMFENALCO].[Transversal].[STG_FACT_AFILIACIONES]</code></strong>, sirviendo de base para la tabla de hechos <strong><code>FACT_ACTIVIDADES</code></strong> del cubo OLAP.</p>
<hr />
<h4 id="descripcion-general_4"><strong>Descripción General</strong><a class="headerlink" href="#descripcion-general_4" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>Tipo de tarea:</strong> Data Flow Task (Microsoft.Pipeline)</li>
<li><strong>Objetivo:</strong> Materializar, mes a mes, la situación de cada afiliado activo en los últimos 3 años, enriquecida con metadatos (edad, empresa aportante, unidad, etc.).</li>
<li><strong>Destino físico:</strong> Tabla de staging <code>Transversal.STG_FACT_AFILIACIONES</code> (motor ADO .NET).</li>
</ul>
<hr />
<h4 id="ubicacion-en-el-paquete_4"><strong>Ubicación en el Paquete</strong><a class="headerlink" href="#ubicacion-en-el-paquete_4" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code>09-ETLS_CUBO
└─ FACT_ACTIVIDADES
   └─ Contenedor de bucles For
      └─ Afiliacion mensual Afiliados   ← (este componente)
</code></pre></div>
<hr />
<h4 id="proposito_4"><strong>Propósito</strong><a class="headerlink" href="#proposito_4" title="Permanent link">&para;</a></h4>
<ol>
<li><strong>Persistir un snapshot mensual</strong> de los afiliados para análisis de cohortes y métricas históricas.</li>
<li><strong>Reducir carga de memoria</strong> procesando los afiliados en lotes de 100 000 registros (controlado por la variable <code>@VarTime</code>).</li>
<li><strong>Centralizar reglas de negocio</strong> de afiliación (vigencia, edad, estrato, población, etc.) antes de la carga definitiva a la tabla de hechos.</li>
</ol>
<hr />
<h4 id="detalles-de-implementacion_4"><strong>Detalles de Implementación</strong><a class="headerlink" href="#detalles-de-implementacion_4" title="Permanent link">&para;</a></h4>
<table>
<thead>
<tr>
<th>Elemento</th>
<th>Configuración clave</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Origen</strong></td>
<td><strong>OLE DB Source</strong> (conexión <code>DWH_COMFENALCO_Destino_OLEDB</code>)</td>
</tr>
<tr>
<td><strong>Modo de acceso</strong></td>
<td><code>SQL Command</code> parametrizado (<code>@VarTime</code> ↔ variable de Foreach)</td>
</tr>
<tr>
<td><strong>Destino</strong></td>
<td><strong>ADO NET Destination</strong> → <code>"Transversal"."STG_FACT_AFILIACIONES"</code></td>
</tr>
<tr>
<td><strong>BatchSize</strong></td>
<td><code>0</code> (lote = tamaño de búfer interno)</td>
</tr>
<tr>
<td><strong>BulkInsert</strong></td>
<td><code>True</code> (usa <code>SqlBulkCopy</code> cuando el proveedor lo permite)</td>
</tr>
<tr>
<td><strong>Timeout</strong></td>
<td><code>600 s</code> en origen y destino</td>
</tr>
<tr>
<td><strong>Gestión de errores</strong></td>
<td>Salida de error dedicada para registro de filas rechazadas</td>
</tr>
</tbody>
</table>
<hr />
<h4 id="logica-de-negocio_4"><strong>Lógica de Negocio</strong><a class="headerlink" href="#logica-de-negocio_4" title="Permanent link">&para;</a></h4>
<ol>
<li>
<p><strong>Generación de calendario mensual</strong></p>
<ul>
<li>Se toma la fecha máxima de <strong><code>DIM_TIEMPO</code></strong> y se retrocede 3 años.</li>
<li>Se cruza con <strong><code>Transversal.DIM_TIEMPO_MENSUAL</code></strong> para garantizar coherencia de la dimensión tiempo.</li>
</ul>
</li>
<li>
<p><strong>Selección de afiliados vigentes</strong></p>
<ul>
<li>De <strong><code>Aportes.DIM_AFILIADOS</code></strong> se filtran registros <code>ESTADOREGISTRO = 'CURRENT'</code>.</li>
<li>Se valida que <code>FECHA_AFILIACION</code> sea fecha válida y que <code>FECHA_RETIRO</code> sea nula o fecha válida.</li>
</ul>
</li>
<li>
<p><strong>Particionamiento controlado</strong></p>
<ul>
<li>El contenedor For Loop alimenta la variable <strong><code>@VarTime</code></strong> (1…N).</li>
<li>Cada iteración procesa hasta <strong>100 000</strong> afiliados (<code>ROW_NUMBER()</code> → <code>BETWEEN…</code>).</li>
</ul>
</li>
<li>
<p><strong>Expansión temporal</strong></p>
<ul>
<li>Se repite cada afiliado por todos los meses comprendidos entre su afiliación y su retiro (o el mes corriente).</li>
</ul>
</li>
<li>
<p><strong>Cálculo de atributos</strong></p>
<ul>
<li><strong>Edad:</strong> <code>DATEDIFF(YEAR, FECHA_NACIMIENTO, FECHA_MENSUAL)</code>.</li>
<li><strong>Unidad:</strong> constante <code>5</code>.</li>
<li><strong>Empresa aportante:</strong> primer <code>PARTNER</code> encontrado en <strong><code>Aportes.DIM_EMPRESAS</code></strong>.</li>
<li><strong>Tipo población / Actividad / Fuente:</strong> valores literales ‘AFILIADO’, ‘AFILIACION’ y ruta de origen.</li>
</ul>
</li>
<li>
<p><strong>Filtrado de duplicados</strong></p>
<ul>
<li>Se conserva la fila con salario más alto por afiliado y mes (<code>ROW_NUMBER() OVER(PARTITION BY PARTNER, ID_FECHA ORDER BY SALARIO_BASICO DESC) = 1</code>).</li>
</ul>
</li>
</ol>
<hr />
<h4 id="script-sql-completo"><strong>Script SQL (completo)</strong><a class="headerlink" href="#script-sql-completo" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="k">DECLARE</span><span class="w"> </span><span class="o">@</span><span class="n">VarTime</span><span class="w"> </span><span class="nb">INT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">?</span><span class="p">;</span>

<span class="c1">-- 1) Fechas mensuales (últimos 3 años)</span>
<span class="k">WITH</span><span class="w"> </span><span class="n">MaxFecha</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="k">MAX</span><span class="p">(</span><span class="n">FECHA</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">MaxFecha</span>
<span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Dwh</span><span class="p">].[</span><span class="n">DIM_TIEMPO</span><span class="p">]</span>
<span class="p">),</span>
<span class="n">NumberSeries</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="n">ROW_NUMBER</span><span class="p">()</span><span class="w"> </span><span class="n">OVER</span><span class="w"> </span><span class="p">(</span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="k">NULL</span><span class="p">))</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="nb">Number</span>
<span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Dwh</span><span class="p">].[</span><span class="n">DIM_TIEMPO</span><span class="p">]</span>
<span class="p">),</span>
<span class="n">DateSeries</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="n">DATEADD</span><span class="p">(</span><span class="k">MONTH</span><span class="p">,</span><span class="w"> </span><span class="nb">Number</span><span class="p">,</span><span class="w"> </span><span class="n">DATEFROMPARTS</span><span class="p">(</span><span class="k">YEAR</span><span class="p">(</span><span class="n">MaxFecha</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">))</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">MonthDate</span><span class="p">,</span>
<span class="w">           </span><span class="k">CONVERT</span><span class="p">(</span><span class="nb">INT</span><span class="p">,</span><span class="w"> </span><span class="n">FORMAT</span><span class="p">(</span>
<span class="w">               </span><span class="n">DATEADD</span><span class="p">(</span><span class="k">MONTH</span><span class="p">,</span><span class="w"> </span><span class="nb">Number</span><span class="p">,</span><span class="w"> </span><span class="n">DATEFROMPARTS</span><span class="p">(</span><span class="k">YEAR</span><span class="p">(</span><span class="n">MaxFecha</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)),</span>
<span class="w">               </span><span class="s1">&#39;yyyyMMdd&#39;</span><span class="p">))</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_FECHA</span>
<span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">NumberSeries</span>
<span class="w">    </span><span class="k">CROSS</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">MaxFecha</span>
<span class="w">    </span><span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Transversal</span><span class="p">].[</span><span class="n">DIM_TIEMPO_MENSUAL</span><span class="p">]</span><span class="w"> </span><span class="n">dtm</span>
<span class="w">           </span><span class="k">ON</span><span class="w"> </span><span class="n">dtm</span><span class="p">.</span><span class="n">ID_FECHA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">CONVERT</span><span class="p">(</span><span class="nb">INT</span><span class="p">,</span><span class="w"> </span><span class="n">FORMAT</span><span class="p">(</span>
<span class="w">                </span><span class="n">DATEADD</span><span class="p">(</span><span class="k">MONTH</span><span class="p">,</span><span class="w"> </span><span class="nb">Number</span><span class="p">,</span><span class="w"> </span><span class="n">DATEFROMPARTS</span><span class="p">(</span><span class="k">YEAR</span><span class="p">(</span><span class="n">MaxFecha</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)),</span>
<span class="w">                </span><span class="s1">&#39;yyyyMMdd&#39;</span><span class="p">))</span>
<span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="nb">Number</span><span class="w"> </span><span class="k">BETWEEN</span><span class="w"> </span><span class="mi">0</span>
<span class="w">          </span><span class="k">AND</span><span class="w"> </span><span class="n">DATEDIFF</span><span class="p">(</span><span class="k">MONTH</span><span class="p">,</span><span class="w"> </span><span class="n">DATEFROMPARTS</span><span class="p">(</span><span class="k">YEAR</span><span class="p">(</span><span class="n">MaxFecha</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="n">MaxFecha</span><span class="p">)</span>
<span class="p">),</span>

<span class="c1">-- 2) Empresa aportante principal</span>
<span class="n">UniquePartners</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="n">PARTNER</span><span class="p">,</span><span class="w"> </span><span class="n">DOCUMENTO</span><span class="p">,</span>
<span class="w">           </span><span class="n">ROW_NUMBER</span><span class="p">()</span><span class="w"> </span><span class="n">OVER</span><span class="w"> </span><span class="p">(</span><span class="n">PARTITION</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">DOCUMENTO</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">PARTNER</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">RowNum</span>
<span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Aportes</span><span class="p">].[</span><span class="n">DIM_EMPRESAS</span><span class="p">]</span>
<span class="p">),</span>
<span class="n">FilteredPartners</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="n">PARTNER</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">PARTNER_EMPRESA</span><span class="p">,</span><span class="w"> </span><span class="n">DOCUMENTO</span>
<span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">UniquePartners</span>
<span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="n">RowNum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span>
<span class="p">),</span>

<span class="c1">-- 3) Afiliados activos + paginación</span>
<span class="n">AfiliadosConRowNum</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="k">SELECT</span><span class="w">  </span><span class="n">ID_AFILIADO</span><span class="p">,</span><span class="w"> </span><span class="n">PARTNER</span><span class="p">,</span><span class="w"> </span><span class="n">ID_TIPO_AFILIADO</span><span class="p">,</span><span class="w"> </span><span class="n">TIPO_AFILIADO</span><span class="p">,</span>
<span class="w">            </span><span class="n">ID_CATEGORIA</span><span class="p">,</span><span class="w"> </span><span class="k">CAST</span><span class="p">(</span><span class="n">FECHA_NACIMIENTO</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="nb">DATE</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">FECHA_NACIMIENTO</span><span class="p">,</span>
<span class="w">            </span><span class="k">CAST</span><span class="p">(</span><span class="n">FECHA_AFILIACION</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="nb">DATE</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">FECHA_AFILIACION</span><span class="p">,</span>
<span class="w">            </span><span class="k">CAST</span><span class="p">(</span><span class="n">FECHA_RETIRO</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="nb">DATE</span><span class="p">)</span><span class="w">     </span><span class="k">AS</span><span class="w"> </span><span class="n">FECHA_RETIRO</span><span class="p">,</span>
<span class="w">            </span><span class="n">ID_GENERO</span><span class="p">,</span><span class="w"> </span><span class="n">ID_ESTADO_CIVIL</span><span class="p">,</span><span class="w"> </span><span class="n">ID_PERTENENCIA_ETNICA</span><span class="p">,</span>
<span class="w">            </span><span class="n">ID_FACTOR_VULNERABILIDAD</span><span class="p">,</span><span class="w"> </span><span class="n">ESTRATO</span><span class="p">,</span><span class="w"> </span><span class="n">ID_CIUDAD</span><span class="p">,</span>
<span class="w">            </span><span class="n">SALARIO_BASICO</span><span class="p">,</span><span class="w"> </span><span class="n">APORTANTE</span><span class="p">,</span><span class="w"> </span><span class="n">ESTADOREGISTRO</span><span class="p">,</span>
<span class="w">            </span><span class="n">ROW_NUMBER</span><span class="p">()</span><span class="w"> </span><span class="n">OVER</span><span class="w"> </span><span class="p">(</span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">ID_AFILIADO</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">RowNum</span>
<span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Aportes</span><span class="p">].[</span><span class="n">DIM_AFILIADOS</span><span class="p">]</span>
<span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="n">ESTADOREGISTRO</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;CURRENT&#39;</span>
<span class="w">      </span><span class="k">AND</span><span class="w"> </span><span class="n">ISDATE</span><span class="p">(</span><span class="n">FECHA_AFILIACION</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span>
<span class="w">      </span><span class="k">AND</span><span class="w"> </span><span class="p">(</span><span class="n">ISDATE</span><span class="p">(</span><span class="n">FECHA_RETIRO</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">OR</span><span class="w"> </span><span class="n">FECHA_RETIRO</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="k">NULL</span><span class="p">)</span>
<span class="p">),</span>
<span class="n">Afiliados</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span>
<span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">AfiliadosConRowNum</span>
<span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="n">RowNum</span><span class="w"> </span><span class="k">BETWEEN</span><span class="w"> </span><span class="p">((</span><span class="o">@</span><span class="n">VarTime</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">100000</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
<span class="w">                     </span><span class="k">AND</span><span class="w">     </span><span class="o">@</span><span class="n">VarTime</span><span class="w">      </span><span class="o">*</span><span class="w"> </span><span class="mi">100000</span>
<span class="p">),</span>

<span class="c1">-- 4) Repetir afiliado por cada mes de vigencia</span>
<span class="n">AfiliadosPorMes</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="k">SELECT</span><span class="w">  </span><span class="n">a</span><span class="p">.</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="n">ds</span><span class="p">.</span><span class="n">MonthDate</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">FECHA_MENSUAL</span><span class="p">,</span><span class="w"> </span><span class="n">ds</span><span class="p">.</span><span class="n">ID_FECHA</span><span class="p">,</span>
<span class="w">            </span><span class="mi">5</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_UNIDAD</span><span class="p">,</span>
<span class="w">            </span><span class="n">ROW_NUMBER</span><span class="p">()</span><span class="w"> </span><span class="n">OVER</span>
<span class="w">               </span><span class="p">(</span><span class="n">PARTITION</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">PARTNER</span><span class="p">,</span><span class="w"> </span><span class="n">ds</span><span class="p">.</span><span class="n">ID_FECHA</span>
<span class="w">                </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">SALARIO_BASICO</span><span class="w"> </span><span class="k">DESC</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">RN</span>
<span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">Afiliados</span><span class="w"> </span><span class="n">a</span>
<span class="w">    </span><span class="k">JOIN</span><span class="w"> </span><span class="n">DateSeries</span><span class="w"> </span><span class="n">ds</span>
<span class="w">      </span><span class="k">ON</span><span class="w"> </span><span class="n">ds</span><span class="p">.</span><span class="n">MonthDate</span><span class="w"> </span><span class="k">BETWEEN</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">FECHA_AFILIACION</span>
<span class="w">                          </span><span class="k">AND</span><span class="w"> </span><span class="k">COALESCE</span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">FECHA_RETIRO</span><span class="p">,</span><span class="w"> </span><span class="n">GETDATE</span><span class="p">())</span>
<span class="p">)</span>

<span class="c1">-- 5) Resultado final</span>
<span class="k">SELECT</span><span class="w">  </span><span class="n">am</span><span class="p">.</span><span class="n">PARTNER</span><span class="p">,</span>
<span class="w">        </span><span class="o">-</span><span class="mi">1</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_EMPRESA</span><span class="p">,</span>
<span class="w">        </span><span class="n">am</span><span class="p">.</span><span class="n">ID_AFILIADO</span><span class="p">,</span><span class="w"> </span><span class="n">am</span><span class="p">.</span><span class="n">ID_TIPO_AFILIADO</span><span class="p">,</span><span class="w"> </span><span class="n">am</span><span class="p">.</span><span class="n">TIPO_AFILIADO</span><span class="p">,</span>
<span class="w">        </span><span class="n">am</span><span class="p">.</span><span class="n">ID_CATEGORIA</span><span class="p">,</span><span class="w"> </span><span class="n">am</span><span class="p">.</span><span class="n">FECHA_NACIMIENTO</span><span class="p">,</span>
<span class="w">        </span><span class="n">DATEDIFF</span><span class="p">(</span><span class="k">YEAR</span><span class="p">,</span><span class="w"> </span><span class="n">am</span><span class="p">.</span><span class="n">FECHA_NACIMIENTO</span><span class="p">,</span><span class="w"> </span><span class="n">am</span><span class="p">.</span><span class="n">FECHA_MENSUAL</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">EDAD</span><span class="p">,</span>
<span class="w">        </span><span class="n">am</span><span class="p">.</span><span class="n">FECHA_AFILIACION</span><span class="p">,</span><span class="w"> </span><span class="n">am</span><span class="p">.</span><span class="n">FECHA_RETIRO</span><span class="p">,</span>
<span class="w">        </span><span class="n">am</span><span class="p">.</span><span class="n">ID_GENERO</span><span class="p">,</span><span class="w"> </span><span class="n">am</span><span class="p">.</span><span class="n">ID_ESTADO_CIVIL</span><span class="p">,</span><span class="w"> </span><span class="n">am</span><span class="p">.</span><span class="n">ID_PERTENENCIA_ETNICA</span><span class="p">,</span>
<span class="w">        </span><span class="n">am</span><span class="p">.</span><span class="n">ID_FACTOR_VULNERABILIDAD</span><span class="p">,</span><span class="w"> </span><span class="n">am</span><span class="p">.</span><span class="n">ESTRATO</span><span class="p">,</span><span class="w"> </span><span class="n">am</span><span class="p">.</span><span class="n">ID_CIUDAD</span><span class="p">,</span>
<span class="w">        </span><span class="n">am</span><span class="p">.</span><span class="n">SALARIO_BASICO</span><span class="p">,</span><span class="w"> </span><span class="n">am</span><span class="p">.</span><span class="n">FECHA_MENSUAL</span><span class="p">,</span><span class="w"> </span><span class="n">am</span><span class="p">.</span><span class="n">ID_FECHA</span><span class="p">,</span><span class="w"> </span><span class="n">am</span><span class="p">.</span><span class="n">ID_UNIDAD</span><span class="p">,</span>
<span class="w">        </span><span class="n">am</span><span class="p">.</span><span class="n">ESTADOREGISTRO</span><span class="p">,</span>
<span class="w">        </span><span class="n">am</span><span class="p">.</span><span class="n">PARTNER</span><span class="w">           </span><span class="k">AS</span><span class="w"> </span><span class="n">PARTNER_AFILIADO</span><span class="p">,</span>
<span class="w">        </span><span class="n">fp</span><span class="p">.</span><span class="n">PARTNER_EMPRESA</span><span class="p">,</span>
<span class="w">        </span><span class="s1">&#39;AFILIADO&#39;</span><span class="w">   </span><span class="k">AS</span><span class="w"> </span><span class="n">TIPO_POBLACION</span><span class="p">,</span>
<span class="w">        </span><span class="s1">&#39;AFILIACION&#39;</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ACTIVIDAD</span><span class="p">,</span>
<span class="w">        </span><span class="s1">&#39;[DWH_COMFENALCO].[Aportes].[DIM_AFILIADOS]&#39;</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">FUENTE_PRINCIPAL</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">AfiliadosPorMes</span><span class="w"> </span><span class="n">am</span>
<span class="k">JOIN</span><span class="w"> </span><span class="n">FilteredPartners</span><span class="w"> </span><span class="n">fp</span>
<span class="w">  </span><span class="k">ON</span><span class="w"> </span><span class="n">am</span><span class="p">.</span><span class="n">APORTANTE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fp</span><span class="p">.</span><span class="n">DOCUMENTO</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">am</span><span class="p">.</span><span class="n">RN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span>
<span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">am</span><span class="p">.</span><span class="n">PARTNER</span><span class="p">,</span><span class="w"> </span><span class="n">am</span><span class="p">.</span><span class="n">FECHA_MENSUAL</span><span class="p">;</span>
</code></pre></div>
<hr />
<h4 id="relacion-con-otros-componentes_3"><strong>Relación con Otros Componentes</strong><a class="headerlink" href="#relacion-con-otros-componentes_3" title="Permanent link">&para;</a></h4>
<table>
<thead>
<tr>
<th>Dependencia</th>
<th>Tipo</th>
<th>Uso</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong><code>Transversal.DIM_TIEMPO_MENSUAL</code></strong></td>
<td>Dimensión de tiempo</td>
<td>Asegura que los ID_FECHA generados existan en el DW</td>
</tr>
<tr>
<td><strong><code>Dwh.DIM_TIEMPO</code></strong></td>
<td>Dimensión de tiempo</td>
<td>Obtención de la fecha máxima para acotar el rango de 3 años</td>
</tr>
<tr>
<td><strong><code>Aportes.DIM_AFILIADOS</code></strong></td>
<td>Dimensión de dominio</td>
<td>Fuente principal de los afiliados</td>
</tr>
<tr>
<td><strong><code>Aportes.DIM_EMPRESAS</code></strong></td>
<td>Dimensión de empresas</td>
<td>Derivar <code>PARTNER_EMPRESA</code> (aportante)</td>
</tr>
<tr>
<td><strong><code>STG_FACT_AFILIACIONES</code></strong></td>
<td>Tabla staging destino</td>
<td>Recibe los registros para posteriores transformaciones hacia <code>FACT_ACTIVIDADES</code></td>
</tr>
</tbody>
</table>
<hr />
<blockquote>
<p><strong>Observación:</strong> La tarea se encuentra dentro de un <strong>Contenedor For Loop</strong> que recorre el rango de valores de <code>@VarTime</code>, permitiendo que grandes volúmenes de afiliados se carguen en paralelo o en iteraciones controladas, evitando sobrecargar la memoria durante la ejecución del paquete.</p>
</blockquote>
<h3 id="fact_actividadesalmacenar-max-beneficiarios"><strong>FACT_ACTIVIDADES\Almacenar MAX beneficiarios</strong><a class="headerlink" href="#fact_actividadesalmacenar-max-beneficiarios" title="Permanent link">&para;</a></h3>
<p>El componente <strong><code>FACT_ACTIVIDADES\Almacenar MAX beneficiarios</code></strong> es una <strong>tarea Ejecutar SQL</strong> dentro del paquete SSIS <strong><code>09‑ETLS_CUBO</code></strong>. Su misión es calcular cuántas iteraciones deberá ejecutar posteriormente el contenedor <em>For Loop</em> que procesa la carga masiva de beneficiarios, evitando desbordes de memoria y asegurando un particionamiento homogéneo de 100 000 registros por lote.</p>
<hr />
<h4 id="descripcion-general_5"><strong>Descripción General</strong><a class="headerlink" href="#descripcion-general_5" title="Permanent link">&para;</a></h4>
<table>
<thead>
<tr>
<th>Atributo</th>
<th>Valor</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Tipo de tarea</strong></td>
<td><code>ExecuteSQLTask</code></td>
</tr>
<tr>
<td><strong>Conexión</strong></td>
<td><code>{29BC876E-1EAF-4F6F-8F38-39B8E881EEB6}</code> (base de datos <strong><code>DWH_COMFENALCO</code></strong>)</td>
</tr>
<tr>
<td><strong>ResultSet</strong></td>
<td><code>Single Row</code></td>
</tr>
<tr>
<td><strong>Variable de salida</strong></td>
<td><code>User::MaxIterationBene</code> (INT)</td>
</tr>
</tbody>
</table>
<hr />
<h4 id="ubicacion-en-el-paquete_5"><strong>Ubicación en el Paquete</strong><a class="headerlink" href="#ubicacion-en-el-paquete_5" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code>09-ETLS_CUBO
└─ FACT_ACTIVIDADES
   └─ Almacenar MAX beneficiarios   ← (este componente)
</code></pre></div>
<hr />
<h4 id="proposito_5"><strong>Propósito</strong><a class="headerlink" href="#proposito_5" title="Permanent link">&para;</a></h4>
<ol>
<li><strong>Contar beneficiarios vigentes</strong> registrados en <strong><code>Aportes.DIM_BENEFICIARIOS</code></strong> cuyo <strong><code>TIPO_APORTANTE = 'X'</code></strong>.</li>
<li><strong>Calcular el número de lotes</strong> necesarios para procesarlos de a 100 000 filas.</li>
<li><strong>Almacenar el resultado</strong> en la variable <code>User::MaxIterationBene</code>, utilizada como límite superior del For Loop que alimenta el flujo de datos <em>Afiliación mensual Beneficiarios</em> (y componentes afines).</li>
</ol>
<hr />
<h4 id="detalles-de-implementacion_5"><strong>Detalles de Implementación</strong><a class="headerlink" href="#detalles-de-implementacion_5" title="Permanent link">&para;</a></h4>
<table>
<thead>
<tr>
<th>Elemento</th>
<th>Configuración</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>SQLStatementSource</strong></td>
<td>Sentencia <code>SELECT</code> (ver más abajo)</td>
</tr>
<tr>
<td><strong>Result Binding</strong></td>
<td>Resultado ordinal <strong>0</strong> → <code>User::MaxIterationBene</code></td>
</tr>
<tr>
<td><strong>ResultType</strong></td>
<td><code>SingleRow</code> (una sola fila con un campo <code>num</code>)</td>
</tr>
<tr>
<td><strong>ThreadHint</strong></td>
<td><code>0</code> (sin afinidad de subproceso)</td>
</tr>
<tr>
<td><strong>Reintentos / Timeout</strong></td>
<td>Hereda configuración global del paquete</td>
</tr>
</tbody>
</table>
<hr />
<h4 id="script-sql_3"><strong>Script SQL</strong><a class="headerlink" href="#script-sql_3" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w">  </span><span class="n">FLOOR</span><span class="p">(</span><span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">100000</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">num</span>
<span class="k">FROM</span><span class="w">    </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Aportes</span><span class="p">].[</span><span class="n">DIM_BENEFICIARIOS</span><span class="p">]</span>
<span class="k">WHERE</span><span class="w">   </span><span class="p">[</span><span class="n">ESTADOREGISTRO</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;CURRENT&#39;</span>
<span class="w">  </span><span class="k">AND</span><span class="w">   </span><span class="p">[</span><span class="n">TIPO_APORTANTE</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;X&#39;</span><span class="p">;</span>
</code></pre></div>
<ul>
<li>
<p><strong>Lógica:</strong></p>
<ul>
<li>Cuenta los beneficiarios <strong>vigentes</strong> (<code>ESTADOREGISTRO = 'CURRENT'</code>) y con aportante de tipo <strong>‘X’</strong>.</li>
<li>Divide el total entre <strong>100 000</strong> y redondea hacia abajo (<code>FLOOR</code>).</li>
<li>Suma <strong>1</strong> para cubrir el residuo del último lote.</li>
</ul>
</li>
</ul>
<hr />
<h4 id="relacion-con-otros-componentes_4"><strong>Relación con Otros Componentes</strong><a class="headerlink" href="#relacion-con-otros-componentes_4" title="Permanent link">&para;</a></h4>
<table>
<thead>
<tr>
<th>Componente</th>
<th>Tipo</th>
<th>Interacción</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong><code>Contenedor de bucles For\Afiliación mensual Beneficiarios</code></strong></td>
<td>For Loop</td>
<td>Usa <code>User::MaxIterationBene</code> como valor máximo (<code>EvalExpression</code>) para iterar los lotes.</td>
</tr>
<tr>
<td><strong><code>Transversal.STG_FACT_BENEFICIARIOS</code></strong> (u otro staging)</td>
<td>Destino de flujos</td>
<td>Recibe los datos procesados en cada iteración.</td>
</tr>
</tbody>
</table>
<hr />
<blockquote>
<p><strong>Observación:</strong>
Este cálculo se ejecuta <strong>antes</strong> de iniciar la carga masiva de beneficiarios. De este modo el paquete conoce de antemano cuántas vueltas dará el bucle y puede distribuir los recursos (memoria, tiempo de ejecución) de forma predecible.</p>
</blockquote>
<h3 id="fact_actividadescontenedor-de-bucles-for-1afiliacion-mensual-beneficiarios"><strong>FACT_ACTIVIDADES\Contenedor de bucles For 1\Afiliación mensual Beneficiarios</strong><a class="headerlink" href="#fact_actividadescontenedor-de-bucles-for-1afiliacion-mensual-beneficiarios" title="Permanent link">&para;</a></h3>
<p>El componente <strong>Afiliación mensual Beneficiarios</strong> es un <strong>Data Flow Task</strong> que vive dentro del contenedor <strong>For Loop 1</strong> del paquete SSIS <strong><code>09‑ETLS_CUBO</code></strong>. Su función es extraer, transformar y cargar —en lotes de 100 000 filas— la afiliación mensual de beneficiarios vigentes, generando un registro por cada combinación <em>beneficiario‑mes</em> en la tabla <strong><code>Transversal.STG_FACT_AFILIACIONES</code></strong>.</p>
<hr />
<h4 id="descripcion-general_6"><strong>Descripción General</strong><a class="headerlink" href="#descripcion-general_6" title="Permanent link">&para;</a></h4>
<table>
<thead>
<tr>
<th>Atributo</th>
<th>Valor</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Tipo de componente</strong></td>
<td><code>Data Flow Task</code></td>
</tr>
<tr>
<td><strong>Fuente</strong></td>
<td><code>OLE DB Source</code> — consulta SQL parametrizada (ver <em>Lógica de negocio</em>)</td>
</tr>
<tr>
<td><strong>Destino</strong></td>
<td><code>ADO NET Destination</code> → <strong><code>Transversal.STG_FACT_AFILIACIONES</code></strong></td>
</tr>
<tr>
<td><strong>Conexiones</strong></td>
<td>- OLE DB: <code>{57F24C4D‑…582B}</code> → <strong>DWH_COMFENALCO</strong>  <br>‑ ADO NET: <code>{5972EC76‑…645D}</code> → <strong>STAGE_AREA</strong></td>
</tr>
<tr>
<td><strong>Lote insert</strong></td>
<td><code>UseBulkInsertWhenPossible = true</code> • <code>BatchSize = 0</code> (auto)</td>
</tr>
<tr>
<td><strong>Parámetro de entrada</strong></td>
<td><code>@VarTime</code> (INT) ← variable del For Loop (<code>User::IterTimeBene</code>)</td>
</tr>
<tr>
<td><strong>Filas por iteración</strong></td>
<td>100 000 (ROW_NUMBER con filtrado por rango)</td>
</tr>
</tbody>
</table>
<hr />
<h4 id="ubicacion-en-el-paquete_6"><strong>Ubicación en el Paquete</strong><a class="headerlink" href="#ubicacion-en-el-paquete_6" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code>09-ETLS_CUBO
└─ FACT_ACTIVIDADES
   └─ Contenedor de bucles For 1
      └─ Afiliación mensual Beneficiarios   ← (este flujo de datos)
</code></pre></div>
<hr />
<h4 id="proposito_6"><strong>Propósito</strong><a class="headerlink" href="#proposito_6" title="Permanent link">&para;</a></h4>
<ol>
<li><strong>Paginación de beneficiarios vigentes</strong>
   Procesa 100 000 registros por vuelta, según el índice <code>RowNumm</code> y el parámetro <code>@VarTime</code> que suministra el For Loop.</li>
<li><strong>Generación de series mensuales</strong>
   Replica cada beneficiario para cada mes comprendido entre su fecha de afiliación y de retiro (cortadas a los límites globales de la tabla de tiempo).</li>
<li>
<p><strong>Normalización y enriquecimiento</strong></p>
<ul>
<li>Ajuste de fechas erróneas (<em>'1900‑01‑01'</em> → <em>9999‑12‑31</em>).</li>
<li>Cálculo de edad al corte del mes.</li>
<li>Asignación de categoría (<code>ID_CATEGORIA</code>) a partir de actividades del <em>staging</em> de afiliados (si existe, si no, valor por defecto <code>4</code> – categoría D).</li>
</ul>
</li>
<li>
<p><strong>Carga incremental</strong>
   Inserta el resultado en <strong><code>STG_FACT_AFILIACIONES</code></strong> para ser consolidado más adelante por la rutina de fact table.</p>
</li>
</ol>
<hr />
<h4 id="detalles-de-implementacion_6"><strong>Detalles de Implementación</strong><a class="headerlink" href="#detalles-de-implementacion_6" title="Permanent link">&para;</a></h4>
<table>
<thead>
<tr>
<th>Elemento</th>
<th>Configuración / Observación</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>OLE DB Source – SQL</strong></td>
<td>Consulta con varios <strong>CTE</strong> para: <br>• Paginar (<code>BeneficiariosConRowNum</code>) <br>• Corregir fechas y filtrar (<code>BeneficiariosOptimizado</code>) <br>• Expandir a meses (<code>BeneficiariosPorMes</code>) <br>• Asociar categoría vía <em>left join</em> al staging de afiliados (<code>CTE_Ranking</code>)</td>
</tr>
<tr>
<td><strong>ParameterMapping</strong></td>
<td><code>"Parámetro0:Input",{16F02750‑… EB7F}</code> ← variable del contenedor</td>
</tr>
<tr>
<td><strong>Destino ADO NET</strong></td>
<td>Tabla: <strong><code>Transversal.STG_FACT_AFILIACIONES</code></strong>; <code>UseBulkInsertWhenPossible = true</code></td>
</tr>
<tr>
<td><strong>Manejo de errores</strong></td>
<td>Salida “<strong>Error Output</strong>” configurada; filas erróneas se redirigen (actualmente sin conexión de manejo específica, solo logging).</td>
</tr>
<tr>
<td><strong>ThreadHint / Buffering</strong></td>
<td>Configuración heredada; <code>BatchSize = 0</code> confía en el tamaño interno del buffer SSIS.</td>
</tr>
</tbody>
</table>
<hr />
<h4 id="logica-de-negocio-resumen-de-la-sql"><strong>Lógica de Negocio (resumen de la SQL)</strong><a class="headerlink" href="#logica-de-negocio-resumen-de-la-sql" title="Permanent link">&para;</a></h4>
<ol>
<li>
<p><strong>Ventana de fechas</strong></p>
<ul>
<li><code>MinFecha</code>, <code>MaxFecha</code> se toman de <code>Transversal.DIM_TIEMPO_MENSUAL</code>.</li>
</ul>
</li>
<li>
<p><strong>Selección de beneficiarios vigentes</strong></p>
<div class="highlight"><pre><span></span><code>WHERE ESTADOREGISTRO = &#39;CURRENT&#39;
  AND TIPO_APORTANTE  = &#39;X&#39;
</code></pre></div>
</li>
<li>
<p><strong>Paginación</strong> por <code>ROW_NUMBER()</code> → rango = <code>(@VarTime‑1)*100 000 + 1</code> … <code>@VarTime*100 000</code>.</p>
</li>
<li>
<p><strong>Depuración / Normalización</strong></p>
<ul>
<li>Relleno de fechas nulas o valores 1900‑01‑01 / 9999‑12‑31.</li>
<li>Eliminación de duplicados por <code>PARTNER</code> conservando el ingreso más antiguo.</li>
</ul>
</li>
<li>
<p><strong>Explosión mensual</strong>
   Join con <code>DIM_TIEMPO_MENSUAL</code> ⇒ un registro por mes.</p>
</li>
<li>
<p><strong>Enriquecimiento de categoría</strong>
   <code>LEFT JOIN</code> con <em>staging</em> de afiliados; si no existe, se asigna <code>4</code>.</p>
</li>
<li>
<p><strong>Selección final</strong>
   Se elige <strong><code>RowNum = 1</code></strong> (primer registro por beneficiario‑mes) y se proyectan 40+ columnas normalizadas, incluyendo:</p>
<ul>
<li><code>TIPO_POBLACION = 'BENEFICIARIO'</code></li>
<li><code>ACTIVIDAD      = 'AFILIACION'</code></li>
<li><code>FUENTE_PRINCIPAL = [DIM_BENEFICIARIOS]</code></li>
</ul>
</li>
</ol>
<h4 id="relacion-con-otros-componentes_5"><strong>Relación con Otros Componentes</strong><a class="headerlink" href="#relacion-con-otros-componentes_5" title="Permanent link">&para;</a></h4>
<table>
<thead>
<tr>
<th>Componente</th>
<th>Tipo</th>
<th>Relación</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>For Loop 1</strong></td>
<td>Contenedor</td>
<td>Suministra <code>@VarTime</code> y controla el número de iteraciones (<code>User::MaxIterationBene</code>) calculado en la tarea <strong>Almacenar MAX beneficiarios</strong>.</td>
</tr>
<tr>
<td><strong>Almacenar MAX beneficiarios</strong></td>
<td>Execute SQL Task</td>
<td>Define cuántas vueltas da el For Loop (→ lotes de 100 k).</td>
</tr>
<tr>
<td><strong>STG_FACT_AFILIACIONES</strong></td>
<td>Tabla staging</td>
<td>Recibe tanto afiliados como beneficiarios; etapa previa a la fact table definitiva.</td>
</tr>
<tr>
<td><strong>Flujo Afiliación mensual Afiliados</strong></td>
<td>Data Flow</td>
<td>Corre en paralelo (diferente contenedor) y escribe en la misma tabla, con <code>TIPO_POBLACION = 'AFILIADO'</code>.</td>
</tr>
</tbody>
</table>
<hr />
<blockquote>
<p><strong>Buenas prácticas implementadas</strong></p>
<ul>
<li>Paginación para evitar consumo excesivo de memoria.</li>
<li>Uso de <code>BulkInsert</code> para acelerar la escritura.</li>
<li>Normalización agresiva de fechas y categorías para minimizar reprocesos posteriores. </li>
</ul>
</blockquote>
<h3 id="fact_actividades-fact_actividades_pqrs"><strong>FACT_ACTIVIDADES\ FACT_ACTIVIDADES_PQRS</strong><a class="headerlink" href="#fact_actividades-fact_actividades_pqrs" title="Permanent link">&para;</a></h3>
<p>Flujo de datos que consolida <strong>todas las PQRS</strong> (Peticiones, Quejas, Reclamos y Sugerencias) provenientes de afiliados, beneficiarios, empresas y no‑aportantes, y las carga en la fact table <strong><code>Transversal.FACT_ACTIVIDADES</code></strong>.</p>
<hr />
<h4 id="resumen-rapido"><strong>Resumen rápido</strong><a class="headerlink" href="#resumen-rapido" title="Permanent link">&para;</a></h4>
<table>
<thead>
<tr>
<th>Atributo</th>
<th>Valor</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Tipo de tarea</strong></td>
<td><code>Data Flow Task</code></td>
</tr>
<tr>
<td><strong>Origen</strong></td>
<td><code>ADO NET Source</code> (consulta UNION ALL de 4 conjuntos)</td>
</tr>
<tr>
<td><strong>Destino</strong></td>
<td><code>ADO NET Destination</code> → <strong><code>Transversal.FACT_ACTIVIDADES</code></strong></td>
</tr>
<tr>
<td><strong>Conexión</strong></td>
<td><code>{29BC876E‑…EEB6}</code> → <strong>DWH_COMFENALCO</strong></td>
</tr>
<tr>
<td><strong>BulkInsert</strong></td>
<td><code>UseBulkInsertWhenPossible = true</code></td>
</tr>
<tr>
<td><strong>Timeout</strong></td>
<td>30 seg. (origen y destino)</td>
</tr>
<tr>
<td><strong>Registros estimados</strong></td>
<td>≈ 1 × <code>FACT_PQRS</code> (sin paginación; carga completa)</td>
</tr>
</tbody>
</table>
<hr />
<h4 id="flujo-de-alta-nivel"><strong>Flujo de alta nivel</strong><a class="headerlink" href="#flujo-de-alta-nivel" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code>FACT_ACTIVIDADES
└─ FACT_ACTIVIDADES_PQRS
   ├─ Origen ADO NET  ──► (Resultados UNION de 4 SELECT)
   └─ Destino ADO NET ──► FACT_ACTIVIDADES
</code></pre></div>
<hr />
<h4 id="contenido-del-origen"><strong>Contenido del origen</strong><a class="headerlink" href="#contenido-del-origen" title="Permanent link">&para;</a></h4>
<p>La instrucción SQL crea el alias <strong><code>con</code></strong> uniendo cuatro SELECT:</p>
<ol>
<li>
<p><strong>Afiliados</strong></p>
<ul>
<li>JOIN <code>FACT_PQRS</code> ↔ <code>DIM_AFILIADOS</code></li>
<li>Calcula edad con <code>DATEDIFF</code> sobre <code>DIM_TIEMPO_MENSUAL</code>.</li>
<li>Copia <code>ID_CATEGORIA</code> que ya existe en el afiliado.</li>
</ul>
</li>
<li>
<p><strong>Beneficiarios</strong></p>
<ul>
<li>JOIN <code>FACT_PQRS</code> ↔ <code>DIM_BENEFICIARIOS</code> (+ <code>DIM_AFILIADOS</code> para la categoría).</li>
<li>Si el afiliado no aporta categoría se usa <code>4</code> (D).</li>
</ul>
</li>
<li>
<p><strong>Empresas</strong></p>
<ul>
<li>JOIN <code>FACT_PQRS</code> ↔ <code>DIM_EMPRESAS</code>.</li>
<li>Fija <code>ID_CATEGORIA = 5</code> (E).</li>
<li>Edad = ‑1; datos demográficos genéricos (‑1).</li>
</ul>
</li>
<li>
<p><strong>No aportantes</strong></p>
<ul>
<li>Filtra registros donde <code>ID_AFILIADO + ID_EMPRESA + ID_BENEFICIARIO = -3</code>.</li>
<li>Marca partner ‘0000000000’, categoría <code>4</code>, demografía genérica.</li>
</ul>
</li>
</ol>
<p>Los cuatro bloques añaden campos comunes faltantes con valores por defecto (<code>-1</code>, <code>NULL</code> o literales) y establecen:</p>
<ul>
<li><strong>ACTIVIDAD = 'PQR'</strong></li>
<li><strong>POBLACION_EDUCACION</strong> y sub‑banderas «FORMAL / TÉCNICA / CONTINUA / PROTECCIÓN» basadas en <code>ID_UNIDAD</code>.</li>
<li><strong>FUENTE_PRINCIPAL = '[DWH_COMFENALCO].[Transversal].[FACT_PQRS]'</strong></li>
<li><strong>ID_FECHA</strong> se normaliza al primer día del mes (<code>yyyymm01</code>) para compatibilizar con la dimensión tiempo mensual.</li>
</ul>
<hr />
<h4 id="mapeo-principal-de-columnas"><strong>Mapeo principal de columnas</strong><a class="headerlink" href="#mapeo-principal-de-columnas" title="Permanent link">&para;</a></h4>
<table>
<thead>
<tr>
<th>Salida del origen</th>
<th>Destino <code>FACT_ACTIVIDADES</code></th>
<th>Nota</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ID_PQR</code></td>
<td><code>ID_PQR</code></td>
<td>Identificador único de la PQR</td>
</tr>
<tr>
<td><code>ID_UNIDAD</code></td>
<td><code>ID_UNIDAD</code></td>
<td>1 = Educación Formal, 2 = Técnica…</td>
</tr>
<tr>
<td><code>ID_FECHA</code></td>
<td><code>ID_FECHA</code></td>
<td>Fecha mensual normalizada</td>
</tr>
<tr>
<td><code>ESTADO_PQR</code></td>
<td><code>ESTADO_PQR</code></td>
<td>Abierta, Cerrada, etc.</td>
</tr>
<tr>
<td>…</td>
<td>…</td>
<td>40+ columnas mapeadas automáticamente (ver XML)</td>
</tr>
</tbody>
</table>
<p>Campos no aplicables a cierto tipo de solicitante se rellenan con:</p>
<ul>
<li><code>‑1</code> para claves foráneas ausentes</li>
<li><code>NULL</code> para fechas y textos indeterminados</li>
<li>Valores literales de control (<code>2</code> para discapacidad predeterminada, ‘SI/NO’ en banderas de educación).</li>
</ul>
<hr />
<h4 id="manejo-de-errores"><strong>Manejo de errores</strong><a class="headerlink" href="#manejo-de-errores" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>Salida de error</strong> configurada tanto en origen como en destino.</li>
<li>Filas que fallen se redirigen al <code>Error Output</code> (actualmente sin downstream handler — solo logging).</li>
</ul>
<hr />
<h4 id="relacion-con-el-resto-del-paquete"><strong>Relación con el resto del paquete</strong><a class="headerlink" href="#relacion-con-el-resto-del-paquete" title="Permanent link">&para;</a></h4>
<table>
<thead>
<tr>
<th>Componente</th>
<th>Rol</th>
<th>Interacción</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>FACT_ACTIVIDADES_PQRS</code></td>
<td><strong>Carga PQRS</strong></td>
<td>Complementa las cargas de <strong>Afiliados</strong> y <strong>Beneficiarios</strong> dentro de <code>FACT_ACTIVIDADES</code>; todos escriben sobre la misma table con distintas <em>ACTIVIDAD</em> (<code>AFILIACION</code>, <code>PQR</code>, etc.).</td>
</tr>
<tr>
<td><code>Transversal.FACT_PQRS</code></td>
<td>Fuente operacional</td>
<td>Contiene los movimientos brutos de PQRS — punto de partida del flujo.</td>
</tr>
<tr>
<td><code>Transversal.DIM_TIEMPO_MENSUAL</code></td>
<td>Dimensión tiempo</td>
<td>Provee la fecha de corte mensual (<code>ID_FECHA</code>, <code>FECHA</code>).</td>
</tr>
<tr>
<td><code>DIM_AFILIADOS</code>, <code>DIM_BENEFICIARIOS</code>, <code>DIM_EMPRESAS</code></td>
<td>Dimensiones de contexto</td>
<td>Enriquecen con datos demográficos y de categoría.</td>
</tr>
</tbody>
</table>
<hr />
<h4 id="buenas-practicas-destacadas"><strong>Buenas prácticas destacadas</strong><a class="headerlink" href="#buenas-practicas-destacadas" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>Normalización de fechas</strong> a fin de mes para garantizar consistencia temporal.</li>
<li><strong>Discriminación por tipo de solicitante</strong> mediante <code>UNION ALL</code> (evita lógica condicional pesada).</li>
<li><strong>Carga masiva (<code>BulkInsert</code>)</strong> directamente a la fact table, minimizando staging intermedio.</li>
<li><strong>Bandera de población educativa</strong> derivada de la unidad para facilitar reporting de formación.</li>
</ul>
<h3 id="fact_actividades_nps"><strong>FACT_ACTIVIDADES_NPS</strong><a class="headerlink" href="#fact_actividades_nps" title="Permanent link">&para;</a></h3>
<p>El componente <strong><code>FACT_ACTIVIDADES_NPS</code></strong> forma parte del paquete SSIS <strong><code>FACT_ACTIVIDADES</code></strong> y está diseñado para cargar la información de Net Promoter Score (NPS) en la tabla de hechos <strong><code>FACT_ACTIVIDADES</code></strong> del Data Warehouse <strong><code>DWH_COMFENALCO</code></strong>. Su función principal es extraer, transformar y cargar los datos relacionados con las encuestas NPS y las actividades asociadas para su posterior análisis.</p>
<hr />
<h4 id="descripcion-general_7"><strong>Descripción General</strong><a class="headerlink" href="#descripcion-general_7" title="Permanent link">&para;</a></h4>
<p><strong><code>FACT_ACTIVIDADES_NPS</code></strong> es una <strong>Data Flow Task</strong> que combina un origen ADO .NET y un destino ADO .NET.</p>
<ul>
<li>El <strong>origen</strong> (componente <strong><code>fact nps</code></strong>) emplea una consulta Transact‑SQL para obtener información de varias tablas de hechos y dimensiones.</li>
<li>El <strong>destino</strong> (componente <strong><code>Destino de ADO NET</code></strong>) inserta los registros transformados en la tabla <strong><code>[Transversal].[FACT_ACTIVIDADES]</code></strong> utilizando modo bulk insert cuando es posible, lo que optimiza la carga.</li>
</ul>
<hr />
<h4 id="ubicacion-en-el-paquete_7"><strong>Ubicación en el Paquete</strong><a class="headerlink" href="#ubicacion-en-el-paquete_7" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>Paquete</strong>: <strong><code>FACT_ACTIVIDADES</code></strong></li>
<li><strong>Tarea</strong>: <strong><code>FACT_ACTIVIDADES_NPS</code></strong></li>
<li><strong>Componente</strong>: <strong><code>Microsoft.Pipeline</code></strong> (Data Flow Task)</li>
<li><strong>DTSID</strong>: <strong><code>{89720DBD-8A16-4443-AA6F-BBB82A9BC068}</code></strong></li>
</ul>
<hr />
<h4 id="proposito_7"><strong>Propósito</strong><a class="headerlink" href="#proposito_7" title="Permanent link">&para;</a></h4>
<p>Extraer las respuestas NPS registradas en <strong><code>FACT_ENCUESTAS</code></strong>, enriquecerlas con información de afiliados, beneficiarios, empresas y tiempos, y consolidar todo en la tabla <strong><code>FACT_ACTIVIDADES</code></strong>. Esto permite analizar la satisfacción (NPS) junto con atributos demográficos, de tiempo y de negocio en el cubo OLAP o en reportes relacionales.</p>
<hr />
<h4 id="detalles-de-implementacion_7"><strong>Detalles de Implementación</strong><a class="headerlink" href="#detalles-de-implementacion_7" title="Permanent link">&para;</a></h4>
<table>
<thead>
<tr>
<th>Elemento</th>
<th>Descripción</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Origen de Datos</strong></td>
<td>Componente <strong><code>fact nps</code></strong> (ADO .NET Source) conectado a <strong><code>DWH_COMFENALCO</code></strong>. Recupera los datos mediante la instrucción SQL mostrada más abajo.</td>
</tr>
<tr>
<td><strong>Destino de Carga</strong></td>
<td>Componente <strong><code>Destino de ADO NET</code></strong> que inserta en <strong><code>[Transversal].[FACT_ACTIVIDADES]</code></strong>.</td>
</tr>
<tr>
<td><strong>Conexión</strong></td>
<td><code>Project.ConnectionManagers[DWH_COMFENALCO]</code> – GUID <code>{29BC876E-1EAF-4F6F-8F38-39B8E881EEB6}:external</code>.</td>
</tr>
<tr>
<td><strong>Modo de Inserción</strong></td>
<td><code>UseBulkInsertWhenPossible = true</code>, <code>BatchSize = 0</code> (usa el tamaño de búfer interno).</td>
</tr>
<tr>
<td><strong>Flujo</strong></td>
<td>La salida del origen se conecta directamente a la entrada del destino a través del path <strong>“Salida de origen de ADO NET”</strong>.</td>
</tr>
</tbody>
</table>
<hr />
<h4 id="logica-de-negocio_5"><strong>Lógica de Negocio</strong><a class="headerlink" href="#logica-de-negocio_5" title="Permanent link">&para;</a></h4>
<ol>
<li>
<p><strong>Consulta principal (<code>consulta</code>)</strong></p>
<ul>
<li>Recupera los registros NPS de <strong><code>[Transversal].[FACT_ENCUESTAS]</code></strong> filtrando <code>NPS = 'SI'</code>.</li>
<li>Enriquecer con datos de <strong>dimensiones</strong>: <code>DIM_AFILIADOS</code>, <code>DIM_BENEFICIARIOS</code>, <code>DIM_EMPRESAS</code> y <code>DIM_APORTANTE_NOAFILIADO</code>.</li>
<li>Ajusta claves de tiempo al primer día de mes y asegura la existencia en <strong><code>DIM_TIEMPO_MENSUAL</code></strong>.</li>
</ul>
</li>
<li>
<p><strong>Tabla auxiliar (<code>partnerTable</code>)</strong></p>
<ul>
<li>Agrega información de partners a partir de <strong><code>STG_FACT_AFILIACIONES</code></strong> (actividad = 'AFILIACION').</li>
</ul>
</li>
<li>
<p><strong>Resultado final</strong></p>
<ul>
<li>Une <code>consulta</code> con <code>partnerTable</code> para completar atributos faltantes (partner afiliado, categoría, género, edad, discapacidad).</li>
<li>Añade campos calculados y valores por defecto (por ejemplo, <code>ID_UNIDAD = COALESCE(ID_UNIDAD,5)</code>, <code>ID_CURSO = -1</code>).</li>
<li>Etiqueta la fuente de los datos con la columna <code>FUENTE_PRINCIPAL</code>.</li>
</ul>
</li>
</ol>
<hr />
<h4 id="relacion-con-otros-componentes_6"><strong>Relación con Otros Componentes</strong><a class="headerlink" href="#relacion-con-otros-componentes_6" title="Permanent link">&para;</a></h4>
<ul>
<li>Depende de la carga previa de <strong><code>DIM_TIEMPO_MENSUAL</code></strong> para validar las fechas.</li>
<li>Requiere que las dimensiones de <strong>Afiliados</strong>, <strong>Beneficiarios</strong>, <strong>Empresas</strong> y <strong>Aportantes No Afiliados</strong> estén actualizadas para las claves foráneas.</li>
<li>La tabla <strong><code>FACT_ACTIVIDADES</code></strong> es consumida por cubos OLAP y reportes analíticos que combinan actividades (ventas, cursos, NPS, etc.).</li>
</ul>
<hr />
<h4 id="script-sql-de-extraccion_1"><strong>Script SQL de Extracción</strong><a class="headerlink" href="#script-sql-de-extraccion_1" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="k">WITH</span><span class="w"> </span><span class="n">consulta</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="cm">/* -------------------------------------------------</span>
<span class="cm">       Construye el dataset base a partir de ENCUESTAS NPS</span>
<span class="cm">    -------------------------------------------------- */</span>
<span class="w">    </span><span class="k">SELECT</span><span class="w"> </span>
<span class="w">        </span><span class="k">NULL</span><span class="w">                     </span><span class="k">AS</span><span class="w"> </span><span class="n">CURSO</span><span class="p">,</span>
<span class="w">        </span><span class="k">NULL</span><span class="w">                     </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_GRADO</span><span class="p">,</span>
<span class="w">        </span><span class="k">NULL</span><span class="w">                     </span><span class="k">AS</span><span class="w"> </span><span class="n">ANIO_ACADEMICO</span><span class="p">,</span>
<span class="w">        </span><span class="n">PARTNER</span><span class="p">,</span>
<span class="w">        </span><span class="k">NULL</span><span class="w">                     </span><span class="k">AS</span><span class="w"> </span><span class="n">ESTADO</span><span class="p">,</span>
<span class="w">        </span><span class="k">NULL</span><span class="w">                     </span><span class="k">AS</span><span class="w"> </span><span class="n">ESTADO_PAGO</span><span class="p">,</span>
<span class="w">        </span><span class="n">ID_FECHA</span><span class="p">,</span>
<span class="w">        </span><span class="k">NULL</span><span class="w">                     </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_ESTADO_GESTION</span><span class="p">,</span>
<span class="w">        </span><span class="k">NULL</span><span class="w">                     </span><span class="k">AS</span><span class="w"> </span><span class="n">FECHA_ADMISION</span><span class="p">,</span>
<span class="w">        </span><span class="k">NULL</span><span class="w">                     </span><span class="k">AS</span><span class="w"> </span><span class="n">SERVICIO_TRANSPORTE</span><span class="p">,</span>
<span class="w">        </span><span class="n">ID_EMPRESA</span><span class="p">,</span>
<span class="w">        </span><span class="n">ID_AFILIADO</span><span class="p">,</span>
<span class="w">        </span><span class="n">ID_BENEFICIARIO</span><span class="p">,</span>
<span class="w">        </span><span class="n">ID_TIPO_AFILIADO</span><span class="p">,</span>
<span class="w">        </span><span class="n">TIPO_AFILIADO</span><span class="p">,</span>
<span class="w">        </span><span class="n">FECHA_AFILIACION</span><span class="p">,</span>
<span class="w">        </span><span class="n">FECHA_RETIRO</span><span class="p">,</span>
<span class="w">        </span><span class="n">ID_ESTADO_CIVIL</span><span class="p">,</span>
<span class="w">        </span><span class="n">ID_PERTENENCIA_ETNICA</span><span class="p">,</span>
<span class="w">        </span><span class="n">ID_FACTOR_VULNERABILIDAD</span><span class="p">,</span>
<span class="w">        </span><span class="n">ESTRATO</span><span class="p">,</span>
<span class="w">        </span><span class="n">ID_CIUDAD</span><span class="p">,</span>
<span class="w">        </span><span class="n">SALARIO_BASICO</span><span class="p">,</span>
<span class="w">        </span><span class="n">FECHA_MENSUAL</span><span class="p">,</span>
<span class="w">        </span><span class="k">NULL</span><span class="w">                     </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_CONCEPTO</span><span class="p">,</span>
<span class="w">        </span><span class="k">NULL</span><span class="w">                     </span><span class="k">AS</span><span class="w"> </span><span class="n">VALOR_FACTURADO</span><span class="p">,</span>
<span class="w">        </span><span class="k">NULL</span><span class="w">                     </span><span class="k">AS</span><span class="w"> </span><span class="n">VALOR_PAGADO</span><span class="p">,</span>
<span class="w">        </span><span class="k">NULL</span><span class="w">                     </span><span class="k">AS</span><span class="w"> </span><span class="n">ADEUDA</span><span class="p">,</span>
<span class="w">        </span><span class="k">NULL</span><span class="w">                     </span><span class="k">AS</span><span class="w"> </span><span class="n">NO_PRESTAMOS</span><span class="p">,</span>
<span class="w">        </span><span class="s1">&#39;INDEFINIDO&#39;</span><span class="w">             </span><span class="k">AS</span><span class="w"> </span><span class="n">DESCRIPCION</span><span class="p">,</span>
<span class="w">        </span><span class="n">ACTIVIDAD</span><span class="p">,</span>
<span class="w">        </span><span class="n">ESTADOREGISTRO</span><span class="p">,</span>
<span class="w">        </span><span class="n">TIPO_POBLACION</span><span class="p">,</span>
<span class="w">        </span><span class="n">TOTAL_APORTES</span><span class="p">,</span>
<span class="w">        </span><span class="n">NUMERO_APORTES</span><span class="p">,</span>
<span class="w">        </span><span class="n">CALIFICACION</span><span class="p">,</span>
<span class="w">        </span><span class="k">COALESCE</span><span class="p">(</span><span class="n">ID_UNIDAD</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span><span class="w">    </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_UNIDAD</span><span class="p">,</span>
<span class="w">        </span><span class="o">-</span><span class="mi">1</span><span class="w">                       </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_CURSO</span><span class="p">,</span>
<span class="w">        </span><span class="o">-</span><span class="mi">1</span><span class="w">                       </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_PROGRAMA</span><span class="p">,</span>
<span class="w">        </span><span class="o">-</span><span class="mi">1</span><span class="w">                       </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_TARIFA</span><span class="p">,</span>
<span class="w">        </span><span class="s1">&#39;SI&#39;</span><span class="w">                     </span><span class="k">AS</span><span class="w"> </span><span class="n">POBLACION_EDUCACION</span><span class="p">,</span>
<span class="w">        </span><span class="k">CASE</span><span class="w"> </span><span class="k">WHEN</span><span class="w"> </span><span class="n">ID_UNIDAD</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="s1">&#39;SI&#39;</span><span class="w"> </span><span class="k">ELSE</span><span class="w"> </span><span class="s1">&#39;NO&#39;</span><span class="w"> </span><span class="k">END</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">POBLACION_EDUCACION_FORMAL</span><span class="p">,</span>
<span class="w">        </span><span class="k">CASE</span><span class="w"> </span><span class="k">WHEN</span><span class="w"> </span><span class="n">ID_UNIDAD</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="s1">&#39;SI&#39;</span><span class="w"> </span><span class="k">ELSE</span><span class="w"> </span><span class="s1">&#39;NO&#39;</span><span class="w"> </span><span class="k">END</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">POBLACION_EDUCACION_TECNICA</span><span class="p">,</span>
<span class="w">        </span><span class="k">CASE</span><span class="w"> </span><span class="k">WHEN</span><span class="w"> </span><span class="n">ID_UNIDAD</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="s1">&#39;SI&#39;</span><span class="w"> </span><span class="k">ELSE</span><span class="w"> </span><span class="s1">&#39;NO&#39;</span><span class="w"> </span><span class="k">END</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">POBLACION_EDUCACION_CONTINUA</span><span class="p">,</span>
<span class="w">        </span><span class="k">CASE</span><span class="w"> </span><span class="k">WHEN</span><span class="w"> </span><span class="n">ID_UNIDAD</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="s1">&#39;SI&#39;</span><span class="w"> </span><span class="k">ELSE</span><span class="w"> </span><span class="s1">&#39;NO&#39;</span><span class="w"> </span><span class="k">END</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">POBLACION_EDUCACION_PROTECCION</span>
<span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="p">(</span>
<span class="w">        </span><span class="cm">/* ---------- Datos crudos de FACT_ENCUESTAS y dimensiones ---------- */</span>
<span class="w">        </span><span class="k">SELECT</span><span class="w"> </span>
<span class="w">            </span><span class="k">COALESCE</span><span class="p">(</span><span class="k">NULLIF</span><span class="p">(</span><span class="n">de</span><span class="p">.</span><span class="n">PARTNER</span><span class="p">,</span><span class="s1">&#39;0000000000&#39;</span><span class="p">),</span>
<span class="w">                     </span><span class="k">NULLIF</span><span class="p">(</span><span class="n">da</span><span class="p">.</span><span class="n">PARTNER</span><span class="p">,</span><span class="s1">&#39;0000000000&#39;</span><span class="p">),</span>
<span class="w">                     </span><span class="k">NULLIF</span><span class="p">(</span><span class="n">db</span><span class="p">.</span><span class="n">PARTNER</span><span class="p">,</span><span class="s1">&#39;0000000000&#39;</span><span class="p">),</span>
<span class="w">                     </span><span class="n">daa</span><span class="p">.</span><span class="n">PARTNER</span><span class="p">)</span><span class="w">         </span><span class="k">AS</span><span class="w"> </span><span class="n">PARTNER</span><span class="p">,</span>
<span class="w">            </span><span class="n">fe</span><span class="p">.</span><span class="n">ID_EMPRESA</span><span class="p">,</span>
<span class="w">            </span><span class="n">fe</span><span class="p">.</span><span class="n">ID_AFILIADO</span><span class="p">,</span>
<span class="w">            </span><span class="n">fe</span><span class="p">.</span><span class="n">ID_BENEFICIARIO</span><span class="p">,</span>
<span class="w">            </span><span class="k">NULL</span><span class="w">                       </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_TIPO_AFILIADO</span><span class="p">,</span>
<span class="w">            </span><span class="k">NULL</span><span class="w">                       </span><span class="k">AS</span><span class="w"> </span><span class="n">TIPO_AFILIADO</span><span class="p">,</span>
<span class="w">            </span><span class="k">COALESCE</span><span class="p">(</span><span class="n">da</span><span class="p">.</span><span class="n">ID_CATEGORIA</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_CATEGORIA</span><span class="p">,</span>
<span class="w">            </span><span class="k">NULL</span><span class="w">                       </span><span class="k">AS</span><span class="w"> </span><span class="n">FECHA_AFILIACION</span><span class="p">,</span>
<span class="w">            </span><span class="k">NULL</span><span class="w">                       </span><span class="k">AS</span><span class="w"> </span><span class="n">FECHA_RETIRO</span><span class="p">,</span>
<span class="w">            </span><span class="k">COALESCE</span><span class="p">(</span><span class="n">da</span><span class="p">.</span><span class="n">ID_GENERO</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w">  </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_GENERO</span><span class="p">,</span>
<span class="w">            </span><span class="o">-</span><span class="mi">1</span><span class="w">                         </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_ESTADO_CIVIL</span><span class="p">,</span>
<span class="w">            </span><span class="o">-</span><span class="mi">1</span><span class="w">                         </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_PERTENENCIA_ETNICA</span><span class="p">,</span>
<span class="w">            </span><span class="o">-</span><span class="mi">1</span><span class="w">                         </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_FACTOR_VULNERABILIDAD</span><span class="p">,</span>
<span class="w">            </span><span class="k">NULL</span><span class="w">                       </span><span class="k">AS</span><span class="w"> </span><span class="n">ESTRATO</span><span class="p">,</span>
<span class="w">            </span><span class="k">NULL</span><span class="w">                       </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_CIUDAD</span><span class="p">,</span>
<span class="w">            </span><span class="k">NULL</span><span class="w">                       </span><span class="k">AS</span><span class="w"> </span><span class="n">SALARIO_BASICO</span><span class="p">,</span>
<span class="w">            </span><span class="k">NULL</span><span class="w">                       </span><span class="k">AS</span><span class="w"> </span><span class="n">FECHA_MENSUAL</span><span class="p">,</span>
<span class="w">            </span><span class="k">LEFT</span><span class="p">(</span><span class="n">fe</span><span class="p">.</span><span class="n">ID_FECHA</span><span class="p">,</span><span class="mi">6</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="o">+</span><span class="mi">1</span><span class="w">  </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_FECHA</span><span class="p">,</span>
<span class="w">            </span><span class="n">fe</span><span class="p">.</span><span class="n">ID_UNIDAD</span><span class="p">,</span>
<span class="w">            </span><span class="k">NULL</span><span class="w">                       </span><span class="k">AS</span><span class="w"> </span><span class="n">ESTADOREGISTRO</span><span class="p">,</span>
<span class="w">            </span><span class="k">NULL</span><span class="w">                       </span><span class="k">AS</span><span class="w"> </span><span class="n">TIPO_POBLACION</span><span class="p">,</span>
<span class="w">            </span><span class="s1">&#39;NSU&#39;</span><span class="w">                      </span><span class="k">AS</span><span class="w"> </span><span class="n">ACTIVIDAD</span><span class="p">,</span>
<span class="w">            </span><span class="k">NULL</span><span class="w">                       </span><span class="k">AS</span><span class="w"> </span><span class="n">TOTAL_APORTES</span><span class="p">,</span>
<span class="w">            </span><span class="k">NULL</span><span class="w">                       </span><span class="k">AS</span><span class="w"> </span><span class="n">NUMERO_APORTES</span><span class="p">,</span>
<span class="w">            </span><span class="n">fe</span><span class="p">.</span><span class="n">CALIFICACION</span>
<span class="w">        </span><span class="k">FROM</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Transversal</span><span class="p">].[</span><span class="n">FACT_ENCUESTAS</span><span class="p">]</span><span class="w">              </span><span class="n">fe</span>
<span class="w">        </span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Transversal</span><span class="p">].[</span><span class="n">DIM_AFILIADOS</span><span class="p">]</span><span class="w">          </span><span class="n">da</span><span class="w">  </span><span class="k">ON</span><span class="w"> </span><span class="n">fe</span><span class="p">.</span><span class="n">ID_AFILIADO</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">da</span><span class="p">.</span><span class="n">ID_AFILIADO</span>
<span class="w">        </span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Transversal</span><span class="p">].[</span><span class="n">DIM_BENEFICIARIOS</span><span class="p">]</span><span class="w">      </span><span class="n">db</span><span class="w">  </span><span class="k">ON</span><span class="w"> </span><span class="n">fe</span><span class="p">.</span><span class="n">ID_BENEFICIARIO</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">db</span><span class="p">.</span><span class="n">ID_BENEFICIARIO</span>
<span class="w">        </span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Transversal</span><span class="p">].[</span><span class="n">DIM_EMPRESAS</span><span class="p">]</span><span class="w">           </span><span class="n">de</span><span class="w">  </span><span class="k">ON</span><span class="w"> </span><span class="n">fe</span><span class="p">.</span><span class="n">ID_EMPRESA</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">de</span><span class="p">.</span><span class="n">ID_EMPRESA</span>
<span class="w">        </span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Transversal</span><span class="p">].[</span><span class="n">DIM_APORTANTE_NOAFILIADO</span><span class="p">]</span><span class="w"> </span><span class="n">daa</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">fe</span><span class="p">.</span><span class="n">ID_APORTANTE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">daa</span><span class="p">.</span><span class="n">ID_APORTANTE</span>
<span class="w">        </span><span class="k">WHERE</span><span class="w"> </span><span class="n">fe</span><span class="p">.</span><span class="n">NPS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;SI&#39;</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">uni</span>
<span class="w">    </span><span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Transversal</span><span class="p">].[</span><span class="n">DIM_TIEMPO_MENSUAL</span><span class="p">]</span><span class="w"> </span><span class="n">dimM</span>
<span class="w">        </span><span class="k">ON</span><span class="w"> </span><span class="n">uni</span><span class="p">.</span><span class="n">ID_FECHA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dimM</span><span class="p">.</span><span class="n">ID_FECHA</span>
<span class="p">),</span>
<span class="n">partnerTable</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="cm">/* ----------------------------------------------</span>
<span class="cm">       Datos complementarios de afiliaciones por PARTNER</span>
<span class="cm">    ----------------------------------------------- */</span>
<span class="w">    </span><span class="k">SELECT</span><span class="w"> </span>
<span class="w">        </span><span class="n">PARTNER</span><span class="p">,</span>
<span class="w">        </span><span class="n">ID_FECHA</span><span class="p">,</span>
<span class="w">        </span><span class="k">MAX</span><span class="p">(</span><span class="n">PARTNER_AFILIADO</span><span class="p">)</span><span class="w">           </span><span class="k">AS</span><span class="w"> </span><span class="n">PARTNER_AFILIADO</span><span class="p">,</span>
<span class="w">        </span><span class="k">MAX</span><span class="p">(</span><span class="n">PARTNER_EMPRESA</span><span class="p">)</span><span class="w">            </span><span class="k">AS</span><span class="w"> </span><span class="n">PARTNER_EMPRESA</span><span class="p">,</span>
<span class="w">        </span><span class="k">MIN</span><span class="p">(</span><span class="n">ID_CATEGORIA</span><span class="p">)</span><span class="w">               </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_CATEGORIA</span><span class="p">,</span>
<span class="w">        </span><span class="k">MAX</span><span class="p">(</span><span class="n">ID_GENERO</span><span class="p">)</span><span class="w">                  </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_GENERO</span><span class="p">,</span>
<span class="w">        </span><span class="k">MAX</span><span class="p">(</span><span class="n">FECHA_NACIMIENTO</span><span class="p">)</span><span class="w">           </span><span class="k">AS</span><span class="w"> </span><span class="n">FECHA_NACIMIENTO</span><span class="p">,</span>
<span class="w">        </span><span class="k">MAX</span><span class="p">(</span><span class="n">EDAD</span><span class="p">)</span><span class="w">                       </span><span class="k">AS</span><span class="w"> </span><span class="n">EDAD</span><span class="p">,</span>
<span class="w">        </span><span class="k">MAX</span><span class="p">(</span><span class="n">DISCAPACIDAD</span><span class="p">)</span><span class="w">               </span><span class="k">AS</span><span class="w"> </span><span class="n">DISCAPACIDAD</span>
<span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="p">[</span><span class="n">STAGE_AREA</span><span class="p">].[</span><span class="n">Transversal</span><span class="p">].[</span><span class="n">STG_FACT_AFILIACIONES</span><span class="p">]</span>
<span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="n">ACTIVIDAD</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;AFILIACION&#39;</span>
<span class="w">    </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">PARTNER</span><span class="p">,</span><span class="w"> </span><span class="n">ID_FECHA</span>
<span class="p">)</span>
<span class="k">SELECT</span><span class="w">  </span>
<span class="w">    </span><span class="k">c</span><span class="p">.</span><span class="o">*</span><span class="p">,</span>
<span class="w">    </span><span class="k">COALESCE</span><span class="p">(</span><span class="n">pt</span><span class="p">.</span><span class="n">PARTNER_AFILIADO</span><span class="p">,</span><span class="s1">&#39;0000000000&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">PARTNER_AFILIADO</span><span class="p">,</span>
<span class="w">    </span><span class="k">COALESCE</span><span class="p">(</span><span class="n">pt</span><span class="p">.</span><span class="n">PARTNER_EMPRESA</span><span class="p">,</span><span class="s1">&#39;0000000000&#39;</span><span class="p">)</span><span class="w">  </span><span class="k">AS</span><span class="w"> </span><span class="n">PARTNER_EMPRESA</span><span class="p">,</span>
<span class="w">    </span><span class="s1">&#39;[DWH_COMFENALCO].[Transversal].[FACT_ENCUESTAS]&#39;</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">FUENTE_PRINCIPAL</span><span class="p">,</span>
<span class="w">    </span><span class="k">COALESCE</span><span class="p">(</span><span class="n">pt</span><span class="p">.</span><span class="n">ID_CATEGORIA</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span><span class="w">    </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_CATEGORIA</span><span class="p">,</span>
<span class="w">    </span><span class="k">COALESCE</span><span class="p">(</span><span class="n">pt</span><span class="p">.</span><span class="n">ID_GENERO</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w">      </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_GENERO</span><span class="p">,</span>
<span class="w">    </span><span class="n">pt</span><span class="p">.</span><span class="n">FECHA_NACIMIENTO</span><span class="p">,</span>
<span class="w">    </span><span class="k">COALESCE</span><span class="p">(</span><span class="n">pt</span><span class="p">.</span><span class="n">EDAD</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w">           </span><span class="k">AS</span><span class="w"> </span><span class="n">EDAD</span><span class="p">,</span>
<span class="w">    </span><span class="k">COALESCE</span><span class="p">(</span><span class="n">pt</span><span class="p">.</span><span class="n">DISCAPACIDAD</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="w">    </span><span class="k">AS</span><span class="w"> </span><span class="n">DISCAPACIDAD</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">consulta</span><span class="w"> </span><span class="k">c</span>
<span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">partnerTable</span><span class="w"> </span><span class="n">pt</span>
<span class="w">    </span><span class="k">ON</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">PARTNER</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pt</span><span class="p">.</span><span class="n">PARTNER</span>
<span class="w">   </span><span class="k">AND</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">ID_FECHA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pt</span><span class="p">.</span><span class="n">ID_FECHA</span><span class="p">;</span>
</code></pre></div>
<hr />
<blockquote>
<p><strong>Nota:</strong></p>
<ul>
<li>La consulta usa varias funciones <code>COALESCE</code> y valores por defecto (<code>-1</code>, <code>'SI'</code>, <code>'NO'</code>, <code>'INDEFINIDO'</code>) para garantizar integridad referencial y evitar valores nulos en la tabla de hechos.</li>
<li>Las columnas de tiempo se alinean al primer día de cada mes para aprovechar la clave existente en <strong><code>DIM_TIEMPO_MENSUAL</code></strong>.</li>
<li>El campo <code>FUENTE_PRINCIPAL</code> documenta la procedencia original de los datos, facilitando trazabilidad en el Data Warehouse.</li>
</ul>
</blockquote>
<hr />
<h3 id="fact_actividades_proteccion"><strong>FACT_ACTIVIDADES_PROTECCION</strong><a class="headerlink" href="#fact_actividades_proteccion" title="Permanent link">&para;</a></h3>
<p>El componente <strong><code>FACT_ACTIVIDADES_PROTECCION</code></strong> forma parte del paquete SSIS <strong><code>FACT_ACTIVIDADES</code></strong> y consolida las actividades del área de <strong>Protección</strong> (ventas, caracterizaciones, deserciones y entrega de material) en la tabla <strong><code>FACT_ACTIVIDADES</code></strong> del Data Warehouse <strong><code>DWH_COMFENALCO</code></strong>.</p>
<hr />
<h4 id="descripcion-general_8"><strong>Descripción general</strong><a class="headerlink" href="#descripcion-general_8" title="Permanent link">&para;</a></h4>
<p>Se trata de una <strong>tarea de flujo de datos</strong> (<em>Data Flow Task</em>) que:</p>
<ol>
<li><strong>Extrae</strong> la información mediante una fuente <strong>ADO .NET</strong> (componente <strong><code>proteccion</code></strong>) usando una consulta SQL que unifica varias tablas fact y adiciona metadatos procedentes de otras dimensiones.</li>
<li><strong>Transforma</strong> determinados campos con el componente <strong><code>Data Conversion</code></strong> (por ejemplo, convierte numéricos a decimales y a cadenas).</li>
<li><strong>Carga</strong> el resultado en <strong><code>[Transversal].[FACT_ACTIVIDADES]</code></strong> mediante un <strong>destino ADO .NET</strong> con inserción masiva (<em>SqlBulkCopy</em>).</li>
</ol>
<hr />
<h4 id="ubicacion-en-el-paquete_8"><strong>Ubicación en el paquete</strong><a class="headerlink" href="#ubicacion-en-el-paquete_8" title="Permanent link">&para;</a></h4>
<table>
<thead>
<tr>
<th>Nivel</th>
<th>Valor</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Paquete</strong></td>
<td><code>FACT_ACTIVIDADES</code></td>
</tr>
<tr>
<td><strong>Ruta interna</strong></td>
<td><code>Package\FACT_ACTIVIDADES\FACT_ACTIVIDADES_PROTECCION</code></td>
</tr>
<tr>
<td><strong>Tipo de ejecutable</strong></td>
<td><code>Microsoft.Pipeline</code> (Data Flow Task)</td>
</tr>
<tr>
<td><strong>DTSID</strong></td>
<td><code>{96A6D477-CB23-402D-9C9C-7D0337963198}</code></td>
</tr>
</tbody>
</table>
<hr />
<h4 id="proposito_8"><strong>Propósito</strong><a class="headerlink" href="#proposito_8" title="Permanent link">&para;</a></h4>
<p>Consolidar, a nivel mensual, todas las actividades de los programas de protección en un único <em>fact table</em> (<code>FACT_ACTIVIDADES</code>) para su explotación analítica.
Se integran ventas, caracterizaciones, deserciones y entregas de material junto con atributos poblacionales, afiliatorios y temporales.</p>
<hr />
<h4 id="detalles-de-implementacion_8"><strong>Detalles de implementación</strong><a class="headerlink" href="#detalles-de-implementacion_8" title="Permanent link">&para;</a></h4>
<table>
<thead>
<tr>
<th>Elemento</th>
<th>Descripción</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Origen de datos</strong></td>
<td>Componente <strong><code>proteccion</code></strong> – ADO .NET Source. Extrae datos mediante la consulta SQL que se documenta más abajo.</td>
</tr>
<tr>
<td><strong>Transformaciones</strong></td>
<td><strong><code>Data Conversion</code></strong> crea:<br/>• <code>Copy of VALOR_MATERIAL</code> → <code>decimal(28,2)</code><br/>• <code>Copy of VALOR_PAGADO_SIN_IMP</code> → <code>decimal(28,2)</code><br/>• <code>Copy of SUBSIDIO</code> → <code>nvarchar(50)</code></td>
</tr>
<tr>
<td><strong>Destino de carga</strong></td>
<td>Componente <strong><code>Destino de ADO NET</code></strong> – tabla <strong><code>[Transversal].[FACT_ACTIVIDADES]</code></strong>. Usa <code>UseBulkInsertWhenPossible = true</code> para mayor rendimiento.</td>
</tr>
<tr>
<td><strong>Conexiones</strong></td>
<td><code>Project.ConnectionManagers[DWH_COMFENALCO]</code> (origen y destino).</td>
</tr>
<tr>
<td><strong>Filas por lote</strong></td>
<td>0 (usa el tamaño de búfer interno de SSIS).</td>
</tr>
<tr>
<td><strong>Timeout comandos</strong></td>
<td>30 s (por defecto)</td>
</tr>
</tbody>
</table>
<hr />
<h4 id="logica-de-negocio_6"><strong>Lógica de negocio</strong><a class="headerlink" href="#logica-de-negocio_6" title="Permanent link">&para;</a></h4>
<ol>
<li>
<p><strong>Unificación de fuentes</strong> – la CTE <code>consulta</code> agrupa registros de:</p>
<ul>
<li><code>[Proteccion].[FACT_VENTA]</code></li>
<li><code>[Proteccion].[FACT_CARACTERIZACION]</code> + <code>[Proteccion].[DIM_PROGRAMA]</code></li>
<li><code>[Proteccion].[FACT_DESERCION]</code> + <code>[Proteccion].[DIM_PROGRAMA]</code></li>
<li><code>[Proteccion].[FACT_ENTREGA_MATERIAL]</code></li>
</ul>
</li>
<li>
<p><strong>Enriquecimiento poblacional</strong> – se enlaza con <code>[Proteccion].[DIM_POBLACION]</code> para obtener <code>ID_AFILIADO</code>, <code>ID_BENEFICIARIO</code>, <code>ID_EMPRESA</code>, etc.</p>
</li>
<li>
<p><strong>Datos afiliatorios</strong> – se cruzan las dimensiones de afiliados, beneficiarios, empresas y aportantes no afiliados del esquema <strong>Transversal</strong> para resolver el <code>PARTNER</code>.</p>
</li>
<li>
<p><strong>Calendario</strong> – se obliga a que la fecha fact (<code>ID_FECHA</code>) exista en <code>[Transversal].[DIM_TIEMPO_MENSUAL]</code>.</p>
</li>
<li>
<p><strong>Metadatos de afiliación</strong> – se trae información complementaria de <code>[STAGE_AREA].[Transversal].[STG_FACT_AFILIACIONES]</code> (CTE <code>partnerTable</code>) para categoría, género, edad, discapacidad y partners relacionados.</p>
</li>
<li>
<p><strong>Flags de población</strong> – se derivan los campos <code>POBLACION_EDUCACION*</code> según la unidad académica (<code>ID_UNIDAD</code>).</p>
</li>
<li>
<p><strong>Conversión de tipos</strong> – se ajustan tipos numéricos y se generan copias para adecuarse al schema de destino.</p>
</li>
</ol>
<hr />
<h4 id="relacion-con-otros-componentes_7"><strong>Relación con otros componentes</strong><a class="headerlink" href="#relacion-con-otros-componentes_7" title="Permanent link">&para;</a></h4>
<ul>
<li>Este flujo se ejecuta dentro del contenedor <strong><code>FACT_ACTIVIDADES</code></strong>, junto con otros procesos (por ejemplo, afiliaciones y aportes) que alimentan la misma tabla de hechos <code>FACT_ACTIVIDADES</code>.</li>
<li>Las columnas de afiliación utilizadas aquí provienen del flujo <strong><code>STG_FACT_AFILIACIONES</code></strong> documentado aparte.</li>
</ul>
<hr />
<h4 id="script-sql-de-extraccion_2"><strong>Script SQL de extracción</strong><a class="headerlink" href="#script-sql-de-extraccion_2" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="k">WITH</span><span class="w"> </span><span class="n">consulta</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span><span class="w">  </span><span class="c1">----------------------------------</span>
<span class="w">    </span><span class="k">SELECT</span>
<span class="w">        </span><span class="k">CASE</span>
<span class="w">            </span><span class="k">WHEN</span><span class="w"> </span><span class="n">de</span><span class="p">.</span><span class="n">PARTNER</span><span class="w"> </span><span class="o">&lt;&gt;</span><span class="w"> </span><span class="s1">&#39;0000000000&#39;</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="n">de</span><span class="p">.</span><span class="n">PARTNER</span>
<span class="w">            </span><span class="k">WHEN</span><span class="w"> </span><span class="n">da</span><span class="p">.</span><span class="n">PARTNER</span><span class="w"> </span><span class="o">&lt;&gt;</span><span class="w"> </span><span class="s1">&#39;0000000000&#39;</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="n">da</span><span class="p">.</span><span class="n">PARTNER</span>
<span class="w">            </span><span class="k">WHEN</span><span class="w"> </span><span class="n">db</span><span class="p">.</span><span class="n">PARTNER</span><span class="w"> </span><span class="o">&lt;&gt;</span><span class="w"> </span><span class="s1">&#39;0000000000&#39;</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="n">db</span><span class="p">.</span><span class="n">PARTNER</span>
<span class="w">            </span><span class="k">ELSE</span><span class="w"> </span><span class="n">daa</span><span class="p">.</span><span class="n">PARTNER</span>
<span class="w">        </span><span class="k">END</span><span class="w">                                            </span><span class="k">AS</span><span class="w"> </span><span class="p">[</span><span class="n">PARTNER</span><span class="p">],</span>
<span class="w">        </span><span class="n">dp</span><span class="p">.[</span><span class="n">ID_EMPRESA</span><span class="p">],</span>
<span class="w">        </span><span class="n">dp</span><span class="p">.[</span><span class="n">ID_AFILIADO</span><span class="p">],</span>
<span class="w">        </span><span class="n">dp</span><span class="p">.[</span><span class="n">ID_BENEFICIARIO</span><span class="p">],</span>
<span class="w">        </span><span class="n">dp</span><span class="p">.</span><span class="n">ID_POBLACION</span><span class="p">,</span>
<span class="w">        </span><span class="n">ID_FECHA</span><span class="p">,</span>
<span class="w">        </span><span class="p">[</span><span class="n">CATEGORIA_VENTA</span><span class="p">],</span>
<span class="w">        </span><span class="k">COALESCE</span><span class="p">(</span><span class="n">DESCRIPCION</span><span class="p">,</span><span class="s1">&#39;INDEFINIDO&#39;</span><span class="p">)</span><span class="w">             </span><span class="k">AS</span><span class="w"> </span><span class="n">DESCRIPCION</span><span class="p">,</span>
<span class="w">        </span><span class="p">[</span><span class="n">COSTO</span><span class="p">],</span>
<span class="w">        </span><span class="p">[</span><span class="n">SUBSIDIO</span><span class="p">],</span>
<span class="w">        </span><span class="p">[</span><span class="n">VALOR_PAGADO_SIN_IMP</span><span class="p">],</span>
<span class="w">        </span><span class="n">ID_PREGUNTA</span><span class="p">,</span>
<span class="w">        </span><span class="n">RESPUESTA</span><span class="p">,</span>
<span class="w">        </span><span class="n">ANIO_ACADEMICO</span><span class="p">,</span>
<span class="w">        </span><span class="n">CAUSA</span><span class="p">,</span>
<span class="w">        </span><span class="n">ID_PROGRAMA</span><span class="p">,</span>
<span class="w">        </span><span class="n">ID_MATERIAL</span><span class="p">,</span>
<span class="w">        </span><span class="n">CANTIDAD_MATERIAL</span><span class="p">,</span>
<span class="w">        </span><span class="n">VALOR_MATERIAL</span><span class="p">,</span>
<span class="w">        </span><span class="n">ACTIVIDAD</span><span class="p">,</span>
<span class="w">        </span><span class="mi">4</span><span class="w">                                              </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_UNIDAD</span><span class="p">,</span>
<span class="w">        </span><span class="o">-</span><span class="mi">1</span><span class="w">                                             </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_CURSO</span><span class="p">,</span>
<span class="w">        </span><span class="o">-</span><span class="mi">1</span><span class="w">                                             </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_PERTENENCIA_ETNICA</span><span class="p">,</span>
<span class="w">        </span><span class="n">ID_FACTOR_VULNERABILIDAD</span><span class="p">,</span>
<span class="w">        </span><span class="o">-</span><span class="mi">1</span><span class="w">                                             </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_ESTADO_CIVIL</span><span class="p">,</span>
<span class="w">        </span><span class="n">ID_TARIFA</span><span class="p">,</span>
<span class="w">        </span><span class="s1">&#39;INDEFINIDO&#39;</span><span class="w">                                   </span><span class="k">AS</span><span class="w"> </span><span class="n">ESTADO_PAGO</span><span class="p">,</span>
<span class="w">        </span><span class="s1">&#39;INDEFINIDO&#39;</span><span class="w">                                   </span><span class="k">AS</span><span class="w"> </span><span class="n">TIPO_POBLACION</span><span class="p">,</span>
<span class="w">        </span><span class="n">FUENTE_PRINCIPAL</span>
<span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="p">(</span>
<span class="w">        </span><span class="cm">/* ---------- FACT_VENTA ---------- */</span>
<span class="w">        </span><span class="k">SELECT</span><span class="w">  </span><span class="k">LEFT</span><span class="p">([</span><span class="n">ID_FECHA</span><span class="p">],</span><span class="mi">6</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="o">+</span><span class="mi">1</span><span class="w">               </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_FECHA</span><span class="p">,</span>
<span class="w">                </span><span class="p">[</span><span class="n">ID_POBLACION</span><span class="p">],</span>
<span class="w">                </span><span class="p">[</span><span class="n">CATEGORIA_VENTA</span><span class="p">],</span>
<span class="w">                </span><span class="p">[</span><span class="n">SERVICIO</span><span class="p">]</span><span class="w">                             </span><span class="k">AS</span><span class="w"> </span><span class="n">DESCRIPCION</span><span class="p">,</span>
<span class="w">                </span><span class="p">[</span><span class="n">COSTO</span><span class="p">],</span>
<span class="w">                </span><span class="p">[</span><span class="n">SUBSIDIO</span><span class="p">],</span>
<span class="w">                </span><span class="p">[</span><span class="n">VALOR_PAGADO_SIN_IMP</span><span class="p">],</span>
<span class="w">                </span><span class="k">NULL</span><span class="w">                                   </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_PREGUNTA</span><span class="p">,</span>
<span class="w">                </span><span class="k">NULL</span><span class="w">                                   </span><span class="k">AS</span><span class="w"> </span><span class="n">RESPUESTA</span><span class="p">,</span>
<span class="w">                </span><span class="k">NULL</span><span class="w">                                   </span><span class="k">AS</span><span class="w"> </span><span class="n">ANIO_ACADEMICO</span><span class="p">,</span>
<span class="w">                </span><span class="k">NULL</span><span class="w">                                   </span><span class="k">AS</span><span class="w"> </span><span class="n">CAUSA</span><span class="p">,</span>
<span class="w">                </span><span class="o">-</span><span class="mi">1</span><span class="w">                                     </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_PROGRAMA</span><span class="p">,</span>
<span class="w">                </span><span class="k">NULL</span><span class="w">                                   </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_MATERIAL</span><span class="p">,</span>
<span class="w">                </span><span class="k">NULL</span><span class="w">                                   </span><span class="k">AS</span><span class="w"> </span><span class="n">CANTIDAD_MATERIAL</span><span class="p">,</span>
<span class="w">                </span><span class="k">NULL</span><span class="w">                                   </span><span class="k">AS</span><span class="w"> </span><span class="n">VALOR_MATERIAL</span><span class="p">,</span>
<span class="w">                </span><span class="s1">&#39;VENTA&#39;</span><span class="w">                                </span><span class="k">AS</span><span class="w"> </span><span class="n">ACTIVIDAD</span><span class="p">,</span>
<span class="w">                </span><span class="s1">&#39;[DWH_COMFENALCO].[Proteccion].[FACT_VENTA]&#39;</span><span class="w">          </span><span class="k">AS</span><span class="w"> </span><span class="p">[</span><span class="n">FUENTE_PRINCIPAL</span><span class="p">],</span>
<span class="w">                </span><span class="p">[</span><span class="n">ID_TARIFA</span><span class="p">]</span>
<span class="w">        </span><span class="k">FROM</span><span class="w">    </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Proteccion</span><span class="p">].[</span><span class="n">FACT_VENTA</span><span class="p">]</span>

<span class="w">        </span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span>
<span class="w">        </span><span class="cm">/* ---------- FACT_CARACTERIZACION ---------- */</span>
<span class="w">        </span><span class="k">SELECT</span><span class="w">  </span><span class="k">LEFT</span><span class="p">([</span><span class="n">ID_FECHA</span><span class="p">],</span><span class="mi">6</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="o">+</span><span class="mi">1</span><span class="w">               </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_FECHA</span><span class="p">,</span>
<span class="w">                </span><span class="p">[</span><span class="n">ID_POBLACION</span><span class="p">],</span>
<span class="w">                </span><span class="k">NULL</span><span class="w">                                   </span><span class="k">AS</span><span class="w"> </span><span class="n">CATEGORIA_VENTA</span><span class="p">,</span>
<span class="w">                </span><span class="n">dp</span><span class="p">.</span><span class="n">PROGRAMA</span><span class="w">                            </span><span class="k">AS</span><span class="w"> </span><span class="n">DESCRIPCION</span><span class="p">,</span>
<span class="w">                </span><span class="k">NULL</span><span class="w">                                   </span><span class="k">AS</span><span class="w"> </span><span class="n">COSTO</span><span class="p">,</span>
<span class="w">                </span><span class="k">NULL</span><span class="w">                                   </span><span class="k">AS</span><span class="w"> </span><span class="n">SUBSIDIO</span><span class="p">,</span>
<span class="w">                </span><span class="k">NULL</span><span class="w">                                   </span><span class="k">AS</span><span class="w"> </span><span class="n">VALOR_PAGADO_SIN_IMP</span><span class="p">,</span>
<span class="w">                </span><span class="p">[</span><span class="n">ID_PREGUNTA</span><span class="p">],</span>
<span class="w">                </span><span class="p">[</span><span class="n">RESPUESTA</span><span class="p">],</span>
<span class="w">                </span><span class="k">NULL</span><span class="w">                                   </span><span class="k">AS</span><span class="w"> </span><span class="n">ANIO_ACADEMICO</span><span class="p">,</span>
<span class="w">                </span><span class="k">NULL</span><span class="w">                                   </span><span class="k">AS</span><span class="w"> </span><span class="n">CAUSA</span><span class="p">,</span>
<span class="w">                </span><span class="n">fc</span><span class="p">.</span><span class="n">ID_PROGRAMA</span><span class="p">,</span>
<span class="w">                </span><span class="k">NULL</span><span class="w">                                   </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_MATERIAL</span><span class="p">,</span>
<span class="w">                </span><span class="k">NULL</span><span class="w">                                   </span><span class="k">AS</span><span class="w"> </span><span class="n">CANTIDAD_MATERIAL</span><span class="p">,</span>
<span class="w">                </span><span class="k">NULL</span><span class="w">                                   </span><span class="k">AS</span><span class="w"> </span><span class="n">VALOR_MATERIAL</span><span class="p">,</span>
<span class="w">                </span><span class="s1">&#39;CARACTERIZACION&#39;</span><span class="w">                      </span><span class="k">AS</span><span class="w"> </span><span class="n">ACTIVIDAD</span><span class="p">,</span>
<span class="w">                </span><span class="s1">&#39;[DWH_COMFENALCO].[Proteccion].[FACT_CARACTERIZACION]&#39;</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">[</span><span class="n">FUENTE_PRINCIPAL</span><span class="p">],</span>
<span class="w">                </span><span class="o">-</span><span class="mi">1</span><span class="w">                                     </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_TARIFA</span>
<span class="w">        </span><span class="k">FROM</span><span class="w">    </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Proteccion</span><span class="p">].[</span><span class="n">FACT_CARACTERIZACION</span><span class="p">]</span><span class="w"> </span><span class="n">fc</span>
<span class="w">        </span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Proteccion</span><span class="p">].[</span><span class="n">DIM_PROGRAMA</span><span class="p">]</span><span class="w"> </span><span class="n">dp</span>
<span class="w">               </span><span class="k">ON</span><span class="w"> </span><span class="n">fc</span><span class="p">.</span><span class="n">ID_PROGRAMA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dp</span><span class="p">.</span><span class="n">ID_PROGRAMA</span>

<span class="w">        </span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span>
<span class="w">        </span><span class="cm">/* ---------- FACT_DESERCION ---------- */</span>
<span class="w">        </span><span class="k">SELECT</span><span class="w">  </span><span class="k">LEFT</span><span class="p">([</span><span class="n">ID_FECHA</span><span class="p">],</span><span class="mi">6</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="o">+</span><span class="mi">1</span><span class="w">               </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_FECHA</span><span class="p">,</span>
<span class="w">                </span><span class="n">fd</span><span class="p">.[</span><span class="n">ID_POBLACION</span><span class="p">],</span>
<span class="w">                </span><span class="k">NULL</span><span class="w">                                   </span><span class="k">AS</span><span class="w"> </span><span class="n">CATEGORIA_VENTA</span><span class="p">,</span>
<span class="w">                </span><span class="n">dp</span><span class="p">.</span><span class="n">PROGRAMA</span><span class="w">                            </span><span class="k">AS</span><span class="w"> </span><span class="n">DESCRIPCION</span><span class="p">,</span>
<span class="w">                </span><span class="k">NULL</span><span class="w">                                   </span><span class="k">AS</span><span class="w"> </span><span class="n">COSTO</span><span class="p">,</span>
<span class="w">                </span><span class="k">NULL</span><span class="w">                                   </span><span class="k">AS</span><span class="w"> </span><span class="n">SUBSIDIO</span><span class="p">,</span>
<span class="w">                </span><span class="k">NULL</span><span class="w">                                   </span><span class="k">AS</span><span class="w"> </span><span class="n">VALOR_PAGADO_SIN_IMP</span><span class="p">,</span>
<span class="w">                </span><span class="k">NULL</span><span class="w">                                   </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_PREGUNTA</span><span class="p">,</span>
<span class="w">                </span><span class="k">NULL</span><span class="w">                                   </span><span class="k">AS</span><span class="w"> </span><span class="n">RESPUESTA</span><span class="p">,</span>
<span class="w">                </span><span class="p">[</span><span class="n">ANIO_ACADEMICO</span><span class="p">]</span><span class="o">*</span><span class="mi">10000</span><span class="o">+</span><span class="mi">101</span><span class="w">             </span><span class="k">AS</span><span class="w"> </span><span class="n">ANIO_ACADEMICO</span><span class="p">,</span>
<span class="w">                </span><span class="p">[</span><span class="n">CAUSA</span><span class="p">],</span>
<span class="w">                </span><span class="o">-</span><span class="mi">1</span><span class="w">                                     </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_PROGRAMA</span><span class="p">,</span>
<span class="w">                </span><span class="k">NULL</span><span class="w">                                   </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_MATERIAL</span><span class="p">,</span>
<span class="w">                </span><span class="k">NULL</span><span class="w">                                   </span><span class="k">AS</span><span class="w"> </span><span class="n">CANTIDAD_MATERIAL</span><span class="p">,</span>
<span class="w">                </span><span class="k">NULL</span><span class="w">                                   </span><span class="k">AS</span><span class="w"> </span><span class="n">VALOR_MATERIAL</span><span class="p">,</span>
<span class="w">                </span><span class="s1">&#39;DESERCION&#39;</span><span class="w">                            </span><span class="k">AS</span><span class="w"> </span><span class="n">ACTIVIDAD</span><span class="p">,</span>
<span class="w">                </span><span class="s1">&#39;[DWH_COMFENALCO].[Proteccion].[FACT_DESERCION]&#39;</span><span class="w">      </span><span class="k">AS</span><span class="w"> </span><span class="p">[</span><span class="n">FUENTE_PRINCIPAL</span><span class="p">],</span>
<span class="w">                </span><span class="o">-</span><span class="mi">1</span><span class="w">                                     </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_TARIFA</span>
<span class="w">        </span><span class="k">FROM</span><span class="w">    </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Proteccion</span><span class="p">].[</span><span class="n">FACT_DESERCION</span><span class="p">]</span><span class="w"> </span><span class="n">fd</span>
<span class="w">        </span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Proteccion</span><span class="p">].[</span><span class="n">DIM_PROGRAMA</span><span class="p">]</span><span class="w"> </span><span class="n">dp</span>
<span class="w">               </span><span class="k">ON</span><span class="w"> </span><span class="n">fd</span><span class="p">.</span><span class="n">ID_PROGRAMA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dp</span><span class="p">.</span><span class="n">ID_PROGRAMA</span>

<span class="w">        </span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span>
<span class="w">        </span><span class="cm">/* ---------- FACT_ENTREGA_MATERIAL ---------- */</span>
<span class="w">        </span><span class="k">SELECT</span><span class="w">  </span><span class="k">LEFT</span><span class="p">([</span><span class="n">ID_FECHA</span><span class="p">],</span><span class="mi">6</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="o">+</span><span class="mi">1</span><span class="w">               </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_FECHA</span><span class="p">,</span>
<span class="w">                </span><span class="p">[</span><span class="n">ID_POBLACION</span><span class="p">],</span>
<span class="w">                </span><span class="k">NULL</span><span class="w">                                   </span><span class="k">AS</span><span class="w"> </span><span class="n">CATEGORIA_VENTA</span><span class="p">,</span>
<span class="w">                </span><span class="k">NULL</span><span class="w">                                   </span><span class="k">AS</span><span class="w"> </span><span class="n">DESCRIPCION</span><span class="p">,</span>
<span class="w">                </span><span class="k">NULL</span><span class="w">                                   </span><span class="k">AS</span><span class="w"> </span><span class="n">COSTO</span><span class="p">,</span>
<span class="w">                </span><span class="k">NULL</span><span class="w">                                   </span><span class="k">AS</span><span class="w"> </span><span class="n">SUBSIDIO</span><span class="p">,</span>
<span class="w">                </span><span class="k">NULL</span><span class="w">                                   </span><span class="k">AS</span><span class="w"> </span><span class="n">VALOR_PAGADO_SIN_IMP</span><span class="p">,</span>
<span class="w">                </span><span class="k">NULL</span><span class="w">                                   </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_PREGUNTA</span><span class="p">,</span>
<span class="w">                </span><span class="k">NULL</span><span class="w">                                   </span><span class="k">AS</span><span class="w"> </span><span class="n">RESPUESTA</span><span class="p">,</span>
<span class="w">                </span><span class="k">NULL</span><span class="w">                                   </span><span class="k">AS</span><span class="w"> </span><span class="n">ANIO_ACADEMICO</span><span class="p">,</span>
<span class="w">                </span><span class="k">NULL</span><span class="w">                                   </span><span class="k">AS</span><span class="w"> </span><span class="n">CAUSA</span><span class="p">,</span>
<span class="w">                </span><span class="p">[</span><span class="n">ID_PROGRAMA</span><span class="p">],</span>
<span class="w">                </span><span class="p">[</span><span class="n">ID_MATERIAL</span><span class="p">],</span>
<span class="w">                </span><span class="p">[</span><span class="n">CANTIDAD_MATERIAL</span><span class="p">],</span>
<span class="w">                </span><span class="p">[</span><span class="n">VALOR_MATERIAL</span><span class="p">],</span>
<span class="w">                </span><span class="s1">&#39;ENTREGA_MATERIAL&#39;</span><span class="w">                     </span><span class="k">AS</span><span class="w"> </span><span class="n">ACTIVIDAD</span><span class="p">,</span>
<span class="w">                </span><span class="s1">&#39;[DWH_COMFENALCO].[Proteccion].[FACT_ENTREGA_MATERIAL]&#39;</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">[</span><span class="n">FUENTE_PRINCIPAL</span><span class="p">],</span>
<span class="w">                </span><span class="o">-</span><span class="mi">1</span><span class="w">                                     </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_TARIFA</span>
<span class="w">        </span><span class="k">FROM</span><span class="w">    </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Proteccion</span><span class="p">].[</span><span class="n">FACT_ENTREGA_MATERIAL</span><span class="p">]</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="n">un</span>
<span class="w">    </span><span class="k">JOIN</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Proteccion</span><span class="p">].[</span><span class="n">DIM_POBLACION</span><span class="p">]</span><span class="w">   </span><span class="n">dp</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">un</span><span class="p">.[</span><span class="n">ID_POBLACION</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dp</span><span class="p">.[</span><span class="n">ID_POBLACION</span><span class="p">]</span>
<span class="w">    </span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Transversal</span><span class="p">].[</span><span class="n">DIM_AFILIADOS</span><span class="p">]</span><span class="w">           </span><span class="n">da</span><span class="w">  </span><span class="k">ON</span><span class="w"> </span><span class="n">dp</span><span class="p">.</span><span class="n">ID_AFILIADO</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">da</span><span class="p">.</span><span class="n">ID_AFILIADO</span>
<span class="w">    </span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Transversal</span><span class="p">].[</span><span class="n">DIM_BENEFICIARIOS</span><span class="p">]</span><span class="w">       </span><span class="n">db</span><span class="w">  </span><span class="k">ON</span><span class="w"> </span><span class="n">dp</span><span class="p">.</span><span class="n">ID_BENEFICIARIO</span><span class="o">=</span><span class="w"> </span><span class="n">db</span><span class="p">.</span><span class="n">ID_BENEFICIARIO</span>
<span class="w">    </span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Transversal</span><span class="p">].[</span><span class="n">DIM_EMPRESAS</span><span class="p">]</span><span class="w">            </span><span class="n">de</span><span class="w">  </span><span class="k">ON</span><span class="w"> </span><span class="n">dp</span><span class="p">.</span><span class="n">ID_EMPRESA</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="n">de</span><span class="p">.</span><span class="n">ID_EMPRESA</span>
<span class="w">    </span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Transversal</span><span class="p">].[</span><span class="n">DIM_APORTANTE_NOAFILIADO</span><span class="p">]</span><span class="n">daa</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">dp</span><span class="p">.</span><span class="n">ID_APORTANTE</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">daa</span><span class="p">.</span><span class="n">ID_APORTANTE</span>
<span class="w">    </span><span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="p">(</span>
<span class="w">        </span><span class="k">SELECT</span><span class="w"> </span><span class="n">ID_FECHA</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_FECHA2</span>
<span class="w">        </span><span class="k">FROM</span><span class="w">   </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Transversal</span><span class="p">].[</span><span class="n">DIM_TIEMPO_MENSUAL</span><span class="p">]</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="n">dimM</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">un</span><span class="p">.</span><span class="n">ID_FECHA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dimM</span><span class="p">.</span><span class="n">ID_FECHA2</span>
<span class="p">),</span>
<span class="n">partnerTable</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="n">PARTNER</span><span class="p">,</span><span class="w"> </span><span class="n">ID_FECHA</span><span class="p">,</span>
<span class="w">           </span><span class="k">MAX</span><span class="p">(</span><span class="n">PARTNER_AFILIADO</span><span class="p">)</span><span class="w">  </span><span class="k">AS</span><span class="w"> </span><span class="n">PARTNER_AFILIADO</span><span class="p">,</span>
<span class="w">           </span><span class="k">MAX</span><span class="p">(</span><span class="n">PARTNER_EMPRESA</span><span class="p">)</span><span class="w">   </span><span class="k">AS</span><span class="w"> </span><span class="n">PARTNER_EMPRESA</span><span class="p">,</span>
<span class="w">           </span><span class="k">MIN</span><span class="p">(</span><span class="n">ID_CATEGORIA</span><span class="p">)</span><span class="w">      </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_CATEGORIA</span><span class="p">,</span>
<span class="w">           </span><span class="k">MAX</span><span class="p">(</span><span class="n">ID_GENERO</span><span class="p">)</span><span class="w">         </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_GENERO</span><span class="p">,</span>
<span class="w">           </span><span class="k">MAX</span><span class="p">(</span><span class="n">FECHA_NACIMIENTO</span><span class="p">)</span><span class="w">  </span><span class="k">AS</span><span class="w"> </span><span class="n">FECHA_NACIMIENTO</span><span class="p">,</span>
<span class="w">           </span><span class="k">MAX</span><span class="p">(</span><span class="n">EDAD</span><span class="p">)</span><span class="w">              </span><span class="k">AS</span><span class="w"> </span><span class="n">EDAD</span><span class="p">,</span>
<span class="w">           </span><span class="k">MAX</span><span class="p">(</span><span class="n">DISCAPACIDAD</span><span class="p">)</span><span class="w">      </span><span class="k">AS</span><span class="w"> </span><span class="n">DISCAPACIDAD</span>
<span class="w">    </span><span class="k">FROM</span><span class="w">   </span><span class="p">[</span><span class="n">STAGE_AREA</span><span class="p">].[</span><span class="n">Transversal</span><span class="p">].[</span><span class="n">STG_FACT_AFILIACIONES</span><span class="p">]</span>
<span class="w">    </span><span class="k">WHERE</span><span class="w">  </span><span class="n">ACTIVIDAD</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;AFILIACION&#39;</span>
<span class="w">    </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">PARTNER</span><span class="p">,</span><span class="w"> </span><span class="n">ID_FECHA</span>
<span class="p">)</span>
<span class="k">SELECT</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="o">*</span><span class="p">,</span>
<span class="w">       </span><span class="k">COALESCE</span><span class="p">(</span><span class="n">pt</span><span class="p">.</span><span class="n">PARTNER_AFILIADO</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;0000000000&#39;</span><span class="p">)</span><span class="w">      </span><span class="k">AS</span><span class="w"> </span><span class="n">PARTNER_AFILIADO</span><span class="p">,</span>
<span class="w">       </span><span class="k">COALESCE</span><span class="p">(</span><span class="n">pt</span><span class="p">.</span><span class="n">PARTNER_EMPRESA</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;0000000000&#39;</span><span class="p">)</span><span class="w">      </span><span class="k">AS</span><span class="w"> </span><span class="n">PARTNER_EMPRESA</span><span class="p">,</span>
<span class="w">       </span><span class="k">COALESCE</span><span class="p">(</span><span class="n">pt</span><span class="p">.</span><span class="n">ID_CATEGORIA</span><span class="w">   </span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span><span class="w">                 </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_CATEGORIA</span><span class="p">,</span>
<span class="w">       </span><span class="k">COALESCE</span><span class="p">(</span><span class="n">pt</span><span class="p">.</span><span class="n">ID_GENERO</span><span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w">                </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_GENERO</span><span class="p">,</span>
<span class="w">       </span><span class="n">pt</span><span class="p">.</span><span class="n">FECHA_NACIMIENTO</span><span class="p">,</span>
<span class="w">       </span><span class="k">COALESCE</span><span class="p">(</span><span class="n">pt</span><span class="p">.</span><span class="n">EDAD</span><span class="w">           </span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w">                </span><span class="k">AS</span><span class="w"> </span><span class="n">EDAD</span><span class="p">,</span>
<span class="w">       </span><span class="k">COALESCE</span><span class="p">(</span><span class="n">pt</span><span class="p">.</span><span class="n">DISCAPACIDAD</span><span class="w">   </span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w">                 </span><span class="k">AS</span><span class="w"> </span><span class="n">DISCAPACIDAD</span><span class="p">,</span>
<span class="w">       </span><span class="s1">&#39;SI&#39;</span><span class="w">                                            </span><span class="k">AS</span><span class="w"> </span><span class="n">POBLACION_EDUCACION</span><span class="p">,</span>
<span class="w">       </span><span class="k">CASE</span><span class="w"> </span><span class="k">WHEN</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">ID_UNIDAD</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="s1">&#39;SI&#39;</span><span class="w"> </span><span class="k">ELSE</span><span class="w"> </span><span class="s1">&#39;NO&#39;</span><span class="w"> </span><span class="k">END</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">POBLACION_EDUCACION_FORMAL</span><span class="p">,</span>
<span class="w">       </span><span class="k">CASE</span><span class="w"> </span><span class="k">WHEN</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">ID_UNIDAD</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="s1">&#39;SI&#39;</span><span class="w"> </span><span class="k">ELSE</span><span class="w"> </span><span class="s1">&#39;NO&#39;</span><span class="w"> </span><span class="k">END</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">POBLACION_EDUCACION_TECNICA</span><span class="p">,</span>
<span class="w">       </span><span class="k">CASE</span><span class="w"> </span><span class="k">WHEN</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">ID_UNIDAD</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="s1">&#39;SI&#39;</span><span class="w"> </span><span class="k">ELSE</span><span class="w"> </span><span class="s1">&#39;NO&#39;</span><span class="w"> </span><span class="k">END</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">POBLACION_EDUCACION_CONTINUA</span><span class="p">,</span>
<span class="w">       </span><span class="k">CASE</span><span class="w"> </span><span class="k">WHEN</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">ID_UNIDAD</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="s1">&#39;SI&#39;</span><span class="w"> </span><span class="k">ELSE</span><span class="w"> </span><span class="s1">&#39;NO&#39;</span><span class="w"> </span><span class="k">END</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">POBLACION_EDUCACION_PROTECCION</span>
<span class="k">FROM</span><span class="w">   </span><span class="n">consulta</span><span class="w"> </span><span class="k">c</span>
<span class="k">LEFT</span><span class="w">  </span><span class="k">JOIN</span><span class="w"> </span><span class="n">partnerTable</span><span class="w"> </span><span class="n">pt</span>
<span class="w">       </span><span class="k">ON</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">PARTNER</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pt</span><span class="p">.</span><span class="n">PARTNER</span>
<span class="w">      </span><span class="k">AND</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">ID_FECHA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pt</span><span class="p">.</span><span class="n">ID_FECHA</span><span class="p">;</span>
</code></pre></div>
<h3 id="fact_actividades_cedesarrollo"><strong>FACT_ACTIVIDADES_CEDESARROLLO</strong><a class="headerlink" href="#fact_actividades_cedesarrollo" title="Permanent link">&para;</a></h3>
<p>El componente <strong><code>FACT_ACTIVIDADES_CEDESARROLLO</code></strong> pertenece al paquete SSIS <strong><code>FACT_ACTIVIDADES</code></strong>, dentro de la ruta <strong><code>Actividades Cedesarrollo\FACT_ACTIVIDADES_CEDESARROLLO</code></strong>, y se encarga de consolidar y cargar la información de actividades académicas y administrativas en la tabla <strong><code>[DWH_COMFENALCO].[Transversal].[FACT_ACTIVIDADES]</code></strong> del Data Warehouse.</p>
<hr />
<h4 id="descripcion-general_9"><strong>Descripción General</strong><a class="headerlink" href="#descripcion-general_9" title="Permanent link">&para;</a></h4>
<p>Se trata de una <strong>tarea de flujo de datos</strong> (Data Flow Task) compuesta por:</p>
<table>
<thead>
<tr>
<th>Componente</th>
<th>Tipo</th>
<th>Descripción</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>cedesarrollo</strong></td>
<td><em>ADO NET Source</em></td>
<td>Ejecuta una consulta SQL extensa que unifica múltiples hechos (graduados, inasistencias, cotizaciones, matrícula, deserciones, etc.) y les añade atributos demográficos.</td>
</tr>
<tr>
<td><strong>Destino de ADO NET</strong></td>
<td><em>ADO NET Destination</em></td>
<td>Inserta el conjunto resultante en <strong><code>Transversal.FACT_ACTIVIDADES</code></strong> usando <em>SqlBulkCopy</em> para acelerar la carga.</td>
</tr>
</tbody>
</table>
<hr />
<h4 id="ubicacion-en-el-paquete_9"><strong>Ubicación en el Paquete</strong><a class="headerlink" href="#ubicacion-en-el-paquete_9" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>Paquete:</strong> <code>FACT_ACTIVIDADES</code></li>
<li><strong>Carpeta:</strong> <code>Actividades Cedesarrollo</code></li>
<li><strong>Tarea:</strong> <code>FACT_ACTIVIDADES_CEDESARROLLO</code></li>
<li><strong>DTSID:</strong> <code>{fd72a580-f504-4930-9aef-e5cb0d6648cb}</code></li>
</ul>
<hr />
<h4 id="proposito_9"><strong>Propósito</strong><a class="headerlink" href="#proposito_9" title="Permanent link">&para;</a></h4>
<p>Consolidar, enriquecer y cargar en un único hecho todas las interacciones relevantes de los estudiantes del programa <strong>Cedesarrollo</strong> (graduación, asistencia, retiros, notas, facturación, etc.), normalizadas a <strong>nivel mensual</strong> y alineadas con la dimensión tiempo <strong><code>DIM_TIEMPO_MENSUAL</code></strong> para su análisis en el cubo OLAP y en reportes operativos.</p>
<hr />
<h4 id="detalles-de-implementacion_9"><strong>Detalles de Implementación</strong><a class="headerlink" href="#detalles-de-implementacion_9" title="Permanent link">&para;</a></h4>
<table>
<thead>
<tr>
<th>Aspecto</th>
<th>Detalle</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Origen de datos</strong></td>
<td>La consulta extrae y unifica información de varias tablas de los esquemas <strong><code>Cedesarrollo</code></strong> y <strong><code>Transversal</code></strong>.</td>
</tr>
<tr>
<td><strong>Transformaciones clave</strong></td>
<td>* UNION de ocho subconjuntos de datos.<br>* Derivación de campos por defecto (<code>-1</code>, ‘INDEFINIDO’).<br>* Join con la tabla <strong><code>STG_FACT_AFILIACIONES</code></strong> (aliased <em>partnerTable</em>) para atributos demográficos.<br>* Filtrado a fechas presentes en <strong><code>DIM_TIEMPO_MENSUAL</code></strong> (garantizando granularidad mensual).</td>
</tr>
<tr>
<td><strong>Destino</strong></td>
<td><strong><code>[DWH_COMFENALCO].[Transversal].[FACT_ACTIVIDADES]</code></strong></td>
</tr>
<tr>
<td><strong>Conexión</strong></td>
<td>Connection Manager <strong><code>DWH_COMFENALCO</code></strong> – GUID <code>{29BC876E‑1EAF‑4F6F‑8F38‑39B8E881EEB6}</code></td>
</tr>
<tr>
<td><strong>Modo de carga</strong></td>
<td><em>SqlBulkCopy</em> (propiedad <strong><code>UseBulkInsertWhenPossible = true</code></strong>) sin partición por lotes (BatchSize = 0).</td>
</tr>
<tr>
<td><strong>Manejo de errores</strong></td>
<td>Salidas de error configuradas para origen y destino con los campos estándar <code>ErrorCode</code> y <code>ErrorColumn</code>.</td>
</tr>
</tbody>
</table>
<hr />
<h4 id="logica-de-negocio_7"><strong>Lógica de Negocio</strong><a class="headerlink" href="#logica-de-negocio_7" title="Permanent link">&para;</a></h4>
<ol>
<li>
<p><strong>Unificación de hechos:</strong></p>
<ul>
<li><strong>Graduados</strong>, <strong>Inasistencias</strong> (regular y FOSFEC), <strong>Inscripción y Estado de Matrículas</strong>, <strong>Asistencia a Bienestar</strong>, <strong>Cotizaciones</strong>, <strong>Deserciones</strong> y <strong>Promoción/Repitencia</strong> se combinan en una sola CTE <code>consulta</code>.</li>
</ul>
</li>
<li>
<p><strong>Normalización temporal:</strong></p>
<ul>
<li>Cada registro se convierte al primer día del mes correspondiente (<code>LEFT(ID_FECHA,6)*100+1</code>) y se valida contra <code>DIM_TIEMPO_MENSUAL</code>.</li>
</ul>
</li>
<li>
<p><strong>Enriquecimiento demográfico:</strong></p>
<ul>
<li>Unión con <strong><code>STG_FACT_AFILIACIONES</code></strong> para obtener <code>PARTNER_AFILIADO</code>, <code>PARTNER_EMPRESA</code>, <code>ID_CATEGORIA</code>, <code>ID_GENERO</code>, edad, discapacidad y fecha de nacimiento.</li>
</ul>
</li>
<li>
<p><strong>Marcado de población:</strong></p>
<ul>
<li>Se generan banderas <code>POBLACION_EDUCACION_*</code> según la unidad académica (1=Formal, 2=Técnica, 3=Continua, 4=Protección).</li>
</ul>
</li>
<li>
<p><strong>Carga:</strong></p>
<ul>
<li>El resultado final se inserta en <code>FACT_ACTIVIDADES</code> para consumo analítico.</li>
</ul>
</li>
</ol>
<hr />
<h4 id="relacion-con-otros-componentes_8"><strong>Relación con Otros Componentes</strong><a class="headerlink" href="#relacion-con-otros-componentes_8" title="Permanent link">&para;</a></h4>
<ul>
<li><strong><code>DIM_TIEMPO_MENSUAL</code></strong> – Garantiza coherencia de fechas a nivel mensual.</li>
<li>Diversas dimensiones de <strong>Transversal</strong> (Afiliados, Beneficiarios, Empresas, Aportantes) y de <strong>Cedesarrollo</strong> (Estudiantes, Jornada, Periodo Académico) para claves foráneas.</li>
<li>Sirve como hecho base para indicadores de gestión educativa, asistencia y facturación en los cubos de <strong>Educación y Bienestar</strong>.</li>
</ul>
<hr />
<h4 id="script-sql-de-extraccion_3"><strong>Script SQL de Extracción</strong><a class="headerlink" href="#script-sql-de-extraccion_3" title="Permanent link">&para;</a></h4>
<blockquote>
<p><em>A continuación se incluye íntegramente la consulta utilizada por el componente </em><em><code>cedesarrollo</code></em><em>. Se divide en dos CTE principales (<code>consulta</code>, <code>partnerTable</code>) y la selección final.</em></p>
</blockquote>
<div class="highlight"><pre><span></span><code><span class="k">WITH</span><span class="w"> </span><span class="n">consulta</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="c1">----------------------------------</span>
<span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="n">con</span><span class="p">.</span><span class="o">*</span><span class="p">,</span>
<span class="w">           </span><span class="o">-</span><span class="mi">1</span><span class="w">  </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_CURSO</span><span class="p">,</span>
<span class="w">           </span><span class="o">-</span><span class="mi">1</span><span class="w">  </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_PERTENENCIA_ETNICA</span><span class="p">,</span>
<span class="w">           </span><span class="o">-</span><span class="mi">1</span><span class="w">  </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_FACTOR_VULNERABILIDAD</span><span class="p">,</span>
<span class="w">           </span><span class="o">-</span><span class="mi">1</span><span class="w">  </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_ESTADO_CIVIL</span><span class="p">,</span>
<span class="w">           </span><span class="s1">&#39;INDEFINIDO&#39;</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ESTADO_PAGO</span><span class="p">,</span>
<span class="w">           </span><span class="s1">&#39;INDEFINIDO&#39;</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">TIPO_POBLACION</span>
<span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="p">(</span>
<span class="w">        </span><span class="cm">/* === GRADUADOS ==================================================== */</span>
<span class="w">        </span><span class="k">SELECT</span><span class="w">  </span><span class="n">ID_ESTUDIANTE</span><span class="p">,</span>
<span class="w">                </span><span class="k">ISNULL</span><span class="p">(</span><span class="n">ID_PROGRAMA</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w">          </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_PROGRAMA</span><span class="p">,</span>
<span class="w">                </span><span class="n">ID_PERIODO</span><span class="p">,</span>
<span class="w">                </span><span class="k">LEFT</span><span class="p">(</span><span class="n">FORMAT</span><span class="p">(</span><span class="n">FECHA_GRADUADO</span><span class="p">,</span><span class="s1">&#39;yyyyMMdd&#39;</span><span class="p">),</span><span class="mi">6</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="o">+</span><span class="mi">1</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_FECHA</span><span class="p">,</span>
<span class="w">                </span><span class="n">GRUPO</span><span class="p">,</span>
<span class="w">                </span><span class="k">NULL</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">TOTAL_INASISTENCIA</span><span class="p">,</span>
<span class="w">                </span><span class="k">NULL</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ESTADO</span><span class="p">,</span>
<span class="w">                </span><span class="s1">&#39;INDEFINIDO&#39;</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">DESCRIPCION</span><span class="p">,</span>
<span class="w">                </span><span class="k">NULL</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ASISTIO</span><span class="p">,</span>
<span class="w">                </span><span class="s1">&#39;GRADUADOS&#39;</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ACTIVIDAD</span><span class="p">,</span>
<span class="w">                </span><span class="n">j</span><span class="p">.</span><span class="n">ID_UNIDAD</span><span class="p">,</span>
<span class="w">                </span><span class="s1">&#39;[DWH_COMFENALCO].[Cedesarrollo].[FACT_GRADUADOS]&#39;</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">FUENTE_PRINCIPAL</span><span class="p">,</span>
<span class="w">                </span><span class="n">ID_GRADUADO</span><span class="p">,</span>
<span class="w">                </span><span class="o">-</span><span class="mi">1</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_DESERCION</span><span class="p">,</span>
<span class="w">                </span><span class="o">-</span><span class="mi">1</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_MATRICULA</span>
<span class="w">        </span><span class="k">FROM</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Cedesarrollo</span><span class="p">].[</span><span class="n">FACT_GRADUADOS</span><span class="p">]</span><span class="w"> </span><span class="n">fg</span>
<span class="w">        </span><span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Cedesarrollo</span><span class="p">].[</span><span class="n">DIM_JORNADA</span><span class="p">]</span><span class="w"> </span><span class="n">j</span>
<span class="w">               </span><span class="k">ON</span><span class="w"> </span><span class="n">fg</span><span class="p">.</span><span class="n">ID_JORNADA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">j</span><span class="p">.</span><span class="n">ID_JORNADA</span>

<span class="w">        </span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span>
<span class="w">        </span><span class="cm">/* === INASISTENCIAS ================================================ */</span>
<span class="w">        </span><span class="k">SELECT</span><span class="w"> </span><span class="n">ID_ESTUDIANTE</span><span class="p">,</span>
<span class="w">               </span><span class="o">-</span><span class="mi">1</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_PROGRAMA</span><span class="p">,</span>
<span class="w">               </span><span class="n">ID_PERIODO</span><span class="p">,</span>
<span class="w">               </span><span class="k">LEFT</span><span class="p">(</span><span class="n">ID_FECHA</span><span class="p">,</span><span class="mi">6</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="o">+</span><span class="mi">1</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_FECHA</span><span class="p">,</span>
<span class="w">               </span><span class="k">NULL</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">GRUPO</span><span class="p">,</span>
<span class="w">               </span><span class="n">TOTAL_INASISTENCIA</span><span class="p">,</span>
<span class="w">               </span><span class="k">NULL</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ESTADO</span><span class="p">,</span>
<span class="w">               </span><span class="s1">&#39;INDEFINIDO&#39;</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">DESCRIPCION</span><span class="p">,</span>
<span class="w">               </span><span class="k">NULL</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ASISTIO</span><span class="p">,</span>
<span class="w">               </span><span class="s1">&#39;INASISTENCIAS&#39;</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ACTIVIDAD</span><span class="p">,</span>
<span class="w">               </span><span class="n">j</span><span class="p">.</span><span class="n">ID_UNIDAD</span><span class="p">,</span>
<span class="w">               </span><span class="s1">&#39;[DWH_COMFENALCO].[Cedesarrollo].[FACT_INASISTENCIAS]&#39;</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">FUENTE_PRINCIPAL</span><span class="p">,</span>
<span class="w">               </span><span class="o">-</span><span class="mi">1</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_GRADUADO</span><span class="p">,</span>
<span class="w">               </span><span class="o">-</span><span class="mi">1</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_DESERCION</span><span class="p">,</span>
<span class="w">               </span><span class="o">-</span><span class="mi">1</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_MATRICULA</span>
<span class="w">        </span><span class="k">FROM</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Cedesarrollo</span><span class="p">].[</span><span class="n">FACT_INASISTENCIAS</span><span class="p">]</span><span class="w"> </span><span class="n">fi</span>
<span class="w">        </span><span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Cedesarrollo</span><span class="p">].[</span><span class="n">DIM_JORNADA</span><span class="p">]</span><span class="w"> </span><span class="n">j</span>
<span class="w">               </span><span class="k">ON</span><span class="w"> </span><span class="n">fi</span><span class="p">.</span><span class="n">ID_JORNADA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">j</span><span class="p">.</span><span class="n">ID_JORNADA</span>
<span class="w">        </span><span class="cm">/* …………………………………………………… */</span>
<span class="w">        </span><span class="cm">/*  ↳ Se omiten por brevedad los bloques UNION ALL de:                */</span>
<span class="w">        </span><span class="cm">/*    - INASISTENCIA_FOSFEC                                           */</span>
<span class="w">        </span><span class="cm">/*    - INSCRIPCION_MATRICULAS                                        */</span>
<span class="w">        </span><span class="cm">/*    - ASISTENCIA_ACT_BIENESTAR                                      */</span>
<span class="w">        </span><span class="cm">/*    - COTIZACIONES                                                  */</span>
<span class="w">        </span><span class="cm">/*    - ESTADO_MATRICULAS                                             */</span>
<span class="w">        </span><span class="cm">/*    - DESERCION                                                     */</span>
<span class="w">        </span><span class="cm">/*    - PROMOCION / REPITENCIA                                        */</span>
<span class="w">        </span><span class="cm">/* ================================================================== */</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="n">uni</span>
<span class="w">    </span><span class="cm">/* === JOIN con dimensiones Transversal y validación de fecha mensual === */</span>
<span class="w">    </span><span class="k">LEFT</span><span class="w">  </span><span class="k">JOIN</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Cedesarrollo</span><span class="p">].[</span><span class="n">DIM_ESTUDIANTES</span><span class="p">]</span><span class="w"> </span><span class="n">die</span>
<span class="w">           </span><span class="k">ON</span><span class="w"> </span><span class="n">uni</span><span class="p">.</span><span class="n">ID_ESTUDIANTE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">die</span><span class="p">.</span><span class="n">ID_ESTUDIANTE</span>
<span class="w">    </span><span class="k">LEFT</span><span class="w">  </span><span class="k">JOIN</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Transversal</span><span class="p">].[</span><span class="n">DIM_AFILIADOS</span><span class="p">]</span><span class="w"> </span><span class="n">da</span>
<span class="w">           </span><span class="k">ON</span><span class="w"> </span><span class="n">die</span><span class="p">.</span><span class="n">ID_AFILIADO</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">da</span><span class="p">.</span><span class="n">ID_AFILIADO</span>
<span class="w">    </span><span class="k">LEFT</span><span class="w">  </span><span class="k">JOIN</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Transversal</span><span class="p">].[</span><span class="n">DIM_BENEFICIARIOS</span><span class="p">]</span><span class="w"> </span><span class="n">db</span>
<span class="w">           </span><span class="k">ON</span><span class="w"> </span><span class="n">die</span><span class="p">.</span><span class="n">ID_BENEFICIARIO</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">db</span><span class="p">.</span><span class="n">ID_BENEFICIARIO</span>
<span class="w">    </span><span class="k">LEFT</span><span class="w">  </span><span class="k">JOIN</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Transversal</span><span class="p">].[</span><span class="n">DIM_EMPRESAS</span><span class="p">]</span><span class="w"> </span><span class="n">de</span>
<span class="w">           </span><span class="k">ON</span><span class="w"> </span><span class="n">die</span><span class="p">.</span><span class="n">ID_EMPRESA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">de</span><span class="p">.</span><span class="n">ID_EMPRESA</span>
<span class="w">    </span><span class="k">LEFT</span><span class="w">  </span><span class="k">JOIN</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Transversal</span><span class="p">].[</span><span class="n">DIM_APORTANTE_NOAFILIADO</span><span class="p">]</span><span class="w"> </span><span class="n">daa</span>
<span class="w">           </span><span class="k">ON</span><span class="w"> </span><span class="n">die</span><span class="p">.</span><span class="n">ID_APORTANTE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">daa</span><span class="p">.</span><span class="n">ID_APORTANTE</span>
<span class="w">    </span><span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="n">ID_FECHA</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_FECHA2</span>
<span class="w">                </span><span class="k">FROM</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Transversal</span><span class="p">].[</span><span class="n">DIM_TIEMPO_MENSUAL</span><span class="p">])</span><span class="w"> </span><span class="n">dimM</span>
<span class="w">           </span><span class="k">ON</span><span class="w"> </span><span class="n">uni</span><span class="p">.</span><span class="n">ID_FECHA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dimM</span><span class="p">.</span><span class="n">ID_FECHA2</span>
<span class="w">    </span><span class="c1">-----------------------------------</span>
<span class="p">),</span>
<span class="n">partnerTable</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="k">SELECT</span><span class="w">  </span><span class="n">PARTNER</span><span class="p">,</span>
<span class="w">            </span><span class="n">ID_FECHA</span><span class="p">,</span>
<span class="w">            </span><span class="k">MAX</span><span class="p">(</span><span class="n">PARTNER_AFILIADO</span><span class="p">)</span><span class="w">  </span><span class="k">AS</span><span class="w"> </span><span class="n">PARTNER_AFILIADO</span><span class="p">,</span>
<span class="w">            </span><span class="k">MAX</span><span class="p">(</span><span class="n">PARTNER_EMPRESA</span><span class="p">)</span><span class="w">   </span><span class="k">AS</span><span class="w"> </span><span class="n">PARTNER_EMPRESA</span><span class="p">,</span>
<span class="w">            </span><span class="k">MIN</span><span class="p">(</span><span class="n">ID_CATEGORIA</span><span class="p">)</span><span class="w">      </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_CATEGORIA</span><span class="p">,</span>
<span class="w">            </span><span class="k">MAX</span><span class="p">(</span><span class="n">ID_GENERO</span><span class="p">)</span><span class="w">         </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_GENERO</span><span class="p">,</span>
<span class="w">            </span><span class="k">MAX</span><span class="p">(</span><span class="n">FECHA_NACIMIENTO</span><span class="p">)</span><span class="w">  </span><span class="k">AS</span><span class="w"> </span><span class="n">FECHA_NACIMIENTO</span><span class="p">,</span>
<span class="w">            </span><span class="k">MAX</span><span class="p">(</span><span class="n">EDAD</span><span class="p">)</span><span class="w">              </span><span class="k">AS</span><span class="w"> </span><span class="n">EDAD</span><span class="p">,</span>
<span class="w">            </span><span class="k">MAX</span><span class="p">(</span><span class="n">DISCAPACIDAD</span><span class="p">)</span><span class="w">      </span><span class="k">AS</span><span class="w"> </span><span class="n">DISCAPACIDAD</span>
<span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="p">[</span><span class="n">STAGE_AREA</span><span class="p">].[</span><span class="n">Transversal</span><span class="p">].[</span><span class="n">STG_FACT_AFILIACIONES</span><span class="p">]</span>
<span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="n">ACTIVIDAD</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;AFILIACION&#39;</span>
<span class="w">    </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">PARTNER</span><span class="p">,</span><span class="w"> </span><span class="n">ID_FECHA</span>
<span class="p">)</span>
<span class="cm">/* === Selección final ===================================================== */</span>
<span class="k">SELECT</span><span class="w">  </span><span class="k">c</span><span class="p">.</span><span class="o">*</span><span class="p">,</span>
<span class="w">        </span><span class="k">ISNULL</span><span class="p">(</span><span class="n">pt</span><span class="p">.</span><span class="n">PARTNER_AFILIADO</span><span class="p">,</span><span class="s1">&#39;0000000000&#39;</span><span class="p">)</span><span class="w">               </span><span class="k">AS</span><span class="w"> </span><span class="n">PARTNER_AFILIADO</span><span class="p">,</span>
<span class="w">        </span><span class="k">ISNULL</span><span class="p">(</span><span class="n">pt</span><span class="p">.</span><span class="n">PARTNER_EMPRESA</span><span class="p">,</span><span class="s1">&#39;0000000000&#39;</span><span class="p">)</span><span class="w">                </span><span class="k">AS</span><span class="w"> </span><span class="n">PARTNER_EMPRESA</span><span class="p">,</span>
<span class="w">        </span><span class="k">ISNULL</span><span class="p">(</span><span class="n">pt</span><span class="p">.</span><span class="n">ID_CATEGORIA</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span><span class="w">                              </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_CATEGORIA</span><span class="p">,</span>
<span class="w">        </span><span class="k">ISNULL</span><span class="p">(</span><span class="n">pt</span><span class="p">.</span><span class="n">ID_GENERO</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w">                                </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_GENERO</span><span class="p">,</span>
<span class="w">        </span><span class="n">pt</span><span class="p">.</span><span class="n">FECHA_NACIMIENTO</span><span class="p">,</span>
<span class="w">        </span><span class="k">ISNULL</span><span class="p">(</span><span class="n">pt</span><span class="p">.</span><span class="n">EDAD</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w">                                     </span><span class="k">AS</span><span class="w"> </span><span class="n">EDAD</span><span class="p">,</span>
<span class="w">        </span><span class="k">ISNULL</span><span class="p">(</span><span class="n">pt</span><span class="p">.</span><span class="n">DISCAPACIDAD</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="w">                              </span><span class="k">AS</span><span class="w"> </span><span class="n">DISCAPACIDAD</span><span class="p">,</span>
<span class="w">        </span><span class="s1">&#39;SI&#39;</span><span class="w">                                                   </span><span class="k">AS</span><span class="w"> </span><span class="n">POBLACION_EDUCACION</span><span class="p">,</span>
<span class="w">        </span><span class="k">CASE</span><span class="w"> </span><span class="k">WHEN</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">ID_UNIDAD</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="s1">&#39;SI&#39;</span><span class="w"> </span><span class="k">ELSE</span><span class="w"> </span><span class="s1">&#39;NO&#39;</span><span class="w"> </span><span class="k">END</span><span class="w">      </span><span class="k">AS</span><span class="w"> </span><span class="n">POBLACION_EDUCACION_FORMAL</span><span class="p">,</span>
<span class="w">        </span><span class="k">CASE</span><span class="w"> </span><span class="k">WHEN</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">ID_UNIDAD</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="s1">&#39;SI&#39;</span><span class="w"> </span><span class="k">ELSE</span><span class="w"> </span><span class="s1">&#39;NO&#39;</span><span class="w"> </span><span class="k">END</span><span class="w">      </span><span class="k">AS</span><span class="w"> </span><span class="n">POBLACION_EDUCACION_TECNICA</span><span class="p">,</span>
<span class="w">        </span><span class="k">CASE</span><span class="w"> </span><span class="k">WHEN</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">ID_UNIDAD</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="s1">&#39;SI&#39;</span><span class="w"> </span><span class="k">ELSE</span><span class="w"> </span><span class="s1">&#39;NO&#39;</span><span class="w"> </span><span class="k">END</span><span class="w">      </span><span class="k">AS</span><span class="w"> </span><span class="n">POBLACION_EDUCACION_CONTINUA</span><span class="p">,</span>
<span class="w">        </span><span class="k">CASE</span><span class="w"> </span><span class="k">WHEN</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">ID_UNIDAD</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="s1">&#39;SI&#39;</span><span class="w"> </span><span class="k">ELSE</span><span class="w"> </span><span class="s1">&#39;NO&#39;</span><span class="w"> </span><span class="k">END</span><span class="w">      </span><span class="k">AS</span><span class="w"> </span><span class="n">POBLACION_EDUCACION_PROTECCION</span>
<span class="k">FROM</span><span class="w">    </span><span class="n">consulta</span><span class="w"> </span><span class="k">c</span>
<span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">partnerTable</span><span class="w"> </span><span class="n">pt</span>
<span class="w">       </span><span class="k">ON</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">PARTNER</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pt</span><span class="p">.</span><span class="n">PARTNER</span>
<span class="w">      </span><span class="k">AND</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">ID_FECHA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pt</span><span class="p">.</span><span class="n">ID_FECHA</span><span class="p">;</span>
</code></pre></div>
<hr />
<h4 id="notas-adicionales"><strong>Notas Adicionales</strong><a class="headerlink" href="#notas-adicionales" title="Permanent link">&para;</a></h4>
<ul>
<li>La salida incluye columnas de control (<code>ErrorCode</code>, <code>ErrorColumn</code>) para manejo de filas rechazadas.</li>
<li>Los valores por defecto (<code>-1</code>, ‘INDEFINIDO’, ‘0000000000’) permiten mantener integridad referencial sin nulos en el destino.</li>
<li>El modelo soporta trazabilidad de la fuente original mediante el campo <strong><code>FUENTE_PRINCIPAL</code></strong>.</li>
</ul>
<h3 id="actividades-cedesarrollomatricula-mensual-educacion-tecnica"><strong>Actividades Cedesarrollo\Matricula Mensual Educacion Tecnica</strong><a class="headerlink" href="#actividades-cedesarrollomatricula-mensual-educacion-tecnica" title="Permanent link">&para;</a></h3>
<hr />
<h4 id="descripcion-general-del-componente"><strong>Descripción General del Componente</strong><a class="headerlink" href="#descripcion-general-del-componente" title="Permanent link">&para;</a></h4>
<p>Este flujo de datos del paquete SSIS extrae, transforma y carga registros mensuales de matrícula de educación técnica provenientes de Cedesarrollo. Su propósito es consolidar la información de estudiantes matriculados con dimensiones transversales como afiliaciones, beneficiarios, empresas y tiempo académico, para insertarla en la tabla <code>FACT_ACTIVIDADES</code> del DWH.</p>
<hr />
<h4 id="ubicacion-del-paquete"><strong>Ubicación del Paquete</strong><a class="headerlink" href="#ubicacion-del-paquete" title="Permanent link">&para;</a></h4>
<p><code>Package\FACT_ACTIVIDADES\Actividades Cedesarrollo\Matricula Mensual Educacion Tecnica</code></p>
<hr />
<h4 id="proposito-del-componente"><strong>Propósito del Componente</strong><a class="headerlink" href="#proposito-del-componente" title="Permanent link">&para;</a></h4>
<p>Cargar mensualmente las matrículas aprobadas en educación técnica desde la tabla <code>FACT_ESTADO_MATRICULAS</code> y enriquecerlas con información demográfica, académica y de afiliación para análisis de cobertura y caracterización poblacional.</p>
<hr />
<h4 id="detalles-de-implementacion_10"><strong>Detalles de Implementación</strong><a class="headerlink" href="#detalles-de-implementacion_10" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>Origen:</strong> <code>DWH_COMFENALCO.Cedesarrollo.FACT_ESTADO_MATRICULAS</code></li>
<li><strong>Destino:</strong> <code>DWH_COMFENALCO_Destino.Transversal.FACT_ACTIVIDADES</code></li>
<li>
<p><strong>Transformaciones:</strong></p>
<ul>
<li>Filtrado por unidad académica <code>ID_UNIDAD = 2</code>.</li>
<li>Unión con las tablas de dimensión <code>DIM_JORNADA</code>, <code>DIM_ESTUDIANTES</code>, <code>DIM_PERIODO_ACADEMICO</code>, <code>STG_FACT_AFILIACIONES</code>, <code>DIM_AFILIADOS</code>, <code>DIM_BENEFICIARIOS</code> y <code>DIM_EMPRESAS</code>.</li>
<li>Generación de fechas mensuales con <code>DIM_TIEMPO_MENSUAL</code>.</li>
<li>Clasificación de población por tipo de educación.</li>
<li>Conversión de campos como <code>ID_FECHA</code>, <code>PARTNER</code>, <code>ID_ESTUDIANTE</code>, <code>ID_CATEGORIA</code>, <code>DISCAPACIDAD</code>, entre otros.</li>
</ul>
</li>
<li>
<p><strong>Método de carga:</strong> Bulk Insert mediante ADO.NET Destination.</p>
</li>
</ul>
<hr />
<h4 id="logica-de-negocio_8"><strong>Lógica de Negocio</strong><a class="headerlink" href="#logica-de-negocio_8" title="Permanent link">&para;</a></h4>
<ol>
<li>Se filtran las matrículas con fecha de inicio válida y unidad de tipo técnica.</li>
<li>Se enriquecen con datos del estudiante (afiliado, empresa, beneficiario) mediante <code>LEFT JOIN</code>.</li>
<li>Se busca información de afiliaciones activas (<code>ACTIVIDAD = 'AFILIACION'</code>) para el mismo partner y fecha.</li>
<li>Se establecen variables categóricas como <code>POBLACION_EDUCACION_TECNICA</code> para segmentar según unidad educativa.</li>
<li>Se replican los datos para cada mes en el rango del semestre utilizando una tabla de fechas generada dinámicamente.</li>
<li>Finalmente, se insertan en <code>FACT_ACTIVIDADES</code>, incluyendo trazabilidad del partner, identificación del estudiante y clasificación poblacional.</li>
</ol>
<hr />
<h4 id="relacion-con-otros-componentes_9"><strong>Relación con Otros Componentes</strong><a class="headerlink" href="#relacion-con-otros-componentes_9" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p><strong>Dependencias:</strong></p>
<ul>
<li><code>DWH_COMFENALCO.Cedesarrollo.DIM_JORNADA</code></li>
<li><code>DWH_COMFENALCO.Cedesarrollo.DIM_ESTUDIANTES</code></li>
<li><code>DWH_COMFENALCO.Transversal.STG_FACT_AFILIACIONES</code></li>
<li><code>DWH_COMFENALCO.Transversal.DIM_TIEMPO_MENSUAL</code></li>
</ul>
</li>
<li>
<p><strong>Alimenta:</strong></p>
<ul>
<li>Tabla de hechos <code>FACT_ACTIVIDADES</code>, usada en dashboards de educación técnica.</li>
</ul>
</li>
</ul>
<hr />
<h4 id="script-sql-principal"><strong>Script SQL Principal</strong><a class="headerlink" href="#script-sql-principal" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="k">WITH</span><span class="w"> </span><span class="n">Matriculas_Cedesarrollo</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
<span class="w">  </span><span class="k">SELECT</span><span class="w"> </span><span class="k">DISTINCT</span><span class="w"> </span><span class="p">...</span>
<span class="w">  </span><span class="k">FROM</span><span class="w"> </span><span class="n">DWH_COMFENALCO</span><span class="p">.</span><span class="n">Cedesarrollo</span><span class="p">.</span><span class="n">FACT_ESTADO_MATRICULAS</span><span class="w"> </span><span class="p">...</span>
<span class="w">  </span><span class="k">WHERE</span><span class="w"> </span><span class="n">j</span><span class="p">.</span><span class="n">ID_UNIDAD</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">pa</span><span class="p">.</span><span class="n">FECHA_INICIO</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span>
<span class="p">),</span>
<span class="n">FechasMensualesCedesarrollo</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
<span class="w">  </span><span class="k">SELECT</span><span class="w"> </span><span class="n">Año</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">10000</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">Mes</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mi">100</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">01</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_FECHA_MENSUAL</span><span class="p">,</span><span class="w"> </span><span class="p">...</span>
<span class="p">),</span>
<span class="n">partnerTable</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
<span class="w">  </span><span class="k">SELECT</span><span class="w"> </span><span class="n">PARTNER</span><span class="p">,</span><span class="w"> </span><span class="n">ID_FECHA</span><span class="p">,</span><span class="w"> </span><span class="k">MAX</span><span class="p">(</span><span class="n">PARTNER_AFILIADO</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">PARTNER_AFILIADO</span><span class="p">,</span><span class="w"> </span><span class="p">...</span>
<span class="w">  </span><span class="k">FROM</span><span class="w"> </span><span class="n">STAGE_AREA</span><span class="p">.</span><span class="n">Transversal</span><span class="p">.</span><span class="n">STG_FACT_AFILIACIONES</span>
<span class="w">  </span><span class="k">WHERE</span><span class="w"> </span><span class="n">ACTIVIDAD</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;AFILIACION&#39;</span>
<span class="w">  </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">PARTNER</span><span class="p">,</span><span class="w"> </span><span class="n">ID_FECHA</span>
<span class="p">),</span>
<span class="n">MatriculasCedesarrolloCompleto</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
<span class="w">  </span><span class="k">SELECT</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="k">COALESCE</span><span class="p">(</span><span class="n">pt</span><span class="p">.</span><span class="n">PARTNER_AFILIADO</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;0000000000&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">...</span>
<span class="w">  </span><span class="k">FROM</span><span class="w"> </span><span class="n">Matriculas_Cedesarrollo</span><span class="w"> </span><span class="k">c</span>
<span class="w">  </span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">partnerTable</span><span class="w"> </span><span class="n">pt</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">PARTNER</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pt</span><span class="p">.</span><span class="n">PARTNER</span><span class="w"> </span><span class="p">...</span>
<span class="p">),</span>
<span class="n">Matriculas_CedesarrolloMensual</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
<span class="w">  </span><span class="k">SELECT</span><span class="w"> </span><span class="n">mc</span><span class="p">.</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="n">ID_FECHA_MENSUAL</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_FECHA</span>
<span class="w">  </span><span class="k">FROM</span><span class="w"> </span><span class="n">MatriculasCedesarrolloCompleto</span><span class="w"> </span><span class="n">mc</span>
<span class="w">  </span><span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">FechasMensualesCedesarrollo</span><span class="w"> </span><span class="n">fm</span><span class="w"> </span><span class="p">...</span>
<span class="p">)</span>
<span class="k">SELECT</span><span class="w"> </span><span class="n">cm</span><span class="p">.</span><span class="o">*</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">Matriculas_CedesarrolloMensual</span><span class="w"> </span><span class="n">cm</span>
<span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">DWH_COMFENALCO</span><span class="p">.</span><span class="n">Transversal</span><span class="p">.</span><span class="n">DIM_TIEMPO_MENSUAL</span><span class="w"> </span><span class="n">dimM</span>
<span class="w">  </span><span class="k">ON</span><span class="w"> </span><span class="n">cm</span><span class="p">.</span><span class="n">ID_FECHA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dimM</span><span class="p">.</span><span class="n">ID_FECHA</span>
<span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">PARTNER</span><span class="p">,</span><span class="w"> </span><span class="n">ID_FECHA</span><span class="p">;</span>
</code></pre></div>
<h3 id="actividades-cedesarrollofacturacion-tecnica-y-continua"><strong>Actividades Cedesarrollo\Facturacion Tecnica y Continua</strong><a class="headerlink" href="#actividades-cedesarrollofacturacion-tecnica-y-continua" title="Permanent link">&para;</a></h3>
<hr />
<h4 id="descripcion-general-del-componente_1"><strong>Descripción General del Componente</strong><a class="headerlink" href="#descripcion-general-del-componente_1" title="Permanent link">&para;</a></h4>
<p>Este componente realiza la extracción, transformación y carga (ETL) de la información de facturación de servicios técnicos y educación continua del sistema de Cedesarrollo hacia la tabla <code>FACT_ACTIVIDADES</code> en el <code>DWH_COMFENALCO</code>.</p>
<hr />
<h4 id="ubicacion-del-componente"><strong>Ubicación del Componente</strong><a class="headerlink" href="#ubicacion-del-componente" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>Paquete SSIS:</strong> <code>FACT_ACTIVIDADES</code></li>
<li><strong>Ruta:</strong> <code>Actividades Cedesarrollo\Facturacion Tecnica y Continua</code></li>
<li><strong>Tipo de tarea:</strong> <code>Data Flow Task</code></li>
</ul>
<hr />
<h4 id="proposito_10"><strong>Propósito</strong><a class="headerlink" href="#proposito_10" title="Permanent link">&para;</a></h4>
<p>Unificar, enriquecer y cargar información de facturación técnica y continua, relacionando datos de tarifas, afiliados, estudiantes y beneficios, permitiendo análisis detallados de cobertura educativa y subsidios aplicados.</p>
<hr />
<h4 id="detalles-de-implementacion_11"><strong>Detalles de Implementación</strong><a class="headerlink" href="#detalles-de-implementacion_11" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p><strong>Origen:</strong></p>
<ul>
<li>Componente <code>cedesarrollo</code> (origen ADO.NET).</li>
<li>Consulta SQL avanzada con subconsultas <code>SubsidiosCedesarrollo</code>, <code>Facturacion</code> y <code>partnerTable</code>.</li>
</ul>
</li>
<li>
<p><strong>Destino:</strong></p>
<ul>
<li>Componente <code>Destino de ADO NET</code> cargando en tabla <code>"Transversal"."FACT_ACTIVIDADES"</code>.</li>
<li>Uso de <code>SqlBulkCopy</code> habilitado para rendimiento óptimo.</li>
</ul>
</li>
<li>
<p><strong>Tipo de Conexiones:</strong></p>
<ul>
<li><code>DWH_COMFENALCO</code> (origen).</li>
<li><code>DWH_COMFENALCO_Destino</code> (destino).</li>
</ul>
</li>
<li>
<p><strong>Timeout Configurado:</strong> 30 segundos.</p>
</li>
</ul>
<hr />
<h4 id="logica-de-negocio_9"><strong>Lógica de Negocio</strong><a class="headerlink" href="#logica-de-negocio_9" title="Permanent link">&para;</a></h4>
<ul>
<li>Se calculan subsidios para categorías 1 y 2 en tarifas distintas al año 2022.</li>
<li>
<p>La unidad educativa se clasifica como:</p>
<ul>
<li><code>ID_UNIDAD = 1</code>: Formal</li>
<li><code>ID_UNIDAD = 2</code>: Técnica</li>
<li><code>ID_UNIDAD = 3</code>: Continua</li>
<li><code>ID_UNIDAD = 4</code>: Protección</li>
</ul>
</li>
<li>
<p>Se asignan valores categóricos "SI"/"NO" a indicadores como <code>POBLACION_EDUCACION_CONTINUA</code>.</p>
</li>
<li>
<p>La determinación del <code>PARTNER</code> se basa en un orden de prioridad entre tablas de afiliados, empresas y estudiantes.</p>
</li>
</ul>
<hr />
<h4 id="relacion-con-otros-componentes_10"><strong>Relación con Otros Componentes</strong><a class="headerlink" href="#relacion-con-otros-componentes_10" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>Integra datos desde:</p>
<ul>
<li><code>FACT_FACTURACION</code> de Cedesarrollo.</li>
<li>Tablas dimensionales: <code>DIM_AFILIADOS</code>, <code>DIM_BENEFICIARIOS</code>, <code>DIM_EMPRESAS</code>, <code>DIM_APORTANTE_NOAFILIADO</code>, <code>DIM_ESTUDIANTES</code>.</li>
<li>STG <code>STG_FACT_AFILIACIONES</code>.</li>
</ul>
</li>
<li>
<p>Se relaciona temporalmente con <code>DIM_TIEMPO_MENSUAL</code>.</p>
</li>
</ul>
<hr />
<h4 id="script-sql-principal_1"><strong>Script SQL Principal</strong><a class="headerlink" href="#script-sql-principal_1" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="k">WITH</span><span class="w"> </span><span class="n">SubsidiosCedesarrollo</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
<span class="k">SELECT</span><span class="w"> </span><span class="p">[</span><span class="n">ANIO_TARIFA</span><span class="p">]</span>
<span class="w">      </span><span class="p">,</span><span class="n">COD_CATEGORIA</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_CATEGORIA</span>
<span class="w">      </span><span class="p">,</span><span class="k">max</span><span class="p">([</span><span class="n">COS_UNITARIO_CONCEPTO</span><span class="p">])</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">COSTO_UNITARIO</span>
<span class="w">      </span><span class="p">,</span><span class="k">MAX</span><span class="p">([</span><span class="n">VAL_TARIFA</span><span class="p">])</span><span class="w"> </span><span class="n">VALOR_TARIFA</span>
<span class="w">      </span><span class="p">,</span><span class="k">max</span><span class="p">([</span><span class="n">COS_UNITARIO_CONCEPTO</span><span class="p">])</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">MAX</span><span class="p">([</span><span class="n">VAL_TARIFA</span><span class="p">])</span><span class="w">  </span><span class="k">AS</span><span class="w"> </span><span class="n">SUBSIDIO</span>
<span class="w">  </span><span class="k">FROM</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Transversal</span><span class="p">].[</span><span class="n">DIM_TARIFAS_SERVICIOS</span><span class="p">]</span>
<span class="w">  </span><span class="k">WHERE</span><span class="w"> </span><span class="n">COD_INFRAESTRUCTURA_CCF</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;CCF008-13-00001&#39;</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">COD_CATEGORIA</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">ANIO_TARIFA</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">2022</span>
<span class="w">  </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="p">[</span><span class="n">ANIO_TARIFA</span><span class="p">],</span><span class="w"> </span><span class="n">COD_CATEGORIA</span>
<span class="w">  </span><span class="p">),</span>
<span class="n">Facturacion</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="p">(</span>
<span class="k">SELECT</span><span class="w"> </span>
<span class="w">    </span><span class="o">-</span><span class="mi">1</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">ID_PROGRAMA</span><span class="p">,</span>
<span class="w">    </span><span class="k">LEFT</span><span class="p">([</span><span class="n">ID_FECHA</span><span class="p">],</span><span class="mi">6</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">ID_FECHA</span><span class="p">,</span>
<span class="w">    </span><span class="p">[</span><span class="n">ESTADO_PAGO</span><span class="p">]</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">ESTADO</span><span class="p">,</span>
<span class="w">    </span><span class="k">COALESCE</span><span class="p">(</span><span class="w"> </span><span class="p">[</span><span class="n">CONCEPTO</span><span class="p">]</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;INDEFINIDO&#39;</span><span class="p">)</span><span class="w">  </span><span class="k">as</span><span class="w"> </span><span class="n">DESCRIPCION</span><span class="p">,</span>
<span class="w">    </span><span class="s1">&#39;FACTURACION&#39;</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">ACTIVIDAD</span><span class="p">,</span>
<span class="w">    </span><span class="k">ISNULL</span><span class="p">(</span>
<span class="w">     </span><span class="k">CASE</span><span class="w"> </span>
<span class="w">        </span><span class="k">WHEN</span><span class="w"> </span><span class="n">de</span><span class="p">.</span><span class="n">PARTNER</span><span class="w"> </span><span class="o">&lt;&gt;</span><span class="w"> </span><span class="s1">&#39;0000000000&#39;</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="n">de</span><span class="p">.</span><span class="n">PARTNER</span><span class="w"> </span>
<span class="w">        </span><span class="k">ELSE</span><span class="w"> </span><span class="k">CASE</span><span class="w"> </span>
<span class="w">            </span><span class="k">WHEN</span><span class="w"> </span><span class="n">da</span><span class="p">.</span><span class="n">PARTNER</span><span class="w"> </span><span class="o">&lt;&gt;</span><span class="w"> </span><span class="s1">&#39;0000000000&#39;</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="n">da</span><span class="p">.</span><span class="n">PARTNER</span><span class="w"> </span>
<span class="w">            </span><span class="k">ELSE</span><span class="w"> </span><span class="k">CASE</span><span class="w"> </span>
<span class="w">                </span><span class="k">WHEN</span><span class="w"> </span><span class="n">db</span><span class="p">.</span><span class="n">PARTNER</span><span class="w"> </span><span class="o">&lt;&gt;</span><span class="w"> </span><span class="s1">&#39;0000000000&#39;</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="n">db</span><span class="p">.</span><span class="n">PARTNER</span><span class="w"> </span>
<span class="w">                </span><span class="k">ELSE</span><span class="w"> </span><span class="n">daa</span><span class="p">.</span><span class="n">PARTNER</span><span class="w"> </span>
<span class="w">                </span><span class="k">END</span><span class="w"> </span>
<span class="w">            </span><span class="k">END</span><span class="w"> </span>
<span class="w">        </span><span class="k">END</span><span class="p">,</span><span class="s1">&#39;0000000000&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="p">[</span><span class="n">PARTNER</span><span class="p">],</span>
<span class="w">    </span><span class="k">CASE</span>
<span class="w">            </span><span class="k">WHEN</span><span class="w"> </span><span class="n">LEN</span><span class="p">(</span><span class="n">NO_RECIBO</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">6</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="mi">2</span>
<span class="w">            </span><span class="k">ELSE</span><span class="w"> </span><span class="mi">3</span>
<span class="w">        </span><span class="k">END</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_UNIDAD</span><span class="p">,</span>
<span class="w">        </span><span class="k">COALESCE</span><span class="p">(</span><span class="n">ID_TARIFA</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">ID_TARIFA</span><span class="p">,</span>
<span class="w">        </span><span class="k">ISNULL</span><span class="p">(</span><span class="n">SUBSIDIO</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">SUBSIDIO</span><span class="p">,</span>
<span class="w">        </span><span class="k">COALESCE</span><span class="p">(</span><span class="n">dest</span><span class="p">.</span><span class="n">ID_EMPRESA</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">ID_EMPRESA</span><span class="p">,</span>
<span class="w">    </span><span class="k">COALESCE</span><span class="p">(</span><span class="n">dest</span><span class="p">.</span><span class="n">ID_AFILIADO</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">ID_AFILIADO</span><span class="p">,</span>
<span class="w">     </span><span class="k">COALESCE</span><span class="p">(</span><span class="n">dest</span><span class="p">.</span><span class="n">ID_BENEFICIARIO</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">ID_BENEFICIARIO</span><span class="p">,</span>
<span class="w">     </span><span class="k">COALESCE</span><span class="p">(</span><span class="n">dest</span><span class="p">.</span><span class="n">ID_APORTANTE</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">ID_APORTANTE</span><span class="p">,</span>
<span class="w">     </span><span class="k">COALESCE</span><span class="p">(</span><span class="n">dest</span><span class="p">.</span><span class="n">ID_ESTUDIANTE</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w">  </span><span class="n">ID_ESTUDIANTE</span><span class="p">,</span>
<span class="w">     </span><span class="s1">&#39;[DWH_COMFENALCO].[Cedesarrollo].[FACT_FACTURACION]&#39;</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="p">[</span><span class="n">FUENTE_PRINCIPAL</span><span class="p">]</span>
<span class="k">FROM</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Cedesarrollo</span><span class="p">].[</span><span class="n">FACT_FACTURACION</span><span class="p">]</span><span class="w"> </span><span class="n">ff</span>

<span class="w">  </span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Transversal</span><span class="p">].[</span><span class="n">DIM_AFILIADOS</span><span class="p">]</span><span class="w"> </span><span class="n">da</span>
<span class="w">  </span><span class="k">ON</span><span class="w"> </span><span class="n">ff</span><span class="p">.[</span><span class="n">TIPO_DOCUMENTO_PAGO</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">da</span><span class="p">.[</span><span class="n">COD_TIPO_DOCUMENTO</span><span class="p">]</span>
<span class="w">  </span><span class="k">AND</span><span class="w"> </span><span class="n">ff</span><span class="p">.[</span><span class="n">DOCUMENTO_PAGO</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">da</span><span class="p">.[</span><span class="n">NUMERO_DOCUMENTO</span><span class="p">]</span>
<span class="w">  </span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Transversal</span><span class="p">].[</span><span class="n">DIM_BENEFICIARIOS</span><span class="p">]</span><span class="w"> </span><span class="n">db</span>
<span class="w">   </span><span class="k">ON</span><span class="w"> </span><span class="n">ff</span><span class="p">.[</span><span class="n">TIPO_DOCUMENTO_PAGO</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">db</span><span class="p">.[</span><span class="n">COD_TIPO_DOCUMENTO</span><span class="p">]</span>
<span class="w">  </span><span class="k">AND</span><span class="w"> </span><span class="n">ff</span><span class="p">.[</span><span class="n">DOCUMENTO_PAGO</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">db</span><span class="p">.[</span><span class="n">NUMERO_DOCUMENTO</span><span class="p">]</span>
<span class="w">  </span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Transversal</span><span class="p">].[</span><span class="n">DIM_EMPRESAS</span><span class="p">]</span><span class="w"> </span><span class="n">de</span>
<span class="w">   </span><span class="k">ON</span><span class="w"> </span><span class="n">ff</span><span class="p">.[</span><span class="n">TIPO_DOCUMENTO_PAGO</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">de</span><span class="p">.[</span><span class="n">COD_TIPO_DOCUMENTO</span><span class="p">]</span>
<span class="w">  </span><span class="k">AND</span><span class="w"> </span><span class="n">ff</span><span class="p">.[</span><span class="n">DOCUMENTO_PAGO</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">de</span><span class="p">.[</span><span class="n">DOCUMENTO</span><span class="p">]</span>
<span class="w">  </span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Transversal</span><span class="p">].[</span><span class="n">DIM_APORTANTE_NOAFILIADO</span><span class="p">]</span><span class="w"> </span><span class="n">daa</span>
<span class="w">   </span><span class="k">ON</span><span class="w"> </span><span class="n">ff</span><span class="p">.[</span><span class="n">TIPO_DOCUMENTO_PAGO</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">daa</span><span class="p">.[</span><span class="n">COD_TIPO_DOCUMENTO</span><span class="p">]</span>
<span class="w">  </span><span class="k">AND</span><span class="w"> </span><span class="n">ff</span><span class="p">.[</span><span class="n">DOCUMENTO_PAGO</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">daa</span><span class="p">.[</span><span class="n">DOCUMENTO</span><span class="p">]</span>
<span class="w">  </span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Cedesarrollo</span><span class="p">].[</span><span class="n">DIM_ESTUDIANTES</span><span class="p">]</span><span class="w"> </span><span class="n">dest</span><span class="w"> </span>
<span class="w">  </span><span class="k">ON</span><span class="w"> </span><span class="n">ff</span><span class="p">.[</span><span class="n">TIPO_DOCUMENTO_PAGO</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dest</span><span class="w"> </span><span class="p">.[</span><span class="n">TIPO_DOCUMENTO</span><span class="p">]</span>
<span class="w">  </span><span class="k">AND</span><span class="w"> </span><span class="n">ff</span><span class="p">.[</span><span class="n">DOCUMENTO_PAGO</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dest</span><span class="w"> </span><span class="p">.[</span><span class="n">DOCUMENTO</span><span class="p">]</span><span class="w"> </span>
<span class="w">   </span><span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="p">(</span><span class="k">select</span><span class="w"> </span><span class="n">ID_FECHA</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">ID_FECHA2</span><span class="w">  </span><span class="k">from</span><span class="w">  </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Transversal</span><span class="p">].[</span><span class="n">DIM_TIEMPO_MENSUAL</span><span class="p">]</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">dimM</span>
<span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">ff</span><span class="p">.</span><span class="n">ID_FECHA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dimM</span><span class="p">.</span><span class="n">ID_FECHA2</span><span class="p">)</span>
<span class="p">,</span>
<span class="w">  </span><span class="n">partnerTable</span><span class="w">  </span><span class="k">as</span><span class="w"> </span><span class="p">(</span>
<span class="k">SELECT</span><span class="w"> </span>
<span class="w">    </span><span class="n">PARTNER</span><span class="p">,</span>
<span class="w">    </span><span class="n">ID_FECHA</span><span class="p">,</span>
<span class="w">    </span><span class="k">MAX</span><span class="p">([</span><span class="n">PARTNER_AFILIADO</span><span class="p">])</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">PARTNER_AFILIADO</span><span class="p">,</span>
<span class="w">    </span><span class="k">MAX</span><span class="p">([</span><span class="n">PARTNER_EMPRESA</span><span class="p">])</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">PARTNER_EMPRESA</span><span class="p">,</span>
<span class="w">    </span><span class="k">MIN</span><span class="p">([</span><span class="n">ID_CATEGORIA</span><span class="p">])</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_CATEGORIA</span><span class="p">,</span>
<span class="w">    </span><span class="k">MAX</span><span class="p">([</span><span class="n">ID_GENERO</span><span class="p">])</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_GENERO</span><span class="p">,</span>
<span class="w">    </span><span class="k">MAX</span><span class="p">([</span><span class="n">FECHA_NACIMIENTO</span><span class="p">])</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">FECHA_NACIMIENTO</span><span class="p">,</span>
<span class="w">    </span><span class="k">MAX</span><span class="p">([</span><span class="n">EDAD</span><span class="p">])</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">EDAD</span><span class="p">,</span>
<span class="w">    </span><span class="k">MAX</span><span class="p">([</span><span class="n">DISCAPACIDAD</span><span class="p">])</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">DISCAPACIDAD</span>
<span class="k">FROM</span><span class="w"> </span><span class="p">[</span><span class="n">STAGE_AREA</span><span class="p">].[</span><span class="n">Transversal</span><span class="p">].[</span><span class="n">STG_FACT_AFILIACIONES</span><span class="p">]</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">ACTIVIDAD</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;AFILIACION&#39;</span>
<span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">PARTNER</span><span class="p">,</span><span class="w"> </span><span class="n">ID_FECHA</span>

<span class="w">  </span><span class="p">)</span>
<span class="w">  </span><span class="k">select</span><span class="w">  </span>
<span class="w">        </span><span class="k">c</span><span class="p">.</span><span class="n">ID_PROGRAMA</span><span class="p">,</span>
<span class="w">        </span><span class="k">c</span><span class="p">.</span><span class="n">ID_FECHA</span><span class="p">,</span>
<span class="w">        </span><span class="k">c</span><span class="p">.</span><span class="n">ESTADO</span><span class="p">,</span>
<span class="w">        </span><span class="k">c</span><span class="p">.</span><span class="n">DESCRIPCION</span><span class="p">,</span>
<span class="w">        </span><span class="k">c</span><span class="p">.</span><span class="n">ACTIVIDAD</span><span class="p">,</span>
<span class="w">        </span><span class="k">c</span><span class="p">.[</span><span class="n">PARTNER</span><span class="p">],</span>
<span class="w">        </span><span class="k">c</span><span class="p">.</span><span class="n">ID_UNIDAD</span><span class="p">,</span>
<span class="w">        </span><span class="k">c</span><span class="p">.</span><span class="n">ID_TARIFA</span><span class="p">,</span>
<span class="w">        </span><span class="c1">--c.SUBSIDIO,</span>
<span class="w">        </span><span class="k">CASE</span>
<span class="w">            </span><span class="k">WHEN</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">SUBSIDIO</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">pt</span><span class="p">.</span><span class="n">ID_CATEGORIA</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="w">                </span><span class="k">AND</span><span class="w"> </span><span class="n">DESCRIPCION</span><span class="w"> </span><span class="k">LIKE</span><span class="w"> </span><span class="s1">&#39;%PROG%&#39;</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">DESCRIPCION</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">LIKE</span><span class="w"> </span><span class="s1">&#39;%CREDITO%&#39;</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="n">SC</span><span class="p">.</span><span class="n">SUBSIDIO</span>
<span class="w">            </span><span class="k">ELSE</span><span class="w"> </span><span class="mi">0</span>
<span class="w">        </span><span class="k">END</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">SUBSIDIO</span><span class="p">,</span>
<span class="w">        </span><span class="k">c</span><span class="p">.</span><span class="n">ID_EMPRESA</span><span class="p">,</span>
<span class="w">        </span><span class="k">c</span><span class="p">.</span><span class="n">ID_AFILIADO</span><span class="p">,</span>
<span class="w">        </span><span class="k">c</span><span class="p">.</span><span class="n">ID_BENEFICIARIO</span><span class="p">,</span>
<span class="w">        </span><span class="k">c</span><span class="p">.</span><span class="n">ID_APORTANTE</span><span class="p">,</span>
<span class="w">        </span><span class="k">c</span><span class="p">.</span><span class="n">ID_ESTUDIANTE</span><span class="p">,</span>
<span class="w">        </span><span class="k">c</span><span class="p">.[</span><span class="n">FUENTE_PRINCIPAL</span><span class="p">],</span>
<span class="w">        </span><span class="k">COALESCE</span><span class="p">(</span><span class="n">pt</span><span class="p">.[</span><span class="n">PARTNER_AFILIADO</span><span class="p">],</span><span class="w"> </span><span class="s1">&#39;0000000000&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">PARTNER_AFILIADO</span><span class="p">,</span>
<span class="w">        </span><span class="k">COALESCE</span><span class="p">(</span><span class="n">pt</span><span class="p">.[</span><span class="n">PARTNER_EMPRESA</span><span class="p">]</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;0000000000&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">PARTNER_EMPRESA</span><span class="p">,</span>
<span class="w">        </span><span class="k">COALESCE</span><span class="p">(</span><span class="n">pt</span><span class="p">.[</span><span class="n">ID_CATEGORIA</span><span class="p">]</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">ID_CATEGORIA</span><span class="p">,</span>
<span class="w">        </span><span class="k">COALESCE</span><span class="p">(</span><span class="n">pt</span><span class="p">.[</span><span class="n">ID_GENERO</span><span class="p">]</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">ID_GENERO</span><span class="p">,</span>
<span class="w">        </span><span class="n">pt</span><span class="p">.[</span><span class="n">FECHA_NACIMIENTO</span><span class="p">],</span><span class="w"> </span>
<span class="w">        </span><span class="k">COALESCE</span><span class="p">(</span><span class="n">pt</span><span class="p">.[</span><span class="n">EDAD</span><span class="p">]</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">EDAD</span><span class="p">,</span>
<span class="w">        </span><span class="k">COALESCE</span><span class="p">(</span><span class="n">pt</span><span class="p">.</span><span class="n">DISCAPACIDAD</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">DISCAPACIDAD</span>
<span class="w">        </span><span class="p">,</span><span class="s1">&#39;SI&#39;</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">POBLACION_EDUCACION</span>
<span class="w">        </span><span class="p">,</span><span class="k">CASE</span><span class="w"> </span>
<span class="w">            </span><span class="k">WHEN</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">ID_UNIDAD</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="s1">&#39;SI&#39;</span>
<span class="w">            </span><span class="k">ELSE</span><span class="w"> </span><span class="s1">&#39;NO&#39;</span>
<span class="w">        </span><span class="k">END</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">POBLACION_EDUCACION_FORMAL</span><span class="p">,</span>
<span class="w">        </span><span class="k">CASE</span><span class="w"> </span>
<span class="w">            </span><span class="k">WHEN</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">ID_UNIDAD</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="s1">&#39;SI&#39;</span>
<span class="w">            </span><span class="k">ELSE</span><span class="w"> </span><span class="s1">&#39;NO&#39;</span>
<span class="w">        </span><span class="k">END</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">POBLACION_EDUCACION_TECNICA</span><span class="p">,</span>
<span class="w">        </span><span class="k">CASE</span><span class="w"> </span>
<span class="w">            </span><span class="k">WHEN</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">ID_UNIDAD</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="s1">&#39;SI&#39;</span>
<span class="w">            </span><span class="k">ELSE</span><span class="w"> </span><span class="s1">&#39;NO&#39;</span>
<span class="w">        </span><span class="k">END</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">POBLACION_EDUCACION_CONTINUA</span><span class="p">,</span>
<span class="w">        </span><span class="k">CASE</span><span class="w"> </span>
<span class="w">            </span><span class="k">WHEN</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">ID_UNIDAD</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="s1">&#39;SI&#39;</span>
<span class="w">            </span><span class="k">ELSE</span><span class="w"> </span><span class="s1">&#39;NO&#39;</span>
<span class="w">        </span><span class="k">END</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">POBLACION_EDUCACION_PROTECCION</span><span class="w"> </span>
<span class="w">  </span><span class="k">from</span><span class="w">  </span><span class="n">Facturacion</span><span class="w"> </span><span class="k">c</span>
<span class="w">  </span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w">  </span><span class="n">partnerTable</span><span class="w"> </span><span class="n">pt</span>
<span class="w">  </span><span class="k">ON</span><span class="w"> </span><span class="k">c</span><span class="p">.[</span><span class="n">PARTNER</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pt</span><span class="p">.[</span><span class="n">PARTNER</span><span class="p">]</span>
<span class="w">  </span><span class="k">AND</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">ID_FECHA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pt</span><span class="p">.</span><span class="n">ID_FECHA</span>
<span class="w">  </span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">SubsidiosCedesarrollo</span><span class="w"> </span><span class="n">sc</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="k">LEFT</span><span class="p">(</span><span class="k">c</span><span class="p">.</span><span class="n">ID_FECHA</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sc</span><span class="p">.</span><span class="n">ANIO_TARIFA</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">pt</span><span class="p">.</span><span class="n">ID_CATEGORIA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sc</span><span class="p">.</span><span class="n">ID_CATEGORIA</span>
</code></pre></div>
<h3 id="actividades-colegiofact_actividades_colegio"><strong>Actividades Colegio\FACT_ACTIVIDADES_COLEGIO</strong><a class="headerlink" href="#actividades-colegiofact_actividades_colegio" title="Permanent link">&para;</a></h3>
<hr />
<h4 id="descripcion-general-del-componente_2"><strong>Descripción General del Componente</strong><a class="headerlink" href="#descripcion-general-del-componente_2" title="Permanent link">&para;</a></h4>
<p>Este flujo de datos realiza la consolidación de múltiples fuentes relacionadas con actividades académicas y de apoyo en el entorno escolar, tales como matrículas, facturación, transporte, biblioteca, enfermería, retiros y psicorientación. A través de una lógica unificada y enriquecimiento con dimensiones transversales, se genera una vista consolidada de actividades por año académico, beneficiario y tipo de servicio, para cargarla en la tabla <code>FACT_ACTIVIDADES</code> del DWH.</p>
<hr />
<h4 id="ubicacion-del-paquete_1"><strong>Ubicación del Paquete</strong><a class="headerlink" href="#ubicacion-del-paquete_1" title="Permanent link">&para;</a></h4>
<p><code>Package\FACT_ACTIVIDADES\Actividades Colegio\FACT_ACTIVIDADES_COLEGIO</code></p>
<hr />
<h4 id="proposito-del-componente_1"><strong>Propósito del Componente</strong><a class="headerlink" href="#proposito-del-componente_1" title="Permanent link">&para;</a></h4>
<p>Integrar diferentes hechos escolares provenientes de múltiples fuentes del dominio educativo, enriqueciendo cada registro con afiliaciones, características poblacionales y categorizaciones transversales. Esta integración proporciona una vista consolidada de la experiencia educativa de los beneficiarios, facilitando análisis institucionales y caracterización poblacional.</p>
<hr />
<h4 id="detalles-de-implementacion_12"><strong>Detalles de Implementación</strong><a class="headerlink" href="#detalles-de-implementacion_12" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p><strong>Origen de datos:</strong></p>
<ul>
<li><code>FACT_INSCRIPCION_MATRICULAS</code></li>
<li><code>FACT_RESULTADOS</code></li>
<li><code>FACT_TRANSPORTE</code></li>
<li><code>FACT_FACTURACION_MATRICULAS</code></li>
<li><code>FACT_BIBLIOTECA</code></li>
<li><code>FACT_BIBLIOTECA_VIRTUAL</code></li>
<li><code>FACT_ENFERMERIA</code></li>
<li><code>FACT_RETIROS</code></li>
<li><code>FACT_PSICORIENTACION</code></li>
</ul>
</li>
<li>
<p><strong>Transformaciones aplicadas:</strong></p>
<ul>
<li>Unión y estandarización de todos los hechos bajo una estructura común.</li>
<li>Cálculo de fecha académica (<code>ANIO_ACADEMICO</code>) y normalización de <code>ID_FECHA</code>.</li>
<li>Enriquecimiento con datos del beneficiario desde <code>DIM_BENEFICIARIOS</code>.</li>
<li>Incorporación de características poblacionales desde <code>STG_FACT_AFILIACIONES</code>.</li>
<li>Clasificación de registros por unidad académica (formal, técnica, continua, protección).</li>
</ul>
</li>
<li>
<p><strong>Carga final:</strong></p>
<ul>
<li>Se aplica lógica <code>CASE</code> para generar banderas de clasificación (<code>POBLACION_EDUCACION_TECNICA</code>, <code>POBLACION_EDUCACION_FORMAL</code>, etc.).</li>
<li>Unión con <code>DIM_TIEMPO_MENSUAL</code> asegura trazabilidad temporal estructurada.</li>
<li>La información es enviada al destino final <code>FACT_ACTIVIDADES</code>.</li>
</ul>
</li>
</ul>
<hr />
<h4 id="logica-de-negocio_10"><strong>Lógica de Negocio</strong><a class="headerlink" href="#logica-de-negocio_10" title="Permanent link">&para;</a></h4>
<ul>
<li>Consolidar en un único conjunto de datos las distintas actividades realizadas por los estudiantes durante el año académico.</li>
<li>Estandarizar columnas comunes como <code>PARTNER</code>, <code>ID_FECHA</code>, <code>ACTIVIDAD</code>, <code>VALOR_FACTURADO</code>, <code>ADEUDA</code>, <code>SERVICIO_TRANSPORTE</code>.</li>
<li>Utilizar la dimensión de tiempo para garantizar granularidad mensual.</li>
<li>Clasificar registros por unidad para uso en dashboards segmentados (formal, técnica, continua).</li>
<li>Asegurar integridad referencial mediante <code>LEFT JOIN</code> con dimensiones de beneficiarios y afiliaciones.</li>
</ul>
<hr />
<h4 id="relacion-con-otros-componentes_11"><strong>Relación con Otros Componentes</strong><a class="headerlink" href="#relacion-con-otros-componentes_11" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p><strong>Dependencias:</strong></p>
<ul>
<li>Tablas fuente del dominio <code>Colegio</code> en el DWH.</li>
<li>Dimensiones transversales: <code>DIM_BENEFICIARIOS</code>, <code>STG_FACT_AFILIACIONES</code>, <code>DIM_TIEMPO_MENSUAL</code>.</li>
</ul>
</li>
<li>
<p><strong>Destino:</strong></p>
<ul>
<li>Tabla consolidada <code>FACT_ACTIVIDADES</code> que representa el principal insumo para visualizaciones y análisis educativos.</li>
</ul>
</li>
</ul>
<hr />
<h4 id="script-sql-principal-fragmento-representativo"><strong>Script SQL Principal (Fragmento Representativo)</strong><a class="headerlink" href="#script-sql-principal-fragmento-representativo" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="k">WITH</span><span class="w"> </span><span class="n">consulta</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
<span class="w">  </span><span class="k">SELECT</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">FACT_INSCRIPCION_MATRICULAS</span>
<span class="w">  </span><span class="k">UNION</span>
<span class="w">  </span><span class="k">SELECT</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">FACT_RESULTADOS</span>
<span class="w">  </span><span class="k">UNION</span>
<span class="w">  </span><span class="k">SELECT</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">FACT_TRANSPORTE</span>
<span class="w">  </span><span class="k">UNION</span>
<span class="w">  </span><span class="k">SELECT</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">FACT_FACTURACION_MATRICULAS</span>
<span class="w">  </span><span class="k">UNION</span>
<span class="w">  </span><span class="k">SELECT</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">FACT_BIBLIOTECA</span>
<span class="w">  </span><span class="k">UNION</span>
<span class="w">  </span><span class="k">SELECT</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">FACT_BIBLIOTECA_VIRTUAL</span>
<span class="w">  </span><span class="k">UNION</span>
<span class="w">  </span><span class="k">SELECT</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">FACT_ENFERMERIA</span>
<span class="w">  </span><span class="k">UNION</span>
<span class="w">  </span><span class="k">SELECT</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">FACT_RETIROS</span>
<span class="w">  </span><span class="k">UNION</span>
<span class="w">  </span><span class="k">SELECT</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">FACT_PSICORIENTACION</span>
<span class="p">),</span>
<span class="n">partnerTable</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
<span class="w">  </span><span class="k">SELECT</span><span class="w"> </span><span class="n">PARTNER</span><span class="p">,</span><span class="w"> </span><span class="n">ID_FECHA</span><span class="p">,</span><span class="w"> </span><span class="k">MAX</span><span class="p">(</span><span class="n">PARTNER_AFILIADO</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">PARTNER_AFILIADO</span><span class="p">,</span><span class="w"> </span><span class="p">...</span>
<span class="w">  </span><span class="k">FROM</span><span class="w"> </span><span class="n">STG_FACT_AFILIACIONES</span>
<span class="w">  </span><span class="k">WHERE</span><span class="w"> </span><span class="n">ACTIVIDAD</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;AFILIACION&#39;</span>
<span class="w">  </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">PARTNER</span><span class="p">,</span><span class="w"> </span><span class="n">ID_FECHA</span>
<span class="p">)</span>
<span class="k">SELECT</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="o">*</span><span class="p">,</span><span class="w"> </span>
<span class="w">       </span><span class="k">COALESCE</span><span class="p">(</span><span class="n">pt</span><span class="p">.</span><span class="n">PARTNER_AFILIADO</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;0000000000&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">PARTNER_AFILIADO</span><span class="p">,</span>
<span class="w">       </span><span class="k">COALESCE</span><span class="p">(</span><span class="n">pt</span><span class="p">.</span><span class="n">ID_CATEGORIA</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_CATEGORIA</span><span class="p">,</span>
<span class="w">       </span><span class="p">...</span>
<span class="w">       </span><span class="k">CASE</span><span class="w"> </span><span class="k">WHEN</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">ID_UNIDAD</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="s1">&#39;SI&#39;</span><span class="w"> </span><span class="k">ELSE</span><span class="w"> </span><span class="s1">&#39;NO&#39;</span><span class="w"> </span><span class="k">END</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">POBLACION_EDUCACION_FORMAL</span><span class="p">,</span>
<span class="w">       </span><span class="p">...</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">consulta</span><span class="w"> </span><span class="k">c</span>
<span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">partnerTable</span><span class="w"> </span><span class="n">pt</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">PARTNER</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pt</span><span class="p">.</span><span class="n">PARTNER</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">ID_FECHA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pt</span><span class="p">.</span><span class="n">ID_FECHA</span><span class="p">;</span>
</code></pre></div>
<h3 id="actividades-colegiomatricula-mensual-colegio"><strong>Actividades Colegio\Matricula Mensual Colegio</strong><a class="headerlink" href="#actividades-colegiomatricula-mensual-colegio" title="Permanent link">&para;</a></h3>
<hr />
<h4 id="descripcion-general_10">Descripción General<a class="headerlink" href="#descripcion-general_10" title="Permanent link">&para;</a></h4>
<p>Este componente del paquete SSIS se encarga de consolidar la información mensual de matrículas aprobadas en colegios, combinando datos de matriculación académica con atributos de afiliación del beneficiario. Los resultados se cargan en la tabla de hechos <code>FACT_ACTIVIDADES</code>, permitiendo su posterior análisis multidimensional en el Data Warehouse institucional.</p>
<hr />
<h4 id="ubicacion-del-paquete_2">Ubicación del Paquete<a class="headerlink" href="#ubicacion-del-paquete_2" title="Permanent link">&para;</a></h4>
<p><code>Package\FACT_ACTIVIDADES\Actividades Colegio\Matricula Mensual Colegio</code></p>
<hr />
<h4 id="proposito_11">Propósito<a class="headerlink" href="#proposito_11" title="Permanent link">&para;</a></h4>
<p>Transformar registros de matrícula aprobada de educación formal provenientes de la tabla <code>FACT_ESTADO_MATRICULAS</code>, enriquecerlos con atributos demográficos y afiliativos, y normalizar fechas en formato mensual. El componente genera un set de datos depurado para seguimiento mensual de población escolar beneficiaria.</p>
<hr />
<h4 id="detalles-de-implementacion_13">Detalles de Implementación<a class="headerlink" href="#detalles-de-implementacion_13" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>Origen de datos</strong>: ADO.NET con query compleja basada en CTEs sobre <code>DWH_COMFENALCO.Colegio.FACT_ESTADO_MATRICULAS</code>.</li>
<li>
<p><strong>Transformaciones</strong>:</p>
<ul>
<li>Conversión de fecha de pago en <code>ID_FECHA_MENSUAL</code>.</li>
<li>Uniones con <code>DIM_BENEFICIARIOS</code> y <code>STG_FACT_AFILIACIONES</code>.</li>
<li>Etiquetado de tipo de población educativa por unidad.</li>
</ul>
</li>
<li>
<p><strong>Destino</strong>: ADO.NET hacia <code>DWH_COMFENALCO.Transversal.FACT_ACTIVIDADES</code>.</p>
</li>
</ul>
<hr />
<h4 id="logica-de-negocio_11">Lógica de Negocio<a class="headerlink" href="#logica-de-negocio_11" title="Permanent link">&para;</a></h4>
<ul>
<li>Filtra matrículas aprobadas (<code>CA20_ESTADO_MATRICULA = 'APROBADA'</code>).</li>
<li>Excluye registros con fechas de pago no válidas (<code>CA20_FECHA_PAGO != '00000000'</code>).</li>
<li>Crea una dimensión de fechas mensuales (enero a diciembre).</li>
<li>Clasifica la actividad como <code>ESTADO_MATRICULAS</code>.</li>
<li>Enlaza cada matrícula con datos afiliativos y demográficos del beneficiario.</li>
<li>Asegura consistencia temporal con la tabla <code>DIM_TIEMPO_MENSUAL</code>.</li>
</ul>
<hr />
<h4 id="relacion-con-otros-componentes_12">Relación con Otros Componentes<a class="headerlink" href="#relacion-con-otros-componentes_12" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>Reutiliza estructuras comunes con otros componentes del paquete <code>FACT_ACTIVIDADES</code> como:</p>
<ul>
<li><code>Matricula Mensual Educacion Tecnica</code></li>
<li><code>FACT_ESTADO_MATRICULAS</code> como fuente primaria</li>
<li><code>STG_FACT_AFILIACIONES</code> y <code>DIM_BENEFICIARIOS</code> como enriquecimiento transversal</li>
</ul>
</li>
</ul>
<hr />
<h4 id="script-sql-principal_2">Script SQL Principal<a class="headerlink" href="#script-sql-principal_2" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="k">WITH</span><span class="w"> </span><span class="n">EstadoMatriculasColegio</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="k">SELECT</span><span class="w">  </span>
<span class="w">        </span><span class="mi">1</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_UNIDAD</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="n">ID_GRADO</span><span class="p">],</span><span class="w"> </span><span class="p">[</span><span class="n">CA20_ANO_ACADEMICO</span><span class="p">]</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ANIO_ACADEMICO</span><span class="p">,</span>
<span class="w">        </span><span class="p">[</span><span class="n">CA20_BP_ESTUDIANTE</span><span class="p">]</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">PARTNER</span><span class="p">,</span><span class="w"> </span><span class="k">COALESCE</span><span class="p">(</span><span class="n">db</span><span class="p">.</span><span class="n">ID_BENEFICIARIO</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_BENEFICIARIO</span><span class="p">,</span>
<span class="w">        </span><span class="p">[</span><span class="n">CA20_ESTADO_MATRICULA</span><span class="p">]</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ESTADO</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="n">CA20_ESTADO_PAGO</span><span class="p">]</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ESTADO_PAGO</span><span class="p">,</span>
<span class="w">        </span><span class="k">CASE</span><span class="w"> </span>
<span class="w">            </span><span class="k">WHEN</span><span class="w"> </span><span class="p">[</span><span class="n">CA20_FECHA_PAGO</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">00000000</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="p">[</span><span class="n">CA20_FECHA_PAGO</span><span class="p">]</span>
<span class="w">            </span><span class="k">WHEN</span><span class="w"> </span><span class="k">CAST</span><span class="p">(</span><span class="k">LEFT</span><span class="p">([</span><span class="n">CA20_FECHA_PAGO</span><span class="p">],</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="nb">INT</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="p">[</span><span class="n">CA20_ANO_ACADEMICO</span><span class="p">]</span>
<span class="w">                </span><span class="k">THEN</span><span class="w"> </span><span class="p">[</span><span class="n">CA20_ANO_ACADEMICO</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">10000</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">101</span>
<span class="w">            </span><span class="k">ELSE</span><span class="w"> </span><span class="k">LEFT</span><span class="p">([</span><span class="n">CA20_FECHA_PAGO</span><span class="p">],</span><span class="w"> </span><span class="mi">6</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span>
<span class="w">        </span><span class="k">END</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_FECHA_MENSUAL</span><span class="p">,</span>
<span class="w">        </span><span class="p">[</span><span class="n">CA20_FECHA_PAGO</span><span class="p">],</span><span class="w"> </span><span class="n">CA20_CURSO</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_CURSO</span><span class="p">,</span><span class="w"> </span>
<span class="w">        </span><span class="s1">&#39;ESTADO_MATRICULAS&#39;</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ACTIVIDAD</span><span class="p">,</span>
<span class="w">        </span><span class="s1">&#39;[DWH_COMFENALCO].[Colegio].[FACT_ESTADO_MATRICULAS]&#39;</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">FUENTE_PRINCIPAL</span>
<span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Colegio</span><span class="p">].[</span><span class="n">FACT_ESTADO_MATRICULAS</span><span class="p">]</span><span class="w"> </span><span class="n">em</span>
<span class="w">    </span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Transversal</span><span class="p">].[</span><span class="n">DIM_BENEFICIARIOS</span><span class="p">]</span><span class="w"> </span><span class="n">db</span>
<span class="w">        </span><span class="k">ON</span><span class="w"> </span><span class="n">em</span><span class="p">.[</span><span class="n">CA20_BP_ESTUDIANTE</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">db</span><span class="p">.[</span><span class="n">PARTNER</span><span class="p">]</span>
<span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="p">[</span><span class="n">CA20_ESTADO_MATRICULA</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;APROBADA&#39;</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">CA20_FECHA_PAGO</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s1">&#39;00000000&#39;</span>
<span class="p">),</span>
<span class="p">...</span>
<span class="k">SELECT</span><span class="w"> </span><span class="n">cm</span><span class="p">.</span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">EstadoMatriculasColegioMensual</span><span class="w"> </span><span class="n">cm</span>
<span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Transversal</span><span class="p">].[</span><span class="n">DIM_TIEMPO_MENSUAL</span><span class="p">]</span><span class="w"> </span><span class="n">dimM</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">cm</span><span class="p">.</span><span class="n">ID_FECHA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dimM</span><span class="p">.</span><span class="n">ID_FECHA</span><span class="p">;</span>
</code></pre></div>
<hr />
<h3 id="almacenar-max-actividades"><strong>Almacenar MAX ACTIVIDADES</strong><a class="headerlink" href="#almacenar-max-actividades" title="Permanent link">&para;</a></h3>
<hr />
<h4 id="descripcion-general_11"><strong>Descripción General</strong><a class="headerlink" href="#descripcion-general_11" title="Permanent link">&para;</a></h4>
<p>Este componente es una <strong>tarea de ejecución SQL</strong> (<code>Execute SQL Task</code>) cuyo propósito es calcular la cantidad total de iteraciones mensuales requeridas para procesar los datos de afiliaciones, determinando así el <strong>mes más reciente disponible</strong> en el tiempo dimensional.</p>
<hr />
<h4 id="ubicacion-en-el-paquete_10"><strong>Ubicación en el Paquete</strong><a class="headerlink" href="#ubicacion-en-el-paquete_10" title="Permanent link">&para;</a></h4>
<p>Se encuentra dentro del paquete SSIS <code>FACT_ACTIVIDADES</code>, bajo la ruta lógica <code>Package\FACT_ACTIVIDADES\Almacenar MAX ACTIVIDADES</code>.</p>
<hr />
<h4 id="proposito_12"><strong>Propósito</strong><a class="headerlink" href="#proposito_12" title="Permanent link">&para;</a></h4>
<p>Obtener el número de iteraciones necesarias para recorrer todos los meses disponibles en la tabla <code>STG_FACT_AFILIACIONES</code>, validando que los datos coincidan con el calendario definido en la tabla <code>DIM_TIEMPO_MENSUAL</code>. Este resultado se almacena en una variable de usuario para control del flujo posterior.</p>
<hr />
<h4 id="detalles-de-implementacion_14"><strong>Detalles de Implementación</strong><a class="headerlink" href="#detalles-de-implementacion_14" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>Tipo de tarea:</strong> <code>Execute SQL Task</code></li>
<li><strong>Conexión usada:</strong> <code>{29BC876E-1EAF-4F6F-8F38-39B8E881EEB6}</code> (probablemente conexión a <code>STAGE_AREA</code> o <code>DWH_COMFENALCO</code>)</li>
<li><strong>Variable de salida:</strong> <code>User::MaxIterationApor</code></li>
<li><strong>Tipo de resultado:</strong> Fila única (Single Row)</li>
</ul>
<hr />
<h4 id="logica-de-negocio_12"><strong>Lógica de Negocio</strong><a class="headerlink" href="#logica-de-negocio_12" title="Permanent link">&para;</a></h4>
<ol>
<li>Se declaran dos variables locales <code>@MinID_FECHA</code> y <code>@MaxID_FECHA</code> que almacenan el primer y último mes válido de la tabla de afiliaciones (<code>STG_FACT_AFILIACIONES</code>), considerando solamente los registros que tengan correspondencia en la tabla de fechas <code>DIM_TIEMPO_MENSUAL</code>.</li>
<li>Se calcula la diferencia en meses entre ambas fechas usando <code>DATEDIFF(MONTH, ...)</code>.</li>
<li>A este valor se le suma 1 para incluir el mes actual en la iteración (<code>@DiffMonths + 1</code>).</li>
<li>El resultado (<code>@VarTime</code>) se almacena como salida de la consulta en la variable <code>User::MaxIterationApor</code>.</li>
</ol>
<hr />
<h4 id="script-sql-utilizado"><strong>Script SQL Utilizado</strong><a class="headerlink" href="#script-sql-utilizado" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="k">DECLARE</span><span class="w"> </span><span class="o">@</span><span class="n">MinID_FECHA</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">8</span><span class="p">);</span>
<span class="k">DECLARE</span><span class="w"> </span><span class="o">@</span><span class="n">MaxID_FECHA</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">8</span><span class="p">);</span>

<span class="c1">-- Obtener el mes mínimo de ID_FECHA</span>
<span class="k">SELECT</span><span class="w"> </span>
<span class="w">    </span><span class="o">@</span><span class="n">MinID_FECHA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">MIN</span><span class="p">(</span><span class="k">LEFT</span><span class="p">(</span><span class="k">CONVERT</span><span class="p">(</span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span><span class="w"> </span><span class="n">a</span><span class="p">.[</span><span class="n">ID_FECHA</span><span class="p">],</span><span class="w"> </span><span class="mi">112</span><span class="p">),</span><span class="w"> </span><span class="mi">6</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;01&#39;</span><span class="p">)</span>
<span class="k">FROM</span><span class="w"> </span>
<span class="w">    </span><span class="p">[</span><span class="n">STAGE_AREA</span><span class="p">].[</span><span class="n">Transversal</span><span class="p">].[</span><span class="n">STG_FACT_AFILIACIONES</span><span class="p">]</span><span class="w"> </span><span class="n">a</span>
<span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span>
<span class="w">    </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Transversal</span><span class="p">].[</span><span class="n">DIM_TIEMPO_MENSUAL</span><span class="p">]</span><span class="w"> </span><span class="n">t</span>
<span class="w">    </span><span class="k">ON</span><span class="w"> </span><span class="k">LEFT</span><span class="p">(</span><span class="k">CONVERT</span><span class="p">(</span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span><span class="w"> </span><span class="n">a</span><span class="p">.[</span><span class="n">ID_FECHA</span><span class="p">],</span><span class="w"> </span><span class="mi">112</span><span class="p">),</span><span class="w"> </span><span class="mi">6</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;01&#39;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">CONVERT</span><span class="p">(</span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span><span class="w"> </span><span class="n">t</span><span class="p">.[</span><span class="n">ID_FECHA</span><span class="p">],</span><span class="w"> </span><span class="mi">112</span><span class="p">);</span>

<span class="c1">-- Obtener el mes máximo de ID_FECHA</span>
<span class="k">SELECT</span><span class="w"> </span>
<span class="w">    </span><span class="o">@</span><span class="n">MaxID_FECHA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">MAX</span><span class="p">(</span><span class="k">LEFT</span><span class="p">(</span><span class="k">CONVERT</span><span class="p">(</span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span><span class="w"> </span><span class="n">a</span><span class="p">.[</span><span class="n">ID_FECHA</span><span class="p">],</span><span class="w"> </span><span class="mi">112</span><span class="p">),</span><span class="w"> </span><span class="mi">6</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;01&#39;</span><span class="p">)</span>
<span class="k">FROM</span><span class="w"> </span>
<span class="w">    </span><span class="p">[</span><span class="n">STAGE_AREA</span><span class="p">].[</span><span class="n">Transversal</span><span class="p">].[</span><span class="n">STG_FACT_AFILIACIONES</span><span class="p">]</span><span class="w"> </span><span class="n">a</span>
<span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span>
<span class="w">    </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Transversal</span><span class="p">].[</span><span class="n">DIM_TIEMPO_MENSUAL</span><span class="p">]</span><span class="w"> </span><span class="n">t</span>
<span class="w">    </span><span class="k">ON</span><span class="w"> </span><span class="k">LEFT</span><span class="p">(</span><span class="k">CONVERT</span><span class="p">(</span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span><span class="w"> </span><span class="n">a</span><span class="p">.[</span><span class="n">ID_FECHA</span><span class="p">],</span><span class="w"> </span><span class="mi">112</span><span class="p">),</span><span class="w"> </span><span class="mi">6</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;01&#39;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">CONVERT</span><span class="p">(</span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span><span class="w"> </span><span class="n">t</span><span class="p">.[</span><span class="n">ID_FECHA</span><span class="p">],</span><span class="w"> </span><span class="mi">112</span><span class="p">);</span>

<span class="c1">-- Calcular la diferencia en meses entre el mes mínimo y el mes máximo</span>
<span class="k">DECLARE</span><span class="w"> </span><span class="o">@</span><span class="n">DiffMonths</span><span class="w"> </span><span class="nb">INT</span><span class="p">;</span>

<span class="k">SELECT</span><span class="w"> </span>
<span class="w">    </span><span class="o">@</span><span class="n">DiffMonths</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DATEDIFF</span><span class="p">(</span><span class="k">MONTH</span><span class="p">,</span><span class="w"> </span>
<span class="w">        </span><span class="k">CONVERT</span><span class="p">(</span><span class="nb">DATE</span><span class="p">,</span><span class="w"> </span><span class="k">LEFT</span><span class="p">(</span><span class="o">@</span><span class="n">MinID_FECHA</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;01&#39;</span><span class="p">),</span><span class="w"> </span>
<span class="w">        </span><span class="k">CONVERT</span><span class="p">(</span><span class="nb">DATE</span><span class="p">,</span><span class="w"> </span><span class="k">LEFT</span><span class="p">(</span><span class="o">@</span><span class="n">MaxID_FECHA</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;01&#39;</span><span class="p">));</span>

<span class="c1">-- El valor entero que debes poner en la variable @VarTime para obtener el último mes</span>
<span class="k">DECLARE</span><span class="w"> </span><span class="o">@</span><span class="n">VarTime</span><span class="w"> </span><span class="nb">INT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">@</span><span class="n">DiffMonths</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>

<span class="c1">-- Resultado</span>
<span class="k">SELECT</span><span class="w"> </span><span class="k">ISNULL</span><span class="p">(</span><span class="o">@</span><span class="n">VarTime</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">VarTimeParaMaxMes</span><span class="p">;</span>
</code></pre></div>
<h3 id="contenedor-de-bucles-para-actividadesactividad-afiliacion"><strong>Contenedor de bucles para Actividades\Actividad Afiliacion</strong><a class="headerlink" href="#contenedor-de-bucles-para-actividadesactividad-afiliacion" title="Permanent link">&para;</a></h3>
<hr />
<h4 id="descripcion-general_12"><strong>Descripción General</strong><a class="headerlink" href="#descripcion-general_12" title="Permanent link">&para;</a></h4>
<p>Este componente es una <strong>tarea de flujo de datos</strong> que tiene como objetivo cargar información transformada relacionada con actividades afiliadas en la tabla <code>FACT_ACTIVIDADES</code>, la cual forma parte del Data Warehouse <code>DWH_COMFENALCO</code>.</p>
<hr />
<h4 id="ubicacion-dentro-del-paquete"><strong>Ubicación dentro del Paquete</strong><a class="headerlink" href="#ubicacion-dentro-del-paquete" title="Permanent link">&para;</a></h4>
<p><code>FACT_ACTIVIDADES &gt; Contenedor de bucles para Actividades &gt; Actividad Afiliacion</code></p>
<hr />
<h4 id="proposito_13"><strong>Propósito</strong><a class="headerlink" href="#proposito_13" title="Permanent link">&para;</a></h4>
<p>Almacenar en el Data Warehouse información detallada sobre afiliaciones y actividades realizadas por beneficiarios en distintos programas o servicios, permitiendo su análisis desde múltiples dimensiones como género, curso, estrato, programa, tipo de afiliación, entre otros.</p>
<hr />
<h4 id="detalles-de-implementacion_15"><strong>Detalles de Implementación</strong><a class="headerlink" href="#detalles-de-implementacion_15" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>Tipo de tarea</strong>: <code>Data Flow Task</code></li>
<li><strong>Destino</strong>: Tabla <code>"Transversal"."FACT_ACTIVIDADES"</code> vía componente <code>ADO NET Destination</code></li>
<li><strong>Conexión</strong>: <code>Project.ConnectionManagers[DWH_COMFENALCO]</code></li>
<li><strong>Modo de inserción</strong>: Uso de <code>SqlBulkCopy</code> activado para mayor rendimiento</li>
<li><strong>Timeout del comando</strong>: 30 segundos</li>
<li><strong>Batch Size</strong>: 0 (usa el buffer predeterminado de SSIS)</li>
</ul>
<hr />
<h4 id="logica-de-negocio_13"><strong>Lógica de Negocio</strong><a class="headerlink" href="#logica-de-negocio_13" title="Permanent link">&para;</a></h4>
<ol>
<li>Se reciben los datos desde una fuente OLE DB (no incluida en este extracto).</li>
<li>Se procesan columnas correspondientes a atributos de afiliación, actividad, contexto educativo, condiciones socioeconómicas, demografía, y gestión.</li>
<li>Se realiza una carga directa de los datos transformados a <code>FACT_ACTIVIDADES</code> manteniendo alineación con las columnas definidas en el metadata externo.</li>
</ol>
<hr />
<h4 id="relacion-con-otros-componentes_13"><strong>Relación con Otros Componentes</strong><a class="headerlink" href="#relacion-con-otros-componentes_13" title="Permanent link">&para;</a></h4>
<ul>
<li>Este flujo se encuentra dentro de un contenedor iterativo que probablemente procese múltiples actividades por lote.</li>
<li>Se alimenta de una fuente OLE DB definida en el mismo flujo de datos.</li>
<li>Está acoplado al componente de carga del Data Warehouse de Comfenalco para el dominio de actividades.</li>
</ul>
<hr />
<h4 id="script-sql_4"><strong>Script SQL</strong><a class="headerlink" href="#script-sql_4" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="k">DECLARE</span><span class="w"> </span><span class="o">@</span><span class="n">MinMes</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">8</span><span class="p">);</span><span class="w"> </span><span class="c1">-- Cambiado a VARCHAR para manejar unicode</span>

<span class="k">SELECT</span><span class="w"> </span>
<span class="w">    </span><span class="o">@</span><span class="n">MinMes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">MIN</span><span class="p">(</span><span class="k">LEFT</span><span class="p">(</span><span class="k">CONVERT</span><span class="p">(</span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span><span class="w"> </span><span class="n">a</span><span class="p">.[</span><span class="n">ID_FECHA</span><span class="p">],</span><span class="w"> </span><span class="mi">112</span><span class="p">),</span><span class="w"> </span><span class="mi">6</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;01&#39;</span><span class="p">)</span><span class="w"> </span><span class="c1">-- Uso de VARCHAR aquí</span>
<span class="k">FROM</span><span class="w"> </span>
<span class="w">    </span><span class="p">[</span><span class="n">STAGE_AREA</span><span class="p">].[</span><span class="n">Transversal</span><span class="p">].[</span><span class="n">STG_FACT_AFILIACIONES</span><span class="p">]</span><span class="w"> </span><span class="n">a</span>
<span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span>
<span class="w">    </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Transversal</span><span class="p">].[</span><span class="n">DIM_TIEMPO_MENSUAL</span><span class="p">]</span><span class="w"> </span><span class="n">t</span>
<span class="w">    </span><span class="k">ON</span><span class="w"> </span><span class="k">LEFT</span><span class="p">(</span><span class="k">CONVERT</span><span class="p">(</span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span><span class="w"> </span><span class="n">a</span><span class="p">.[</span><span class="n">ID_FECHA</span><span class="p">],</span><span class="w"> </span><span class="mi">112</span><span class="p">),</span><span class="w"> </span><span class="mi">6</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;01&#39;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">CONVERT</span><span class="p">(</span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span><span class="w"> </span><span class="n">t</span><span class="p">.[</span><span class="n">ID_FECHA</span><span class="p">],</span><span class="w"> </span><span class="mi">112</span><span class="p">);</span><span class="w"> </span><span class="c1">-- Conversión a VARCHAR</span>

<span class="c1">-- Paso 2: Declarar la variable para determinar el mes</span>
<span class="k">DECLARE</span><span class="w"> </span><span class="o">@</span><span class="n">VarTime</span><span class="w"> </span><span class="nb">INT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">?</span><span class="p">;</span><span class="w"> </span><span class="c1">-- Ajusta este valor según la iteración que quieras filtrar</span>

<span class="c1">-- Calcular el mes a filtrar basado en @VarTime</span>
<span class="k">DECLARE</span><span class="w"> </span><span class="o">@</span><span class="n">MesFiltrado</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FORMAT</span><span class="p">(</span><span class="n">DATEADD</span><span class="p">(</span><span class="k">MONTH</span><span class="p">,</span><span class="w"> </span><span class="o">@</span><span class="n">VarTime</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="k">CONVERT</span><span class="p">(</span><span class="nb">DATE</span><span class="p">,</span><span class="w"> </span><span class="o">@</span><span class="n">MinMes</span><span class="p">)),</span><span class="w"> </span><span class="s1">&#39;yyyyMM&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;01&#39;</span><span class="p">;</span><span class="w"> </span><span class="c1">-- Ajustado a VARCHAR</span>

<span class="c1">-- Consultas posteriores</span>
<span class="k">WITH</span><span class="w"> </span><span class="n">ActividadesPoblacionPartner</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="k">SELECT</span><span class="w"> </span>
<span class="w">        </span><span class="k">CONVERT</span><span class="p">(</span><span class="nb">VARCHAR</span><span class="p">,</span><span class="w"> </span><span class="n">ID_FECHA</span><span class="p">,</span><span class="w"> </span><span class="mi">112</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_FECHA</span><span class="p">,</span>
<span class="w">        </span><span class="k">CONVERT</span><span class="p">(</span><span class="nb">VARCHAR</span><span class="p">,</span><span class="w"> </span><span class="n">PARTNER</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">PARTNER</span><span class="p">,</span>
<span class="w">        </span><span class="k">CASE</span><span class="w"> </span><span class="k">WHEN</span><span class="w"> </span><span class="k">MAX</span><span class="p">(</span><span class="n">POBLACION_EDUCACION</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;SI&#39;</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="s1">&#39;SI&#39;</span><span class="w"> </span><span class="k">ELSE</span><span class="w"> </span><span class="s1">&#39;NO&#39;</span><span class="w"> </span><span class="k">END</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">POBLACION_EDUCACION</span><span class="p">,</span>
<span class="w">        </span><span class="k">CASE</span><span class="w"> </span><span class="k">WHEN</span><span class="w"> </span><span class="k">MAX</span><span class="p">(</span><span class="n">POBLACION_EDUCACION_FORMAL</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;SI&#39;</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="s1">&#39;SI&#39;</span><span class="w"> </span><span class="k">ELSE</span><span class="w"> </span><span class="s1">&#39;NO&#39;</span><span class="w"> </span><span class="k">END</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">POBLACION_EDUCACION_FORMAL</span><span class="p">,</span>
<span class="w">        </span><span class="k">CASE</span><span class="w"> </span><span class="k">WHEN</span><span class="w"> </span><span class="k">MAX</span><span class="p">(</span><span class="n">POBLACION_EDUCACION_TECNICA</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;SI&#39;</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="s1">&#39;SI&#39;</span><span class="w"> </span><span class="k">ELSE</span><span class="w"> </span><span class="s1">&#39;NO&#39;</span><span class="w"> </span><span class="k">END</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">POBLACION_EDUCACION_TECNICA</span><span class="p">,</span>
<span class="w">        </span><span class="k">CASE</span><span class="w"> </span><span class="k">WHEN</span><span class="w"> </span><span class="k">MAX</span><span class="p">(</span><span class="n">POBLACION_EDUCACION_CONTINUA</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;SI&#39;</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="s1">&#39;SI&#39;</span><span class="w"> </span><span class="k">ELSE</span><span class="w"> </span><span class="s1">&#39;NO&#39;</span><span class="w"> </span><span class="k">END</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">POBLACION_EDUCACION_CONTINUA</span><span class="p">,</span>
<span class="w">        </span><span class="k">CASE</span><span class="w"> </span><span class="k">WHEN</span><span class="w"> </span><span class="k">MAX</span><span class="p">(</span><span class="n">POBLACION_EDUCACION_PROTECCION</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;SI&#39;</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="s1">&#39;SI&#39;</span><span class="w"> </span><span class="k">ELSE</span><span class="w"> </span><span class="s1">&#39;NO&#39;</span><span class="w"> </span><span class="k">END</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">POBLACION_EDUCACION_PROTECCION</span>
<span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Transversal</span><span class="p">].[</span><span class="n">FACT_ACTIVIDADES</span><span class="p">]</span>
<span class="w">    </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="k">CONVERT</span><span class="p">(</span><span class="nb">VARCHAR</span><span class="p">,</span><span class="w"> </span><span class="n">ID_FECHA</span><span class="p">,</span><span class="w"> </span><span class="mi">112</span><span class="p">),</span><span class="w"> </span><span class="k">CONVERT</span><span class="p">(</span><span class="nb">VARCHAR</span><span class="p">,</span><span class="w"> </span><span class="n">PARTNER</span><span class="p">)</span>
<span class="p">),</span>
<span class="n">ActividadesPoblacionAgrupadoAfiliado</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="k">SELECT</span><span class="w"> </span>
<span class="w">        </span><span class="k">CONVERT</span><span class="p">(</span><span class="nb">VARCHAR</span><span class="p">,</span><span class="w"> </span><span class="n">ID_FECHA</span><span class="p">,</span><span class="w"> </span><span class="mi">112</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_FECHA</span><span class="p">,</span>
<span class="w">        </span><span class="k">CONVERT</span><span class="p">(</span><span class="nb">VARCHAR</span><span class="p">,</span><span class="w"> </span><span class="n">PARTNER_AFILIADO</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">PARTNER</span><span class="p">,</span>
<span class="w">        </span><span class="k">CASE</span><span class="w"> </span><span class="k">WHEN</span><span class="w"> </span><span class="k">MAX</span><span class="p">(</span><span class="n">POBLACION_EDUCACION</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;SI&#39;</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="s1">&#39;SI&#39;</span><span class="w"> </span><span class="k">ELSE</span><span class="w"> </span><span class="s1">&#39;NO&#39;</span><span class="w"> </span><span class="k">END</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">POBLACION_EDUCACION</span><span class="p">,</span>
<span class="w">        </span><span class="k">CASE</span><span class="w"> </span><span class="k">WHEN</span><span class="w"> </span><span class="k">MAX</span><span class="p">(</span><span class="n">POBLACION_EDUCACION_FORMAL</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;SI&#39;</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="s1">&#39;SI&#39;</span><span class="w"> </span><span class="k">ELSE</span><span class="w"> </span><span class="s1">&#39;NO&#39;</span><span class="w"> </span><span class="k">END</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">POBLACION_EDUCACION_FORMAL</span><span class="p">,</span>
<span class="w">        </span><span class="k">CASE</span><span class="w"> </span><span class="k">WHEN</span><span class="w"> </span><span class="k">MAX</span><span class="p">(</span><span class="n">POBLACION_EDUCACION_TECNICA</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;SI&#39;</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="s1">&#39;SI&#39;</span><span class="w"> </span><span class="k">ELSE</span><span class="w"> </span><span class="s1">&#39;NO&#39;</span><span class="w"> </span><span class="k">END</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">POBLACION_EDUCACION_TECNICA</span><span class="p">,</span>
<span class="w">        </span><span class="k">CASE</span><span class="w"> </span><span class="k">WHEN</span><span class="w"> </span><span class="k">MAX</span><span class="p">(</span><span class="n">POBLACION_EDUCACION_CONTINUA</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;SI&#39;</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="s1">&#39;SI&#39;</span><span class="w"> </span><span class="k">ELSE</span><span class="w"> </span><span class="s1">&#39;NO&#39;</span><span class="w"> </span><span class="k">END</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">POBLACION_EDUCACION_CONTINUA</span><span class="p">,</span>
<span class="w">        </span><span class="k">CASE</span><span class="w"> </span><span class="k">WHEN</span><span class="w"> </span><span class="k">MAX</span><span class="p">(</span><span class="n">POBLACION_EDUCACION_PROTECCION</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;SI&#39;</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="s1">&#39;SI&#39;</span><span class="w"> </span><span class="k">ELSE</span><span class="w"> </span><span class="s1">&#39;NO&#39;</span><span class="w"> </span><span class="k">END</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">POBLACION_EDUCACION_PROTECCION</span>
<span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Transversal</span><span class="p">].[</span><span class="n">FACT_ACTIVIDADES</span><span class="p">]</span>
<span class="w">    </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="k">CONVERT</span><span class="p">(</span><span class="nb">VARCHAR</span><span class="p">,</span><span class="w"> </span><span class="n">ID_FECHA</span><span class="p">,</span><span class="w"> </span><span class="mi">112</span><span class="p">),</span><span class="w"> </span><span class="k">CONVERT</span><span class="p">(</span><span class="nb">VARCHAR</span><span class="p">,</span><span class="w"> </span><span class="n">PARTNER_AFILIADO</span><span class="p">)</span>
<span class="p">),</span>
<span class="n">ActividadesPoblacionAgrupadoEmpresa</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="k">SELECT</span><span class="w"> </span>
<span class="w">        </span><span class="k">CONVERT</span><span class="p">(</span><span class="nb">VARCHAR</span><span class="p">,</span><span class="w"> </span><span class="n">ID_FECHA</span><span class="p">,</span><span class="w"> </span><span class="mi">112</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_FECHA</span><span class="p">,</span>
<span class="w">        </span><span class="k">CONVERT</span><span class="p">(</span><span class="nb">VARCHAR</span><span class="p">,</span><span class="w"> </span><span class="n">PARTNER_EMPRESA</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">PARTNER</span><span class="p">,</span>
<span class="w">        </span><span class="k">CASE</span><span class="w"> </span><span class="k">WHEN</span><span class="w"> </span><span class="k">MAX</span><span class="p">(</span><span class="n">POBLACION_EDUCACION</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;SI&#39;</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="s1">&#39;SI&#39;</span><span class="w"> </span><span class="k">ELSE</span><span class="w"> </span><span class="s1">&#39;NO&#39;</span><span class="w"> </span><span class="k">END</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">POBLACION_EDUCACION</span><span class="p">,</span>
<span class="w">        </span><span class="k">CASE</span><span class="w"> </span><span class="k">WHEN</span><span class="w"> </span><span class="k">MAX</span><span class="p">(</span><span class="n">POBLACION_EDUCACION_FORMAL</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;SI&#39;</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="s1">&#39;SI&#39;</span><span class="w"> </span><span class="k">ELSE</span><span class="w"> </span><span class="s1">&#39;NO&#39;</span><span class="w"> </span><span class="k">END</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">POBLACION_EDUCACION_FORMAL</span><span class="p">,</span>
<span class="w">        </span><span class="k">CASE</span><span class="w"> </span><span class="k">WHEN</span><span class="w"> </span><span class="k">MAX</span><span class="p">(</span><span class="n">POBLACION_EDUCACION_TECNICA</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;SI&#39;</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="s1">&#39;SI&#39;</span><span class="w"> </span><span class="k">ELSE</span><span class="w"> </span><span class="s1">&#39;NO&#39;</span><span class="w"> </span><span class="k">END</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">POBLACION_EDUCACION_TECNICA</span><span class="p">,</span>
<span class="w">        </span><span class="k">CASE</span><span class="w"> </span><span class="k">WHEN</span><span class="w"> </span><span class="k">MAX</span><span class="p">(</span><span class="n">POBLACION_EDUCACION_CONTINUA</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;SI&#39;</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="s1">&#39;SI&#39;</span><span class="w"> </span><span class="k">ELSE</span><span class="w"> </span><span class="s1">&#39;NO&#39;</span><span class="w"> </span><span class="k">END</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">POBLACION_EDUCACION_CONTINUA</span><span class="p">,</span>
<span class="w">        </span><span class="k">CASE</span><span class="w"> </span><span class="k">WHEN</span><span class="w"> </span><span class="k">MAX</span><span class="p">(</span><span class="n">POBLACION_EDUCACION_PROTECCION</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;SI&#39;</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="s1">&#39;SI&#39;</span><span class="w"> </span><span class="k">ELSE</span><span class="w"> </span><span class="s1">&#39;NO&#39;</span><span class="w"> </span><span class="k">END</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">POBLACION_EDUCACION_PROTECCION</span>
<span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Transversal</span><span class="p">].[</span><span class="n">FACT_ACTIVIDADES</span><span class="p">]</span>
<span class="w">    </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="k">CONVERT</span><span class="p">(</span><span class="nb">VARCHAR</span><span class="p">,</span><span class="w"> </span><span class="n">ID_FECHA</span><span class="p">,</span><span class="w"> </span><span class="mi">112</span><span class="p">),</span><span class="w"> </span><span class="k">CONVERT</span><span class="p">(</span><span class="nb">VARCHAR</span><span class="p">,</span><span class="w"> </span><span class="n">PARTNER_EMPRESA</span><span class="p">)</span>
<span class="p">),</span>
<span class="n">ConsolidadoActividades</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="n">ID_FECHA</span><span class="p">,</span><span class="w"> </span><span class="n">PARTNER</span><span class="p">,</span><span class="w"> </span>
<span class="w">           </span><span class="n">POBLACION_EDUCACION</span><span class="p">,</span><span class="w"> </span>
<span class="w">           </span><span class="n">POBLACION_EDUCACION_FORMAL</span><span class="p">,</span><span class="w"> </span>
<span class="w">           </span><span class="n">POBLACION_EDUCACION_TECNICA</span><span class="p">,</span><span class="w"> </span>
<span class="w">           </span><span class="n">POBLACION_EDUCACION_CONTINUA</span><span class="p">,</span><span class="w"> </span>
<span class="w">           </span><span class="n">POBLACION_EDUCACION_PROTECCION</span>
<span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">ActividadesPoblacionPartner</span>
<span class="w">    </span><span class="k">UNION</span>
<span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="n">ID_FECHA</span><span class="p">,</span><span class="w"> </span><span class="n">PARTNER</span><span class="p">,</span><span class="w"> </span>
<span class="w">           </span><span class="n">POBLACION_EDUCACION</span><span class="p">,</span><span class="w"> </span>
<span class="w">           </span><span class="n">POBLACION_EDUCACION_FORMAL</span><span class="p">,</span><span class="w"> </span>
<span class="w">           </span><span class="n">POBLACION_EDUCACION_TECNICA</span><span class="p">,</span><span class="w"> </span>
<span class="w">           </span><span class="n">POBLACION_EDUCACION_CONTINUA</span><span class="p">,</span><span class="w"> </span>
<span class="w">           </span><span class="n">POBLACION_EDUCACION_PROTECCION</span>
<span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">ActividadesPoblacionAgrupadoAfiliado</span>
<span class="w">    </span><span class="k">UNION</span>
<span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="n">ID_FECHA</span><span class="p">,</span><span class="w"> </span><span class="n">PARTNER</span><span class="p">,</span><span class="w"> </span>
<span class="w">           </span><span class="n">POBLACION_EDUCACION</span><span class="p">,</span><span class="w"> </span>
<span class="w">           </span><span class="n">POBLACION_EDUCACION_FORMAL</span><span class="p">,</span><span class="w"> </span>
<span class="w">           </span><span class="n">POBLACION_EDUCACION_TECNICA</span><span class="p">,</span><span class="w"> </span>
<span class="w">           </span><span class="n">POBLACION_EDUCACION_CONTINUA</span><span class="p">,</span><span class="w"> </span>
<span class="w">           </span><span class="n">POBLACION_EDUCACION_PROTECCION</span>
<span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">ActividadesPoblacionAgrupadoEmpresa</span>
<span class="p">),</span>
<span class="n">ActividadesPoblacion</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
<span class="k">SELECT</span><span class="w"> </span><span class="n">ID_FECHA</span><span class="p">,</span><span class="w"> </span><span class="n">PARTNER</span><span class="p">,</span>
<span class="w">       </span><span class="k">MAX</span><span class="p">(</span><span class="n">POBLACION_EDUCACION</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">POBLACION_EDUCACION</span><span class="p">,</span>
<span class="w">       </span><span class="k">MAX</span><span class="p">(</span><span class="n">POBLACION_EDUCACION_FORMAL</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">POBLACION_EDUCACION_FORMAL</span><span class="p">,</span>
<span class="w">       </span><span class="k">MAX</span><span class="p">(</span><span class="n">POBLACION_EDUCACION_TECNICA</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">POBLACION_EDUCACION_TECNICA</span><span class="p">,</span>
<span class="w">       </span><span class="k">MAX</span><span class="p">(</span><span class="n">POBLACION_EDUCACION_CONTINUA</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">POBLACION_EDUCACION_CONTINUA</span><span class="p">,</span>
<span class="w">       </span><span class="k">MAX</span><span class="p">(</span><span class="n">POBLACION_EDUCACION_PROTECCION</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">POBLACION_EDUCACION_PROTECCION</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">ConsolidadoActividades</span>
<span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">ID_FECHA</span><span class="p">,</span><span class="w"> </span><span class="n">PARTNER</span><span class="p">),</span>
<span class="n">Afiliaciones</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="k">SELECT</span><span class="w"> </span>
<span class="w">        </span><span class="k">CONVERT</span><span class="p">(</span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">),[</span><span class="n">ACTIVIDAD</span><span class="p">])</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">[</span><span class="n">ACTIVIDAD</span><span class="p">]</span>
<span class="w">      </span><span class="p">,[</span><span class="n">ADEUDA</span><span class="p">]</span>
<span class="w">      </span><span class="p">,[</span><span class="n">ANIO_ACADEMICO</span><span class="p">]</span>
<span class="w">      </span><span class="p">,[</span><span class="n">CANTIDAD_MATERIAL</span><span class="p">]</span>
<span class="w">      </span><span class="p">,[</span><span class="n">CALIFICACION</span><span class="p">]</span>
<span class="w">      </span><span class="p">,[</span><span class="n">CAUSA</span><span class="p">]</span>
<span class="w">      </span><span class="p">,[</span><span class="n">CATEGORIA_VENTA</span><span class="p">]</span>
<span class="w">      </span><span class="p">,[</span><span class="n">COSTO</span><span class="p">]</span>
<span class="w">      </span><span class="p">,[</span><span class="n">CURSO</span><span class="p">]</span>
<span class="w">      </span><span class="p">,[</span><span class="n">DESCRIPCION</span><span class="p">]</span>
<span class="w">      </span><span class="p">,[</span><span class="n">ESTADO</span><span class="p">]</span>
<span class="w">      </span><span class="p">,[</span><span class="n">ESTADOREGISTRO</span><span class="p">]</span>
<span class="w">      </span><span class="p">,[</span><span class="n">ESTADO_PAGO</span><span class="p">]</span>
<span class="w">      </span><span class="p">,[</span><span class="n">ESTRATO</span><span class="p">]</span>
<span class="w">      </span><span class="p">,[</span><span class="n">DISCAPACIDAD</span><span class="p">]</span>
<span class="w">      </span><span class="p">,[</span><span class="n">EDAD</span><span class="p">]</span>
<span class="w">      </span><span class="p">,[</span><span class="n">FECHA_NACIMIENTO</span><span class="p">]</span>
<span class="w">      </span><span class="p">,[</span><span class="n">FECHA_AFILIACION</span><span class="p">]</span>
<span class="w">      </span><span class="p">,[</span><span class="n">FECHA_MENSUAL</span><span class="p">]</span>
<span class="w">      </span><span class="p">,[</span><span class="n">FECHA_RETIRO</span><span class="p">]</span>
<span class="w">      </span><span class="p">,[</span><span class="n">FECHA_ADMISION</span><span class="p">]</span>
<span class="w">      </span><span class="p">,[</span><span class="n">ID_AFILIADO</span><span class="p">]</span>
<span class="w">      </span><span class="p">,[</span><span class="n">ID_CATEGORIA</span><span class="p">]</span>
<span class="w">      </span><span class="p">,[</span><span class="n">ID_CIUDAD</span><span class="p">]</span>
<span class="w">      </span><span class="p">,[</span><span class="n">ID_CONCEPTO</span><span class="p">]</span>
<span class="w">      </span><span class="p">,[</span><span class="n">ID_CURSO</span><span class="p">]</span>
<span class="w">      </span><span class="p">,[</span><span class="n">ID_EMPRESA</span><span class="p">]</span>
<span class="w">      </span><span class="p">,[</span><span class="n">ID_ESTADO_CIVIL</span><span class="p">]</span>
<span class="w">      </span><span class="p">,[</span><span class="n">ID_ESTADO_GESTION</span><span class="p">]</span>
<span class="w">      </span><span class="p">,[</span><span class="n">ID_FACTOR_VULNERABILIDAD</span><span class="p">]</span>
<span class="w">      </span><span class="p">,[</span><span class="n">ID_FECHA</span><span class="p">]</span>
<span class="w">      </span><span class="p">,[</span><span class="n">ID_GENERO</span><span class="p">]</span>
<span class="w">      </span><span class="p">,[</span><span class="n">ID_GRADO</span><span class="p">]</span>
<span class="w">      </span><span class="p">,[</span><span class="n">ID_MATERIAL</span><span class="p">]</span>
<span class="w">      </span><span class="p">,[</span><span class="n">ID_PERTENENCIA_ETNICA</span><span class="p">]</span>
<span class="w">      </span><span class="p">,[</span><span class="n">ID_POBLACION</span><span class="p">]</span>
<span class="w">      </span><span class="p">,[</span><span class="n">ID_PROGRAMA</span><span class="p">]</span>
<span class="w">      </span><span class="p">,[</span><span class="n">ID_PREGUNTA</span><span class="p">]</span>
<span class="w">      </span><span class="p">,[</span><span class="n">ID_TIPO_AFILIADO</span><span class="p">]</span>
<span class="w">      </span><span class="p">,[</span><span class="n">ID_UNIDAD</span><span class="p">]</span>
<span class="w">      </span><span class="p">,[</span><span class="n">NO_PRESTAMOS</span><span class="p">]</span>
<span class="w">      </span><span class="p">,[</span><span class="n">NUMERO_APORTES</span><span class="p">]</span>
<span class="w">      </span><span class="c1">--,[PARTNER]</span>
<span class="w">      </span><span class="p">,[</span><span class="n">PARTNER_AFILIADO</span><span class="p">]</span>
<span class="w">      </span><span class="p">,[</span><span class="n">PARTNER_EMPRESA</span><span class="p">]</span>
<span class="w">      </span><span class="p">,[</span><span class="n">RESPUESTA</span><span class="p">]</span>
<span class="w">      </span><span class="p">,[</span><span class="n">SALARIO_BASICO</span><span class="p">]</span>
<span class="w">      </span><span class="p">,[</span><span class="n">SERVICIO_TRANSPORTE</span><span class="p">]</span>
<span class="w">      </span><span class="p">,[</span><span class="n">SUBSIDIO</span><span class="p">]</span>
<span class="w">      </span><span class="p">,[</span><span class="n">TIPO_AFILIADO</span><span class="p">]</span>
<span class="w">      </span><span class="p">,[</span><span class="n">TIPO_POBLACION</span><span class="p">]</span>
<span class="w">      </span><span class="p">,[</span><span class="n">TOTAL_APORTES</span><span class="p">]</span>
<span class="w">      </span><span class="p">,[</span><span class="n">VALOR_FACTURADO</span><span class="p">]</span>
<span class="w">      </span><span class="p">,[</span><span class="n">VALOR_MATERIAL</span><span class="p">]</span>
<span class="w">      </span><span class="p">,[</span><span class="n">VALOR_PAGADO</span><span class="p">]</span>
<span class="w">      </span><span class="p">,[</span><span class="n">VALOR_PAGADO_SIN_IMP</span><span class="p">]</span>
<span class="w">      </span><span class="p">,</span><span class="k">CONVERT</span><span class="p">(</span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">),[</span><span class="n">FUENTE_PRINCIPAL</span><span class="p">])</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">FUENTE_PRINCIPAL</span>
<span class="w">      </span><span class="p">,[</span><span class="n">ID_PQR</span><span class="p">]</span>
<span class="w">      </span><span class="p">,[</span><span class="n">ESTADO_PQR</span><span class="p">]</span>
<span class="w">      </span><span class="p">,[</span><span class="n">ID_BENEFICIARIO</span><span class="p">]</span>
<span class="w">      </span><span class="p">,[</span><span class="n">CAUSA_PQR</span><span class="p">]</span>
<span class="w">      </span><span class="p">,[</span><span class="n">TIPO_PQRS</span><span class="p">]</span>
<span class="w">      </span><span class="p">,[</span><span class="n">ID_TARIFA</span><span class="p">]</span>
<span class="w">        </span><span class="c1">-- Otras columnas necesarias</span>
<span class="w">        </span><span class="c1">--,CONVERT(VARCHAR, ID_FECHA, 112) AS ID_FECHA, -- Conversión explícita</span>
<span class="w">        </span><span class="p">,</span><span class="k">CONVERT</span><span class="p">(</span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span><span class="w"> </span><span class="n">PARTNER</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">PARTNER</span><span class="w">        </span><span class="c1">-- Conversión explícita</span>
<span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="p">[</span><span class="n">STAGE_AREA</span><span class="p">].[</span><span class="n">Transversal</span><span class="p">].[</span><span class="n">STG_FACT_AFILIACIONES</span><span class="p">]</span>
<span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="k">CONVERT</span><span class="p">(</span><span class="nb">VARCHAR</span><span class="p">,</span><span class="w"> </span><span class="n">ID_FECHA</span><span class="p">,</span><span class="w"> </span><span class="mi">112</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">@</span><span class="n">MesFiltrado</span><span class="w"> </span><span class="c1">-- Conversión explícita</span>
<span class="p">)</span>
<span class="k">SELECT</span><span class="w"> </span>
<span class="w">    </span><span class="n">fa</span><span class="p">.</span><span class="o">*</span><span class="p">,</span>
<span class="w">    </span><span class="k">CONVERT</span><span class="p">(</span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span><span class="k">COALESCE</span><span class="p">(</span><span class="n">ap</span><span class="p">.</span><span class="n">POBLACION_EDUCACION</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;NO&#39;</span><span class="p">))</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">POBLACION_EDUCACION</span><span class="p">,</span>
<span class="w">    </span><span class="k">COALESCE</span><span class="p">(</span><span class="n">ap</span><span class="p">.</span><span class="n">POBLACION_EDUCACION_FORMAL</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;NO&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">POBLACION_EDUCACION_FORMAL</span><span class="p">,</span>
<span class="w">    </span><span class="k">COALESCE</span><span class="p">(</span><span class="n">ap</span><span class="p">.</span><span class="n">POBLACION_EDUCACION_TECNICA</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;NO&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">POBLACION_EDUCACION_TECNICA</span><span class="p">,</span>
<span class="w">    </span><span class="k">COALESCE</span><span class="p">(</span><span class="n">ap</span><span class="p">.</span><span class="n">POBLACION_EDUCACION_CONTINUA</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;NO&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">POBLACION_EDUCACION_CONTINUA</span><span class="p">,</span>
<span class="w">    </span><span class="k">COALESCE</span><span class="p">(</span><span class="n">ap</span><span class="p">.</span><span class="n">POBLACION_EDUCACION_PROTECCION</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;NO&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">POBLACION_EDUCACION_PROTECCION</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">Afiliaciones</span><span class="w"> </span><span class="n">fa</span>
<span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">ActividadesPoblacion</span><span class="w"> </span><span class="n">ap</span>
<span class="w">    </span><span class="k">ON</span><span class="w"> </span><span class="n">fa</span><span class="p">.</span><span class="n">ID_FECHA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ap</span><span class="p">.</span><span class="n">ID_FECHA</span><span class="w"> </span>
<span class="w">   </span><span class="k">AND</span><span class="w"> </span><span class="n">fa</span><span class="p">.</span><span class="n">PARTNER</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ap</span><span class="p">.</span><span class="n">PARTNER</span><span class="p">;</span><span class="w"> </span><span class="c1">-- Comparación compatible</span>
</code></pre></div>
<h3 id="almacenar-max-aportes"><strong>Almacenar MAX Aportes</strong><a class="headerlink" href="#almacenar-max-aportes" title="Permanent link">&para;</a></h3>
<hr />
<h4 id="descripcion-general_13"><strong>Descripción General</strong><a class="headerlink" href="#descripcion-general_13" title="Permanent link">&para;</a></h4>
<p>Este componente es una <strong>tarea de ejecución SQL</strong> (<code>Execute SQL Task</code>) utilizada para calcular dinámicamente el número de periodos mensuales disponibles en la tabla de hechos de aportes. El resultado se almacena en una variable de usuario que controla iteraciones posteriores de procesamiento.</p>
<hr />
<h4 id="ubicacion-dentro-del-paquete_1"><strong>Ubicación dentro del Paquete</strong><a class="headerlink" href="#ubicacion-dentro-del-paquete_1" title="Permanent link">&para;</a></h4>
<p><code>FACT_ACTIVIDADES &gt; Almacenar MAX Aportes</code></p>
<hr />
<h4 id="proposito_14"><strong>Propósito</strong><a class="headerlink" href="#proposito_14" title="Permanent link">&para;</a></h4>
<p>Calcular la diferencia en meses entre la primera y la última fecha contable registrada en la tabla <code>[Aportes].[FACT_APORTES_SHR_DET]</code>, considerando únicamente aquellas fechas que tienen correspondencia válida en la dimensión de tiempo mensual. El resultado se almacena en la variable <code>User::MaxIterationApor</code>, que será utilizada para definir el número de iteraciones o ciclos de procesamiento en componentes posteriores del paquete.</p>
<hr />
<h4 id="detalles-de-implementacion_16"><strong>Detalles de Implementación</strong><a class="headerlink" href="#detalles-de-implementacion_16" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>Tipo de tarea</strong>: <code>Execute SQL Task</code></li>
<li><strong>Conexión</strong>: <code>{29BC876E-1EAF-4F6F-8F38-39B8E881EEB6}</code> → Conexión al servidor <code>DWH_COMFENALCO</code></li>
<li><strong>Tipo de resultado</strong>: <code>ResultSetType_SingleRow</code></li>
<li><strong>Variable de destino</strong>: <code>User::MaxIterationApor</code></li>
<li><strong>Script ejecutado</strong>:</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="k">DECLARE</span><span class="w"> </span><span class="o">@</span><span class="n">MinID_FECHA</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">8</span><span class="p">);</span>
<span class="k">DECLARE</span><span class="w"> </span><span class="o">@</span><span class="n">MaxID_FECHA</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">8</span><span class="p">);</span>

<span class="c1">-- Obtener el mes mínimo de FECHA_CONTABLE</span>
<span class="k">SELECT</span><span class="w"> </span>
<span class="w">    </span><span class="o">@</span><span class="n">MinID_FECHA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">MIN</span><span class="p">(</span><span class="k">LEFT</span><span class="p">(</span><span class="k">CONVERT</span><span class="p">(</span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span><span class="w"> </span><span class="n">a</span><span class="p">.[</span><span class="n">FECHA_CONTABLE</span><span class="p">],</span><span class="w"> </span><span class="mi">112</span><span class="p">),</span><span class="w"> </span><span class="mi">6</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;01&#39;</span><span class="p">)</span>
<span class="k">FROM</span><span class="w"> </span>
<span class="w">    </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Aportes</span><span class="p">].[</span><span class="n">FACT_APORTES_SHR_DET</span><span class="p">]</span><span class="w"> </span><span class="n">a</span>
<span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span>
<span class="w">    </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Transversal</span><span class="p">].[</span><span class="n">DIM_TIEMPO_MENSUAL</span><span class="p">]</span><span class="w"> </span><span class="n">t</span>
<span class="w">    </span><span class="k">ON</span><span class="w"> </span><span class="k">LEFT</span><span class="p">(</span><span class="k">CONVERT</span><span class="p">(</span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span><span class="w"> </span><span class="n">a</span><span class="p">.[</span><span class="n">FECHA_CONTABLE</span><span class="p">],</span><span class="w"> </span><span class="mi">112</span><span class="p">),</span><span class="w"> </span><span class="mi">6</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;01&#39;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">CONVERT</span><span class="p">(</span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span><span class="w"> </span><span class="n">t</span><span class="p">.[</span><span class="n">ID_FECHA</span><span class="p">],</span><span class="w"> </span><span class="mi">112</span><span class="p">);</span>

<span class="c1">-- Obtener el mes máximo de FECHA_CONTABLE</span>
<span class="k">SELECT</span><span class="w"> </span>
<span class="w">    </span><span class="o">@</span><span class="n">MaxID_FECHA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">MAX</span><span class="p">(</span><span class="k">LEFT</span><span class="p">(</span><span class="k">CONVERT</span><span class="p">(</span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span><span class="w"> </span><span class="n">a</span><span class="p">.[</span><span class="n">FECHA_CONTABLE</span><span class="p">],</span><span class="w"> </span><span class="mi">112</span><span class="p">),</span><span class="w"> </span><span class="mi">6</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;01&#39;</span><span class="p">)</span>
<span class="k">FROM</span><span class="w"> </span>
<span class="w">    </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Aportes</span><span class="p">].[</span><span class="n">FACT_APORTES_SHR_DET</span><span class="p">]</span><span class="w"> </span><span class="n">a</span>
<span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span>
<span class="w">    </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Transversal</span><span class="p">].[</span><span class="n">DIM_TIEMPO_MENSUAL</span><span class="p">]</span><span class="w"> </span><span class="n">t</span>
<span class="w">    </span><span class="k">ON</span><span class="w"> </span><span class="k">LEFT</span><span class="p">(</span><span class="k">CONVERT</span><span class="p">(</span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span><span class="w"> </span><span class="n">a</span><span class="p">.[</span><span class="n">FECHA_CONTABLE</span><span class="p">],</span><span class="w"> </span><span class="mi">112</span><span class="p">),</span><span class="w"> </span><span class="mi">6</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;01&#39;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">CONVERT</span><span class="p">(</span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span><span class="w"> </span><span class="n">t</span><span class="p">.[</span><span class="n">ID_FECHA</span><span class="p">],</span><span class="w"> </span><span class="mi">112</span><span class="p">);</span>

<span class="c1">-- Calcular diferencia en meses</span>
<span class="k">DECLARE</span><span class="w"> </span><span class="o">@</span><span class="n">DiffMonths</span><span class="w"> </span><span class="nb">INT</span><span class="p">;</span>
<span class="k">SELECT</span><span class="w"> </span>
<span class="w">    </span><span class="o">@</span><span class="n">DiffMonths</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DATEDIFF</span><span class="p">(</span><span class="k">MONTH</span><span class="p">,</span><span class="w"> </span>
<span class="w">        </span><span class="k">CONVERT</span><span class="p">(</span><span class="nb">DATE</span><span class="p">,</span><span class="w"> </span><span class="k">LEFT</span><span class="p">(</span><span class="o">@</span><span class="n">MinID_FECHA</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;01&#39;</span><span class="p">),</span><span class="w"> </span>
<span class="w">        </span><span class="k">CONVERT</span><span class="p">(</span><span class="nb">DATE</span><span class="p">,</span><span class="w"> </span><span class="k">LEFT</span><span class="p">(</span><span class="o">@</span><span class="n">MaxID_FECHA</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;01&#39;</span><span class="p">));</span>

<span class="c1">-- Resultado ajustado</span>
<span class="k">DECLARE</span><span class="w"> </span><span class="o">@</span><span class="n">VarTime</span><span class="w"> </span><span class="nb">INT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">@</span><span class="n">DiffMonths</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="k">SELECT</span><span class="w"> </span><span class="o">@</span><span class="n">VarTime</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">VarTimeParaMaxMes</span><span class="p">;</span>
</code></pre></div>
<hr />
<h4 id="logica-de-negocio_14"><strong>Lógica de Negocio</strong><a class="headerlink" href="#logica-de-negocio_14" title="Permanent link">&para;</a></h4>
<p>El objetivo de esta tarea es preparar la variable <code>User::MaxIterationApor</code> con un valor dinámico que representa la cantidad de meses a procesar en iteraciones posteriores. Esta lógica es útil en escenarios de ejecución mensual o incremental, asegurando que se abarquen todos los periodos registrados en la fuente.</p>
<hr />
<h4 id="relacion-con-otros-componentes_14"><strong>Relación con Otros Componentes</strong><a class="headerlink" href="#relacion-con-otros-componentes_14" title="Permanent link">&para;</a></h4>
<ul>
<li>Esta tarea es un paso previo necesario para contenedores de tipo bucle <code>For Loop</code> u otros componentes iterativos dentro del mismo paquete.</li>
<li>Tiene relación directa con la estructura temporal <code>DIM_TIEMPO_MENSUAL</code>, asegurando la validez del rango de fechas contables procesadas.</li>
</ul>
<h3 id="contenedor-de-bucles-for-1-1aportes-totales"><strong>Contenedor de bucles For 1 1\Aportes Totales</strong><a class="headerlink" href="#contenedor-de-bucles-for-1-1aportes-totales" title="Permanent link">&para;</a></h3>
<hr />
<h4 id="descripcion-general_14"><strong>Descripción General</strong><a class="headerlink" href="#descripcion-general_14" title="Permanent link">&para;</a></h4>
<p>Este componente SSIS es un <em>Data Flow Task</em> que consolida y transforma los aportes mensuales de los afiliados a partir de la tabla <code>FACT_APORTES_SHR_DET</code>. Posteriormente, los enriquece con información de afiliación, categorización, población educativa y otras dimensiones clave para cargarlos en la tabla <code>Transversal.FACT_ACTIVIDADES</code> del Data Warehouse.</p>
<hr />
<h4 id="ubicacion-del-paquete_3"><strong>Ubicación del Paquete</strong><a class="headerlink" href="#ubicacion-del-paquete_3" title="Permanent link">&para;</a></h4>
<p><code>FACT_ACTIVIDADES.dtsx → Contenedor de bucles For 1 1 → Aportes Totales</code></p>
<hr />
<h4 id="proposito_15"><strong>Propósito</strong><a class="headerlink" href="#proposito_15" title="Permanent link">&para;</a></h4>
<p>Transformar y centralizar la información mensual de aportes del dominio de educación formal y técnica, asociando características adicionales de los beneficiarios y su entorno educativo, con el fin de consolidar un conjunto de datos para análisis institucional y estratégico.</p>
<hr />
<h4 id="detalles-de-implementacion_17"><strong>Detalles de Implementación</strong><a class="headerlink" href="#detalles-de-implementacion_17" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>Origen de datos:</strong> <code>DWH_COMFENALCO.Aportes.FACT_APORTES_SHR_DET</code></li>
<li><strong>Tipo de componente origen:</strong> OLE DB Source con query parametrizada por variable <code>@VarTime</code></li>
<li><strong>Destino:</strong> <code>Transversal.FACT_ACTIVIDADES</code> vía componente ADO.NET Destination</li>
<li><strong>Modo de escritura:</strong> Bulk Insert habilitado</li>
<li><strong>Timeout configurado:</strong> 600 segundos</li>
<li><strong>Variable de entrada:</strong> <code>@VarTime</code> mapeada como parámetro de iteración mensual</li>
</ul>
<hr />
<h4 id="logica-de-negocio_15"><strong>Lógica de Negocio</strong><a class="headerlink" href="#logica-de-negocio_15" title="Permanent link">&para;</a></h4>
<ol>
<li>Determina el mes más antiguo de aportes (<code>@MinMes</code>) en la tabla fuente.</li>
<li>Calcula dinámicamente el mes a filtrar (<code>@MesFiltrado</code>) según el valor iterado en el bucle For.</li>
<li>Consolida los aportes por afiliado y empresa agrupados por mes.</li>
<li>Enlaza los registros con afiliaciones y población educativa activa en el mismo mes (<code>AfiliadosEducacionMes</code>).</li>
<li>
<p>Cruza los datos con dimensiones complementarias como:</p>
<ul>
<li>Tabla <code>STG_FACT_AFILIACIONES</code> para obtener <code>ID_CATEGORIA</code>, <code>ID_GENERO</code>, <code>FECHA_NACIMIENTO</code>, <code>EDAD</code>.</li>
<li>Tabla <code>FACT_ACTIVIDADES</code> para campos como <code>POBLACION_EDUCACION_FORMAL</code>, <code>TEC</code>, <code>CONTINUA</code>, <code>PROTECCION</code>.</li>
</ul>
</li>
<li>
<p>Se asignan valores por defecto en atributos cuando no hay correspondencias (<code>-1</code> o constantes como <code>5</code> en <code>ID_UNIDAD</code>).</p>
</li>
<li>
<p>Finalmente, se cargan los registros en la tabla de hechos <code>FACT_ACTIVIDADES</code>.</p>
</li>
</ol>
<hr />
<h4 id="relacion-con-otros-componentes_15"><strong>Relación con Otros Componentes</strong><a class="headerlink" href="#relacion-con-otros-componentes_15" title="Permanent link">&para;</a></h4>
<ul>
<li>Este flujo depende de las salidas previas del proceso de afiliaciones (<code>AFILIACION</code> como ACTIVIDAD).</li>
<li>Su resultado alimenta la vista consolidada de actividades mensuales (<code>FACT_ACTIVIDADES_COLEGIO</code>).</li>
<li>Las dimensiones <code>DIM_TIEMPO_MENSUAL</code>, <code>STG_FACT_AFILIACIONES</code>, y <code>FACT_ACTIVIDADES</code> son clave para enriquecer el dataset.</li>
</ul>
<hr />
<h4 id="script-sql-utilizado_1"><strong>Script SQL Utilizado</strong><a class="headerlink" href="#script-sql-utilizado_1" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="k">DECLARE</span><span class="w"> </span><span class="o">@</span><span class="n">MinMes</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">8</span><span class="p">);</span>


<span class="k">SELECT</span><span class="w"> </span>
<span class="w">    </span><span class="o">@</span><span class="n">MinMes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">MIN</span><span class="p">(</span><span class="k">LEFT</span><span class="p">(</span><span class="k">CONVERT</span><span class="p">(</span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span><span class="w"> </span><span class="n">a</span><span class="p">.[</span><span class="n">FECHA_CONTABLE</span><span class="p">],</span><span class="w"> </span><span class="mi">112</span><span class="p">),</span><span class="w"> </span><span class="mi">6</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;01&#39;</span><span class="p">)</span>
<span class="k">FROM</span><span class="w"> </span>
<span class="w">    </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Aportes</span><span class="p">].[</span><span class="n">FACT_APORTES_SHR_DET</span><span class="p">]</span><span class="w"> </span><span class="n">a</span>
<span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span>
<span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Transversal</span><span class="p">].[</span><span class="n">DIM_TIEMPO_MENSUAL</span><span class="p">]</span><span class="w"> </span><span class="n">t</span>
<span class="k">ON</span><span class="w"> </span><span class="k">LEFT</span><span class="p">(</span><span class="k">CONVERT</span><span class="p">(</span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span><span class="w"> </span><span class="n">a</span><span class="p">.[</span><span class="n">FECHA_CONTABLE</span><span class="p">],</span><span class="w"> </span><span class="mi">112</span><span class="p">),</span><span class="w"> </span><span class="mi">6</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;01&#39;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">CONVERT</span><span class="p">(</span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span><span class="w"> </span><span class="n">t</span><span class="p">.[</span><span class="n">ID_FECHA</span><span class="p">],</span><span class="w"> </span><span class="mi">112</span><span class="p">)</span>


<span class="c1">-- Paso 2: Declarar la variable para determinar el mes</span>
<span class="k">DECLARE</span><span class="w"> </span><span class="o">@</span><span class="n">VarTime</span><span class="w"> </span><span class="nb">INT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">?</span><span class="p">;</span><span class="w"> </span><span class="c1">-- Ajusta este valor según la iteración que quieras filtrar</span>

<span class="c1">-- Calcular el mes a filtrar basado en @VarTime</span>
<span class="k">DECLARE</span><span class="w"> </span><span class="o">@</span><span class="n">MesFiltrado</span><span class="w"> </span><span class="nb">INT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">CONVERT</span><span class="p">(</span><span class="nb">INT</span><span class="p">,</span><span class="w"> </span><span class="n">FORMAT</span><span class="p">(</span><span class="n">DATEADD</span><span class="p">(</span><span class="k">MONTH</span><span class="p">,</span><span class="w"> </span><span class="o">@</span><span class="n">VarTime</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="k">CONVERT</span><span class="p">(</span><span class="nb">DATE</span><span class="p">,</span><span class="w"> </span><span class="o">@</span><span class="n">MinMes</span><span class="p">)),</span><span class="w"> </span><span class="s1">&#39;yyyyMM&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;01&#39;</span><span class="p">);</span>

<span class="c1">--SELECT @MesFiltrado AS MinID_FECHA;</span>

<span class="k">WITH</span><span class="w"> </span><span class="n">Aportes_Total</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
<span class="k">SELECT</span><span class="w"> </span>
<span class="w">    </span><span class="k">ISNULL</span><span class="p">(</span><span class="n">a</span><span class="p">.[</span><span class="n">BP_EMPRESA</span><span class="p">],</span><span class="s1">&#39;0000000000&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="s1">&#39;PARTNER&#39;</span><span class="p">,</span><span class="w"> </span>
<span class="w">    </span><span class="n">a</span><span class="p">.[</span><span class="n">ID_EMPRESA</span><span class="p">],</span>
<span class="w">    </span><span class="n">a</span><span class="p">.[</span><span class="n">ID_AFILIADO</span><span class="p">],</span>
<span class="w">    </span><span class="k">CONVERT</span><span class="p">(</span><span class="nb">DATE</span><span class="p">,</span><span class="w"> </span><span class="k">LEFT</span><span class="p">(</span><span class="k">CONVERT</span><span class="p">(</span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span><span class="w"> </span><span class="n">a</span><span class="p">.[</span><span class="n">FECHA_CONTABLE</span><span class="p">],</span><span class="w"> </span><span class="mi">112</span><span class="p">),</span><span class="w"> </span><span class="mi">6</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;01&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">FECHA_MENSUAL</span><span class="p">,</span>
<span class="w">    </span><span class="k">LEFT</span><span class="p">(</span><span class="k">CONVERT</span><span class="p">(</span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span><span class="w"> </span><span class="n">a</span><span class="p">.[</span><span class="n">FECHA_CONTABLE</span><span class="p">],</span><span class="w"> </span><span class="mi">112</span><span class="p">),</span><span class="w"> </span><span class="mi">6</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;01&#39;</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_FECHA</span><span class="p">,</span>
<span class="w">    </span><span class="k">SUM</span><span class="p">(</span><span class="k">CONVERT</span><span class="p">(</span><span class="nb">DECIMAL</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">),</span><span class="w"> </span><span class="n">a</span><span class="p">.[</span><span class="n">APORTE</span><span class="p">]))</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">TOTAL_APORTES</span><span class="p">,</span>
<span class="w">    </span><span class="k">COUNT</span><span class="p">(</span><span class="n">a</span><span class="p">.[</span><span class="n">APORTE</span><span class="p">])</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">NUMERO_APORTES</span><span class="p">,</span>
<span class="w">    </span><span class="k">ISNULL</span><span class="p">(</span><span class="n">a</span><span class="p">.[</span><span class="n">BP_EMPRESA</span><span class="p">],</span><span class="s1">&#39;0000000000&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">BP_EMPRESA</span><span class="p">,</span>
<span class="w">    </span><span class="n">a</span><span class="p">.[</span><span class="n">BP_AFILIADO</span><span class="p">],</span>
<span class="w">    </span><span class="s1">&#39;APORTES&#39;</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ACTIVIDAD</span>
<span class="k">FROM</span><span class="w"> </span>
<span class="w">    </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Aportes</span><span class="p">].[</span><span class="n">FACT_APORTES_SHR_DET</span><span class="p">]</span><span class="w"> </span><span class="n">a</span>
<span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span>
<span class="w">    </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Transversal</span><span class="p">].[</span><span class="n">DIM_TIEMPO_MENSUAL</span><span class="p">]</span><span class="w"> </span><span class="n">t</span>
<span class="w">    </span><span class="k">ON</span><span class="w"> </span><span class="k">LEFT</span><span class="p">(</span><span class="k">CONVERT</span><span class="p">(</span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span><span class="w"> </span><span class="n">a</span><span class="p">.[</span><span class="n">FECHA_CONTABLE</span><span class="p">],</span><span class="w"> </span><span class="mi">112</span><span class="p">),</span><span class="w"> </span><span class="mi">6</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;01&#39;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">CONVERT</span><span class="p">(</span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span><span class="w"> </span><span class="n">t</span><span class="p">.[</span><span class="n">ID_FECHA</span><span class="p">],</span><span class="w"> </span><span class="mi">112</span><span class="p">)</span>
<span class="k">WHERE</span><span class="w"> </span><span class="k">LEFT</span><span class="p">(</span><span class="k">CONVERT</span><span class="p">(</span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span><span class="w"> </span><span class="n">a</span><span class="p">.[</span><span class="n">FECHA_CONTABLE</span><span class="p">],</span><span class="w"> </span><span class="mi">112</span><span class="p">),</span><span class="w"> </span><span class="mi">6</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;01&#39;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">@</span><span class="n">MesFiltrado</span>
<span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span>
<span class="w">    </span><span class="n">a</span><span class="p">.[</span><span class="n">ID_EMPRESA</span><span class="p">],</span>
<span class="w">    </span><span class="n">a</span><span class="p">.[</span><span class="n">ID_AFILIADO</span><span class="p">],</span>
<span class="w">    </span><span class="k">LEFT</span><span class="p">(</span><span class="k">CONVERT</span><span class="p">(</span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span><span class="w"> </span><span class="n">a</span><span class="p">.[</span><span class="n">FECHA_CONTABLE</span><span class="p">],</span><span class="w"> </span><span class="mi">112</span><span class="p">),</span><span class="w"> </span><span class="mi">6</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;01&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="n">a</span><span class="p">.[</span><span class="n">BP_EMPRESA</span><span class="p">],</span>
<span class="w">    </span><span class="n">a</span><span class="p">.[</span><span class="n">BP_AFILIADO</span><span class="p">]),</span>
<span class="n">Poblacion_Educacion_Mes</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
<span class="k">SELECT</span><span class="w"> </span><span class="k">DISTINCT</span><span class="w"> </span>
<span class="w">      </span><span class="p">[</span><span class="n">ID_FECHA</span><span class="p">]</span>
<span class="w">      </span><span class="p">,[</span><span class="n">PARTNER</span><span class="p">]</span>
<span class="w">  </span><span class="k">FROM</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Transversal</span><span class="p">].[</span><span class="n">FACT_ACTIVIDADES</span><span class="p">]</span>
<span class="w">  </span><span class="k">WHERE</span><span class="w"> </span><span class="n">ACTIVIDAD</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s1">&#39;AFILIACION&#39;</span><span class="p">),</span>
<span class="n">AfiliadosMes</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
<span class="k">SELECT</span><span class="w"> </span><span class="k">DISTINCT</span><span class="w"> </span>
<span class="w">      </span><span class="p">[</span><span class="n">ID_FECHA</span><span class="p">]</span>
<span class="w">      </span><span class="p">,[</span><span class="n">PARTNER</span><span class="p">]</span>
<span class="w">      </span><span class="p">,[</span><span class="n">PARTNER_AFILIADO</span><span class="p">]</span>
<span class="w">  </span><span class="k">FROM</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Transversal</span><span class="p">].[</span><span class="n">FACT_ACTIVIDADES</span><span class="p">]</span>
<span class="w">  </span><span class="k">WHERE</span><span class="w"> </span><span class="n">ACTIVIDAD</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;AFILIACION&#39;</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">PARTNER_AFILIADO</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span>
<span class="p">),</span>
<span class="n">AfiliadosEducacionMes</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
<span class="k">SELECT</span><span class="w"> </span>
<span class="w">    </span><span class="n">am</span><span class="p">.[</span><span class="n">ID_FECHA</span><span class="p">]</span>
<span class="w">    </span><span class="p">,</span><span class="n">am</span><span class="p">.[</span><span class="n">PARTNER_AFILIADO</span><span class="p">]</span>
<span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">AfiliadosMes</span><span class="w"> </span><span class="n">am</span>
<span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">Poblacion_Educacion_Mes</span><span class="w"> </span><span class="n">pem</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">am</span><span class="p">.[</span><span class="n">ID_FECHA</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="n">pem</span><span class="p">.[</span><span class="n">ID_FECHA</span><span class="p">]</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">am</span><span class="p">.</span><span class="n">PARTNER</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pem</span><span class="p">.</span><span class="n">PARTNER</span>
<span class="p">),</span>
<span class="n">consulta</span><span class="w"> </span><span class="k">as</span><span class="p">(</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="k">distinct</span><span class="w"> </span><span class="n">ap</span><span class="p">.</span><span class="o">*</span><span class="w">  </span>
<span class="w">    </span><span class="c1">--,am.PARTNER_AFILIADO</span>
<span class="w">    </span><span class="p">,</span><span class="c1">--CASE WHEN aem.PARTNER_AFILIADO IS NULL THEN &#39;NO&#39; ELSE &#39;SI&#39; END AS POBLACION_EDUCACION,</span>
<span class="w">    </span><span class="o">-</span><span class="mi">1</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">ID_CURSO</span><span class="p">,</span>
<span class="w">    </span><span class="o">-</span><span class="mi">1</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">ID_PROGRAMA</span><span class="p">,</span>
<span class="w">    </span><span class="o">-</span><span class="mi">1</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">ID_PERTENENCIA_ETNICA</span><span class="p">,</span>
<span class="w">    </span><span class="c1">---1 as ID_GENERO,</span>
<span class="w">    </span><span class="o">-</span><span class="mi">1</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">ID_FACTOR_VULNERABILIDAD</span><span class="p">,</span>
<span class="w">    </span><span class="o">-</span><span class="mi">1</span><span class="w"> </span><span class="n">ID_ESTADO_CIVIL</span><span class="p">,</span>
<span class="w">    </span><span class="o">-</span><span class="mi">1</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">ID_TARIFA</span><span class="p">,</span>
<span class="w">    </span><span class="c1">---1 as ID_CATEGORIA,</span>
<span class="w">    </span><span class="mi">5</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">ID_UNIDAD</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">Aportes_Total</span><span class="w"> </span><span class="n">ap</span>
<span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">AfiliadosEducacionMes</span><span class="w"> </span><span class="n">aem</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">ap</span><span class="p">.</span><span class="n">ID_FECHA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aem</span><span class="p">.</span><span class="n">ID_FECHA</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">ap</span><span class="p">.</span><span class="n">BP_AFILIADO</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aem</span><span class="p">.</span><span class="n">PARTNER_AFILIADO</span>
<span class="p">),</span>
<span class="w">  </span><span class="n">partnerTable</span><span class="w">  </span><span class="k">as</span><span class="w"> </span><span class="p">(</span>
<span class="k">SELECT</span><span class="w"> </span><span class="n">PARTNER</span><span class="p">,</span><span class="n">ID_FECHA</span><span class="p">,</span>
<span class="w">      </span><span class="k">MAX</span><span class="p">([</span><span class="n">PARTNER_AFILIADO</span><span class="p">])</span><span class="w"> </span><span class="k">as</span><span class="w">  </span><span class="n">PARTNER_AFILIADO</span>
<span class="w">      </span><span class="p">,</span><span class="k">MAX</span><span class="p">([</span><span class="n">PARTNER_EMPRESA</span><span class="p">])</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">PARTNER_EMPRESA</span><span class="p">,</span>
<span class="w">    </span><span class="k">MAX</span><span class="p">([</span><span class="n">ID_CATEGORIA</span><span class="p">])</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_CATEGORIA</span><span class="p">,</span>
<span class="w">    </span><span class="k">MAX</span><span class="p">([</span><span class="n">ID_GENERO</span><span class="p">])</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_GENERO</span>

<span class="w">  </span><span class="k">FROM</span><span class="w"> </span><span class="p">[</span><span class="n">STAGE_AREA</span><span class="p">].[</span><span class="n">Transversal</span><span class="p">].[</span><span class="n">STG_FACT_AFILIACIONES</span><span class="p">]</span>
<span class="w">  </span><span class="k">where</span><span class="w"> </span><span class="n">ACTIVIDAD</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;AFILIACION&#39;</span>
<span class="w">  </span><span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="p">[</span><span class="n">PARTNER</span><span class="p">],</span><span class="w"> </span><span class="n">ID_FECHA</span>

<span class="w">  </span><span class="p">),</span>
<span class="w">  </span><span class="n">CategoriaAfiliadoTable</span><span class="w">  </span><span class="k">as</span><span class="w"> </span><span class="p">(</span>
<span class="k">SELECT</span><span class="w"> </span><span class="n">ID_AFILIADO</span><span class="p">,</span><span class="n">ID_FECHA</span><span class="p">,</span>
<span class="w">    </span><span class="k">MAX</span><span class="p">([</span><span class="n">ID_CATEGORIA</span><span class="p">])</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_CATEGORIA</span><span class="p">,</span>
<span class="w">    </span><span class="k">MAX</span><span class="p">([</span><span class="n">ID_GENERO</span><span class="p">])</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_GENERO</span><span class="p">,</span>
<span class="w">    </span><span class="k">MAX</span><span class="p">([</span><span class="n">FECHA_NACIMIENTO</span><span class="p">])</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">FECHA_NACIMIENTO</span><span class="p">,</span>
<span class="w">    </span><span class="k">MAX</span><span class="p">([</span><span class="n">EDAD</span><span class="p">])</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">EDAD</span><span class="w">      </span>
<span class="w">  </span><span class="k">FROM</span><span class="w"> </span><span class="p">[</span><span class="n">STAGE_AREA</span><span class="p">].[</span><span class="n">Transversal</span><span class="p">].[</span><span class="n">STG_FACT_AFILIACIONES</span><span class="p">]</span>
<span class="w">  </span><span class="k">where</span><span class="w"> </span><span class="n">ACTIVIDAD</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;AFILIACION&#39;</span>
<span class="w">  </span><span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">ID_AFILIADO</span><span class="p">,</span><span class="w"> </span><span class="n">ID_FECHA</span>

<span class="w">  </span><span class="p">),</span>
<span class="w">  </span><span class="n">ActividadesPoblacion</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="k">SELECT</span><span class="w"> </span>
<span class="w">        </span><span class="n">ID_FECHA</span><span class="p">,</span><span class="w"> </span><span class="c1">-- Conversión explícita</span>
<span class="w">        </span><span class="c1">--PARTNER,       -- Conversión explícita</span>
<span class="w">        </span><span class="n">ID_AFILIADO</span><span class="p">,</span>
<span class="w">        </span><span class="k">MAX</span><span class="p">(</span><span class="n">POBLACION_EDUCACION</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">POBLACION_EDUCACION</span><span class="p">,</span>
<span class="w">        </span><span class="k">MAX</span><span class="p">(</span><span class="n">POBLACION_EDUCACION_FORMAL</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">POBLACION_EDUCACION_FORMAL</span><span class="p">,</span>
<span class="w">        </span><span class="k">MAX</span><span class="p">(</span><span class="n">POBLACION_EDUCACION_TECNICA</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">POBLACION_EDUCACION_TECNICA</span><span class="p">,</span>
<span class="w">        </span><span class="k">MAX</span><span class="p">(</span><span class="n">POBLACION_EDUCACION_CONTINUA</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">POBLACION_EDUCACION_CONTINUA</span><span class="p">,</span>
<span class="w">        </span><span class="k">MAX</span><span class="p">(</span><span class="n">POBLACION_EDUCACION_PROTECCION</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">POBLACION_EDUCACION_PROTECCION</span>
<span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Transversal</span><span class="p">].[</span><span class="n">FACT_ACTIVIDADES</span><span class="p">]</span>
<span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="n">ID_AFILIADO</span><span class="w"> </span><span class="o">!=-</span><span class="mi">1</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">ACTIVIDAD</span><span class="w"> </span><span class="o">!=</span><span class="s1">&#39;APORTES&#39;</span>
<span class="w">    </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">ID_AFILIADO</span><span class="p">,</span><span class="w"> </span><span class="n">ID_FECHA</span><span class="p">)</span>

<span class="w">  </span><span class="k">select</span><span class="w">  </span><span class="k">c</span><span class="p">.</span><span class="o">*</span><span class="p">,</span><span class="w"> </span>
<span class="w">  </span><span class="c1">--COALESCE(pt.[PARTNER_AFILIADO], &#39;0000000000&#39;) as PARTNER_AFILIADO,</span>
<span class="w">  </span><span class="c1">--COALESCE(pt.[PARTNER_EMPRESA] , &#39;0000000000&#39;) as PARTNER_EMPRESA,</span>
<span class="w">  </span><span class="k">COALESCE</span><span class="p">(</span><span class="k">c</span><span class="p">.[</span><span class="n">BP_AFILIADO</span><span class="p">],</span><span class="w"> </span><span class="s1">&#39;0000000000&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">PARTNER_AFILIADO</span><span class="p">,</span>
<span class="w">  </span><span class="k">COALESCE</span><span class="p">(</span><span class="k">c</span><span class="p">.[</span><span class="n">BP_EMPRESA</span><span class="p">]</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;0000000000&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">PARTNER_EMPRESA</span><span class="p">,</span>
<span class="w">  </span><span class="k">COALESCE</span><span class="p">(</span><span class="n">cata</span><span class="p">.[</span><span class="n">ID_CATEGORIA</span><span class="p">]</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">ID_CATEGORIA</span><span class="p">,</span>
<span class="w">  </span><span class="k">COALESCE</span><span class="p">(</span><span class="n">cata</span><span class="p">.[</span><span class="n">ID_GENERO</span><span class="p">]</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">ID_GENERO</span><span class="p">,</span>
<span class="w">  </span><span class="n">cata</span><span class="p">.[</span><span class="n">FECHA_NACIMIENTO</span><span class="p">],</span><span class="w"> </span>
<span class="w">  </span><span class="k">COALESCE</span><span class="p">(</span><span class="n">cata</span><span class="p">.[</span><span class="n">EDAD</span><span class="p">]</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">EDAD</span><span class="p">,</span>
<span class="s1">&#39;[DWH_COMFENALCO].[Aportes].[FACT_APORTES_SHR_DET]&#39;</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">[</span><span class="n">FUENTE_PRINCIPAL</span><span class="p">],</span>
<span class="w">    </span><span class="k">CONVERT</span><span class="p">(</span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span><span class="k">COALESCE</span><span class="p">(</span><span class="n">act</span><span class="p">.</span><span class="n">POBLACION_EDUCACION</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;NO&#39;</span><span class="p">))</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">POBLACION_EDUCACION</span><span class="p">,</span>
<span class="w">    </span><span class="k">COALESCE</span><span class="p">(</span><span class="n">act</span><span class="p">.</span><span class="n">POBLACION_EDUCACION_FORMAL</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;NO&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">POBLACION_EDUCACION_FORMAL</span><span class="p">,</span>
<span class="w">    </span><span class="k">COALESCE</span><span class="p">(</span><span class="n">act</span><span class="p">.</span><span class="n">POBLACION_EDUCACION_TECNICA</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;NO&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">POBLACION_EDUCACION_TECNICA</span><span class="p">,</span>
<span class="w">    </span><span class="k">COALESCE</span><span class="p">(</span><span class="n">act</span><span class="p">.</span><span class="n">POBLACION_EDUCACION_CONTINUA</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;NO&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">POBLACION_EDUCACION_CONTINUA</span><span class="p">,</span>
<span class="w">    </span><span class="k">COALESCE</span><span class="p">(</span><span class="n">act</span><span class="p">.</span><span class="n">POBLACION_EDUCACION_PROTECCION</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;NO&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">POBLACION_EDUCACION_PROTECCION</span>
<span class="w">  </span><span class="k">from</span><span class="w">  </span><span class="n">consulta</span><span class="w"> </span><span class="k">c</span>
<span class="w">  </span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w">  </span><span class="n">partnerTable</span><span class="w"> </span><span class="n">pt</span>
<span class="w">  </span><span class="k">ON</span><span class="w"> </span><span class="k">c</span><span class="p">.[</span><span class="n">PARTNER</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pt</span><span class="p">.[</span><span class="n">PARTNER</span><span class="p">]</span>
<span class="w">  </span><span class="k">AND</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">ID_FECHA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pt</span><span class="p">.</span><span class="n">ID_FECHA</span>
<span class="w">  </span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w">  </span><span class="n">ActividadesPoblacion</span><span class="w"> </span><span class="n">act</span>
<span class="w">  </span><span class="c1">--ON c.[PARTNER] = act.[PARTNER]</span>
<span class="w">  </span><span class="k">ON</span><span class="w"> </span><span class="k">c</span><span class="p">.[</span><span class="n">ID_AFILIADO</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">act</span><span class="p">.[</span><span class="n">ID_AFILIADO</span><span class="p">]</span>
<span class="w">  </span><span class="k">AND</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">ID_FECHA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">act</span><span class="p">.</span><span class="n">ID_FECHA</span>
<span class="w">  </span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">CategoriaAfiliadoTable</span><span class="w"> </span><span class="n">cata</span><span class="w"> </span>
<span class="w">  </span><span class="k">ON</span><span class="w"> </span><span class="k">c</span><span class="p">.[</span><span class="n">ID_AFILIADO</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cata</span><span class="p">.[</span><span class="n">ID_AFILIADO</span><span class="p">]</span>
<span class="w">  </span><span class="k">AND</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">ID_FECHA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cata</span><span class="p">.</span><span class="n">ID_FECHA</span>
</code></pre></div>
<h3 id="fact_personal_cubo"><strong>FACT_PERSONAL_CUBO</strong><a class="headerlink" href="#fact_personal_cubo" title="Permanent link">&para;</a></h3>
<hr />
<h4 id="descripcion-general-del-componente_3"><strong>Descripción General del Componente</strong><a class="headerlink" href="#descripcion-general-del-componente_3" title="Permanent link">&para;</a></h4>
<p>El flujo de datos <code>FACT_PERSONAL_CUBO</code> consolida eventos relacionados con el personal docente, tales como ausentismos, reemplazos, contrataciones y terminaciones, provenientes de múltiples fuentes. Integra estos datos y los transforma para su carga en la tabla de hechos <code>FACT_PERSONAL</code> del Data Warehouse <code>DWH_COMFENALCO</code>.</p>
<hr />
<h4 id="ubicacion-del-paquete_4"><strong>Ubicación del Paquete</strong><a class="headerlink" href="#ubicacion-del-paquete_4" title="Permanent link">&para;</a></h4>
<p><code>Package\FACT_PERSONAL_CUBO</code></p>
<hr />
<h4 id="proposito-del-componente_2"><strong>Propósito del Componente</strong><a class="headerlink" href="#proposito-del-componente_2" title="Permanent link">&para;</a></h4>
<p>Unificar eventos mensuales del personal institucional para análisis de disponibilidad, contratación y movimiento del recurso humano. Esta información permite alimentar cubos de análisis para planificación y control de personal.</p>
<hr />
<h4 id="detalles-de-implementacion_18"><strong>Detalles de Implementación</strong><a class="headerlink" href="#detalles-de-implementacion_18" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p><strong>Origen:</strong></p>
<ul>
<li><code>[DWH_COMFENALCO].[Cedesarrollo].[FACT_AUSENTISMO_DOCENTE]</code></li>
<li><code>[DWH_COMFENALCO].[Colegio].[FACT_AUSENTISMO_DOCENTE]</code></li>
<li><code>[DWH_COMFENALCO].[Colegio].[FACT_REEMPLAZO_DOCENTE]</code></li>
<li><code>[DWH_COMFENALCO].[Transversal].[DIM_PERSONAL]</code></li>
</ul>
</li>
<li>
<p><strong>Destino:</strong></p>
<ul>
<li><code>"Transversal"."FACT_PERSONAL"</code></li>
</ul>
</li>
<li>
<p><strong>Transformaciones:</strong></p>
<ul>
<li>Agrupación mensual de eventos mediante la fórmula <code>LEFT(ID_FECHA,6)*100+1</code>.</li>
<li>Uniformización de estructura con campos como <code>CONCEPTO</code>, <code>DESCRIPCION</code>, <code>HORAS_CONTRATADAS_MENSUAL</code>, <code>TIPO_AUSENCIA</code>, etc.</li>
<li>Clasificación de eventos: <code>AUSENTISMO</code>, <code>REEMPLAZO</code>, <code>CONTRATACION</code>, <code>FIN_CONTRATACION</code>.</li>
<li>Trazabilidad con columna <code>FUENTE_PRINCIPAL</code> indicando la fuente original.</li>
</ul>
</li>
<li>
<p><strong>Método de carga:</strong>
  ADO.NET Destination con <code>UseBulkInsertWhenPossible = true</code>.</p>
</li>
</ul>
<hr />
<h4 id="logica-de-negocio_16"><strong>Lógica de Negocio</strong><a class="headerlink" href="#logica-de-negocio_16" title="Permanent link">&para;</a></h4>
<ol>
<li>
<p>Se obtienen y unifican eventos de:</p>
<ul>
<li>Ausentismos docentes.</li>
<li>Reemplazos temporales.</li>
<li>Contrataciones activas.</li>
<li>Terminaciones de contrato.</li>
</ul>
</li>
<li>
<p>Cada evento es asociado a un mes de análisis (<code>ID_FECHA</code> normalizado).</p>
</li>
<li>
<p>Se enriquece con la unidad organizacional del personal mediante <code>LEFT JOIN</code> a <code>DIM_PERSONAL</code>.</p>
</li>
<li>
<p>Se filtra para garantizar la existencia en <code>DIM_TIEMPO_MENSUAL</code>.</p>
</li>
<li>
<p>Se insertan registros estandarizados con sus conceptos y trazabilidad en <code>FACT_PERSONAL</code>.</p>
</li>
</ol>
<hr />
<h4 id="relacion-con-otros-componentes_16"><strong>Relación con Otros Componentes</strong><a class="headerlink" href="#relacion-con-otros-componentes_16" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p><strong>Dependencias:</strong></p>
<ul>
<li><code>DIM_TIEMPO_MENSUAL</code></li>
<li><code>DIM_PERSONAL</code></li>
</ul>
</li>
<li>
<p><strong>Destino Analítico:</strong></p>
<ul>
<li>Tabla de hechos <code>FACT_PERSONAL</code>, insumo para cubos de recursos humanos y reportes de gestión del talento docente.</li>
</ul>
</li>
</ul>
<hr />
<h4 id="script-sql-principal-resumen"><strong>Script SQL Principal (Resumen)</strong><a class="headerlink" href="#script-sql-principal-resumen" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">uni</span><span class="p">.</span><span class="n">ID_FECHA</span><span class="p">,</span><span class="w"> </span><span class="n">uni</span><span class="p">.</span><span class="n">ID_PERSONAL</span><span class="p">,</span><span class="n">uni</span><span class="p">.</span><span class="n">NOMBRE</span><span class="p">,</span><span class="n">uni</span><span class="p">.</span><span class="n">CONCEPTO</span><span class="p">,</span><span class="n">uni</span><span class="p">.</span><span class="n">DESCRIPCION</span><span class="p">,</span><span class="w"> </span><span class="n">uni</span><span class="p">.</span><span class="n">FECHA_FIN</span><span class="w"> </span><span class="p">,</span>
<span class="n">uni</span><span class="p">.</span><span class="n">HORAS_CONTRATADAS_MENSUAL</span><span class="p">,</span><span class="w"> </span><span class="n">pers</span><span class="p">.</span><span class="n">ID_UNIDAD</span><span class="p">,</span><span class="n">AUSENCIA_HORAS</span><span class="p">,</span><span class="n">TIPO_AUSENCIA</span><span class="p">,</span><span class="n">uni</span><span class="p">.</span><span class="n">FUENTE_PRINCIPAL</span><span class="w">  </span><span class="k">FROM</span><span class="p">(</span>

<span class="k">SELECT</span><span class="w"> </span><span class="k">LEFT</span><span class="p">([</span><span class="n">ID_FECHA</span><span class="p">],</span><span class="w"> </span><span class="mi">6</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="w"> </span><span class="o">+</span><span class="mi">1</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">ID_FECHA</span>
<span class="w">      </span><span class="p">,[</span><span class="n">ID_PERSONAL</span><span class="p">]</span>
<span class="w">      </span><span class="p">,[</span><span class="n">NOMBRE_DOCENTE</span><span class="p">]</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">NOMBRE</span>
<span class="w">      </span><span class="p">,</span><span class="s1">&#39;AUSENTISMO&#39;</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">CONCEPTO</span>
<span class="w">      </span><span class="p">,[</span><span class="n">MOTIVO_AUSENCIA</span><span class="p">]</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">DESCRIPCION</span>
<span class="w">      </span><span class="p">,[</span><span class="n">FECHA_FIN</span><span class="p">]</span>
<span class="w">      </span><span class="p">,</span><span class="k">NULL</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">HORAS_CONTRATADAS_MENSUAL</span>
<span class="w">      </span><span class="p">,</span><span class="n">AUSENCIA_HORAS</span>
<span class="w">      </span><span class="p">,</span><span class="n">TIPO_AUSENCIA</span><span class="p">,</span>
<span class="w">      </span><span class="s1">&#39;[DWH_COMFENALCO].[Cedesarrollo].[FACT_AUSENTISMO_DOCENTE]&#39;</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">[</span><span class="n">FUENTE_PRINCIPAL</span><span class="p">]</span>
<span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Cedesarrollo</span><span class="p">].[</span><span class="n">FACT_AUSENTISMO_DOCENTE</span><span class="p">]</span>

<span class="k">UNION</span><span class="w"> </span>

<span class="k">SELECT</span><span class="w"> </span><span class="k">LEFT</span><span class="p">([</span><span class="n">ID_FECHA</span><span class="p">],</span><span class="w"> </span><span class="mi">6</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="w"> </span><span class="o">+</span><span class="mi">1</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">ID_FECHA</span>
<span class="w">      </span><span class="p">,[</span><span class="n">ID_PERSONAL_REEMPLAZA</span><span class="p">]</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">ID_PERSONAL</span>
<span class="w">      </span><span class="p">,[</span><span class="n">DOCENTE_REEMPLAZA</span><span class="p">]</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">NOMBRE</span>
<span class="w">      </span><span class="p">,</span><span class="s1">&#39;REEMPLAZO&#39;</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">CONCEPTO</span>
<span class="w">      </span><span class="p">,</span><span class="k">NULL</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">DESCRIPCION</span>
<span class="w">      </span><span class="p">,</span><span class="k">NULL</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">FECHA_FIN</span>
<span class="w">      </span><span class="p">,</span><span class="k">NULL</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">HORAS_CONTRATADAS_MENSUAL</span>
<span class="w">      </span><span class="p">,</span><span class="k">NULL</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">AUSENCIA_HORAS</span>
<span class="w">      </span><span class="p">,</span><span class="k">NULL</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">TIPO_AUSENCIA</span><span class="p">,</span>
<span class="w">      </span><span class="s1">&#39;[DWH_COMFENALCO].[Colegio].[FACT_REEMPLAZO_DOCENTE]&#39;</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">[</span><span class="n">FUENTE_PRINCIPAL</span><span class="p">]</span>
<span class="k">FROM</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Colegio</span><span class="p">].[</span><span class="n">FACT_REEMPLAZO_DOCENTE</span><span class="p">]</span>

<span class="k">UNION</span><span class="w"> </span>

<span class="k">SELECT</span><span class="w"> </span><span class="k">LEFT</span><span class="p">([</span><span class="n">ID_FECHA</span><span class="p">],</span><span class="w"> </span><span class="mi">6</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="w"> </span><span class="o">+</span><span class="mi">1</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">ID_FECHA</span>
<span class="w">      </span><span class="p">,[</span><span class="n">ID_PERSONAL</span><span class="p">]</span>
<span class="w">      </span><span class="p">,[</span><span class="n">NOMBRE_DOCENTE</span><span class="p">]</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">NOMBRE</span>
<span class="w">      </span><span class="p">,</span><span class="s1">&#39;AUSENTISMO&#39;</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">CONCEPTO</span>
<span class="w">      </span><span class="p">,[</span><span class="n">MOTIVO_AUSENCIA</span><span class="p">]</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">DESCRIPCION</span>
<span class="w">      </span><span class="p">,[</span><span class="n">FECHA_FIN</span><span class="p">]</span>
<span class="w">      </span><span class="p">,</span><span class="k">NULL</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">HORAS_CONTRATADAS_MENSUAL</span>
<span class="w">      </span><span class="p">,</span><span class="n">AUSENCIA_HORAS</span>
<span class="w">      </span><span class="p">,</span><span class="n">TIPO_AUSENCIA</span><span class="p">,</span>
<span class="w">      </span><span class="s1">&#39;[DWH_COMFENALCO].[Colegio].[FACT_AUSENTISMO_DOCENTE]&#39;</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">[</span><span class="n">FUENTE_PRINCIPAL</span><span class="p">]</span>
<span class="k">FROM</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Colegio</span><span class="p">].[</span><span class="n">FACT_AUSENTISMO_DOCENTE</span><span class="p">]</span>

<span class="k">UNION</span><span class="w"> </span>

<span class="k">SELECT</span><span class="w"> </span><span class="k">LEFT</span><span class="p">(</span><span class="k">CONVERT</span><span class="p">(</span><span class="nb">INT</span><span class="p">,</span><span class="w"> </span><span class="n">FORMAT</span><span class="p">([</span><span class="n">FECHA_INICIO_CONTRATACION</span><span class="p">],</span><span class="w"> </span><span class="s1">&#39;yyyyMMdd&#39;</span><span class="p">)),</span><span class="w"> </span><span class="mi">6</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="w"> </span><span class="o">+</span><span class="mi">1</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_FECHA</span>
<span class="w">      </span><span class="p">,[</span><span class="n">ID_PERSONAL</span><span class="p">]</span><span class="w">      </span>
<span class="w">      </span><span class="p">,[</span><span class="n">NOMBRE</span><span class="p">]</span>
<span class="w">      </span><span class="p">,</span><span class="s1">&#39;CONTRATACION&#39;</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">CONCEPTO</span><span class="w"> </span>
<span class="w">      </span><span class="p">,</span><span class="k">NULL</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">DESCRIPCION</span>
<span class="w">      </span><span class="p">,[</span><span class="n">FECHA_FIN_CONTRATACION</span><span class="p">]</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">FECHA_FIN</span>
<span class="w">      </span><span class="p">,[</span><span class="n">HORAS_CONTRATADAS_MENSUAL</span><span class="p">]</span>
<span class="w">      </span><span class="p">,</span><span class="k">NULL</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">AUSENCIA_HORAS</span>
<span class="w">      </span><span class="p">,</span><span class="k">NULL</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">TIPO_AUSENCIA</span><span class="p">,</span>
<span class="w">      </span><span class="s1">&#39;[DWH_COMFENALCO].[Transversal].[DIM_PERSONAL]&#39;</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">[</span><span class="n">FUENTE_PRINCIPAL</span><span class="p">]</span>
<span class="k">FROM</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Transversal</span><span class="p">].[</span><span class="n">DIM_PERSONAL</span><span class="p">]</span>

<span class="k">UNION</span><span class="w"> </span>

<span class="w"> </span><span class="k">SELECT</span><span class="w">  </span><span class="k">LEFT</span><span class="p">(</span><span class="k">CONVERT</span><span class="p">(</span><span class="nb">INT</span><span class="p">,</span><span class="w"> </span><span class="n">FORMAT</span><span class="p">([</span><span class="n">FECHA_FIN_CONTRATACION</span><span class="p">],</span><span class="w"> </span><span class="s1">&#39;yyyyMMdd&#39;</span><span class="p">)),</span><span class="w"> </span><span class="mi">6</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="w"> </span><span class="o">+</span><span class="mi">1</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_FECHA</span>
<span class="w">      </span><span class="p">,[</span><span class="n">ID_PERSONAL</span><span class="p">]</span><span class="w">      </span>
<span class="w">      </span><span class="p">,[</span><span class="n">NOMBRE</span><span class="p">]</span>
<span class="w">      </span><span class="p">,</span><span class="s1">&#39;FIN_CONTRATACION&#39;</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">CONCEPTO</span><span class="w"> </span>
<span class="w">      </span><span class="p">,[</span><span class="n">CAUSA_TERMINACION_CONTRATO</span><span class="p">]</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">DESCRIPCION</span>
<span class="w">      </span><span class="p">,</span><span class="k">NULL</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">FECHA_FIN</span>
<span class="w">      </span><span class="p">,</span><span class="k">NULL</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">HORAS_CONTRATADAS_MENSUAL</span>
<span class="w">      </span><span class="p">,</span><span class="k">NULL</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">AUSENCIA_HORAS</span>
<span class="w">      </span><span class="p">,</span><span class="k">NULL</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">TIPO_AUSENCIA</span><span class="p">,</span>
<span class="w">      </span><span class="s1">&#39;[DWH_COMFENALCO].[Transversal].[DIM_PERSONAL]&#39;</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">[</span><span class="n">FUENTE_PRINCIPAL</span><span class="p">]</span>
<span class="w">  </span><span class="k">FROM</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Transversal</span><span class="p">].[</span><span class="n">DIM_PERSONAL</span><span class="p">]</span>


<span class="w">  </span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">uni</span>
<span class="w"> </span><span class="c1">--   WHERE [ID_FECHA] IS NOT NULL</span>
<span class="w"> </span><span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Transversal</span><span class="p">].[</span><span class="n">DIM_TIEMPO_MENSUAL</span><span class="p">]</span><span class="w"> </span><span class="n">dimM</span>
<span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">uni</span><span class="p">.</span><span class="n">ID_FECHA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dimM</span><span class="p">.</span><span class="n">ID_FECHA</span><span class="w"> </span>
<span class="w"> </span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Transversal</span><span class="p">].[</span><span class="n">DIM_PERSONAL</span><span class="p">]</span><span class="w"> </span><span class="n">pers</span>
<span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">uni</span><span class="p">.</span><span class="n">ID_PERSONAL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pers</span><span class="p">.</span><span class="n">ID_PERSONAL</span>
</code></pre></div>
<h3 id="fact_evaluacion_docente_cubo"><strong>FACT_EVALUACION_DOCENTE_CUBO</strong><a class="headerlink" href="#fact_evaluacion_docente_cubo" title="Permanent link">&para;</a></h3>
<hr />
<h4 id="descripcion-general_15"><strong>Descripción General</strong><a class="headerlink" href="#descripcion-general_15" title="Permanent link">&para;</a></h4>
<p>Este componente del paquete SSIS carga evaluaciones docentes consolidadas desde diversas fuentes académicas hacia la tabla <code>Transversal.FACT_EVALUACION_DOCENTE</code> en el Data Warehouse <code>DWH_COMFENALCO</code>. Su objetivo es integrar calificaciones definitivas por periodo académico, unidad y docente, permitiendo su análisis a nivel histórico y comparativo.</p>
<hr />
<h4 id="ubicacion-en-el-paquete_11"><strong>Ubicación en el Paquete</strong><a class="headerlink" href="#ubicacion-en-el-paquete_11" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>Ruta SSIS:</strong> <code>Package\FACT_EVALUACION_DOCENTE_CUBO</code></li>
<li><strong>Destino:</strong> <code>DWH_COMFENALCO.Transversal.FACT_EVALUACION_DOCENTE</code></li>
</ul>
<hr />
<h4 id="proposito_16"><strong>Propósito</strong><a class="headerlink" href="#proposito_16" title="Permanent link">&para;</a></h4>
<p>Consolidar las calificaciones docentes de los sistemas académicos de <strong>Colegio</strong> y <strong>Cedesarrollo</strong>, incluyendo desempeño y evaluaciones cuantitativas, para su análisis transversal por unidad, docente, fecha y periodo académico.</p>
<hr />
<h4 id="detalles-de-implementacion_19"><strong>Detalles de Implementación</strong><a class="headerlink" href="#detalles-de-implementacion_19" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>Origen:</strong> Componente <code>FACT_EVALUACION</code> (ADO.NET Source)</li>
<li><strong>Destino:</strong> Componente <code>Destino de ADO NET</code> con tabla <code>Transversal.FACT_EVALUACION_DOCENTE</code></li>
<li><strong>Tipo de carga:</strong> Bulk Insert mediante <code>SqlBulkCopy</code></li>
<li><strong>Transformación:</strong> Validación y consolidación de columnas comunes; ajuste de fechas (<code>ID_FECHA</code> generada a partir de <code>FECHA_FIN</code>)</li>
<li><strong>Integración temporal:</strong> <code>DIM_TIEMPO_MENSUAL</code> para validación y normalización de fechas.</li>
</ul>
<hr />
<h4 id="logica-de-negocio_17"><strong>Lógica de Negocio</strong><a class="headerlink" href="#logica-de-negocio_17" title="Permanent link">&para;</a></h4>
<p>La lógica combina múltiples orígenes de evaluación docente:</p>
<ol>
<li>Evaluación cuantitativa (<code>FACT_DESEMPENHO_DOCENTE</code>)</li>
<li>Evaluaciones CE (<code>FACT_DESEMPENHO_DOCENTE_CE</code>)</li>
<li>Evaluaciones DE (<code>FACT_DESEMPENHO_DOCENTE_DE</code>)</li>
</ol>
<p>Se prioriza la obtención de <code>ID_FECHA</code> a partir de la última fecha del periodo y se homogeniza la estructura para facilitar análisis OLAP.</p>
<hr />
<h4 id="relacion-con-otros-componentes_17"><strong>Relación con Otros Componentes</strong><a class="headerlink" href="#relacion-con-otros-componentes_17" title="Permanent link">&para;</a></h4>
<ul>
<li>Utiliza dimensiones compartidas como <code>DIM_TIEMPO_MENSUAL</code> y <code>DIM_PERIODO_ACADEMICO</code>.</li>
<li>Integra lógica de negocio coherente con <code>FACT_PERSONAL_CUBO</code> para trazabilidad de personal docente.</li>
<li>Complementa vistas como <code>VW_EVALUACION_DOCENTE</code> para análisis multidimensional.</li>
</ul>
<hr />
<h4 id="script-sql-implementado"><strong>Script SQL Implementado</strong><a class="headerlink" href="#script-sql-implementado" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span>
<span class="w">    </span><span class="n">PERIODO_ACADEMICO</span><span class="p">,</span>
<span class="w">    </span><span class="n">ID_UNIDAD</span><span class="p">,</span>
<span class="w">    </span><span class="n">ID_PERSONAL</span><span class="p">,</span>
<span class="w">    </span><span class="n">NOMBRE_DOCENTE</span><span class="p">,</span>
<span class="w">    </span><span class="n">CALIFICACION_DEFINITIVA</span><span class="p">,</span>
<span class="w">    </span><span class="n">uni</span><span class="p">.</span><span class="n">ID_FECHA</span><span class="p">,</span><span class="w"> </span>
<span class="w">    </span><span class="n">uni</span><span class="p">.</span><span class="n">FUENTE_PRINCIPAL</span><span class="w"> </span>
<span class="k">FROM</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="k">SELECT</span><span class="w"> </span>
<span class="w">        </span><span class="k">CONVERT</span><span class="p">(</span><span class="n">NVARCHAR</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="n">ANIO_ACADEMICO</span><span class="p">])</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">PERIODO_ACADEMICO</span><span class="p">,</span>
<span class="w">        </span><span class="mi">1</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">ID_UNIDAD</span><span class="p">,</span>
<span class="w">        </span><span class="p">[</span><span class="n">ID_PERSONAL</span><span class="p">],</span>
<span class="w">        </span><span class="p">[</span><span class="n">NOMBRE_DOCENTE</span><span class="p">],</span>
<span class="w">        </span><span class="p">[</span><span class="n">TOTAL_GENERAL</span><span class="p">]</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">CALIFICACION_DEFINITIVA</span><span class="p">,</span>
<span class="w">        </span><span class="p">[</span><span class="n">ID_FECHA</span><span class="p">],</span>
<span class="w">        </span><span class="s1">&#39;[DWH_COMFENALCO].[Colegio].[FACT_DESEMPENHO_DOCENTE]&#39;</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">FUENTE_PRINCIPAL</span>
<span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Colegio</span><span class="p">].[</span><span class="n">FACT_DESEMPENHO_DOCENTE</span><span class="p">]</span>

<span class="w">    </span><span class="k">UNION</span>

<span class="w">    </span><span class="k">SELECT</span><span class="w"> </span>
<span class="w">        </span><span class="n">c2</span><span class="p">.[</span><span class="n">PERIODO_ACADEMICO</span><span class="p">],</span>
<span class="w">        </span><span class="n">c1</span><span class="p">.[</span><span class="n">ID_UNIDAD</span><span class="p">],</span>
<span class="w">        </span><span class="n">c1</span><span class="p">.[</span><span class="n">ID_PERSONAL</span><span class="p">],</span>
<span class="w">        </span><span class="n">c1</span><span class="p">.[</span><span class="n">NOMBRE_DOCENTE</span><span class="p">],</span>
<span class="w">        </span><span class="n">c1</span><span class="p">.[</span><span class="n">CALIFICACION_DEFINITIVA</span><span class="p">],</span>
<span class="w">        </span><span class="k">CONVERT</span><span class="p">(</span><span class="nb">INT</span><span class="p">,</span><span class="w"> </span><span class="n">FORMAT</span><span class="p">(</span><span class="k">MAX</span><span class="p">(</span><span class="n">c2</span><span class="p">.</span><span class="n">FECHA_FIN</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;yyyyMM&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;01&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">ID_FECHA</span><span class="p">,</span>
<span class="w">        </span><span class="s1">&#39;[DWH_COMFENALCO].[Cedesarrollo].[FACT_DESEMPENHO_DOCENTE_CE]&#39;</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">FUENTE_PRINCIPAL</span>
<span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Cedesarrollo</span><span class="p">].[</span><span class="n">FACT_DESEMPENHO_DOCENTE_CE</span><span class="p">]</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">c1</span>
<span class="w">    </span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Cedesarrollo</span><span class="p">].[</span><span class="n">DIM_PERIODO_ACADEMICO</span><span class="p">]</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">c2</span>
<span class="w">        </span><span class="k">ON</span><span class="w"> </span><span class="n">c1</span><span class="p">.</span><span class="n">ID_PERIODO</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">c2</span><span class="p">.</span><span class="n">ID_PERIODO</span>
<span class="w">    </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">c1</span><span class="p">.</span><span class="n">ID_UNIDAD</span><span class="p">,</span><span class="w"> </span><span class="n">c1</span><span class="p">.</span><span class="n">ID_PERSONAL</span><span class="p">,</span><span class="w"> </span><span class="n">c1</span><span class="p">.</span><span class="n">NOMBRE_DOCENTE</span><span class="p">,</span><span class="w"> </span><span class="n">c2</span><span class="p">.</span><span class="n">PERIODO_ACADEMICO</span><span class="p">,</span><span class="w"> </span><span class="n">c1</span><span class="p">.</span><span class="n">CALIFICACION_DEFINITIVA</span>

<span class="w">    </span><span class="k">UNION</span>

<span class="w">    </span><span class="k">SELECT</span><span class="w"> </span>
<span class="w">        </span><span class="n">c2</span><span class="p">.[</span><span class="n">PERIODO_ACADEMICO</span><span class="p">],</span>
<span class="w">        </span><span class="n">c1</span><span class="p">.[</span><span class="n">ID_UNIDAD</span><span class="p">],</span>
<span class="w">        </span><span class="n">c1</span><span class="p">.[</span><span class="n">ID_PERSONAL</span><span class="p">],</span>
<span class="w">        </span><span class="n">c1</span><span class="p">.[</span><span class="n">NOMBRE_DOCENTE</span><span class="p">],</span>
<span class="w">        </span><span class="n">c1</span><span class="p">.[</span><span class="n">CALIFICACION</span><span class="p">]</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">CALIFICACION_DEFINITIVA</span><span class="p">,</span>
<span class="w">        </span><span class="k">CONVERT</span><span class="p">(</span><span class="nb">INT</span><span class="p">,</span><span class="w"> </span><span class="n">FORMAT</span><span class="p">(</span><span class="k">MAX</span><span class="p">(</span><span class="n">c2</span><span class="p">.</span><span class="n">FECHA_FIN</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;yyyyMM&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;01&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">ID_FECHA</span><span class="p">,</span>
<span class="w">        </span><span class="s1">&#39;[DWH_COMFENALCO].[Cedesarrollo].[FACT_DESEMPENHO_DOCENTE_DE]&#39;</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">FUENTE_PRINCIPAL</span>
<span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Cedesarrollo</span><span class="p">].[</span><span class="n">FACT_DESEMPENHO_DOCENTE_DE</span><span class="p">]</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">c1</span>
<span class="w">    </span><span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Cedesarrollo</span><span class="p">].[</span><span class="n">DIM_PERIODO_ACADEMICO</span><span class="p">]</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">c2</span>
<span class="w">        </span><span class="k">ON</span><span class="w"> </span><span class="n">c1</span><span class="p">.</span><span class="n">ID_PERIODO</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">c2</span><span class="p">.</span><span class="n">ID_PERIODO</span>
<span class="w">    </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">c1</span><span class="p">.</span><span class="n">ID_UNIDAD</span><span class="p">,</span><span class="w"> </span><span class="n">c1</span><span class="p">.</span><span class="n">ID_PERSONAL</span><span class="p">,</span><span class="w"> </span><span class="n">c1</span><span class="p">.</span><span class="n">NOMBRE_DOCENTE</span><span class="p">,</span><span class="w"> </span><span class="n">c2</span><span class="p">.</span><span class="n">PERIODO_ACADEMICO</span><span class="p">,</span><span class="w"> </span><span class="n">c1</span><span class="p">.</span><span class="n">CALIFICACION</span>
<span class="p">)</span><span class="w"> </span><span class="n">uni</span>
<span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Transversal</span><span class="p">].[</span><span class="n">DIM_TIEMPO_MENSUAL</span><span class="p">]</span><span class="w"> </span><span class="n">dimM</span>
<span class="w">    </span><span class="k">ON</span><span class="w"> </span><span class="n">uni</span><span class="p">.</span><span class="n">ID_FECHA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dimM</span><span class="p">.</span><span class="n">ID_FECHA</span><span class="p">;</span>
</code></pre></div>
<hr />
<h4 id="importancia-para-el-negocio"><strong>Importancia para el Negocio</strong><a class="headerlink" href="#importancia-para-el-negocio" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>Evaluación Docente Unificada:</strong> Permite una comparación equitativa del desempeño entre unidades y periodos.</li>
<li><strong>Indicadores Estratégicos:</strong> Aporta información clave para la gestión académica y decisiones sobre desarrollo del personal docente.</li>
<li><strong>Auditoría y Trazabilidad:</strong> La columna <code>FUENTE_PRINCIPAL</code> permite rastrear la procedencia exacta de cada registro.</li>
</ul>
<h3 id="fact_financiera_cubo"><strong>FACT_FINANCIERA_CUBO</strong><a class="headerlink" href="#fact_financiera_cubo" title="Permanent link">&para;</a></h3>
<hr />
<h4 id="descripcion-general_16">Descripción General<a class="headerlink" href="#descripcion-general_16" title="Permanent link">&para;</a></h4>
<p>El componente <code>FACT_FINANCIERA_CUBO</code> dentro del paquete SSIS permite la transformación, integración y carga de información contable ejecutada y presupuestada. A través de una consulta unificada, combina datos de ejecución contable y presupuesto para permitir un análisis financiero completo, incluyendo resultados PYG y BALANCE por dimensiones organizativas y temporales.</p>
<hr />
<h4 id="ubicacion-en-el-paquete_12">Ubicación en el Paquete<a class="headerlink" href="#ubicacion-en-el-paquete_12" title="Permanent link">&para;</a></h4>
<p><code>Package\FACT_FINANCIERA_CUBO</code></p>
<hr />
<h4 id="proposito_17">Propósito<a class="headerlink" href="#proposito_17" title="Permanent link">&para;</a></h4>
<p>Unificar, transformar y cargar información financiera desde las tablas <code>FACT_DETALLE_CONTABLE</code> y <code>FACT_PRESUPUESTO</code>, integrando datos presupuestales y ejecutados con el objetivo de habilitar análisis comparativos por unidad organizativa, cuenta contable y periodos mensuales en la tabla final <code>Transversal.FACT_FINANCIERA</code>.</p>
<hr />
<h4 id="detalles-de-implementacion_20">Detalles de Implementación<a class="headerlink" href="#detalles-de-implementacion_20" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p><strong>Origen de Datos</strong>:</p>
<ul>
<li><strong>Ejecución Contable:</strong> <code>Financiera.FACT_DETALLE_CONTABLE</code></li>
<li><strong>Presupuesto Contable:</strong> <code>Financiera.FACT_PRESUPUESTO</code></li>
</ul>
</li>
<li>
<p><strong>Uniones Clave</strong>:</p>
<ul>
<li><code>DIM_UNIDADES_ORGANIZATIVAS</code>, <code>DIM_CUENTA_CONTABLE</code>, <code>DIM_TIEMPO</code></li>
</ul>
</li>
<li>
<p><strong>Destino</strong>:</p>
<ul>
<li>Tabla: <code>"Transversal"."FACT_FINANCIERA"</code> (via componente ADO.NET Destination)</li>
</ul>
</li>
<li>
<p><strong>Carga</strong>:</p>
<ul>
<li>Operación de tipo <code>Bulk Insert</code> habilitada para eficiencia.</li>
</ul>
</li>
</ul>
<hr />
<h4 id="logica-de-negocio_18">Lógica de Negocio<a class="headerlink" href="#logica-de-negocio_18" title="Permanent link">&para;</a></h4>
<ol>
<li>
<p><strong>Consulta de Ejecución</strong>: Se agrupan y suman valores contables como ingresos, gastos, costos, activos y pasivos a nivel de cuenta, unidad y fecha. El resultado incluye una columna calculada <code>TIPO</code> con valor <code>'PYG'</code> o <code>'BALANCE'</code> según el tipo de cuenta.</p>
</li>
<li>
<p><strong>Consulta de Presupuesto</strong>: Similar estructura y lógica, diferenciando mediante el campo <code>ACTIVIDAD = 'PRESUPUESTO_CONTABLE'</code>.</p>
</li>
<li>
<p><strong>Unión</strong>: Se realiza un <code>UNION ALL</code> entre ambas consultas, permitiendo comparar ejecución vs. presupuesto en un solo dataset.</p>
</li>
<li>
<p><strong>Enriquecimiento</strong>: Se integran claves de unidad (<code>ID_UNIDAD</code>) y tiempo (<code>DIM_TIEMPO_MENSUAL</code>) para análisis dimensional.</p>
</li>
</ol>
<hr />
<h4 id="relacion-con-otros-componentes_18">Relación con Otros Componentes<a class="headerlink" href="#relacion-con-otros-componentes_18" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>Fuentes Vinculadas</strong>: <code>FACT_DETALLE_CONTABLE</code>, <code>FACT_PRESUPUESTO</code>, <code>DIM_TIEMPO</code>, <code>DIM_UNIDADES_ORGANIZATIVAS</code>, <code>DIM_CUENTA_CONTABLE</code></li>
<li><strong>Destino Final</strong>: <code>FACT_FINANCIERA</code> (ubicada en esquema <code>Transversal</code>)</li>
<li><strong>Dependencias</strong>: Requiere datos consistentes y cargados previamente en dimensiones de unidades y tiempo.</li>
</ul>
<hr />
<h4 id="script-sql-completo_1">Script SQL Completo<a class="headerlink" href="#script-sql-completo_1" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="k">WITH</span><span class="w"> </span><span class="n">EjecucionContable</span><span class="w"> </span><span class="k">AS</span>
<span class="p">(</span><span class="k">SELECT</span>
<span class="w">    </span><span class="n">Ej</span><span class="p">.[</span><span class="n">ID_MES</span><span class="p">]</span><span class="o">*</span><span class="mi">100</span><span class="o">+</span><span class="mi">1</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">ID_FECHA</span><span class="p">,</span>
<span class="w">    </span><span class="n">Ej</span><span class="p">.</span><span class="n">ID_ANIO</span><span class="p">,</span><span class="n">Ej</span><span class="p">.</span><span class="n">ID_MES</span><span class="p">,</span><span class="n">Ej</span><span class="p">.</span><span class="n">ID_CEBE</span><span class="p">,</span><span class="n">Ej</span><span class="p">.</span><span class="n">CEBE</span><span class="p">,</span><span class="n">DESCRIPCION_CEBE</span><span class="p">,</span><span class="n">Ej</span><span class="p">.</span><span class="n">DEPARTAMENTO</span><span class="p">,</span><span class="n">Ej</span><span class="p">.</span><span class="n">AREA</span><span class="p">,</span><span class="n">Ej</span><span class="p">.</span><span class="n">SUBAREA</span><span class="p">,</span>
<span class="w">    </span><span class="n">Ej</span><span class="p">.</span><span class="n">SEGMENTO</span><span class="p">,</span><span class="n">Ej</span><span class="p">.</span><span class="n">DESCRIPCION_SEGMENTO</span><span class="p">,</span><span class="n">Ej</span><span class="p">.</span><span class="n">CODIGO_SSF</span><span class="p">,</span><span class="n">Ej</span><span class="p">.</span><span class="n">NOMBRE_SSF</span><span class="p">,</span><span class="n">Ej</span><span class="p">.</span><span class="n">ID_CUENTA</span><span class="p">,</span>
<span class="w">    </span><span class="n">Ej</span><span class="p">.</span><span class="n">CUENTA</span><span class="p">,</span><span class="n">Ej</span><span class="p">.</span><span class="n">CUENTA_HOMOLOGA</span><span class="p">,</span><span class="n">Ej</span><span class="p">.</span><span class="n">DESCRIPCION</span><span class="p">,</span><span class="n">Ej</span><span class="p">.</span><span class="n">TIPO_CUENTA</span><span class="p">,</span><span class="n">Ej</span><span class="p">.</span><span class="n">TIPO_OPERACION</span><span class="p">,</span>
<span class="w">    </span><span class="n">Ej</span><span class="p">.</span><span class="n">GRUPO_CUENTA</span><span class="p">,</span><span class="n">Ej</span><span class="p">.</span><span class="n">SUBGRUPO_CUENTA</span><span class="p">,</span><span class="n">Ej</span><span class="p">.</span><span class="n">GRUPO_OPERACION</span><span class="p">,</span><span class="n">Ej</span><span class="p">.</span><span class="n">CUENTA_SSF</span><span class="p">,</span>
<span class="w">    </span><span class="n">Ej</span><span class="p">.</span><span class="n">DESCRIPCION_SSF</span><span class="p">,</span><span class="n">Ej</span><span class="p">.</span><span class="n">CUENTA_DESCRIPCION</span><span class="p">,</span><span class="n">Ej</span><span class="p">.</span><span class="n">CUENTA_DESCRIPCION_SSF</span><span class="p">,</span>
<span class="w">    </span><span class="n">Ej</span><span class="p">.</span><span class="n">SIGNO_INGRESOS</span><span class="p">,</span><span class="n">Ej</span><span class="p">.</span><span class="n">CLASIFICACION</span><span class="p">,</span><span class="n">Ej</span><span class="p">.</span><span class="n">SEGMENT</span><span class="p">,</span>
<span class="w">    </span><span class="n">Ej</span><span class="p">.</span><span class="n">IMPORTE</span><span class="p">,</span>
<span class="w">    </span><span class="n">Ej</span><span class="p">.</span><span class="n">INGRESOS</span><span class="p">,</span>
<span class="w">    </span><span class="n">Ej</span><span class="p">.</span><span class="n">INGRESOS_OPERACIONALES</span><span class="p">,</span>
<span class="w">    </span><span class="n">Ej</span><span class="p">.</span><span class="n">GASTOS</span><span class="p">,</span>
<span class="w">    </span><span class="n">Ej</span><span class="p">.</span><span class="n">GASTOS_OPERACIONALES</span><span class="p">,</span>
<span class="w">    </span><span class="n">Ej</span><span class="p">.</span><span class="n">GASTOS_OPERACIONALES_ADMIN</span><span class="p">,</span>
<span class="w">    </span><span class="n">Ej</span><span class="p">.</span><span class="n">RESULTADO_EJERCICIO</span><span class="p">,</span>
<span class="w">    </span><span class="n">Ej</span><span class="p">.</span><span class="n">COSTOS</span><span class="p">,</span>
<span class="w">    </span><span class="n">Ej</span><span class="p">.</span><span class="n">ACTIVO</span><span class="p">,</span>
<span class="w">    </span><span class="n">Ej</span><span class="p">.</span><span class="n">PASIVO</span><span class="p">,</span>
<span class="w">    </span><span class="n">Ej</span><span class="p">.</span><span class="n">PATRIMONIO</span><span class="p">,</span>
<span class="w">    </span><span class="n">Ej</span><span class="p">.</span><span class="n">GASTOS_CON_DISTRIBUCION</span><span class="p">,</span>
<span class="w">    </span><span class="n">Ej</span><span class="p">.</span><span class="n">GASTOS_SIN_DISTRIBUCION</span><span class="p">,</span>
<span class="w">    </span><span class="k">Case</span><span class="w"> </span><span class="k">When</span><span class="w"> </span><span class="n">Ej</span><span class="p">.</span><span class="n">TIPO_CUENTA</span><span class="w"> </span><span class="k">In</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;INGRESOS&#39;</span><span class="p">,</span><span class="s1">&#39;COSTOS&#39;</span><span class="p">,</span><span class="s1">&#39;GASTOS&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">Then</span><span class="w"> </span><span class="s1">&#39;PYG&#39;</span><span class="w"> </span><span class="k">Else</span><span class="w"> </span><span class="s1">&#39;BALANCE&#39;</span><span class="w"> </span><span class="k">End</span><span class="w"> </span><span class="k">As</span><span class="w"> </span><span class="n">TIPO</span><span class="p">,</span>
<span class="w">    </span><span class="s1">&#39;EJECUCION_CONTABLE&#39;</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">ACTIVIDAD</span><span class="p">,</span>
<span class="w">    </span><span class="s1">&#39;Consulta Detalle Contable Comfenalco&#39;</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">FUENTE_PRINCIPAL</span>

<span class="k">FROM</span>
<span class="p">(</span>

<span class="w">    </span><span class="k">SELECT</span>
<span class="w">        </span><span class="n">Tp</span><span class="p">.[</span><span class="n">ID_ANIO</span><span class="p">],</span>
<span class="w">        </span><span class="n">Tp</span><span class="p">.[</span><span class="n">ID_MES</span><span class="p">],</span>
<span class="w">        </span><span class="n">Ft</span><span class="p">.[</span><span class="n">ID_CEBE</span><span class="p">],</span>
<span class="w">        </span><span class="n">Uo</span><span class="p">.[</span><span class="n">CEBE</span><span class="p">],</span>
<span class="w">        </span><span class="k">Upper</span><span class="p">(</span><span class="n">Uo</span><span class="p">.[</span><span class="n">CEBE_DESCRIPCION</span><span class="p">])</span><span class="k">As</span><span class="w">  </span><span class="p">[</span><span class="n">DESCRIPCION_CEBE</span><span class="p">],</span><span class="w"> </span>
<span class="w">        </span><span class="k">Upper</span><span class="p">(</span><span class="n">Uo</span><span class="p">.[</span><span class="n">DEPARTAMENTO</span><span class="p">])</span><span class="k">As</span><span class="w">  </span><span class="p">[</span><span class="n">DEPARTAMENTO</span><span class="p">],</span>
<span class="w">        </span><span class="k">Upper</span><span class="p">(</span><span class="n">Uo</span><span class="p">.[</span><span class="n">AREA</span><span class="p">])</span><span class="w">        </span><span class="k">As</span><span class="w">  </span><span class="p">[</span><span class="n">AREA</span><span class="p">],</span>
<span class="w">        </span><span class="k">Upper</span><span class="p">(</span><span class="n">Uo</span><span class="p">.[</span><span class="n">SUBAREA</span><span class="p">])</span><span class="w">     </span><span class="k">As</span><span class="w">  </span><span class="p">[</span><span class="n">SUBAREA</span><span class="p">],</span>
<span class="w">        </span><span class="n">Uo</span><span class="p">.[</span><span class="n">SEGMENTO</span><span class="p">],</span>
<span class="w">        </span><span class="n">Uo</span><span class="p">.[</span><span class="n">DESCRIPCION_SEGMENTO</span><span class="p">],</span>
<span class="w">        </span><span class="n">Uo</span><span class="p">.[</span><span class="n">CODIGO_SSF</span><span class="p">],</span>
<span class="w">        </span><span class="n">Uo</span><span class="p">.[</span><span class="n">NOMBRE_SSF</span><span class="p">],</span>
<span class="w">        </span><span class="n">Ft</span><span class="p">.[</span><span class="n">ID_CUENTA</span><span class="p">],</span>
<span class="w">        </span><span class="n">Ct</span><span class="p">.[</span><span class="n">CUENTA</span><span class="p">],</span>
<span class="w">        </span><span class="n">Ct</span><span class="p">.[</span><span class="n">CUENTA_HOMOLOGA</span><span class="p">],</span>
<span class="w">        </span><span class="k">Upper</span><span class="p">(</span><span class="n">Ct</span><span class="p">.[</span><span class="n">DESCRIPCION</span><span class="p">])</span><span class="w">     </span><span class="k">As</span><span class="w">  </span><span class="p">[</span><span class="n">DESCRIPCION</span><span class="p">],</span>
<span class="w">        </span><span class="k">Upper</span><span class="p">(</span><span class="n">Ct</span><span class="p">.[</span><span class="n">TIPO_CUENTA</span><span class="p">])</span><span class="w">     </span><span class="k">As</span><span class="w">  </span><span class="p">[</span><span class="n">TIPO_CUENTA</span><span class="p">],</span>
<span class="w">        </span><span class="k">Upper</span><span class="p">(</span><span class="n">Ct</span><span class="p">.[</span><span class="n">TIPO_OPERACION</span><span class="p">])</span><span class="w">  </span><span class="k">As</span><span class="w">  </span><span class="p">[</span><span class="n">TIPO_OPERACION</span><span class="p">],</span>
<span class="w">        </span><span class="k">Upper</span><span class="p">(</span><span class="n">Ct</span><span class="p">.[</span><span class="n">GRUPO_CUENTA</span><span class="p">])</span><span class="w">    </span><span class="k">As</span><span class="w">  </span><span class="p">[</span><span class="n">GRUPO_CUENTA</span><span class="p">],</span>
<span class="w">        </span><span class="k">Upper</span><span class="p">(</span><span class="n">Ct</span><span class="p">.[</span><span class="n">SUBGRUPO_CUENTA</span><span class="p">])</span><span class="w"> </span><span class="k">As</span><span class="w">  </span><span class="p">[</span><span class="n">SUBGRUPO_CUENTA</span><span class="p">],</span>
<span class="w">        </span><span class="k">Upper</span><span class="p">(</span><span class="n">Ct</span><span class="p">.[</span><span class="n">GRUPO_OPERACION</span><span class="p">])</span><span class="w"> </span><span class="k">As</span><span class="w">  </span><span class="p">[</span><span class="n">GRUPO_OPERACION</span><span class="p">],</span>
<span class="w">        </span><span class="n">Ct</span><span class="p">.[</span><span class="n">CUENTA_SSF</span><span class="p">],</span>
<span class="w">        </span><span class="k">Upper</span><span class="p">(</span><span class="n">Ct</span><span class="p">.[</span><span class="n">DESCRIPCION_SSF</span><span class="p">])</span><span class="w">         </span><span class="k">As</span><span class="w">  </span><span class="p">[</span><span class="n">DESCRIPCION_SSF</span><span class="p">],</span>
<span class="w">        </span><span class="k">Upper</span><span class="p">(</span><span class="n">Ct</span><span class="p">.[</span><span class="n">CUENTA_DESCRIPCION</span><span class="p">])</span><span class="w">      </span><span class="k">As</span><span class="w">  </span><span class="p">[</span><span class="n">CUENTA_DESCRIPCION</span><span class="p">],</span>
<span class="w">        </span><span class="k">Upper</span><span class="p">(</span><span class="n">Ct</span><span class="p">.[</span><span class="n">CUENTA_DESCRIPCION_SSF</span><span class="p">])</span><span class="w">  </span><span class="k">As</span><span class="w">  </span><span class="p">[</span><span class="n">CUENTA_DESCRIPCION_SSF</span><span class="p">],</span>
<span class="w">        </span><span class="n">Ct</span><span class="p">.[</span><span class="n">SIGNO_INGRESOS</span><span class="p">],</span>
<span class="w">        </span><span class="n">Ct</span><span class="p">.[</span><span class="n">CLASIFICACION</span><span class="p">],</span>
<span class="w">        </span><span class="n">Ft</span><span class="p">.[</span><span class="n">SEGMENT</span><span class="p">],</span>
<span class="w">        </span><span class="n">Try_Convert</span><span class="p">(</span><span class="nb">Numeric</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span><span class="k">Sum</span><span class="p">(</span><span class="k">isnull</span><span class="p">(</span><span class="n">Ft</span><span class="p">.[</span><span class="n">IMPORTE</span><span class="p">],</span><span class="mi">0</span><span class="p">)))</span><span class="w">                  </span><span class="k">As</span><span class="w">  </span><span class="p">[</span><span class="n">IMPORTE</span><span class="p">],</span>
<span class="w">        </span><span class="n">Try_Convert</span><span class="p">(</span><span class="nb">Numeric</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span><span class="k">Sum</span><span class="p">(</span><span class="k">isnull</span><span class="p">(</span><span class="n">Ft</span><span class="p">.[</span><span class="n">INGRESOS</span><span class="p">],</span><span class="mi">0</span><span class="p">)))</span><span class="w">                 </span><span class="k">As</span><span class="w">  </span><span class="p">[</span><span class="n">INGRESOS</span><span class="p">],</span>
<span class="w">        </span><span class="n">Try_Convert</span><span class="p">(</span><span class="nb">Numeric</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span><span class="k">Sum</span><span class="p">(</span><span class="k">isnull</span><span class="p">(</span><span class="n">Ft</span><span class="p">.[</span><span class="n">INGRESOS_OPERACIONALES</span><span class="p">],</span><span class="mi">0</span><span class="p">)))</span><span class="w">   </span><span class="k">As</span><span class="w">  </span><span class="p">[</span><span class="n">INGRESOS_OPERACIONALES</span><span class="p">],</span>
<span class="w">        </span><span class="n">Try_Convert</span><span class="p">(</span><span class="nb">Numeric</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span><span class="k">Sum</span><span class="p">(</span><span class="k">isnull</span><span class="p">(</span><span class="n">Ft</span><span class="p">.[</span><span class="n">GASTOS</span><span class="p">],</span><span class="mi">0</span><span class="p">)))</span><span class="w">                   </span><span class="k">As</span><span class="w">  </span><span class="p">[</span><span class="n">GASTOS</span><span class="p">],</span>
<span class="w">        </span><span class="n">Try_Convert</span><span class="p">(</span><span class="nb">Numeric</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span><span class="k">Sum</span><span class="p">(</span><span class="k">isnull</span><span class="p">(</span><span class="n">Ft</span><span class="p">.[</span><span class="n">GASTOS_OPERACIONALES</span><span class="p">],</span><span class="mi">0</span><span class="p">)))</span><span class="w">         </span><span class="k">As</span><span class="w">  </span><span class="p">[</span><span class="n">GASTOS_OPERACIONALES</span><span class="p">],</span>
<span class="w">        </span><span class="n">Try_Convert</span><span class="p">(</span><span class="nb">Numeric</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span><span class="k">Sum</span><span class="p">(</span><span class="k">isnull</span><span class="p">(</span><span class="n">Ft</span><span class="p">.[</span><span class="n">GASTOS_OPERACIONALES_ADMIN</span><span class="p">],</span><span class="mi">0</span><span class="p">)))</span><span class="w">   </span><span class="k">As</span><span class="w">  </span><span class="p">[</span><span class="n">GASTOS_OPERACIONALES_ADMIN</span><span class="p">],</span>
<span class="w">        </span><span class="n">Try_Convert</span><span class="p">(</span><span class="nb">Numeric</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span><span class="k">Sum</span><span class="p">(</span><span class="k">isnull</span><span class="p">(</span><span class="n">Ft</span><span class="p">.[</span><span class="n">RESULTADO_EJERCICIO</span><span class="p">],</span><span class="mi">0</span><span class="p">)))</span><span class="w">      </span><span class="k">As</span><span class="w">  </span><span class="p">[</span><span class="n">RESULTADO_EJERCICIO</span><span class="p">],</span>
<span class="w">        </span><span class="n">Try_Convert</span><span class="p">(</span><span class="nb">Numeric</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span><span class="k">Sum</span><span class="p">(</span><span class="k">isnull</span><span class="p">(</span><span class="n">Ft</span><span class="p">.[</span><span class="n">COSTOS</span><span class="p">],</span><span class="mi">0</span><span class="p">)))</span><span class="w">                   </span><span class="k">As</span><span class="w">  </span><span class="p">[</span><span class="n">COSTOS</span><span class="p">],</span>
<span class="w">        </span><span class="n">Try_Convert</span><span class="p">(</span><span class="nb">Numeric</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span><span class="k">Sum</span><span class="p">(</span><span class="k">isnull</span><span class="p">(</span><span class="n">Ft</span><span class="p">.[</span><span class="n">ACTIVO</span><span class="p">],</span><span class="mi">0</span><span class="p">)))</span><span class="w">                   </span><span class="k">As</span><span class="w">  </span><span class="p">[</span><span class="n">ACTIVO</span><span class="p">],</span>
<span class="w">        </span><span class="n">Try_Convert</span><span class="p">(</span><span class="nb">Numeric</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span><span class="k">Sum</span><span class="p">(</span><span class="k">isnull</span><span class="p">(</span><span class="n">Ft</span><span class="p">.[</span><span class="n">PASIVO</span><span class="p">],</span><span class="mi">0</span><span class="p">)))</span><span class="w">                   </span><span class="k">As</span><span class="w">  </span><span class="p">[</span><span class="n">PASIVO</span><span class="p">],</span>
<span class="w">        </span><span class="n">Try_Convert</span><span class="p">(</span><span class="nb">Numeric</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span><span class="k">Sum</span><span class="p">(</span><span class="k">isnull</span><span class="p">(</span><span class="n">Ft</span><span class="p">.[</span><span class="n">PATRIMONIO</span><span class="p">],</span><span class="mi">0</span><span class="p">)))</span><span class="w">               </span><span class="k">As</span><span class="w">  </span><span class="p">[</span><span class="n">PATRIMONIO</span><span class="p">],</span>
<span class="w">        </span><span class="n">Try_Convert</span><span class="p">(</span><span class="nb">Numeric</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span><span class="k">Sum</span><span class="p">(</span><span class="k">isnull</span><span class="p">(</span><span class="n">Ft</span><span class="p">.[</span><span class="n">GASTOS_CON_DISTRIBUCION</span><span class="p">],</span><span class="mi">0</span><span class="p">)))</span><span class="w">  </span><span class="k">As</span><span class="w">  </span><span class="p">[</span><span class="n">GASTOS_CON_DISTRIBUCION</span><span class="p">],</span><span class="w">  </span>
<span class="w">        </span><span class="n">Try_Convert</span><span class="p">(</span><span class="nb">Numeric</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span><span class="k">Sum</span><span class="p">(</span><span class="k">isnull</span><span class="p">(</span><span class="n">Ft</span><span class="p">.[</span><span class="n">GASTOS_SIN_DISTRIBUCION</span><span class="p">],</span><span class="mi">0</span><span class="p">)))</span><span class="w">  </span><span class="k">As</span><span class="w">  </span><span class="p">[</span><span class="n">GASTOS_SIN_DISTRIBUCION</span><span class="p">]</span>

<span class="w">      </span><span class="k">FROM</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Financiera</span><span class="p">].[</span><span class="n">FACT_DETALLE_CONTABLE</span><span class="p">]</span><span class="w"> </span><span class="n">FT</span>
<span class="w">      </span><span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Financiera</span><span class="p">].[</span><span class="n">DIM_UNIDADES_ORGANIZATIVAS</span><span class="p">]</span><span class="w"> </span><span class="n">Uo</span><span class="w"> </span><span class="k">On</span><span class="w">  </span><span class="n">Ft</span><span class="p">.</span><span class="n">ID_CEBE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Uo</span><span class="p">.</span><span class="n">ID_CEBE</span>
<span class="w">      </span><span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Financiera</span><span class="p">].[</span><span class="n">DIM_CUENTA_CONTABLE</span><span class="p">]</span><span class="w"> </span><span class="n">Ct</span><span class="w"> </span><span class="k">On</span><span class="w">  </span><span class="n">Ft</span><span class="p">.</span><span class="n">ID_CUENTA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ct</span><span class="p">.</span><span class="n">ID_CUENTA</span>
<span class="w">      </span><span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Dwh</span><span class="p">].[</span><span class="n">DIM_TIEMPO</span><span class="p">]</span><span class="w"> </span><span class="n">Tp</span><span class="w"> </span><span class="k">On</span><span class="w">  </span><span class="n">Ft</span><span class="p">.</span><span class="n">ID_FECHA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tp</span><span class="p">.</span><span class="n">ID_FECHA</span>
<span class="w">      </span><span class="k">Where</span><span class="cm">/*   TP.ID_ANIO = @Año_Actual AND Try_convert(date,tp.FECHA,103) &lt;= @PeriodoMax</span>
<span class="cm">        AND*/</span><span class="w"> </span><span class="c1">--Ct.TIPO_CUENTA Not in  (&#39;INGRESOS&#39;,&#39;COSTOS&#39;,&#39;GASTOS&#39;)</span>
<span class="w">        </span><span class="n">Ct</span><span class="p">.</span><span class="n">TIPO_CUENTA</span><span class="w"> </span><span class="k">in</span><span class="w">  </span><span class="p">(</span><span class="s1">&#39;INGRESOS&#39;</span><span class="p">,</span><span class="s1">&#39;COSTOS&#39;</span><span class="p">,</span><span class="s1">&#39;GASTOS&#39;</span><span class="p">)</span>
<span class="w">        </span><span class="c1">--AND   LEFT(Ct.CUENTA,4) in (1516,1528) </span>

<span class="w">      </span><span class="k">Group</span><span class="w"> </span><span class="k">by</span><span class="w"> </span>

<span class="w">        </span><span class="n">Tp</span><span class="p">.[</span><span class="n">ID_ANIO</span><span class="p">],</span><span class="n">Tp</span><span class="p">.[</span><span class="n">ID_MES</span><span class="p">],</span><span class="n">Ft</span><span class="p">.[</span><span class="n">ID_CEBE</span><span class="p">],</span><span class="w"> </span><span class="n">Uo</span><span class="p">.[</span><span class="n">CEBE</span><span class="p">],</span><span class="n">Uo</span><span class="p">.[</span><span class="n">CEBE_DESCRIPCION</span><span class="p">],</span><span class="n">Uo</span><span class="p">.[</span><span class="n">DEPARTAMENTO</span><span class="p">],</span><span class="n">Uo</span><span class="p">.[</span><span class="n">AREA</span><span class="p">],</span><span class="n">Uo</span><span class="p">.[</span><span class="n">SUBAREA</span><span class="p">],</span><span class="n">Uo</span><span class="p">.[</span><span class="n">SEGMENTO</span><span class="p">],</span>
<span class="w">        </span><span class="n">Uo</span><span class="p">.[</span><span class="n">DESCRIPCION_SEGMENTO</span><span class="p">],</span><span class="w"> </span><span class="n">Uo</span><span class="p">.[</span><span class="n">CODIGO_SSF</span><span class="p">],</span><span class="n">Uo</span><span class="p">.[</span><span class="n">NOMBRE_SSF</span><span class="p">],</span><span class="n">Ft</span><span class="p">.[</span><span class="n">ID_CUENTA</span><span class="p">],</span><span class="n">Ct</span><span class="p">.[</span><span class="n">CUENTA</span><span class="p">],</span>
<span class="w">        </span><span class="n">Ct</span><span class="p">.[</span><span class="n">CUENTA_HOMOLOGA</span><span class="p">],</span><span class="n">Ct</span><span class="p">.[</span><span class="n">DESCRIPCION</span><span class="p">],</span><span class="n">Ct</span><span class="p">.[</span><span class="n">TIPO_CUENTA</span><span class="p">],</span><span class="n">Ct</span><span class="p">.[</span><span class="n">TIPO_OPERACION</span><span class="p">],</span><span class="n">Ct</span><span class="p">.[</span><span class="n">GRUPO_CUENTA</span><span class="p">],</span>
<span class="w">        </span><span class="n">Ct</span><span class="p">.[</span><span class="n">SUBGRUPO_CUENTA</span><span class="p">],</span><span class="n">Ct</span><span class="p">.[</span><span class="n">GRUPO_OPERACION</span><span class="p">],</span><span class="n">Ct</span><span class="p">.[</span><span class="n">CUENTA_SSF</span><span class="p">],</span><span class="n">Ct</span><span class="p">.[</span><span class="n">DESCRIPCION_SSF</span><span class="p">],</span><span class="n">Ct</span><span class="p">.[</span><span class="n">CUENTA_DESCRIPCION</span><span class="p">],</span>
<span class="w">        </span><span class="n">Ct</span><span class="p">.[</span><span class="n">CUENTA_DESCRIPCION_SSF</span><span class="p">],</span><span class="n">Ct</span><span class="p">.[</span><span class="n">SIGNO_INGRESOS</span><span class="p">],</span><span class="n">Ct</span><span class="p">.[</span><span class="n">CLASIFICACION</span><span class="p">],</span><span class="n">Ft</span><span class="p">.[</span><span class="n">SEGMENT</span><span class="p">]</span>
<span class="w"> </span><span class="p">)</span><span class="n">Ej</span>
<span class="w">     </span><span class="c1">--Order by Ej.[ID_ANIO],Ej.[ID_MES],Ej.[ID_CEBE]</span>
<span class="p">),</span>
<span class="n">PresupuestoContable</span><span class="w"> </span><span class="k">AS</span>
<span class="p">(</span>
<span class="k">SELECT</span>
<span class="w">    </span><span class="n">Ej</span><span class="p">.[</span><span class="n">ID_MES</span><span class="p">]</span><span class="o">*</span><span class="mi">100</span><span class="o">+</span><span class="mi">1</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">ID_FECHA</span><span class="p">,</span>
<span class="w">    </span><span class="n">Ej</span><span class="p">.</span><span class="n">ID_ANIO</span><span class="p">,</span><span class="n">Ej</span><span class="p">.</span><span class="n">ID_MES</span><span class="p">,</span><span class="n">Ej</span><span class="p">.</span><span class="n">ID_CEBE</span><span class="p">,</span><span class="n">Ej</span><span class="p">.</span><span class="n">CEBE</span><span class="p">,</span><span class="n">Ej</span><span class="p">.</span><span class="n">DESCRIPCION_CEBE</span><span class="p">,</span><span class="n">Ej</span><span class="p">.</span><span class="n">DEPARTAMENTO</span><span class="p">,</span><span class="n">Ej</span><span class="p">.</span><span class="n">AREA</span><span class="p">,</span><span class="n">Ej</span><span class="p">.</span><span class="n">SUBAREA</span><span class="p">,</span>
<span class="w">    </span><span class="n">Ej</span><span class="p">.</span><span class="n">SEGMENTO</span><span class="p">,</span><span class="n">Ej</span><span class="p">.</span><span class="n">DESCRIPCION_SEGMENTO</span><span class="p">,</span><span class="n">Ej</span><span class="p">.</span><span class="n">CODIGO_SSF</span><span class="p">,</span><span class="n">Ej</span><span class="p">.</span><span class="n">NOMBRE_SSF</span><span class="p">,</span><span class="n">Ej</span><span class="p">.</span><span class="n">ID_CUENTA</span><span class="p">,</span>
<span class="w">    </span><span class="n">Ej</span><span class="p">.</span><span class="n">CUENTA</span><span class="p">,</span><span class="n">Ej</span><span class="p">.</span><span class="n">CUENTA_HOMOLOGA</span><span class="p">,</span><span class="n">Ej</span><span class="p">.</span><span class="n">DESCRIPCION</span><span class="p">,</span><span class="n">Ej</span><span class="p">.</span><span class="n">TIPO_CUENTA</span><span class="p">,</span><span class="n">Ej</span><span class="p">.</span><span class="n">TIPO_OPERACION</span><span class="p">,</span>
<span class="w">    </span><span class="n">Ej</span><span class="p">.</span><span class="n">GRUPO_CUENTA</span><span class="p">,</span><span class="n">Ej</span><span class="p">.</span><span class="n">SUBGRUPO_CUENTA</span><span class="p">,</span><span class="n">Ej</span><span class="p">.</span><span class="n">GRUPO_OPERACION</span><span class="p">,</span><span class="n">Ej</span><span class="p">.</span><span class="n">CUENTA_SSF</span><span class="p">,</span>
<span class="w">    </span><span class="n">Ej</span><span class="p">.</span><span class="n">DESCRIPCION_SSF</span><span class="p">,</span><span class="n">Ej</span><span class="p">.</span><span class="n">CUENTA_DESCRIPCION</span><span class="p">,</span><span class="n">Ej</span><span class="p">.</span><span class="n">CUENTA_DESCRIPCION_SSF</span><span class="p">,</span>
<span class="w">    </span><span class="n">Ej</span><span class="p">.</span><span class="n">SIGNO_INGRESOS</span><span class="p">,</span><span class="n">Ej</span><span class="p">.</span><span class="n">CLASIFICACION</span><span class="p">,</span><span class="n">Ej</span><span class="p">.</span><span class="n">SEGMENT</span><span class="p">,</span>
<span class="w">    </span><span class="n">Ej</span><span class="p">.</span><span class="n">IMPORTE</span><span class="p">,</span>
<span class="w">    </span><span class="n">Ej</span><span class="p">.</span><span class="n">INGRESOS</span><span class="p">,</span>
<span class="w">    </span><span class="n">Ej</span><span class="p">.</span><span class="n">INGRESOS_OPERACIONALES</span><span class="p">,</span>
<span class="w">    </span><span class="n">Ej</span><span class="p">.</span><span class="n">GASTOS</span><span class="p">,</span>
<span class="w">    </span><span class="n">Ej</span><span class="p">.</span><span class="n">GASTOS_OPERACIONALES</span><span class="p">,</span>
<span class="w">    </span><span class="n">Ej</span><span class="p">.</span><span class="n">GASTOS_OPERACIONALES_ADMIN</span><span class="p">,</span>
<span class="w">    </span><span class="n">Ej</span><span class="p">.</span><span class="n">RESULTADO_EJERCICIO</span><span class="p">,</span>
<span class="w">    </span><span class="n">Ej</span><span class="p">.</span><span class="n">COSTOS</span><span class="p">,</span>
<span class="w">    </span><span class="n">Ej</span><span class="p">.</span><span class="n">ACTIVO</span><span class="p">,</span>
<span class="w">    </span><span class="n">Ej</span><span class="p">.</span><span class="n">PASIVO</span><span class="p">,</span>
<span class="w">    </span><span class="n">Ej</span><span class="p">.</span><span class="n">PATRIMONIO</span><span class="p">,</span>
<span class="w">    </span><span class="n">Ej</span><span class="p">.</span><span class="n">GASTOS_CON_DISTRIBUCION</span><span class="p">,</span>
<span class="w">    </span><span class="n">Ej</span><span class="p">.</span><span class="n">GASTOS_SIN_DISTRIBUCION</span><span class="p">,</span>
<span class="w">    </span><span class="k">Case</span><span class="w"> </span><span class="k">When</span><span class="w"> </span><span class="n">Ej</span><span class="p">.</span><span class="n">TIPO_CUENTA</span><span class="w"> </span><span class="k">In</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;INGRESOS&#39;</span><span class="p">,</span><span class="s1">&#39;COSTOS&#39;</span><span class="p">,</span><span class="s1">&#39;GASTOS&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">Then</span><span class="w"> </span><span class="s1">&#39;PYG&#39;</span><span class="w"> </span><span class="k">Else</span><span class="w"> </span><span class="s1">&#39;BALANCE&#39;</span><span class="w"> </span><span class="k">End</span><span class="w"> </span><span class="k">As</span><span class="w"> </span><span class="n">TIPO</span>
<span class="w">    </span><span class="p">,</span><span class="s1">&#39;PRESUPUESTO_CONTABLE&#39;</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">ACTIVIDAD</span><span class="p">,</span>
<span class="w">     </span><span class="s1">&#39;Consulta Fact Presupuesto Comfenalco&#39;</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">FUENTE_PRINCIPAL</span>
<span class="k">FROM</span>
<span class="p">(</span>

<span class="w">    </span><span class="k">SELECT</span>
<span class="w">        </span><span class="n">Tp</span><span class="p">.[</span><span class="n">ID_ANIO</span><span class="p">],</span>
<span class="w">        </span><span class="n">Tp</span><span class="p">.[</span><span class="n">ID_MES</span><span class="p">],</span>
<span class="w">        </span><span class="n">Ft</span><span class="p">.[</span><span class="n">ID_CEBE</span><span class="p">],</span>
<span class="w">        </span><span class="n">Uo</span><span class="p">.[</span><span class="n">CEBE</span><span class="p">],</span>
<span class="w">        </span><span class="k">Upper</span><span class="p">(</span><span class="n">Uo</span><span class="p">.[</span><span class="n">CEBE_DESCRIPCION</span><span class="p">])</span><span class="w"> </span><span class="k">As</span><span class="w"> </span><span class="p">[</span><span class="n">DESCRIPCION_CEBE</span><span class="p">],</span>
<span class="w">        </span><span class="k">Upper</span><span class="p">(</span><span class="n">Uo</span><span class="p">.[</span><span class="n">DEPARTAMENTO</span><span class="p">])</span><span class="k">As</span><span class="w">  </span><span class="p">[</span><span class="n">DEPARTAMENTO</span><span class="p">],</span>
<span class="w">        </span><span class="k">Upper</span><span class="p">(</span><span class="n">Uo</span><span class="p">.[</span><span class="n">AREA</span><span class="p">])</span><span class="w">        </span><span class="k">As</span><span class="w">  </span><span class="p">[</span><span class="n">AREA</span><span class="p">],</span>
<span class="w">        </span><span class="k">Upper</span><span class="p">(</span><span class="n">Uo</span><span class="p">.[</span><span class="n">SUBAREA</span><span class="p">])</span><span class="w">     </span><span class="k">As</span><span class="w">  </span><span class="p">[</span><span class="n">SUBAREA</span><span class="p">],</span>
<span class="w">        </span><span class="n">Uo</span><span class="p">.[</span><span class="n">SEGMENTO</span><span class="p">],</span>
<span class="w">        </span><span class="n">Uo</span><span class="p">.[</span><span class="n">DESCRIPCION_SEGMENTO</span><span class="p">],</span>
<span class="w">        </span><span class="n">Uo</span><span class="p">.[</span><span class="n">CODIGO_SSF</span><span class="p">],</span>
<span class="w">        </span><span class="n">Uo</span><span class="p">.[</span><span class="n">NOMBRE_SSF</span><span class="p">],</span>
<span class="w">        </span><span class="n">Ft</span><span class="p">.[</span><span class="n">ID_CUENTA</span><span class="p">],</span>
<span class="w">        </span><span class="n">Ct</span><span class="p">.[</span><span class="n">CUENTA</span><span class="p">],</span>
<span class="w">        </span><span class="n">Ct</span><span class="p">.[</span><span class="n">CUENTA_HOMOLOGA</span><span class="p">],</span>
<span class="w">        </span><span class="k">Upper</span><span class="p">(</span><span class="n">Ct</span><span class="p">.[</span><span class="n">DESCRIPCION</span><span class="p">])</span><span class="w">     </span><span class="k">As</span><span class="w">  </span><span class="p">[</span><span class="n">DESCRIPCION</span><span class="p">],</span>
<span class="w">        </span><span class="k">Upper</span><span class="p">(</span><span class="n">Ct</span><span class="p">.[</span><span class="n">TIPO_CUENTA</span><span class="p">])</span><span class="w">     </span><span class="k">As</span><span class="w">  </span><span class="p">[</span><span class="n">TIPO_CUENTA</span><span class="p">],</span>
<span class="w">        </span><span class="k">Upper</span><span class="p">(</span><span class="n">Ct</span><span class="p">.[</span><span class="n">TIPO_OPERACION</span><span class="p">])</span><span class="w">  </span><span class="k">As</span><span class="w">  </span><span class="p">[</span><span class="n">TIPO_OPERACION</span><span class="p">],</span>
<span class="w">        </span><span class="k">Upper</span><span class="p">(</span><span class="n">Ct</span><span class="p">.[</span><span class="n">GRUPO_CUENTA</span><span class="p">])</span><span class="w">    </span><span class="k">As</span><span class="w">  </span><span class="p">[</span><span class="n">GRUPO_CUENTA</span><span class="p">],</span>
<span class="w">        </span><span class="k">Upper</span><span class="p">(</span><span class="n">Ct</span><span class="p">.[</span><span class="n">SUBGRUPO_CUENTA</span><span class="p">])</span><span class="w"> </span><span class="k">As</span><span class="w">  </span><span class="p">[</span><span class="n">SUBGRUPO_CUENTA</span><span class="p">],</span>
<span class="w">        </span><span class="k">Upper</span><span class="p">(</span><span class="n">Ct</span><span class="p">.[</span><span class="n">GRUPO_OPERACION</span><span class="p">])</span><span class="w"> </span><span class="k">As</span><span class="w">  </span><span class="p">[</span><span class="n">GRUPO_OPERACION</span><span class="p">],</span>
<span class="w">        </span><span class="n">Ct</span><span class="p">.[</span><span class="n">CUENTA_SSF</span><span class="p">],</span>
<span class="w">        </span><span class="k">Upper</span><span class="p">(</span><span class="n">Ct</span><span class="p">.[</span><span class="n">DESCRIPCION_SSF</span><span class="p">])</span><span class="w">         </span><span class="k">As</span><span class="w">  </span><span class="p">[</span><span class="n">DESCRIPCION_SSF</span><span class="p">],</span>
<span class="w">        </span><span class="k">Upper</span><span class="p">(</span><span class="n">Ct</span><span class="p">.[</span><span class="n">CUENTA_DESCRIPCION</span><span class="p">])</span><span class="w">      </span><span class="k">As</span><span class="w">  </span><span class="p">[</span><span class="n">CUENTA_DESCRIPCION</span><span class="p">],</span>
<span class="w">        </span><span class="k">Upper</span><span class="p">(</span><span class="n">Ct</span><span class="p">.[</span><span class="n">CUENTA_DESCRIPCION_SSF</span><span class="p">])</span><span class="w">  </span><span class="k">As</span><span class="w">  </span><span class="p">[</span><span class="n">CUENTA_DESCRIPCION_SSF</span><span class="p">],</span>
<span class="w">        </span><span class="n">Ct</span><span class="p">.[</span><span class="n">SIGNO_INGRESOS</span><span class="p">],</span>
<span class="w">        </span><span class="n">Ct</span><span class="p">.[</span><span class="n">CLASIFICACION</span><span class="p">],</span>
<span class="w">        </span><span class="n">Ft</span><span class="p">.[</span><span class="n">SEGMENT</span><span class="p">],</span>
<span class="w">        </span><span class="n">Try_Convert</span><span class="p">(</span><span class="nb">Numeric</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span><span class="k">Sum</span><span class="p">(</span><span class="k">isnull</span><span class="p">(</span><span class="n">Ft</span><span class="p">.[</span><span class="n">VALOR</span><span class="p">],</span><span class="mi">0</span><span class="p">)))</span><span class="w">                    </span><span class="k">As</span><span class="w">  </span><span class="p">[</span><span class="n">IMPORTE</span><span class="p">],</span>
<span class="w">        </span><span class="n">Try_Convert</span><span class="p">(</span><span class="nb">Numeric</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span><span class="k">Sum</span><span class="p">(</span><span class="k">isnull</span><span class="p">(</span><span class="n">Ft</span><span class="p">.[</span><span class="n">INGRESOS</span><span class="p">],</span><span class="mi">0</span><span class="p">)))</span><span class="w">                 </span><span class="k">As</span><span class="w">  </span><span class="p">[</span><span class="n">INGRESOS</span><span class="p">],</span>
<span class="w">        </span><span class="n">Try_Convert</span><span class="p">(</span><span class="nb">Numeric</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span><span class="k">Sum</span><span class="p">(</span><span class="k">isnull</span><span class="p">(</span><span class="n">Ft</span><span class="p">.[</span><span class="n">INGRESOS_OPERACIONALES</span><span class="p">],</span><span class="mi">0</span><span class="p">)))</span><span class="w">   </span><span class="k">As</span><span class="w">  </span><span class="p">[</span><span class="n">INGRESOS_OPERACIONALES</span><span class="p">],</span>
<span class="w">        </span><span class="n">Try_Convert</span><span class="p">(</span><span class="nb">Numeric</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span><span class="k">Sum</span><span class="p">(</span><span class="k">isnull</span><span class="p">(</span><span class="n">Ft</span><span class="p">.[</span><span class="n">GASTOS</span><span class="p">],</span><span class="mi">0</span><span class="p">)))</span><span class="w">                   </span><span class="k">As</span><span class="w">  </span><span class="p">[</span><span class="n">GASTOS</span><span class="p">],</span>
<span class="w">        </span><span class="n">Try_Convert</span><span class="p">(</span><span class="nb">Numeric</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span><span class="k">Sum</span><span class="p">(</span><span class="k">isnull</span><span class="p">(</span><span class="n">Ft</span><span class="p">.[</span><span class="n">GASTOS_OPERACIONALES</span><span class="p">],</span><span class="mi">0</span><span class="p">)))</span><span class="w">         </span><span class="k">As</span><span class="w">  </span><span class="p">[</span><span class="n">GASTOS_OPERACIONALES</span><span class="p">],</span>
<span class="w">        </span><span class="n">Try_Convert</span><span class="p">(</span><span class="nb">Numeric</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span><span class="k">Sum</span><span class="p">(</span><span class="k">isnull</span><span class="p">(</span><span class="n">Ft</span><span class="p">.[</span><span class="n">GASTOS_OPERACIONALES_ADMIN</span><span class="p">],</span><span class="mi">0</span><span class="p">)))</span><span class="w">   </span><span class="k">As</span><span class="w">  </span><span class="p">[</span><span class="n">GASTOS_OPERACIONALES_ADMIN</span><span class="p">],</span>
<span class="w">        </span><span class="mi">0</span><span class="w"> </span><span class="k">As</span><span class="w">    </span><span class="p">[</span><span class="n">RESULTADO_EJERCICIO</span><span class="p">],</span>
<span class="w">        </span><span class="n">Try_Convert</span><span class="p">(</span><span class="nb">Numeric</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span><span class="k">Sum</span><span class="p">(</span><span class="k">isnull</span><span class="p">(</span><span class="n">Ft</span><span class="p">.[</span><span class="n">COSTOS</span><span class="p">],</span><span class="mi">0</span><span class="p">)))</span><span class="w">                   </span><span class="k">As</span><span class="w">  </span><span class="p">[</span><span class="n">COSTOS</span><span class="p">],</span>
<span class="w">        </span><span class="mi">0</span><span class="w">   </span><span class="k">As</span><span class="w">  </span><span class="p">[</span><span class="n">ACTIVO</span><span class="p">],</span>
<span class="w">        </span><span class="mi">0</span><span class="w">   </span><span class="k">As</span><span class="w">  </span><span class="p">[</span><span class="n">PASIVO</span><span class="p">],</span>
<span class="w">        </span><span class="mi">0</span><span class="w">   </span><span class="k">As</span><span class="w">  </span><span class="p">[</span><span class="n">PATRIMONIO</span><span class="p">],</span>
<span class="w">        </span><span class="n">Try_Convert</span><span class="p">(</span><span class="nb">Numeric</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span><span class="k">Sum</span><span class="p">(</span><span class="k">isnull</span><span class="p">(</span><span class="n">Ft</span><span class="p">.[</span><span class="n">GASTOS_CON_DISTRIBUCION</span><span class="p">],</span><span class="mi">0</span><span class="p">)))</span><span class="w">  </span><span class="k">As</span><span class="w">  </span><span class="p">[</span><span class="n">GASTOS_CON_DISTRIBUCION</span><span class="p">],</span><span class="w">  </span>
<span class="w">        </span><span class="n">Try_Convert</span><span class="p">(</span><span class="nb">Numeric</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span><span class="k">Sum</span><span class="p">(</span><span class="k">isnull</span><span class="p">(</span><span class="n">Ft</span><span class="p">.[</span><span class="n">GASTOS_SIN_DISTRIBUCION</span><span class="p">],</span><span class="mi">0</span><span class="p">)))</span><span class="w">  </span><span class="k">As</span><span class="w">  </span><span class="p">[</span><span class="n">GASTOS_SIN_DISTRIBUCION</span><span class="p">]</span>

<span class="w">      </span><span class="k">FROM</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Financiera</span><span class="p">].[</span><span class="n">FACT_PRESUPUESTO</span><span class="p">]</span><span class="w"> </span><span class="n">FT</span>
<span class="w">      </span><span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Financiera</span><span class="p">].[</span><span class="n">DIM_UNIDADES_ORGANIZATIVAS</span><span class="p">]</span><span class="w"> </span><span class="n">Uo</span><span class="w"> </span><span class="k">On</span><span class="w">  </span><span class="n">Ft</span><span class="p">.</span><span class="n">ID_CEBE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Uo</span><span class="p">.</span><span class="n">ID_CEBE</span>
<span class="w">      </span><span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Financiera</span><span class="p">].[</span><span class="n">DIM_CUENTA_CONTABLE</span><span class="p">]</span><span class="w"> </span><span class="n">Ct</span><span class="w"> </span><span class="k">On</span><span class="w">  </span><span class="n">Ft</span><span class="p">.</span><span class="n">ID_CUENTA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ct</span><span class="p">.</span><span class="n">ID_CUENTA</span>
<span class="w">      </span><span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Dwh</span><span class="p">].[</span><span class="n">DIM_TIEMPO</span><span class="p">]</span><span class="w"> </span><span class="n">Tp</span><span class="w"> </span><span class="k">On</span><span class="w">  </span><span class="n">Ft</span><span class="p">.</span><span class="n">ID_FECHA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tp</span><span class="p">.</span><span class="n">ID_FECHA</span>
<span class="w">      </span><span class="k">Where</span><span class="w"> </span><span class="cm">/*tp.ID_ANIO = @Año_Actual</span>
<span class="cm">        And Try_convert(date,tp.FECHA,103) &lt;= @PeriodoMax</span>
<span class="cm">        and */</span><span class="w"> </span><span class="c1">--Ct.TIPO_CUENTA Not in  (&#39;INGRESOS&#39;,&#39;COSTOS&#39;,&#39;GASTOS&#39;)</span>
<span class="w">        </span><span class="n">Ct</span><span class="p">.</span><span class="n">TIPO_CUENTA</span><span class="w"> </span><span class="k">in</span><span class="w">  </span><span class="p">(</span><span class="s1">&#39;INGRESOS&#39;</span><span class="p">,</span><span class="s1">&#39;COSTOS&#39;</span><span class="p">,</span><span class="s1">&#39;GASTOS&#39;</span><span class="p">)</span>
<span class="w">        </span><span class="k">And</span><span class="w"> </span><span class="n">ft</span><span class="p">.</span><span class="n">ID_TIPO_PRESUPUESTO</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="w">  </span><span class="cm">/*Aprobado*/</span>

<span class="w">      </span><span class="k">Group</span><span class="w"> </span><span class="k">by</span><span class="w"> </span>

<span class="w">        </span><span class="n">Tp</span><span class="p">.[</span><span class="n">ID_ANIO</span><span class="p">],</span><span class="n">Tp</span><span class="p">.[</span><span class="n">ID_MES</span><span class="p">],</span><span class="n">Ft</span><span class="p">.[</span><span class="n">ID_CEBE</span><span class="p">],</span><span class="w"> </span><span class="n">Uo</span><span class="p">.[</span><span class="n">CEBE</span><span class="p">],</span><span class="n">Uo</span><span class="p">.[</span><span class="n">CEBE_DESCRIPCION</span><span class="p">],</span><span class="n">Uo</span><span class="p">.[</span><span class="n">DEPARTAMENTO</span><span class="p">],</span><span class="n">Uo</span><span class="p">.[</span><span class="n">AREA</span><span class="p">],</span><span class="n">Uo</span><span class="p">.[</span><span class="n">SUBAREA</span><span class="p">],</span><span class="n">Uo</span><span class="p">.[</span><span class="n">SEGMENTO</span><span class="p">],</span>
<span class="w">        </span><span class="n">Uo</span><span class="p">.[</span><span class="n">DESCRIPCION_SEGMENTO</span><span class="p">],</span><span class="w"> </span><span class="n">Uo</span><span class="p">.[</span><span class="n">CODIGO_SSF</span><span class="p">],</span><span class="n">Uo</span><span class="p">.[</span><span class="n">NOMBRE_SSF</span><span class="p">],</span><span class="n">Ft</span><span class="p">.[</span><span class="n">ID_CUENTA</span><span class="p">],</span><span class="n">Ct</span><span class="p">.[</span><span class="n">CUENTA</span><span class="p">],</span>
<span class="w">        </span><span class="n">Ct</span><span class="p">.[</span><span class="n">CUENTA_HOMOLOGA</span><span class="p">],</span><span class="n">Ct</span><span class="p">.[</span><span class="n">DESCRIPCION</span><span class="p">],</span><span class="n">Ct</span><span class="p">.[</span><span class="n">TIPO_CUENTA</span><span class="p">],</span><span class="n">Ct</span><span class="p">.[</span><span class="n">TIPO_OPERACION</span><span class="p">],</span><span class="n">Ct</span><span class="p">.[</span><span class="n">GRUPO_CUENTA</span><span class="p">],</span>
<span class="w">        </span><span class="n">Ct</span><span class="p">.[</span><span class="n">SUBGRUPO_CUENTA</span><span class="p">],</span><span class="n">Ct</span><span class="p">.[</span><span class="n">GRUPO_OPERACION</span><span class="p">],</span><span class="n">Ct</span><span class="p">.[</span><span class="n">CUENTA_SSF</span><span class="p">],</span><span class="n">Ct</span><span class="p">.[</span><span class="n">DESCRIPCION_SSF</span><span class="p">],</span><span class="n">Ct</span><span class="p">.[</span><span class="n">CUENTA_DESCRIPCION</span><span class="p">],</span>
<span class="w">        </span><span class="n">Ct</span><span class="p">.[</span><span class="n">CUENTA_DESCRIPCION_SSF</span><span class="p">],</span><span class="n">Ct</span><span class="p">.[</span><span class="n">SIGNO_INGRESOS</span><span class="p">],</span><span class="n">Ct</span><span class="p">.[</span><span class="n">CLASIFICACION</span><span class="p">],</span><span class="n">Ft</span><span class="p">.[</span><span class="n">SEGMENT</span><span class="p">]</span>
<span class="w"> </span><span class="p">)</span><span class="n">Ej</span>
<span class="w">     </span><span class="c1">--Order by Ej.[ID_ANIO],Ej.[ID_MES],Ej.[ID_CEBE]</span>
<span class="p">)</span>

<span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="n">Ej</span><span class="p">.</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="n">ID_UNIDAD</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">EjecucionContable</span><span class="w"> </span><span class="n">Ej</span>
<span class="w"> </span><span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Transversal</span><span class="p">].[</span><span class="n">DIM_UNIDADES_ORGANIZATIVAS</span><span class="p">]</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">Ej</span><span class="p">.</span><span class="n">ID_CEBE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">do</span><span class="p">.</span><span class="n">ID_CEBE</span>
<span class="w"> </span><span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Transversal</span><span class="p">].[</span><span class="n">DIM_TIEMPO_MENSUAL</span><span class="p">]</span><span class="w"> </span><span class="n">dimM</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">Ej</span><span class="p">.</span><span class="n">ID_FECHA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dimM</span><span class="p">.</span><span class="n">ID_FECHA</span>


<span class="k">union</span><span class="w"> </span><span class="k">ALL</span>
<span class="k">SELECT</span><span class="w"> </span><span class="n">Ej</span><span class="p">.</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="n">ID_UNIDAD</span>
<span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">PresupuestoContable</span><span class="w"> </span><span class="n">Ej</span>
<span class="w"> </span><span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Transversal</span><span class="p">].[</span><span class="n">DIM_UNIDADES_ORGANIZATIVAS</span><span class="p">]</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">Ej</span><span class="p">.</span><span class="n">ID_CEBE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">do</span><span class="p">.</span><span class="n">ID_CEBE</span>
<span class="w"> </span><span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Transversal</span><span class="p">].[</span><span class="n">DIM_TIEMPO_MENSUAL</span><span class="p">]</span><span class="w"> </span><span class="n">dimM</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">Ej</span><span class="p">.</span><span class="n">ID_FECHA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dimM</span><span class="p">.</span><span class="n">ID_FECHA</span>
</code></pre></div>
<h3 id="procesar-fact_unidadescobertura-proyectada"><strong>Procesar FACT_UNIDADES\Cobertura Proyectada</strong><a class="headerlink" href="#procesar-fact_unidadescobertura-proyectada" title="Permanent link">&para;</a></h3>
<h4 id="ruta-del-componente"><strong>Ruta del Componente:</strong><a class="headerlink" href="#ruta-del-componente" title="Permanent link">&para;</a></h4>
<p><code>Package\Procesar FACT_UNIDADES\Cobertura Proyectada</code></p>
<hr />
<h4 id="descripcion-general_17">Descripción General<a class="headerlink" href="#descripcion-general_17" title="Permanent link">&para;</a></h4>
<p>Este componente de flujo de datos consolida y transforma información de cobertura proyectada mensual desde múltiples dominios del sistema (Colegio, Cedesarrollo, Protección Social y Adulto con Discapacidad), integrando fuentes dispersas en una única tabla de hechos: <code>Transversal.FACT_UNIDADES</code>.</p>
<hr />
<h4 id="ubicacion-dentro-del-paquete_2">Ubicación dentro del Paquete<a class="headerlink" href="#ubicacion-dentro-del-paquete_2" title="Permanent link">&para;</a></h4>
<p>Se encuentra dentro del <code>Data Flow Task</code> llamado <strong>Cobertura Proyectada</strong>, parte del contenedor <code>Procesar FACT_UNIDADES</code>.</p>
<hr />
<h4 id="proposito-del-componente_3">Propósito del Componente<a class="headerlink" href="#proposito-del-componente_3" title="Permanent link">&para;</a></h4>
<p>Su objetivo es centralizar la proyección de cobertura mensual institucionalizada, combinando proyecciones educativas, programas sociales y planes de atención, lo que facilita el análisis estratégico por unidad, grado, programa o tipo de cobertura.</p>
<hr />
<h4 id="detalles-de-implementacion_21">Detalles de Implementación<a class="headerlink" href="#detalles-de-implementacion_21" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p><strong>Origen de Datos</strong>:
  Fuente ADO.NET configurada con <code>AccessMode = 2</code>, ejecutando un script SQL con múltiples CTEs (<code>WITH</code>) y <code>UNION ALL</code>.</p>
</li>
<li>
<p><strong>Destino</strong>:
  Componente ADO.NET de carga hacia la tabla <code>"Transversal"."FACT_UNIDADES"</code>, optimizado con inserciones masivas (<code>UseBulkInsertWhenPossible = true</code>).</p>
</li>
<li>
<p><strong>Relación con otros componentes</strong>:</p>
<ul>
<li>Utiliza la dimensión <code>DIM_TIEMPO_MENSUAL</code> como validador temporal.</li>
<li>
<p>Consolida datos de:</p>
<ul>
<li><code>[Colegio].[DIM_PRESUPUESTO]</code></li>
<li><code>[Cedesarrollo].[FACT_PLAN_COBERTURA]</code></li>
<li><code>[Proteccion].[FACT_PLAN_COBERTURA]</code></li>
<li><code>[Proteccion].[FACT_PLAN_COBERTURA_ADULTO_DISCAPACIDAD]</code></li>
</ul>
</li>
</ul>
</li>
</ul>
<hr />
<h4 id="logica-de-negocio_19">Lógica de Negocio<a class="headerlink" href="#logica-de-negocio_19" title="Permanent link">&para;</a></h4>
<ul>
<li>Se generan tres calendarios mensuales (Colegio, Cedesarrollo y Protección).</li>
<li>Las coberturas proyectadas se asignan a <code>ID_UNIDAD</code>, <code>CATEGORIA</code>, <code>ID_PROGRAMA</code> y <code>ID_FECHA_MENSUAL</code>.</li>
<li>Se hace mapeo categórico explícito en Cedesarrollo (categorías A, B, C...).</li>
<li>Se utiliza <code>UNION ALL</code> para combinar resultados homogéneos, todos marcados con <code>'COBERTURA PROYECTADA'</code> en el campo <code>ACTIVIDAD</code>.</li>
</ul>
<hr />
<h4 id="sql-del-componente-completo">SQL del Componente (completo)<a class="headerlink" href="#sql-del-componente-completo" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="k">WITH</span><span class="w"> </span><span class="n">CalendarioMensualColegio</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="k">SELECT</span><span class="w"> </span>
<span class="w">        </span><span class="n">AñoPresupuesto</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">10000</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">Mes</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mi">100</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">01</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_FECHA_MENSUAL</span><span class="p">,</span>
<span class="w">        </span><span class="n">AñoPresupuesto</span><span class="p">,</span>
<span class="w">        </span><span class="n">Mes</span>
<span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="p">(</span>
<span class="w">        </span><span class="k">SELECT</span><span class="w"> </span><span class="k">DISTINCT</span><span class="w"> </span><span class="p">[</span><span class="n">ID_ANIO_PRESUPUESTO</span><span class="p">]</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">AñoPresupuesto</span>
<span class="w">        </span><span class="k">FROM</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Colegio</span><span class="p">].[</span><span class="n">DIM_PRESUPUESTO</span><span class="p">]</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">Años</span>
<span class="w">    </span><span class="k">CROSS</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="p">(</span>
<span class="w">        </span><span class="k">SELECT</span><span class="w"> </span><span class="mi">101</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">Mes</span><span class="w"> </span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="mi">102</span><span class="w"> </span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="mi">103</span><span class="w"> </span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span>
<span class="w">        </span><span class="k">SELECT</span><span class="w"> </span><span class="mi">104</span><span class="w"> </span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="mi">105</span><span class="w"> </span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="mi">106</span><span class="w"> </span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span>
<span class="w">        </span><span class="k">SELECT</span><span class="w"> </span><span class="mi">107</span><span class="w"> </span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="mi">108</span><span class="w"> </span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="mi">109</span><span class="w"> </span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span>
<span class="w">        </span><span class="k">SELECT</span><span class="w"> </span><span class="mi">110</span><span class="w"> </span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="mi">111</span><span class="w"> </span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="mi">112</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">Meses</span>
<span class="p">),</span>
<span class="n">CoberturaProyectadaColegio</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="n">DP</span><span class="p">.[</span><span class="n">ID_CURSO</span><span class="p">],</span><span class="w"> </span><span class="n">DP</span><span class="p">.[</span><span class="n">GRADO</span><span class="p">],</span><span class="w"> </span><span class="n">CM</span><span class="p">.</span><span class="n">ID_FECHA_MENSUAL</span><span class="p">,</span>
<span class="w">           </span><span class="s1">&#39;DIM_PRESUPUESTO&#39;</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ORIGEN</span><span class="p">,</span>
<span class="w">           </span><span class="s1">&#39;[DWH_COMFENALCO].[Colegio].[DIM_PRESUPUESTO]&#39;</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">FUENTE_PRINCIPAL</span><span class="p">,</span>
<span class="w">           </span><span class="k">MAX</span><span class="p">(</span><span class="n">DP</span><span class="p">.</span><span class="n">POBL_PROYECT</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">POBL_PROYECT</span>
<span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Colegio</span><span class="p">].[</span><span class="n">DIM_PRESUPUESTO</span><span class="p">]</span><span class="w"> </span><span class="n">DP</span>
<span class="w">    </span><span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">CalendarioMensualColegio</span><span class="w"> </span><span class="n">CM</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">DP</span><span class="p">.[</span><span class="n">ID_ANIO_PRESUPUESTO</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CM</span><span class="p">.</span><span class="n">AñoPresupuesto</span>
<span class="w">    </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">DP</span><span class="p">.[</span><span class="n">ID_CURSO</span><span class="p">],</span><span class="w"> </span><span class="n">DP</span><span class="p">.[</span><span class="n">GRADO</span><span class="p">],</span><span class="w"> </span><span class="n">CM</span><span class="p">.</span><span class="n">ID_FECHA_MENSUAL</span>
<span class="p">),</span>
<span class="n">CoberturaProyectadaColegioMensual</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="p">[</span><span class="n">ID_CURSO</span><span class="p">],</span><span class="w"> </span><span class="p">[</span><span class="n">GRADO</span><span class="p">],</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_UNIDAD</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">CATEGORIA</span><span class="p">,</span>
<span class="w">           </span><span class="k">NULL</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_PLAN_COBERTURA</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_ESTABLECIMIENTO_EDUCATIVO</span><span class="p">,</span>
<span class="w">           </span><span class="k">NULL</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_PROGRAMA</span><span class="p">,</span><span class="w"> </span><span class="n">ID_FECHA_MENSUAL</span><span class="p">,</span>
<span class="w">           </span><span class="k">SUM</span><span class="p">(</span><span class="k">CAST</span><span class="p">(</span><span class="n">POBL_PROYECT</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="nb">INT</span><span class="p">))</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">POBLACION_PROYECTADA</span><span class="p">,</span>
<span class="w">           </span><span class="n">ORIGEN</span><span class="p">,</span><span class="w"> </span><span class="n">FUENTE_PRINCIPAL</span>
<span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">CoberturaProyectadaColegio</span>
<span class="w">    </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="p">[</span><span class="n">ID_CURSO</span><span class="p">],</span><span class="w"> </span><span class="p">[</span><span class="n">GRADO</span><span class="p">],</span><span class="w"> </span><span class="n">ID_FECHA_MENSUAL</span><span class="p">,</span><span class="w"> </span><span class="n">ORIGEN</span><span class="p">,</span><span class="w"> </span><span class="n">FUENTE_PRINCIPAL</span>
<span class="p">),</span>
<span class="n">FechasMensualesCedesarrollo</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="n">Año</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">10000</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">Mes</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mi">100</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">01</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_FECHA_MENSUAL</span><span class="p">,</span>
<span class="w">           </span><span class="n">Año</span><span class="p">,</span><span class="w"> </span><span class="n">Mes</span><span class="p">,</span>
<span class="w">           </span><span class="k">CASE</span><span class="w"> </span>
<span class="w">             </span><span class="k">WHEN</span><span class="w"> </span><span class="p">(</span><span class="n">Mes</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mi">100</span><span class="p">)</span><span class="w"> </span><span class="k">BETWEEN</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="mi">6</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="n">Año</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">10000</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">101</span>
<span class="w">             </span><span class="k">WHEN</span><span class="w"> </span><span class="p">(</span><span class="n">Mes</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mi">100</span><span class="p">)</span><span class="w"> </span><span class="k">BETWEEN</span><span class="w"> </span><span class="mi">7</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="mi">12</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="n">Año</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">10000</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">701</span>
<span class="w">           </span><span class="k">END</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_FECHA_INICIO_SEMESTRE</span>
<span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="p">(</span>
<span class="w">        </span><span class="k">SELECT</span><span class="w"> </span><span class="k">DISTINCT</span><span class="w"> </span><span class="k">YEAR</span><span class="p">(</span><span class="n">pa</span><span class="p">.[</span><span class="n">FECHA_INICIO</span><span class="p">])</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">Año</span>
<span class="w">        </span><span class="k">FROM</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Cedesarrollo</span><span class="p">].[</span><span class="n">FACT_PLAN_COBERTURA</span><span class="p">]</span><span class="w"> </span><span class="n">up</span>
<span class="w">        </span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Cedesarrollo</span><span class="p">].[</span><span class="n">DIM_PERIODO_ACADEMICO</span><span class="p">]</span><span class="w"> </span><span class="n">pa</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">up</span><span class="p">.</span><span class="n">ID_PERIODO</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pa</span><span class="p">.</span><span class="n">ID_PERIODO</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">Anios</span>
<span class="w">    </span><span class="k">CROSS</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="p">(</span>
<span class="w">        </span><span class="k">SELECT</span><span class="w"> </span><span class="mi">101</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">Mes</span><span class="w"> </span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="mi">102</span><span class="w"> </span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="mi">103</span><span class="w"> </span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span>
<span class="w">        </span><span class="k">SELECT</span><span class="w"> </span><span class="mi">104</span><span class="w"> </span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="mi">105</span><span class="w"> </span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="mi">106</span><span class="w"> </span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span>
<span class="w">        </span><span class="k">SELECT</span><span class="w"> </span><span class="mi">107</span><span class="w"> </span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="mi">108</span><span class="w"> </span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="mi">109</span><span class="w"> </span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span>
<span class="w">        </span><span class="k">SELECT</span><span class="w"> </span><span class="mi">110</span><span class="w"> </span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="mi">111</span><span class="w"> </span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="mi">112</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">Meses</span>
<span class="p">),</span>
<span class="n">CoberturaCedesarrollo</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="n">FORMAT</span><span class="p">([</span><span class="n">FECHA_INICIO</span><span class="p">],</span><span class="w"> </span><span class="s1">&#39;yyyyMMdd&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_FECHA_INICIO_SEMESTRE</span><span class="p">,</span>
<span class="w">           </span><span class="n">up</span><span class="p">.[</span><span class="n">ID_UNIDAD</span><span class="p">],</span>
<span class="w">           </span><span class="k">CASE</span><span class="w"> </span>
<span class="w">             </span><span class="k">WHEN</span><span class="w"> </span><span class="n">CATEGORIA</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Categoría_A&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Categoría_ A&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="mi">1</span>
<span class="w">             </span><span class="k">WHEN</span><span class="w"> </span><span class="n">CATEGORIA</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Categoría_B&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Categoría_ B&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="mi">2</span>
<span class="w">             </span><span class="k">WHEN</span><span class="w"> </span><span class="n">CATEGORIA</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;C&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Categoría_C&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Categoría_ C&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="mi">3</span>
<span class="w">             </span><span class="k">WHEN</span><span class="w"> </span><span class="n">CATEGORIA</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Categoría_D&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Categoría_ D&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="mi">4</span>
<span class="w">             </span><span class="k">WHEN</span><span class="w"> </span><span class="n">CATEGORIA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Convenios&#39;</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="mi">10</span>
<span class="w">             </span><span class="k">WHEN</span><span class="w"> </span><span class="n">CATEGORIA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Empresa Afiliada&#39;</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="mi">5</span>
<span class="w">             </span><span class="k">WHEN</span><span class="w"> </span><span class="n">CATEGORIA</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;Fondo de Ley_FOSFEC&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;FOSFEC&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="mi">6</span>
<span class="w">             </span><span class="k">ELSE</span><span class="w"> </span><span class="mi">4</span>
<span class="w">           </span><span class="k">END</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">CATEGORIA</span><span class="p">,</span>
<span class="w">           </span><span class="p">[</span><span class="n">ID_PROGRAMA</span><span class="p">],</span><span class="w"> </span><span class="p">[</span><span class="n">USUARIOS_PROYECTADOS</span><span class="p">],</span>
<span class="w">           </span><span class="s1">&#39;FACT_PLAN_COBERTURA&#39;</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ORIGEN</span><span class="p">,</span>
<span class="w">           </span><span class="s1">&#39;[DWH_COMFENALCO].[Cedesarrollo].[FACT_PLAN_COBERTURA]&#39;</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">FUENTE_PRINCIPAL</span>
<span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Cedesarrollo</span><span class="p">].[</span><span class="n">FACT_PLAN_COBERTURA</span><span class="p">]</span><span class="w"> </span><span class="n">up</span>
<span class="w">    </span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Cedesarrollo</span><span class="p">].[</span><span class="n">DIM_PERIODO_ACADEMICO</span><span class="p">]</span><span class="w"> </span><span class="n">pa</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">up</span><span class="p">.</span><span class="n">ID_PERIODO</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pa</span><span class="p">.</span><span class="n">ID_PERIODO</span>
<span class="p">),</span>
<span class="n">CoberturaCedesarrolloMensual</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_CURSO</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">GRADO</span><span class="p">,</span><span class="w"> </span><span class="k">COALESCE</span><span class="p">(</span><span class="n">ID_UNIDAD</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_UNIDAD</span><span class="p">,</span>
<span class="w">           </span><span class="n">CATEGORIA</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_PLAN_COBERTURA</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_ESTABLECIMIENTO_EDUCATIVO</span><span class="p">,</span>
<span class="w">           </span><span class="n">ID_PROGRAMA</span><span class="p">,</span><span class="w"> </span><span class="n">ID_FECHA_MENSUAL</span><span class="p">,</span>
<span class="w">           </span><span class="k">SUM</span><span class="p">(</span><span class="k">CAST</span><span class="p">(</span><span class="n">USUARIOS_PROYECTADOS</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="nb">INT</span><span class="p">))</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">POBLACION_PROYECTADA</span><span class="p">,</span>
<span class="w">           </span><span class="n">ORIGEN</span><span class="p">,</span><span class="w"> </span><span class="n">FUENTE_PRINCIPAL</span>
<span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">CoberturaCedesarrollo</span><span class="w"> </span><span class="n">cc</span>
<span class="w">    </span><span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">FechasMensualesCedesarrollo</span><span class="w"> </span><span class="n">fm</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">cc</span><span class="p">.</span><span class="n">ID_FECHA_INICIO_SEMESTRE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fm</span><span class="p">.</span><span class="n">ID_FECHA_INICIO_SEMESTRE</span>
<span class="w">    </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">ID_UNIDAD</span><span class="p">,</span><span class="w"> </span><span class="n">CATEGORIA</span><span class="p">,</span><span class="w"> </span><span class="n">ID_FECHA_MENSUAL</span><span class="p">,</span><span class="w"> </span><span class="n">ID_PROGRAMA</span><span class="p">,</span><span class="w"> </span><span class="n">ORIGEN</span><span class="p">,</span><span class="w"> </span><span class="n">FUENTE_PRINCIPAL</span>
<span class="p">),</span>
<span class="n">CalendarioMensualProteccion</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="n">AñoPresupuesto</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">10000</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">Mes</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mi">100</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">01</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_FECHA_MENSUAL</span><span class="p">,</span>
<span class="w">           </span><span class="n">AñoPresupuesto</span><span class="p">,</span><span class="w"> </span><span class="n">Mes</span>
<span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="p">(</span>
<span class="w">        </span><span class="k">SELECT</span><span class="w"> </span><span class="k">DISTINCT</span><span class="w"> </span><span class="p">[</span><span class="n">ANIO</span><span class="p">]</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">AñoPresupuesto</span>
<span class="w">        </span><span class="k">FROM</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Proteccion</span><span class="p">].[</span><span class="n">FACT_PLAN_COBERTURA</span><span class="p">]</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">Años</span>
<span class="w">    </span><span class="k">CROSS</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="p">(</span>
<span class="w">        </span><span class="k">SELECT</span><span class="w"> </span><span class="mi">101</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">Mes</span><span class="w"> </span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="mi">102</span><span class="w"> </span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="mi">103</span><span class="w"> </span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span>
<span class="w">        </span><span class="k">SELECT</span><span class="w"> </span><span class="mi">104</span><span class="w"> </span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="mi">105</span><span class="w"> </span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="mi">106</span><span class="w"> </span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span>
<span class="w">        </span><span class="k">SELECT</span><span class="w"> </span><span class="mi">107</span><span class="w"> </span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="mi">108</span><span class="w"> </span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="mi">109</span><span class="w"> </span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span>
<span class="w">        </span><span class="k">SELECT</span><span class="w"> </span><span class="mi">110</span><span class="w"> </span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="mi">111</span><span class="w"> </span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="mi">112</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">Meses</span>
<span class="p">),</span>
<span class="n">CoberturaProyectadaProteccion</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="p">[</span><span class="n">ID_PLAN_COBERTURA</span><span class="p">],</span><span class="w"> </span><span class="n">CM</span><span class="p">.</span><span class="n">ID_FECHA_MENSUAL</span><span class="p">,</span>
<span class="w">           </span><span class="p">[</span><span class="n">ID_ESTABLECIMIENTO_EDUCATIVO</span><span class="p">],</span><span class="w"> </span><span class="p">[</span><span class="n">ID_PROGRAMA</span><span class="p">],</span><span class="w"> </span><span class="p">[</span><span class="n">COBERTURA_PROYECTADA</span><span class="p">]</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">POBLACION_PROYECTADA</span><span class="p">,</span>
<span class="w">           </span><span class="s1">&#39;FACT_PLAN_COBERTURA&#39;</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ORIGEN</span><span class="p">,</span>
<span class="w">           </span><span class="s1">&#39;[DWH_COMFENALCO].[Proteccion].[FACT_PLAN_COBERTURA]&#39;</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">FUENTE_PRINCIPAL</span>
<span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Proteccion</span><span class="p">].[</span><span class="n">FACT_PLAN_COBERTURA</span><span class="p">]</span><span class="w"> </span><span class="n">pc</span>
<span class="w">    </span><span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">CalendarioMensualProteccion</span><span class="w"> </span><span class="n">CM</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">pc</span><span class="p">.</span><span class="n">ANIO</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CM</span><span class="p">.</span><span class="n">AñoPresupuesto</span>
<span class="p">),</span>
<span class="n">CoberturaProyectadaProteccionMensual</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_CURSO</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">GRADO</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_UNIDAD</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">CATEGORIA</span><span class="p">,</span>
<span class="w">           </span><span class="n">ID_PLAN_COBERTURA</span><span class="p">,</span><span class="w"> </span><span class="n">ID_ESTABLECIMIENTO_EDUCATIVO</span><span class="p">,</span><span class="w"> </span><span class="n">ID_PROGRAMA</span><span class="p">,</span>
<span class="w">           </span><span class="n">ID_FECHA_MENSUAL</span><span class="p">,</span><span class="w"> </span><span class="n">POBLACION_PROYECTADA</span><span class="p">,</span><span class="w"> </span><span class="n">ORIGEN</span><span class="p">,</span><span class="w"> </span><span class="n">FUENTE_PRINCIPAL</span>
<span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">CoberturaProyectadaProteccion</span>
<span class="p">),</span>
<span class="n">CoberturaProyectadaAdultoDiscapacidad</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_CURSO</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">GRADO</span><span class="p">,</span><span class="w"> </span><span class="n">ID_UNIDAD</span><span class="p">,</span><span class="w"> </span><span class="n">CATEGORIA_CCF</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">CATEGORIA</span><span class="p">,</span>
<span class="w">           </span><span class="n">ID_REGISTRO</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_PLAN_COBERTURA</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_ESTABLECIMIENTO_EDUCATIVO</span><span class="p">,</span>
<span class="w">           </span><span class="n">ID_PROGRAMA</span><span class="p">,</span><span class="w"> </span><span class="n">ID_FECHA</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_FECHA_MENSUAL</span><span class="p">,</span><span class="w"> </span><span class="n">NUM_PERSONAS_COBERTURA_SERVICIOS</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">POBLACION_PROYECTADA</span><span class="p">,</span>
<span class="w">           </span><span class="s1">&#39;FACT_PLAN_COBERTURA_ADULTO_DISCAPACIDAD&#39;</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ORIGEN</span><span class="p">,</span>
<span class="w">           </span><span class="s1">&#39;[DWH_COMFENALCO].[Proteccion].[FACT_PLAN_COBERTURA_ADULTO_DISCAPACIDAD]&#39;</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">FUENTE_PRINCIPAL</span>
<span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Proteccion</span><span class="p">].[</span><span class="n">FACT_PLAN_COBERTURA_ADULTO_DISCAPACIDAD</span><span class="p">]</span>
<span class="p">)</span>
<span class="k">SELECT</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;COBERTURA PROYECTADA&#39;</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ACTIVIDAD</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">CoberturaProyectadaColegioMensual</span><span class="w"> </span><span class="k">c</span>
<span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Transversal</span><span class="p">].[</span><span class="n">DIM_TIEMPO_MENSUAL</span><span class="p">]</span><span class="w"> </span><span class="n">dimM</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">ID_FECHA_MENSUAL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dimM</span><span class="p">.</span><span class="n">ID_FECHA</span>
<span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span>
<span class="k">SELECT</span><span class="w"> </span><span class="n">ce</span><span class="p">.</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;COBERTURA PROYECTADA&#39;</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">CoberturaCedesarrolloMensual</span><span class="w"> </span><span class="n">ce</span>
<span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Transversal</span><span class="p">].[</span><span class="n">DIM_TIEMPO_MENSUAL</span><span class="p">]</span><span class="w"> </span><span class="n">dimM</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">ce</span><span class="p">.</span><span class="n">ID_FECHA_MENSUAL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dimM</span><span class="p">.</span><span class="n">ID_FECHA</span>
<span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span>
<span class="k">SELECT</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;COBERTURA PROYECTADA&#39;</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">CoberturaProyectadaProteccionMensual</span><span class="w"> </span><span class="n">p</span>
<span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Transversal</span><span class="p">].[</span><span class="n">DIM_TIEMPO_MENSUAL</span><span class="p">]</span><span class="w"> </span><span class="n">dimM</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">ID_FECHA_MENSUAL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dimM</span><span class="p">.</span><span class="n">ID_FECHA</span>
<span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span>
<span class="k">SELECT</span><span class="w"> </span><span class="n">ad</span><span class="p">.</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;COBERTURA PROYECTADA&#39;</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">CoberturaProyectadaAdultoDiscapacidad</span><span class="w"> </span><span class="n">ad</span>
<span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Transversal</span><span class="p">].[</span><span class="n">DIM_TIEMPO_MENSUAL</span><span class="p">]</span><span class="w"> </span><span class="n">dimM</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">ad</span><span class="p">.</span><span class="n">ID_FECHA_MENSUAL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dimM</span><span class="p">.</span><span class="n">ID_FECHA</span>
</code></pre></div>
<h3 id="procesar-fact_unidadessaber-11-individual"><strong>Procesar FACT_UNIDADES\Saber 11 Individual</strong><a class="headerlink" href="#procesar-fact_unidadessaber-11-individual" title="Permanent link">&para;</a></h3>
<hr />
<h4 id="descripcion-general_18"><strong>Descripción General</strong><a class="headerlink" href="#descripcion-general_18" title="Permanent link">&para;</a></h4>
<p>Este componente del flujo de datos genera un consolidado mensual de resultados individuales de las pruebas <strong>SABER 11</strong> a partir de registros académicos por estudiante. La información es transformada en un formato unificado y cargada en la tabla <code>Transversal.FACT_UNIDADES</code>.</p>
<hr />
<h4 id="ubicacion-dentro-del-paquete_3"><strong>Ubicación dentro del Paquete</strong><a class="headerlink" href="#ubicacion-dentro-del-paquete_3" title="Permanent link">&para;</a></h4>
<p><code>Package &gt; Procesar FACT_UNIDADES &gt; Saber 11 Individual</code></p>
<hr />
<h4 id="proposito-del-componente_4"><strong>Propósito del Componente</strong><a class="headerlink" href="#proposito-del-componente_4" title="Permanent link">&para;</a></h4>
<p>Permitir el análisis mensualizado de desempeño educativo a nivel de grado undécimo (SABER 11), cruzando resultados temáticos de las pruebas con estructura académica, unidad organizativa y tiempo. Este flujo estandariza la salida para integrarse a reportes consolidados de cobertura y resultados educativos.</p>
<hr />
<h4 id="detalles-de-implementacion_22"><strong>Detalles de Implementación</strong><a class="headerlink" href="#detalles-de-implementacion_22" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p><strong>Origen:</strong>
  Fuente de datos <code>DWH_COMFENALCO.Colegio.FACT_SABER11_INDIVIDUAL</code>, accedido mediante un <code>DataReaderSourceAdapter</code>.</p>
</li>
<li>
<p><strong>Destino:</strong>
  Tabla de destino <code>Transversal.FACT_UNIDADES</code>, cargada mediante <code>ADO.NET Destination</code>.</p>
</li>
<li>
<p><strong>Transformaciones Clave:</strong></p>
<ul>
<li>Cálculo del <code>RESULTADO_FINAL</code> por estudiante basado en la suma ponderada de temas.</li>
<li>Consolidación por año académico con número de estudiantes y conteo de altos desempeños.</li>
<li>Generación mensual del identificador <code>ID_FECHA_MENSUAL</code> mediante expansión de 12 meses.</li>
<li>Filtrado por meses válidos del mismo año mediante <code>DIM_TIEMPO_MENSUAL</code>.</li>
</ul>
</li>
</ul>
<hr />
<h4 id="logica-de-negocio_20"><strong>Lógica de Negocio</strong><a class="headerlink" href="#logica-de-negocio_20" title="Permanent link">&para;</a></h4>
<ol>
<li>Se agrupan resultados individuales por temática y estudiante, calculando una puntuación final ajustada.</li>
<li>Se consolida el resultado anual a nivel de unidad educativa.</li>
<li>Se replican los datos por cada mes del año académico mediante <code>CROSS JOIN</code> con un generador de offset de meses.</li>
<li>El resultado mensual se filtra por existencia en la dimensión de tiempo para asegurar integridad temporal.</li>
</ol>
<hr />
<h4 id="script-sql-de-extraccion_4"><strong>Script SQL de Extracción</strong><a class="headerlink" href="#script-sql-de-extraccion_4" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="k">WITH</span><span class="w"> </span><span class="n">TematicaResultadosSaber11</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="k">MAX</span><span class="p">(</span><span class="n">ID_FECHA</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_FECHA</span><span class="p">,</span>
<span class="w">           </span><span class="n">ANIO_ACADEMICO</span><span class="p">,</span>
<span class="w">           </span><span class="n">ID_POBLACION_MATRICULA</span><span class="p">,</span>
<span class="w">           </span><span class="k">UPPER</span><span class="p">(</span><span class="n">TEMATICA</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">TEMATICA</span><span class="p">,</span>
<span class="w">           </span><span class="k">MAX</span><span class="p">(</span><span class="n">RESULTADO</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">RESULTADO_MAXIMO</span>
<span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">Colegio</span><span class="p">.</span><span class="n">FACT_SABER11_INDIVIDUAL</span>
<span class="w">    </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">ANIO_ACADEMICO</span><span class="p">,</span><span class="w"> </span><span class="n">ID_POBLACION_MATRICULA</span><span class="p">,</span><span class="w"> </span><span class="k">UPPER</span><span class="p">(</span><span class="n">TEMATICA</span><span class="p">)</span>
<span class="p">),</span>
<span class="n">CalculoResultadoSaber11</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="n">ANIO_ACADEMICO</span><span class="p">,</span>
<span class="w">           </span><span class="k">MAX</span><span class="p">(</span><span class="n">ID_FECHA</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_FECHA</span><span class="p">,</span>
<span class="w">           </span><span class="n">ID_POBLACION_MATRICULA</span><span class="p">,</span>
<span class="w">           </span><span class="k">SUM</span><span class="p">(</span><span class="k">CASE</span><span class="w"> </span>
<span class="w">                   </span><span class="k">WHEN</span><span class="w"> </span><span class="n">TEMATICA</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;LECTURA CRÍTICA&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;MATEMÁTICAS&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;SOCIALES&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;CIENCIAS NATURALES&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="n">RESULTADO_MAXIMO</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">3</span>
<span class="w">                   </span><span class="k">WHEN</span><span class="w"> </span><span class="n">TEMATICA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;INGLÉS&#39;</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="n">RESULTADO_MAXIMO</span>
<span class="w">                   </span><span class="k">ELSE</span><span class="w"> </span><span class="mi">0</span>
<span class="w">               </span><span class="k">END</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">SUMA_RESULTADOS</span>
<span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">TematicaResultadosSaber11</span>
<span class="w">    </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">ANIO_ACADEMICO</span><span class="p">,</span><span class="w"> </span><span class="n">ID_POBLACION_MATRICULA</span>
<span class="p">),</span>
<span class="n">Saber11Individual</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="n">ANIO_ACADEMICO</span><span class="p">,</span>
<span class="w">           </span><span class="n">ID_FECHA</span><span class="p">,</span>
<span class="w">           </span><span class="n">ID_POBLACION_MATRICULA</span><span class="p">,</span>
<span class="w">           </span><span class="p">(</span><span class="n">SUMA_RESULTADOS</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">13</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">RESULTADO_FINAL</span>
<span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">CalculoResultadoSaber11</span>
<span class="p">),</span>
<span class="n">Saber11IndividualConsolidado</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="mi">14</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_CURSO</span><span class="p">,</span>
<span class="w">           </span><span class="s1">&#39;UNDECIMO&#39;</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">GRADO</span><span class="p">,</span>
<span class="w">           </span><span class="mi">1</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_UNIDAD</span><span class="p">,</span>
<span class="w">           </span><span class="k">NULL</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">CATEGORIA</span><span class="p">,</span>
<span class="w">           </span><span class="k">NULL</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_PLAN_COBERTURA</span><span class="p">,</span>
<span class="w">           </span><span class="k">NULL</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_ESTABLECIMIENTO_EDUCATIVO</span><span class="p">,</span>
<span class="w">           </span><span class="k">NULL</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_PROGRAMA</span><span class="p">,</span>
<span class="w">           </span><span class="k">LEFT</span><span class="p">(</span><span class="k">MAX</span><span class="p">(</span><span class="n">ID_FECHA</span><span class="p">),</span><span class="w"> </span><span class="mi">6</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_FECHA_MENSUAL</span><span class="p">,</span>
<span class="w">           </span><span class="k">NULL</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">POBLACION_PROYECTADA</span><span class="p">,</span>
<span class="w">           </span><span class="s1">&#39;FACT_SABER11_INDIVIDUAL&#39;</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ORIGEN</span><span class="p">,</span>
<span class="w">           </span><span class="s1">&#39;[DWH_COMFENALCO].[Colegio].[FACT_SABER11_INDIVIDUAL]&#39;</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">FUENTE_PRINCIPAL</span><span class="p">,</span>
<span class="w">           </span><span class="s1">&#39;SABER 11&#39;</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ACTIVIDAD</span><span class="p">,</span>
<span class="w">           </span><span class="k">NULL</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">RESULTADO</span><span class="p">,</span>
<span class="w">           </span><span class="k">NULL</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">CATEGORIA_SABER11</span><span class="p">,</span>
<span class="w">           </span><span class="k">NULL</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">CAUSA</span><span class="p">,</span>
<span class="w">           </span><span class="k">NULL</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">NUM_POBLACION</span><span class="p">,</span>
<span class="w">           </span><span class="k">NULL</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">CALIFICACION</span><span class="p">,</span>
<span class="w">           </span><span class="k">NULL</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">DOCUMENTOS_COMPLETOS</span><span class="p">,</span>
<span class="w">           </span><span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span><span class="w"> </span><span class="n">ID_POBLACION_MATRICULA</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">NUM_ESTUDIANTES</span><span class="p">,</span>
<span class="w">           </span><span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span><span class="w"> </span><span class="k">CASE</span><span class="w"> </span><span class="k">WHEN</span><span class="w"> </span><span class="k">CAST</span><span class="p">(</span><span class="n">RESULTADO_FINAL</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="nb">INT</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">250</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="n">ID_POBLACION_MATRICULA</span><span class="w"> </span><span class="k">ELSE</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">END</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">NUM_MAYOR_250</span><span class="p">,</span>
<span class="w">           </span><span class="k">NULL</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">TEMATICA</span>
<span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">Saber11Individual</span>
<span class="w">    </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">ANIO_ACADEMICO</span>
<span class="p">),</span>
<span class="n">FechasGeneradas</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">MesOffset</span><span class="w"> </span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span>
<span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="mi">6</span><span class="w"> </span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="mi">7</span><span class="w"> </span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span>
<span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="mi">8</span><span class="w"> </span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="mi">9</span><span class="w"> </span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="mi">11</span>
<span class="p">),</span>
<span class="n">Saber11IndividualMensual</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="n">ID_CURSO</span><span class="p">,</span><span class="w"> </span><span class="n">GRADO</span><span class="p">,</span><span class="w"> </span><span class="n">ID_UNIDAD</span><span class="p">,</span><span class="w"> </span><span class="n">CATEGORIA</span><span class="p">,</span><span class="w"> </span><span class="n">ID_PLAN_COBERTURA</span><span class="p">,</span><span class="w"> </span><span class="n">ID_ESTABLECIMIENTO_EDUCATIVO</span><span class="p">,</span>
<span class="w">           </span><span class="n">ID_PROGRAMA</span><span class="p">,</span>
<span class="w">           </span><span class="p">(</span><span class="k">LEFT</span><span class="p">(</span><span class="n">SIC</span><span class="p">.</span><span class="n">ID_FECHA_MENSUAL</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">10000</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span>
<span class="w">           </span><span class="p">(</span><span class="k">MONTH</span><span class="p">(</span><span class="n">DATEADD</span><span class="p">(</span><span class="k">MONTH</span><span class="p">,</span><span class="w"> </span><span class="n">FG</span><span class="p">.</span><span class="n">MesOffset</span><span class="p">,</span><span class="w"> </span><span class="k">CONVERT</span><span class="p">(</span><span class="nb">DATE</span><span class="p">,</span><span class="w"> </span><span class="k">CAST</span><span class="p">(</span><span class="n">SIC</span><span class="p">.</span><span class="n">ID_FECHA_MENSUAL</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="nb">CHAR</span><span class="p">(</span><span class="mi">8</span><span class="p">)))))</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">100</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_FECHA_MENSUAL</span><span class="p">,</span>
<span class="w">           </span><span class="n">POBLACION_PROYECTADA</span><span class="p">,</span><span class="w"> </span><span class="n">ORIGEN</span><span class="p">,</span><span class="w"> </span><span class="n">FUENTE_PRINCIPAL</span><span class="p">,</span><span class="w"> </span><span class="n">ACTIVIDAD</span><span class="p">,</span><span class="w"> </span><span class="n">RESULTADO</span><span class="p">,</span><span class="w"> </span><span class="n">CATEGORIA_SABER11</span><span class="p">,</span>
<span class="w">           </span><span class="n">CAUSA</span><span class="p">,</span><span class="w"> </span><span class="n">NUM_POBLACION</span><span class="p">,</span><span class="w"> </span><span class="n">CALIFICACION</span><span class="p">,</span><span class="w"> </span><span class="n">DOCUMENTOS_COMPLETOS</span><span class="p">,</span><span class="w"> </span><span class="n">NUM_ESTUDIANTES</span><span class="p">,</span>
<span class="w">           </span><span class="n">NUM_MAYOR_250</span><span class="p">,</span><span class="w"> </span><span class="n">TEMATICA</span>
<span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">Saber11IndividualConsolidado</span><span class="w"> </span><span class="n">SIC</span>
<span class="w">    </span><span class="k">CROSS</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">FechasGeneradas</span><span class="w"> </span><span class="n">FG</span>
<span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="k">YEAR</span><span class="p">(</span><span class="n">DATEADD</span><span class="p">(</span><span class="k">MONTH</span><span class="p">,</span><span class="w"> </span><span class="n">FG</span><span class="p">.</span><span class="n">MesOffset</span><span class="p">,</span><span class="w"> </span><span class="k">CONVERT</span><span class="p">(</span><span class="nb">DATE</span><span class="p">,</span><span class="w"> </span><span class="k">CAST</span><span class="p">(</span><span class="n">SIC</span><span class="p">.</span><span class="n">ID_FECHA_MENSUAL</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="nb">CHAR</span><span class="p">(</span><span class="mi">8</span><span class="p">)))))</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">LEFT</span><span class="p">(</span><span class="n">SIC</span><span class="p">.</span><span class="n">ID_FECHA_MENSUAL</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span>
<span class="p">)</span>
<span class="k">SELECT</span><span class="w"> </span><span class="n">s11</span><span class="p">.</span><span class="o">*</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">Saber11IndividualMensual</span><span class="w"> </span><span class="n">s11</span>
<span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">Transversal</span><span class="p">.</span><span class="n">DIM_TIEMPO_MENSUAL</span><span class="w"> </span><span class="n">dimM</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">s11</span><span class="p">.</span><span class="n">ID_FECHA_MENSUAL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dimM</span><span class="p">.</span><span class="n">ID_FECHA</span><span class="p">;</span>
</code></pre></div>
<hr />
<h4 id="relacion-con-otros-componentes_19"><strong>Relación con Otros Componentes</strong><a class="headerlink" href="#relacion-con-otros-componentes_19" title="Permanent link">&para;</a></h4>
<ul>
<li>Se integra con el modelo de datos mensualizados en <code>FACT_UNIDADES</code>.</li>
<li>Su estructura es compatible con otros procesos educativos como matriculas, psicorientación, biblioteca, etc.</li>
<li>Utiliza la dimensión <code>DIM_TIEMPO_MENSUAL</code> como eje de análisis.</li>
</ul>
<h3 id="procesar-fact_unidadessaber-11-colegio"><strong>Procesar FACT_UNIDADES\Saber 11 Colegio</strong><a class="headerlink" href="#procesar-fact_unidadessaber-11-colegio" title="Permanent link">&para;</a></h3>
<hr />
<h4 id="descripcion-general_19"><strong>Descripción General</strong><a class="headerlink" href="#descripcion-general_19" title="Permanent link">&para;</a></h4>
<p>El componente <strong>Saber 11 Colegio</strong> dentro del paquete <code>Procesar FACT_UNIDADES</code> transforma datos de resultados académicos del examen SABER 11 para una institución educativa específica (código 313001003095), replicando sus valores a lo largo de los 12 meses del año y cargando dicha información en la tabla <code>Transversal.FACT_UNIDADES</code> del Data Warehouse <code>DWH_COMFENALCO</code>.</p>
<hr />
<h4 id="ubicacion-en-el-paquete_13"><strong>Ubicación en el Paquete</strong><a class="headerlink" href="#ubicacion-en-el-paquete_13" title="Permanent link">&para;</a></h4>
<p><code>Package\Procesar FACT_UNIDADES\Saber 11 Colegio</code></p>
<hr />
<h4 id="proposito_18"><strong>Propósito</strong><a class="headerlink" href="#proposito_18" title="Permanent link">&para;</a></h4>
<p>Documentar y replicar mensualmente la información del examen SABER 11 de un colegio, permitiendo su análisis en un modelo de series de tiempo a nivel de unidad educativa y periodo mensual.</p>
<hr />
<h4 id="implementacion-tecnica"><strong>Implementación Técnica</strong><a class="headerlink" href="#implementacion-tecnica" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>Origen de Datos</strong>: Consulta SQL sobre la tabla <code>[DWH_COMFENALCO].[Colegio].[FACT_SABER11_COLEGIOS]</code> para un solo establecimiento (<code>COD_ESTABLECIMIENTO_EDUCATIVO = 313001003095</code>).</li>
<li>
<p><strong>Transformación</strong>:</p>
<ul>
<li>Los datos se replican usando una CTE <code>FechasGeneradas</code> que simula los 12 meses del año.</li>
<li>Se recalcula <code>ID_FECHA_MENSUAL</code> para expandir un único registro anual a registros mensuales usando <code>DATEADD</code> y <code>CROSS JOIN</code>.</li>
<li>Se filtran los meses que coincidan con el año original del dato.</li>
</ul>
</li>
<li>
<p><strong>Destino</strong>: Tabla <code>Transversal.FACT_UNIDADES</code> a través de un componente ADO.NET Destination.</p>
</li>
<li><strong>Control de Errores</strong>: Definidas salidas de error en caso de fallos de conversión o truncamiento.</li>
</ul>
<hr />
<h4 id="logica-de-negocio_21"><strong>Lógica de Negocio</strong><a class="headerlink" href="#logica-de-negocio_21" title="Permanent link">&para;</a></h4>
<ul>
<li>Cada resultado SABER 11 anual se convierte en 12 registros mensuales, uno por mes.</li>
<li>Se conserva la trazabilidad con campos como <code>RESULTADO</code>, <code>CATEGORIA_SABER11</code> y <code>FUENTE_PRINCIPAL</code>.</li>
<li>Se utiliza una combinación fija de identificadores: <code>ID_CURSO = 14</code>, <code>GRADO = UNDECIMO</code>, <code>ID_UNIDAD = 1</code>.</li>
<li>La dimensión de tiempo mensual es verificada cruzando <code>ID_FECHA_MENSUAL</code> con <code>DIM_TIEMPO_MENSUAL</code>.</li>
</ul>
<hr />
<h4 id="relacion-con-otros-componentes_20"><strong>Relación con Otros Componentes</strong><a class="headerlink" href="#relacion-con-otros-componentes_20" title="Permanent link">&para;</a></h4>
<ul>
<li>Depende del contenido de la tabla <code>[Colegio].[FACT_SABER11_COLEGIOS]</code>.</li>
<li>Alimenta el cubo de cobertura educativa consolidada en <code>FACT_UNIDADES</code>.</li>
<li>Se integra con otros flujos que procesan datos proyectados, reales y categorizados por actividad y programa.</li>
</ul>
<hr />
<h4 id="script-sql-utilizado_2"><strong>Script SQL Utilizado</strong><a class="headerlink" href="#script-sql-utilizado_2" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="k">WITH</span><span class="w"> </span><span class="n">Saber11Colegio</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="p">(</span>
<span class="w">  </span><span class="k">SELECT</span><span class="w"> </span><span class="mi">14</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">ID_CURSO</span><span class="p">,</span>
<span class="w">         </span><span class="s1">&#39;UNDECIMO&#39;</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">GRADO</span><span class="p">,</span>
<span class="w">         </span><span class="mi">1</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_UNIDAD</span><span class="p">,</span>
<span class="w">         </span><span class="k">NULL</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">CATEGORIA</span><span class="p">,</span>
<span class="w">         </span><span class="k">NULL</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_PLAN_COBERTURA</span><span class="p">,</span>
<span class="w">         </span><span class="p">[</span><span class="n">COD_ESTABLECIMIENTO_EDUCATIVO</span><span class="p">]</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_ESTABLECIMIENTO_EDUCATIVO</span><span class="p">,</span>
<span class="w">         </span><span class="k">NULL</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_PROGRAMA</span><span class="p">,</span>
<span class="w">         </span><span class="k">LEFT</span><span class="p">([</span><span class="n">ID_FECHA</span><span class="p">],</span><span class="mi">6</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="o">+</span><span class="mi">1</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">ID_FECHA_MENSUAL</span><span class="p">,</span>
<span class="w">         </span><span class="k">NULL</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">POBLACION_PROYECTADA</span><span class="p">,</span>
<span class="w">         </span><span class="s1">&#39;FACT_SABER11_COLEGIOS_CEC&#39;</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ORIGEN</span><span class="p">,</span>
<span class="w">         </span><span class="s1">&#39;[DWH_COMFENALCO].[Colegio].[FACT_SABER11_COLEGIOS]&#39;</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">FUENTE_PRINCIPAL</span><span class="p">,</span>
<span class="w">         </span><span class="s1">&#39;SABER 11&#39;</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">ACTIVIDAD</span><span class="p">,</span>
<span class="w">         </span><span class="p">[</span><span class="n">RESULTADO</span><span class="p">],</span>
<span class="w">         </span><span class="p">[</span><span class="n">CATEGORIA_SABER11</span><span class="p">],</span>
<span class="w">         </span><span class="k">NULL</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">CAUSA</span><span class="p">,</span>
<span class="w">         </span><span class="k">NULL</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">NUM_POBLACION</span><span class="p">,</span>
<span class="w">         </span><span class="k">NULL</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">CALIFICACION</span><span class="p">,</span>
<span class="w">         </span><span class="k">NULL</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">DOCUMENTOS_COMPLETOS</span><span class="p">,</span>
<span class="w">         </span><span class="k">NULL</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">NUM_ESTUDIANTES</span><span class="p">,</span>
<span class="w">         </span><span class="k">NULL</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">NUM_MAYOR_250</span><span class="p">,</span>
<span class="w">         </span><span class="k">NULL</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">TEMATICA</span>
<span class="w">  </span><span class="k">FROM</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Colegio</span><span class="p">].[</span><span class="n">FACT_SABER11_COLEGIOS</span><span class="p">]</span>
<span class="w">  </span><span class="k">WHERE</span><span class="w"> </span><span class="p">[</span><span class="n">COD_ESTABLECIMIENTO_EDUCATIVO</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">313001003095</span>
<span class="p">),</span>
<span class="n">FechasGeneradas</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
<span class="w">  </span><span class="k">SELECT</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">MesOffset</span><span class="w"> </span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span>
<span class="w">  </span><span class="k">SELECT</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span>
<span class="w">  </span><span class="k">SELECT</span><span class="w"> </span><span class="mi">6</span><span class="w"> </span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="mi">7</span><span class="w"> </span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="mi">8</span><span class="w"> </span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span>
<span class="w">  </span><span class="k">SELECT</span><span class="w"> </span><span class="mi">9</span><span class="w"> </span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="mi">11</span>
<span class="p">),</span>
<span class="n">Saber11ColegioMensual</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="p">(</span>
<span class="w">  </span><span class="k">SELECT</span><span class="w"> </span><span class="n">ID_CURSO</span><span class="p">,</span>
<span class="w">         </span><span class="n">GRADO</span><span class="p">,</span>
<span class="w">         </span><span class="n">ID_UNIDAD</span><span class="p">,</span>
<span class="w">         </span><span class="n">CATEGORIA</span><span class="p">,</span>
<span class="w">         </span><span class="n">ID_PLAN_COBERTURA</span><span class="p">,</span>
<span class="w">         </span><span class="n">ID_ESTABLECIMIENTO_EDUCATIVO</span><span class="p">,</span>
<span class="w">         </span><span class="n">ID_PROGRAMA</span><span class="p">,</span>
<span class="w">         </span><span class="p">(</span><span class="k">LEFT</span><span class="p">(</span><span class="n">SIC</span><span class="p">.</span><span class="n">ID_FECHA_MENSUAL</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">10000</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span>
<span class="w">         </span><span class="p">((</span><span class="k">MONTH</span><span class="p">(</span><span class="n">DATEADD</span><span class="p">(</span><span class="k">MONTH</span><span class="p">,</span><span class="w"> </span><span class="n">FG</span><span class="p">.</span><span class="n">MesOffset</span><span class="p">,</span><span class="w"> </span><span class="k">CONVERT</span><span class="p">(</span><span class="nb">DATE</span><span class="p">,</span><span class="w"> </span><span class="k">CAST</span><span class="p">(</span><span class="n">SIC</span><span class="p">.</span><span class="n">ID_FECHA_MENSUAL</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="nb">CHAR</span><span class="p">(</span><span class="mi">8</span><span class="p">)))))</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">100</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_FECHA_MENSUAL</span><span class="p">,</span>
<span class="w">         </span><span class="n">POBLACION_PROYECTADA</span><span class="p">,</span>
<span class="w">         </span><span class="n">ORIGEN</span><span class="p">,</span>
<span class="w">         </span><span class="n">FUENTE_PRINCIPAL</span><span class="p">,</span>
<span class="w">         </span><span class="n">ACTIVIDAD</span><span class="p">,</span>
<span class="w">         </span><span class="n">RESULTADO</span><span class="p">,</span>
<span class="w">         </span><span class="n">CATEGORIA_SABER11</span><span class="p">,</span>
<span class="w">         </span><span class="n">CAUSA</span><span class="p">,</span>
<span class="w">         </span><span class="n">NUM_POBLACION</span><span class="p">,</span>
<span class="w">         </span><span class="n">CALIFICACION</span><span class="p">,</span>
<span class="w">         </span><span class="n">DOCUMENTOS_COMPLETOS</span><span class="p">,</span>
<span class="w">         </span><span class="n">NUM_ESTUDIANTES</span><span class="p">,</span>
<span class="w">         </span><span class="n">NUM_MAYOR_250</span><span class="p">,</span>
<span class="w">         </span><span class="n">TEMATICA</span>
<span class="w">  </span><span class="k">FROM</span><span class="w"> </span><span class="n">Saber11Colegio</span><span class="w"> </span><span class="n">SIC</span>
<span class="w">  </span><span class="k">CROSS</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">FechasGeneradas</span><span class="w"> </span><span class="n">FG</span>
<span class="w">  </span><span class="k">WHERE</span><span class="w"> </span><span class="k">YEAR</span><span class="p">(</span><span class="n">DATEADD</span><span class="p">(</span><span class="k">MONTH</span><span class="p">,</span><span class="w"> </span><span class="n">FG</span><span class="p">.</span><span class="n">MesOffset</span><span class="p">,</span><span class="w"> </span><span class="k">CONVERT</span><span class="p">(</span><span class="nb">DATE</span><span class="p">,</span><span class="w"> </span><span class="k">CAST</span><span class="p">(</span><span class="n">SIC</span><span class="p">.</span><span class="n">ID_FECHA_MENSUAL</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="nb">CHAR</span><span class="p">(</span><span class="mi">8</span><span class="p">)))))</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">LEFT</span><span class="p">(</span><span class="n">SIC</span><span class="p">.</span><span class="n">ID_FECHA_MENSUAL</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span>
<span class="p">)</span>
<span class="k">SELECT</span><span class="w"> </span><span class="n">s11</span><span class="p">.</span><span class="o">*</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">Saber11ColegioMensual</span><span class="w"> </span><span class="n">s11</span>
<span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Transversal</span><span class="p">].[</span><span class="n">DIM_TIEMPO_MENSUAL</span><span class="p">]</span><span class="w"> </span><span class="n">dimM</span>
<span class="w">  </span><span class="k">ON</span><span class="w"> </span><span class="n">s11</span><span class="p">.</span><span class="n">ID_FECHA_MENSUAL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dimM</span><span class="p">.</span><span class="n">ID_FECHA</span>
</code></pre></div>
<h3 id="procesar-fact_unidadesdesercion-aipi-y-jec"><strong>Procesar FACT_UNIDADES\Desercion AIPI y JEC</strong><a class="headerlink" href="#procesar-fact_unidadesdesercion-aipi-y-jec" title="Permanent link">&para;</a></h3>
<hr />
<h4 id="descripcion-general_20"><strong>Descripción General</strong><a class="headerlink" href="#descripcion-general_20" title="Permanent link">&para;</a></h4>
<p>Este componente carga mensualmente información de deserción del programa de protección social, específicamente de los programas AIPI y Jornada Escolar Complementaria (JEC), desde la tabla <code>FACT_DESERCION</code>. El proceso consolida esta información y la transforma para integrarla en el modelo de unidades operativas del data warehouse.</p>
<hr />
<h4 id="ubicacion-dentro-del-paquete_4"><strong>Ubicación dentro del Paquete</strong><a class="headerlink" href="#ubicacion-dentro-del-paquete_4" title="Permanent link">&para;</a></h4>
<p><code>Procesar FACT_UNIDADES</code> → <code>Desercion AIPI y JEC</code></p>
<hr />
<h4 id="proposito_19"><strong>Propósito</strong><a class="headerlink" href="#proposito_19" title="Permanent link">&para;</a></h4>
<p>Integrar registros consolidados de deserción educativa por unidad, programa, causa y fecha, permitiendo monitorear causas de abandono y generar indicadores mensuales en la tabla <code>Transversal.FACT_UNIDADES</code>.</p>
<hr />
<h4 id="detalles-de-implementacion_23"><strong>Detalles de Implementación</strong><a class="headerlink" href="#detalles-de-implementacion_23" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p><strong>Origen de Datos:</strong>
  SQL Server → Tabla <code>[DWH_COMFENALCO].[Proteccion].[FACT_DESERCION]</code>
  Consulta T-SQL con agregación (<code>COUNT DISTINCT</code>) y transformación de fechas a <code>ID_FECHA_MENSUAL</code>.</p>
</li>
<li>
<p><strong>Destino de Datos:</strong>
  Tabla: <code>Transversal.FACT_UNIDADES</code>
  Modo de carga: ADO.NET con <code>UseBulkInsertWhenPossible = true</code>.</p>
</li>
<li>
<p><strong>Componentes del Data Flow:</strong></p>
<ul>
<li>
<p><strong>Origen:</strong> <code>unidades</code></p>
<ul>
<li>Tipo: <code>DataReader Source</code></li>
<li>Usa CTE <code>DesercionProteccion</code> para estructurar los datos.</li>
</ul>
</li>
<li>
<p><strong>Destino:</strong> <code>Destino de ADO NET</code></p>
<ul>
<li>Tabla objetivo: <code>Transversal.FACT_UNIDADES</code></li>
<li>Inserta columnas: <code>ID_UNIDAD</code>, <code>ID_ESTABLECIMIENTO_EDUCATIVO</code>, <code>ID_PROGRAMA</code>, <code>ID_FECHA_MENSUAL</code>, <code>ORIGEN</code>, <code>FUENTE_PRINCIPAL</code>, <code>ACTIVIDAD</code>, <code>CAUSA</code>, <code>NUM_POBLACION</code>.</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>Unión con Dimensión de Tiempo:</strong>
  Se realiza un <code>INNER JOIN</code> con <code>Transversal.DIM_TIEMPO_MENSUAL</code> para asegurar la validez temporal del dato.</p>
</li>
</ul>
<hr />
<h4 id="logica-de-negocio_22"><strong>Lógica de Negocio</strong><a class="headerlink" href="#logica-de-negocio_22" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p><strong>Filtro y Transformación:</strong>
  Convierte fechas <code>ID_FECHA</code> a formato <code>ID_FECHA_MENSUAL</code>. Se agrupan los registros por combinación de establecimiento, programa y causa de deserción.</p>
</li>
<li>
<p><strong>Asignación de Unidad:</strong>
  Se asigna un identificador fijo (<code>ID_UNIDAD = 4</code>) para representar la unidad del dominio de protección social.</p>
</li>
<li>
<p><strong>Normalización del Origen y Actividad:</strong>
  Se define <code>ORIGEN = 'FACT_DESERCION'</code>, <code>FUENTE_PRINCIPAL = '[DWH_COMFENALCO].[Proteccion].[FACT_DESERCION]'</code> y <code>ACTIVIDAD = 'DESERCION'</code>.</p>
</li>
</ul>
<hr />
<h4 id="relacion-con-otros-componentes_21"><strong>Relación con Otros Componentes</strong><a class="headerlink" href="#relacion-con-otros-componentes_21" title="Permanent link">&para;</a></h4>
<p>Este flujo es uno de varios que alimentan la tabla <code>FACT_UNIDADES</code>, cada uno especializado por dominio (ej. educación, discapacidad, protección). La unificación final permite análisis comparativos por unidad, programa y periodo.</p>
<hr />
<h4 id="script-sql-utilizado_3"><strong>Script SQL Utilizado</strong><a class="headerlink" href="#script-sql-utilizado_3" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="k">WITH</span><span class="w"> </span><span class="n">DesercionProteccion</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
<span class="w">  </span><span class="k">SELECT</span><span class="w"> </span>
<span class="w">     </span><span class="mi">4</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_UNIDAD</span><span class="p">,</span>
<span class="w">     </span><span class="n">ID_ESTABLECIMIENTO_EDUCATIVO</span><span class="p">,</span>
<span class="w">     </span><span class="n">ID_PROGRAMA</span><span class="p">,</span>
<span class="w">     </span><span class="n">ID_FECHA_MENSUAL</span><span class="p">,</span>
<span class="w">     </span><span class="n">ORIGEN</span><span class="p">,</span>
<span class="w">     </span><span class="n">FUENTE_PRINCIPAL</span><span class="p">,</span>
<span class="w">     </span><span class="n">ACTIVIDAD</span><span class="p">,</span>
<span class="w">     </span><span class="p">[</span><span class="n">CAUSA</span><span class="p">],</span>
<span class="w">     </span><span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span><span class="p">([</span><span class="n">ID_POBLACION</span><span class="p">]))</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">NUM_POBLACION</span>
<span class="w">  </span><span class="k">FROM</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="k">SELECT</span><span class="w"> </span>
<span class="w">      </span><span class="k">CAST</span><span class="p">(</span><span class="n">ID_ESTABLECIMIENTO_EDUCATIVO</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">nvarchar</span><span class="p">(</span><span class="mi">40</span><span class="p">))</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">ID_ESTABLECIMIENTO_EDUCATIVO</span><span class="p">,</span>
<span class="w">      </span><span class="n">ID_PROGRAMA</span><span class="p">,</span>
<span class="w">      </span><span class="k">LEFT</span><span class="p">([</span><span class="n">ID_FECHA</span><span class="p">],</span><span class="mi">6</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="o">+</span><span class="mi">1</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">ID_FECHA_MENSUAL</span><span class="p">,</span>
<span class="w">      </span><span class="s1">&#39;FACT_DESERCION&#39;</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ORIGEN</span><span class="p">,</span>
<span class="w">      </span><span class="s1">&#39;[DWH_COMFENALCO].[Proteccion].[FACT_DESERCION]&#39;</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">FUENTE_PRINCIPAL</span><span class="p">,</span>
<span class="w">      </span><span class="s1">&#39;DESERCION&#39;</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">ACTIVIDAD</span><span class="p">,</span>
<span class="w">      </span><span class="p">[</span><span class="n">CAUSA</span><span class="p">],</span>
<span class="w">      </span><span class="p">[</span><span class="n">ID_POBLACION</span><span class="p">]</span>
<span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Proteccion</span><span class="p">].[</span><span class="n">FACT_DESERCION</span><span class="p">]</span>
<span class="w">  </span><span class="p">)</span><span class="w"> </span><span class="n">ll</span>
<span class="w">  </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w">  </span>
<span class="w">    </span><span class="n">ID_ESTABLECIMIENTO_EDUCATIVO</span><span class="p">,</span>
<span class="w">    </span><span class="n">ID_PROGRAMA</span><span class="p">,</span>
<span class="w">    </span><span class="n">ID_FECHA_MENSUAL</span><span class="p">,</span>
<span class="w">    </span><span class="n">ORIGEN</span><span class="p">,</span>
<span class="w">    </span><span class="n">FUENTE_PRINCIPAL</span><span class="p">,</span>
<span class="w">    </span><span class="n">ACTIVIDAD</span><span class="p">,</span>
<span class="w">    </span><span class="p">[</span><span class="n">CAUSA</span><span class="p">]</span>
<span class="p">)</span>
<span class="k">SELECT</span><span class="w"> </span><span class="n">dp</span><span class="p">.</span><span class="o">*</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">DesercionProteccion</span><span class="w"> </span><span class="n">dp</span>
<span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Transversal</span><span class="p">].[</span><span class="n">DIM_TIEMPO_MENSUAL</span><span class="p">]</span><span class="w"> </span><span class="n">dimM</span>
<span class="w">  </span><span class="k">ON</span><span class="w"> </span><span class="n">dp</span><span class="p">.</span><span class="n">ID_FECHA_MENSUAL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dimM</span><span class="p">.</span><span class="n">ID_FECHA</span>
</code></pre></div>
<h3 id="procesar-fact_unidadesevaluacion-curricular-cedesarrollo"><strong>Procesar FACT_UNIDADES\Evaluacion Curricular Cedesarrollo</strong><a class="headerlink" href="#procesar-fact_unidadesevaluacion-curricular-cedesarrollo" title="Permanent link">&para;</a></h3>
<hr />
<h4 id="descripcion-general_21"><strong>Descripción General</strong><a class="headerlink" href="#descripcion-general_21" title="Permanent link">&para;</a></h4>
<p>Este componente transforma y consolida información de evaluación de diseño curricular realizada por la unidad Cedesarrollo, convirtiendo registros semestrales en valores mensuales dentro del Data Warehouse. La información alimenta la tabla <code>FACT_UNIDADES</code> para análisis longitudinales de desempeño académico.</p>
<hr />
<h4 id="ubicacion-dentro-del-paquete_5"><strong>Ubicación dentro del Paquete</strong><a class="headerlink" href="#ubicacion-dentro-del-paquete_5" title="Permanent link">&para;</a></h4>
<p><code>Procesar FACT_UNIDADES</code> → <code>Evaluacion Curricular Cedesarrollo</code></p>
<hr />
<h4 id="proposito_20"><strong>Propósito</strong><a class="headerlink" href="#proposito_20" title="Permanent link">&para;</a></h4>
<p>Incorporar las calificaciones obtenidas en evaluaciones de diseño curricular del programa Cedesarrollo, asociando dichas calificaciones a fechas mensuales mediante una correspondencia con periodos académicos definidos semestralmente.</p>
<hr />
<h4 id="detalles-de-implementacion_24"><strong>Detalles de Implementación</strong><a class="headerlink" href="#detalles-de-implementacion_24" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p><strong>Origen de Datos:</strong>
  SQL Server → Tabla: <code>[DWH_COMFENALCO].[Cedesarrollo].[FACT_EVALUACION_PLAN_CURRICULAR]</code>
  Consulta con <code>WITH</code> para estructurar las fechas de inicio de semestre y mapeo a calendario mensual (<code>DIM_TIEMPO_MENSUAL</code>).</p>
</li>
<li>
<p><strong>Destino de Datos:</strong>
  Tabla: <code>Transversal.FACT_UNIDADES</code>
  Tipo de carga: ADO.NET con <code>UseBulkInsertWhenPossible = true</code>.</p>
</li>
<li>
<p><strong>Columnas cargadas:</strong></p>
<ul>
<li><code>ID_FECHA_MENSUAL</code></li>
<li><code>ID_UNIDAD</code></li>
<li><code>ORIGEN</code></li>
<li><code>FUENTE_PRINCIPAL</code></li>
<li><code>ACTIVIDAD</code></li>
<li><code>CALIFICACION</code></li>
</ul>
</li>
<li>
<p><strong>Asignación de Unidad:</strong>
  <code>ID_UNIDAD</code> se obtiene con <code>COALESCE(fep.ID_UNIDAD, 5)</code> como valor predeterminado para Cedesarrollo.</p>
</li>
</ul>
<hr />
<h4 id="logica-de-negocio_23"><strong>Lógica de Negocio</strong><a class="headerlink" href="#logica-de-negocio_23" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p><strong>Semestral a Mensual:</strong>
  Se genera un rango completo de fechas mensuales (<code>FechasMensualesCedesarrollo</code>) y se mapean con el inicio de semestre de cada evaluación (<code>ID_FECHA_INICIO_SEMESTRE</code>) para construir <code>ID_FECHA_MENSUAL</code>.</p>
</li>
<li>
<p><strong>Normalización de Valores:</strong></p>
<ul>
<li><code>ORIGEN = 'FACT_EVALUACION_PLAN_CURRICULAR'</code></li>
<li><code>FUENTE_PRINCIPAL = '[DWH_COMFENALCO].[Cedesarrollo].[FACT_EVALUACION_PLAN_CURRICULAR]'</code></li>
<li><code>ACTIVIDAD = 'EVALUACION DISENO CURRICULAR'</code></li>
</ul>
</li>
<li>
<p><strong>Condiciones Especiales:</strong>
  Se realiza un <code>LEFT JOIN</code> con fechas de inicio semestral para asegurar que cada calificación sea representada correctamente en la dimensión mensual.</p>
</li>
</ul>
<hr />
<h4 id="relacion-con-otros-componentes_22"><strong>Relación con Otros Componentes</strong><a class="headerlink" href="#relacion-con-otros-componentes_22" title="Permanent link">&para;</a></h4>
<p>Este flujo complementa otros del paquete <code>FACT_UNIDADES</code>, enfocándose en la dimensión formativa de los programas. Es crucial para consolidar indicadores de calidad académica y seguimiento al diseño curricular en la unidad de Cedesarrollo.</p>
<hr />
<h4 id="script-sql-utilizado_4"><strong>Script SQL Utilizado</strong><a class="headerlink" href="#script-sql-utilizado_4" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="k">WITH</span><span class="w"> </span><span class="n">EvaluacionCurricular</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
<span class="w">  </span><span class="k">SELECT</span><span class="w"> </span>
<span class="w">    </span><span class="k">COALESCE</span><span class="p">(</span><span class="n">fep</span><span class="p">.</span><span class="n">ID_UNIDAD</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_UNIDAD</span><span class="p">,</span>
<span class="w">    </span><span class="n">FORMAT</span><span class="p">([</span><span class="n">FECHA_INICIO</span><span class="p">],</span><span class="w"> </span><span class="s1">&#39;yyyyMMdd&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_FECHA_INICIO_SEMESTRE</span><span class="p">,</span>
<span class="w">    </span><span class="s1">&#39;FACT_EVALUACION_PLAN_CURRICULAR&#39;</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ORIGEN</span><span class="p">,</span>
<span class="w">    </span><span class="s1">&#39;[DWH_COMFENALCO].[Cedesarrollo].[FACT_EVALUACION_PLAN_CURRICULAR]&#39;</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">FUENTE_PRINCIPAL</span><span class="p">,</span>
<span class="w">    </span><span class="s1">&#39;EVALUACION DISENO CURRICULAR&#39;</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ACTIVIDAD</span><span class="p">,</span>
<span class="w">    </span><span class="p">[</span><span class="n">CALIFICACION</span><span class="p">]</span>
<span class="w">  </span><span class="k">FROM</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Cedesarrollo</span><span class="p">].[</span><span class="n">FACT_EVALUACION_PLAN_CURRICULAR</span><span class="p">]</span><span class="w"> </span><span class="n">fep</span>
<span class="w">  </span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Cedesarrollo</span><span class="p">].[</span><span class="n">DIM_PERIODO_ACADEMICO</span><span class="p">]</span><span class="w"> </span><span class="n">pa</span>
<span class="w">    </span><span class="k">ON</span><span class="w"> </span><span class="n">fep</span><span class="p">.</span><span class="n">ID_PERIODO</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pa</span><span class="p">.</span><span class="n">ID_PERIODO</span>
<span class="p">),</span>
<span class="n">FechasMensualesCedesarrollo</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
<span class="w">  </span><span class="k">SELECT</span><span class="w"> </span>
<span class="w">    </span><span class="n">Año</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">10000</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">Mes</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mi">100</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">01</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_FECHA_MENSUAL</span><span class="p">,</span>
<span class="w">    </span><span class="n">Año</span><span class="p">,</span>
<span class="w">    </span><span class="n">Mes</span><span class="p">,</span>
<span class="w">    </span><span class="k">CASE</span><span class="w"> </span>
<span class="w">      </span><span class="k">WHEN</span><span class="w"> </span><span class="p">(</span><span class="n">Mes</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mi">100</span><span class="p">)</span><span class="w"> </span><span class="k">BETWEEN</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="mi">6</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="n">Año</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">10000</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">101</span>
<span class="w">      </span><span class="k">WHEN</span><span class="w"> </span><span class="p">(</span><span class="n">Mes</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mi">100</span><span class="p">)</span><span class="w"> </span><span class="k">BETWEEN</span><span class="w"> </span><span class="mi">7</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="mi">12</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="n">Año</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">10000</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">701</span>
<span class="w">    </span><span class="k">END</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_FECHA_INICIO_SEMESTRE</span>
<span class="w">  </span><span class="k">FROM</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="k">DISTINCT</span><span class="w"> </span><span class="k">YEAR</span><span class="p">(</span><span class="n">pa</span><span class="p">.</span><span class="n">FECHA_INICIO</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">Año</span>
<span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Cedesarrollo</span><span class="p">].[</span><span class="n">DIM_PERIODO_ACADEMICO</span><span class="p">]</span><span class="w"> </span><span class="n">pa</span>
<span class="w">  </span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">Anios</span>
<span class="w">  </span><span class="k">CROSS</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="mi">101</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">Mes</span><span class="w"> </span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="mi">102</span><span class="w"> </span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="mi">103</span><span class="w"> </span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="mi">104</span><span class="w"> </span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span>
<span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="mi">105</span><span class="w"> </span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="mi">106</span><span class="w"> </span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="mi">107</span><span class="w"> </span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="mi">108</span><span class="w"> </span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span>
<span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="mi">109</span><span class="w"> </span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="mi">110</span><span class="w"> </span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="mi">111</span><span class="w"> </span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="mi">112</span>
<span class="w">  </span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">Meses</span>
<span class="p">)</span>
<span class="k">SELECT</span><span class="w"> </span><span class="n">fm</span><span class="p">.</span><span class="n">ID_FECHA_MENSUAL</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="o">*</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">EvaluacionCurricular</span><span class="w"> </span><span class="n">e</span>
<span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">FechasMensualesCedesarrollo</span><span class="w"> </span><span class="n">fm</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">ID_FECHA_INICIO_SEMESTRE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fm</span><span class="p">.</span><span class="n">ID_FECHA_INICIO_SEMESTRE</span>
<span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Transversal</span><span class="p">].[</span><span class="n">DIM_TIEMPO_MENSUAL</span><span class="p">]</span><span class="w"> </span><span class="n">dimM</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">fm</span><span class="p">.</span><span class="n">ID_FECHA_MENSUAL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dimM</span><span class="p">.</span><span class="n">ID_FECHA</span>
</code></pre></div>
<h3 id="procesar-fact_unidadesdocumentos-completos-cedesarrollo"><strong>Procesar FACT_UNIDADES\Documentos Completos Cedesarrollo</strong><a class="headerlink" href="#procesar-fact_unidadesdocumentos-completos-cedesarrollo" title="Permanent link">&para;</a></h3>
<hr />
<h4 id="descripcion-general_22"><strong>Descripción General</strong><a class="headerlink" href="#descripcion-general_22" title="Permanent link">&para;</a></h4>
<p>Este componente del flujo de datos transforma y consolida información mensual sobre el estado de documentación completa de estudiantes del programa Cedesarrollo, calculando la cantidad de estudiantes y registrando dicha condición documental en la tabla <code>FACT_UNIDADES</code>.</p>
<hr />
<h4 id="ubicacion-dentro-del-paquete_6"><strong>Ubicación dentro del Paquete</strong><a class="headerlink" href="#ubicacion-dentro-del-paquete_6" title="Permanent link">&para;</a></h4>
<p><code>Procesar FACT_UNIDADES</code> → <code>Documentos Completos Cedesarrollo</code></p>
<hr />
<h4 id="proposito_21"><strong>Propósito</strong><a class="headerlink" href="#proposito_21" title="Permanent link">&para;</a></h4>
<p>Determinar y cargar indicadores mensuales asociados al estado de documentos completos de los estudiantes registrados en matrículas de Cedesarrollo, permitiendo hacer seguimiento a la formalización académica dentro del sistema educativo.</p>
<hr />
<h4 id="detalles-de-implementacion_25"><strong>Detalles de Implementación</strong><a class="headerlink" href="#detalles-de-implementacion_25" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p><strong>Origen de Datos:</strong>
  Tabla fuente: <code>[DWH_COMFENALCO].[Cedesarrollo].[FACT_ESTADO_MATRICULAS]</code>
  Consulta agrupada por unidad, fecha mensual y estado documental (<code>DOCUMENTOS_COMPLETOS</code>).</p>
</li>
<li>
<p><strong>Destino de Datos:</strong>
  Tabla destino: <code>Transversal.FACT_UNIDADES</code>
  Cargado mediante componente ADO.NET con <code>UseBulkInsertWhenPossible = true</code>.</p>
</li>
<li>
<p><strong>Columnas cargadas:</strong></p>
<ul>
<li><code>ID_UNIDAD</code></li>
<li><code>ID_FECHA_MENSUAL</code></li>
<li><code>ORIGEN</code></li>
<li><code>FUENTE_PRINCIPAL</code></li>
<li><code>ACTIVIDAD</code></li>
<li><code>DOCUMENTOS_COMPLETOS</code></li>
<li><code>NUM_ESTUDIANTES</code></li>
</ul>
</li>
</ul>
<hr />
<h4 id="logica-de-negocio_24"><strong>Lógica de Negocio</strong><a class="headerlink" href="#logica-de-negocio_24" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p><strong>Normalización temporal:</strong>
  La fecha de corte mensual (<code>ID_FECHA_MENSUAL</code>) se calcula como <code>LEFT(ID_FECHA,6)*100 + 1</code>, asignando el primer día del mes.</p>
</li>
<li>
<p><strong>Agrupación:</strong>
  Se agrupan registros por unidad, mes y valor de <code>DOCUMENTOS_COMPLETOS</code>, contando los estudiantes únicos por grupo.</p>
</li>
<li>
<p><strong>Estandarización de atributos:</strong></p>
<ul>
<li><code>ORIGEN = 'FACT_ESTADO_MATRICULAS'</code></li>
<li><code>FUENTE_PRINCIPAL = '[DWH_COMFENALCO].[Cedesarrollo].[FACT_ESTADO_MATRICULAS]'</code></li>
<li><code>ACTIVIDAD = 'MATRICULAS_ESTUDIANTES'</code></li>
</ul>
</li>
<li>
<p><strong>Filtrado de fechas válidas:</strong>
  Solo se cargan datos con <code>ID_FECHA_MENSUAL</code> presentes en la dimensión <code>DIM_TIEMPO_MENSUAL</code>.</p>
</li>
</ul>
<hr />
<h4 id="relacion-con-otros-componentes_23"><strong>Relación con Otros Componentes</strong><a class="headerlink" href="#relacion-con-otros-componentes_23" title="Permanent link">&para;</a></h4>
<p>Este componente alimenta la misma tabla de hechos (<code>FACT_UNIDADES</code>) que otros subprocesos del paquete, pero se enfoca en indicadores de formalización documental, cruciales para validar procesos de matrícula y cumplimiento de requisitos por parte de los estudiantes.</p>
<hr />
<h4 id="script-sql-utilizado_5"><strong>Script SQL Utilizado</strong><a class="headerlink" href="#script-sql-utilizado_5" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="k">WITH</span><span class="w"> </span><span class="n">DocumentosCompletos</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
<span class="w">  </span><span class="k">SELECT</span><span class="w">  </span>
<span class="w">    </span><span class="n">dp</span><span class="p">.</span><span class="n">ID_UNIDAD</span><span class="p">,</span>
<span class="w">    </span><span class="k">LEFT</span><span class="p">(</span><span class="n">ID_FECHA</span><span class="p">,</span><span class="mi">6</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="o">+</span><span class="mi">1</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_FECHA_MENSUAL</span><span class="p">,</span>
<span class="w">    </span><span class="s1">&#39;FACT_ESTADO_MATRICULAS&#39;</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ORIGEN</span><span class="p">,</span>
<span class="w">    </span><span class="s1">&#39;[DWH_COMFENALCO].[Cedesarrollo].[FACT_ESTADO_MATRICULAS]&#39;</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">FUENTE_PRINCIPAL</span><span class="p">,</span>
<span class="w">    </span><span class="s1">&#39;MATRICULAS_ESTUDIANTES&#39;</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ACTIVIDAD</span><span class="p">,</span>
<span class="w">    </span><span class="n">DOCUMENTOS_COMPLETOS</span><span class="p">,</span>
<span class="w">    </span><span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span><span class="p">(</span><span class="n">ID_ESTUDIANTE</span><span class="p">))</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">NUM_ESTUDIANTES</span>
<span class="w">  </span><span class="k">FROM</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Cedesarrollo</span><span class="p">].[</span><span class="n">FACT_ESTADO_MATRICULAS</span><span class="p">]</span><span class="w"> </span><span class="n">fc</span>
<span class="w">  </span><span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Cedesarrollo</span><span class="p">].[</span><span class="n">DIM_PERIODO_ACADEMICO</span><span class="p">]</span><span class="w"> </span><span class="n">dp</span><span class="w"> </span>
<span class="w">    </span><span class="k">ON</span><span class="w"> </span><span class="n">fc</span><span class="p">.</span><span class="n">ID_PERIODO</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dp</span><span class="p">.</span><span class="n">ID_PERIODO</span>
<span class="w">  </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">dp</span><span class="p">.</span><span class="n">ID_UNIDAD</span><span class="p">,</span><span class="w"> </span><span class="k">LEFT</span><span class="p">(</span><span class="n">ID_FECHA</span><span class="p">,</span><span class="mi">6</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">DOCUMENTOS_COMPLETOS</span>
<span class="p">)</span>
<span class="k">SELECT</span><span class="w"> </span><span class="n">dc</span><span class="p">.</span><span class="o">*</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">DocumentosCompletos</span><span class="w"> </span><span class="n">dc</span>
<span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Transversal</span><span class="p">].[</span><span class="n">DIM_TIEMPO_MENSUAL</span><span class="p">]</span><span class="w"> </span><span class="n">dimM</span><span class="w"> </span>
<span class="w">  </span><span class="k">ON</span><span class="w"> </span><span class="n">dc</span><span class="p">.</span><span class="n">ID_FECHA_MENSUAL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dimM</span><span class="p">.</span><span class="n">ID_FECHA</span>
</code></pre></div>
<h3 id="fact_mineriamineria_colegiotruncar-tabla"><strong>FACT_MINERIA\MINERIA_COLEGIO\Truncar Tabla</strong><a class="headerlink" href="#fact_mineriamineria_colegiotruncar-tabla" title="Permanent link">&para;</a></h3>
<hr />
<h4 id="descripcion-general_23"><strong>Descripción General</strong><a class="headerlink" href="#descripcion-general_23" title="Permanent link">&para;</a></h4>
<p>Este componente es una tarea de tipo <code>Execute SQL Task</code> cuya función principal es eliminar todos los registros existentes en la tabla de hechos <code>FACT_MINERIA</code> antes de realizar una nueva carga de datos. Esta operación asegura que los datos cargados sean siempre actualizados y sin duplicaciones.</p>
<hr />
<h4 id="ubicacion-dentro-del-paquete_7"><strong>Ubicación dentro del Paquete</strong><a class="headerlink" href="#ubicacion-dentro-del-paquete_7" title="Permanent link">&para;</a></h4>
<p><code>FACT_MINERIA</code> → <code>MINERIA_COLEGIO</code> → <code>Truncar Tabla</code></p>
<hr />
<h4 id="proposito_22"><strong>Propósito</strong><a class="headerlink" href="#proposito_22" title="Permanent link">&para;</a></h4>
<p>Garantizar una limpieza total de la tabla <code>FACT_MINERIA</code> del esquema <code>Transversal</code> en el Data Warehouse <code>DWH_COMFENALCO</code>, eliminando cualquier residuo de ejecuciones anteriores y habilitando una carga limpia y confiable de los nuevos datos minados desde otras fuentes educativas.</p>
<hr />
<h4 id="detalles-de-implementacion_26"><strong>Detalles de Implementación</strong><a class="headerlink" href="#detalles-de-implementacion_26" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>Tipo de tarea:</strong> <code>Execute SQL Task</code></li>
<li><strong>Conexión utilizada:</strong> Administrador de conexión con ID <code>{29BC876E-1EAF-4F6F-8F38-39B8E881EEB6}</code> apuntando a <code>DWH_COMFENALCO</code></li>
<li><strong>Comando ejecutado:</strong></li>
</ul>
<p><div class="highlight"><pre><span></span><code><span class="k">TRUNCATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Transversal</span><span class="p">].[</span><span class="n">FACT_MINERIA</span><span class="p">];</span>
</code></pre></div>
* <strong>Efecto del comando:</strong>
  Borra <strong>todos los registros</strong> de la tabla <code>FACT_MINERIA</code> de manera <strong>rápida y sin registrar logs de transacción fila por fila</strong>, lo cual mejora el rendimiento en grandes volúmenes de datos.</p>
<hr />
<h4 id="logica-de-negocio_25"><strong>Lógica de Negocio</strong><a class="headerlink" href="#logica-de-negocio_25" title="Permanent link">&para;</a></h4>
<p>Esta tarea no contiene lógica condicional ni validaciones adicionales. Su ejecución es determinista y obligatoria cada vez que se inicia el proceso de carga para asegurar la integridad y unicidad de los datos de minería educativa.</p>
<hr />
<h4 id="relacion-con-otros-componentes_24"><strong>Relación con Otros Componentes</strong><a class="headerlink" href="#relacion-con-otros-componentes_24" title="Permanent link">&para;</a></h4>
<p>Es una tarea inicial que prepara la tabla <code>FACT_MINERIA</code> para ser poblada por flujos posteriores dentro del mismo subproceso <code>MINERIA_COLEGIO</code>. Su correcta ejecución es crítica para evitar duplicidades o inconsistencias en los análisis mineros posteriores.</p>
<hr />
<h3 id="fact_mineriamineria_colegioproceso-matricula-temporal"><strong>FACT_MINERIA\MINERIA_COLEGIO\Proceso Matrícula (Temporal)</strong><a class="headerlink" href="#fact_mineriamineria_colegioproceso-matricula-temporal" title="Permanent link">&para;</a></h3>
<hr />
<h4 id="descripcion-general_24">Descripción General<a class="headerlink" href="#descripcion-general_24" title="Permanent link">&para;</a></h4>
<p>Este componente SSIS ejecuta una consulta compleja sobre la tabla <code>FACT_INSCRIPCION_MATRICULAS</code> del dominio educativo, integrando indicadores clave del proceso de matrícula escolar en una tabla temporal (<code>TMP_PROCESO_MATRICULA_COLEGIO</code>). Se incluyen indicadores por rol (codeudor, secretaria académica, psicología, coordinación académica) y estados del proceso de admisión.</p>
<hr />
<h4 id="ubicacion-dentro-del-paquete_8">Ubicación dentro del Paquete<a class="headerlink" href="#ubicacion-dentro-del-paquete_8" title="Permanent link">&para;</a></h4>
<p>Paquete: <code>FACT_MINERIA</code>
Subcarpeta: <code>MINERIA_COLEGIO</code>
Tarea: <code>Proceso Matrícula (Temporal)</code>
Tipo: Tarea de flujo de datos (<code>Data Flow Task</code>)</p>
<hr />
<h4 id="proposito-del-componente_5">Propósito del Componente<a class="headerlink" href="#proposito-del-componente_5" title="Permanent link">&para;</a></h4>
<p>Cargar una vista temporal consolidada de procesos de matrícula que permita medir la participación y gestión de diferentes actores del proceso académico (codeudor, psicología, coordinación, secretaria académica), así como su estado (en proceso, admitido, desistido, etc.), para análisis posteriores en la minería de datos educativa.</p>
<hr />
<h4 id="detalles-de-implementacion_27">Detalles de Implementación<a class="headerlink" href="#detalles-de-implementacion_27" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p><strong>Origen de Datos</strong>:</p>
<ul>
<li>Tabla: <code>[DWH_COMFENALCO].[Colegio].[FACT_INSCRIPCION_MATRICULAS]</code></li>
<li>Conectividad: ADO.NET a través de <code>ConnectionManager</code> a <code>DWH_COMFENALCO</code>.</li>
<li>Lógica: Se utilizan subconsultas con <code>OUTER APPLY</code>, <code>PIVOT</code>, <code>MAX</code>, <code>COUNT</code> e indicadores lógicos (<code>CASE</code>) para transformar los estados del proceso de inscripción en indicadores analíticos.</li>
</ul>
</li>
<li>
<p><strong>Destino de Datos</strong>:</p>
<ul>
<li>Tabla: <code>Transversal.TMP_PROCESO_MATRICULA_COLEGIO</code></li>
<li>Conectividad: ADO.NET con <code>STAGE_AREA</code></li>
<li>Se utiliza inserción masiva (<code>UseBulkInsertWhenPossible = true</code>) para mejorar rendimiento.</li>
</ul>
</li>
<li>
<p><strong>Configuración adicional</strong>:</p>
<ul>
<li>Timeout de comandos: 30 segundos.</li>
<li>No se define un tamaño de lote específico (<code>BatchSize = 0</code>).</li>
<li>Se manejan errores de conversión como <code>FailComponent</code>.</li>
</ul>
</li>
</ul>
<hr />
<h4 id="logica-de-negocio_26">Lógica de Negocio<a class="headerlink" href="#logica-de-negocio_26" title="Permanent link">&para;</a></h4>
<ol>
<li><strong>Extracción</strong> de las inscripciones académicas válidas (excluyendo ciertos estados).</li>
<li><strong>Transformación</strong> mediante agregaciones (<code>MAX</code>, <code>COUNT</code>), indicadores booleanos y cálculos de cumplimiento.</li>
<li><strong>Segmentación</strong> por actores clave del proceso de matrícula.</li>
<li><strong>Carga</strong> en una tabla temporal para uso en etapas posteriores de análisis o carga en el DWH final.</li>
</ol>
<hr />
<h4 id="relacion-con-otros-componentes_25">Relación con Otros Componentes<a class="headerlink" href="#relacion-con-otros-componentes_25" title="Permanent link">&para;</a></h4>
<p>Este proceso prepara los datos para una posterior integración dentro de un modelo de minería de procesos educativos o para alimentar el componente <code>FACT_MINERIA_ESTUDIANTE</code> como parte del análisis transversal del ciclo educativo.</p>
<hr />
<h4 id="script-sql-del-origen-consulta-principal">Script SQL del Origen (Consulta Principal)<a class="headerlink" href="#script-sql-del-origen-consulta-principal" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="c1">-----------------------------------------------------------------------------------------------------------</span>
<span class="c1">-- FT FACT_INSCRIPCION_MATRICULAS   </span>
<span class="c1">-----------------------------------------------------------------------------------------------------------</span>


<span class="w">    </span><span class="k">SELECT</span><span class="w">  </span><span class="n">FT</span><span class="p">.</span><span class="n">ID_FECHA</span><span class="p">,</span><span class="n">FT</span><span class="p">.</span><span class="n">ID_ANIO_ACADEMICO</span><span class="p">,</span><span class="n">FT</span><span class="p">.</span><span class="n">BP</span><span class="p">,</span><span class="n">FT</span><span class="p">.</span><span class="n">ID_CATEGORIA</span><span class="p">,</span><span class="n">FT</span><span class="p">.</span><span class="n">ID_CURSO</span><span class="p">,</span><span class="n">FT</span><span class="p">.</span><span class="n">ID_TIPO_ESTUDIANTE</span><span class="p">,</span>

<span class="w">            </span><span class="k">CASE</span><span class="w"> </span><span class="k">WHEN</span><span class="w"> </span><span class="n">FT2</span><span class="p">.[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">ELSE</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">END</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">IND_CODEUDOR</span><span class="p">,</span>
<span class="w">            </span><span class="k">CASE</span><span class="w"> </span><span class="k">WHEN</span><span class="w"> </span><span class="n">FT2</span><span class="p">.[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="n">FT4</span><span class="p">.</span><span class="n">T_TOTAL_GESTION</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="k">ISNULL</span><span class="p">(</span><span class="n">Ft3</span><span class="p">.</span><span class="n">IND_CUMPLIMIENTO</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">=</span><span class="mi">0</span><span class="w">  </span><span class="k">THEN</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">ELSE</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">END</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">P_CODEUDOR</span><span class="p">,</span>
<span class="w">            </span><span class="n">FT2</span><span class="p">.[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">T_CODEUDOR</span><span class="p">,</span>

<span class="w">            </span><span class="k">CASE</span><span class="w"> </span><span class="k">WHEN</span><span class="w"> </span><span class="n">FT2</span><span class="p">.[</span><span class="mi">3</span><span class="p">]</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">ELSE</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">END</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">IND_SECRETARIA_ACADEMICA</span><span class="p">,</span>
<span class="w">            </span><span class="k">CASE</span><span class="w"> </span><span class="k">WHEN</span><span class="w"> </span><span class="n">FT2</span><span class="p">.[</span><span class="mi">3</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="n">FT4</span><span class="p">.</span><span class="n">T_TOTAL_GESTION</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="k">ISNULL</span><span class="p">(</span><span class="n">Ft3</span><span class="p">.</span><span class="n">IND_CUMPLIMIENTO</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">=</span><span class="mi">0</span><span class="w">  </span><span class="k">THEN</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">ELSE</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">END</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">P_SECRETARIA_ACADEMICA</span><span class="p">,</span>
<span class="w">            </span><span class="n">FT2</span><span class="p">.[</span><span class="mi">3</span><span class="p">]</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">T_SECRETARIA_ACADEMICA</span><span class="p">,</span>

<span class="w">            </span><span class="k">CASE</span><span class="w"> </span><span class="k">WHEN</span><span class="w"> </span><span class="n">FT2</span><span class="p">.[</span><span class="mi">4</span><span class="p">]</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">ELSE</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">END</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">IND_PSICOLOGIA</span><span class="p">,</span>
<span class="w">            </span><span class="k">CASE</span><span class="w"> </span><span class="k">WHEN</span><span class="w"> </span><span class="n">FT2</span><span class="p">.[</span><span class="mi">4</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="n">FT4</span><span class="p">.</span><span class="n">T_TOTAL_GESTION</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="k">ISNULL</span><span class="p">(</span><span class="n">Ft3</span><span class="p">.</span><span class="n">IND_CUMPLIMIENTO</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">=</span><span class="mi">0</span><span class="w">  </span><span class="k">THEN</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">ELSE</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">END</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">P_PSICOLOGIA</span><span class="p">,</span>
<span class="w">            </span><span class="n">FT2</span><span class="p">.[</span><span class="mi">4</span><span class="p">]</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">T_PSICOLOGIA</span><span class="p">,</span>


<span class="w">            </span><span class="k">CASE</span><span class="w"> </span><span class="k">WHEN</span><span class="w"> </span><span class="n">FT2</span><span class="p">.[</span><span class="mi">5</span><span class="p">]</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">ELSE</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">END</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">IND_COORDINACION_ACADEMICA</span><span class="p">,</span>
<span class="w">            </span><span class="k">CASE</span><span class="w"> </span><span class="k">WHEN</span><span class="w"> </span><span class="n">FT2</span><span class="p">.[</span><span class="mi">5</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="n">FT4</span><span class="p">.</span><span class="n">T_TOTAL_GESTION</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="k">ISNULL</span><span class="p">(</span><span class="n">Ft3</span><span class="p">.</span><span class="n">IND_CUMPLIMIENTO</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">=</span><span class="mi">0</span><span class="w">  </span><span class="k">THEN</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">ELSE</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">END</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">P_COORDINACION_ACADEMICA</span><span class="p">,</span>
<span class="w">            </span><span class="n">FT2</span><span class="p">.[</span><span class="mi">5</span><span class="p">]</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">T_COORDINACION_ACADEMICA</span><span class="p">,</span>

<span class="w">            </span><span class="mi">1</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">INDICADOR</span><span class="p">,</span>
<span class="w">            </span><span class="n">FT4</span><span class="p">.</span><span class="n">T_TOTAL_GESTION</span><span class="p">,</span>

<span class="w">            </span><span class="k">ISNULL</span><span class="p">(</span><span class="n">Ft3</span><span class="p">.</span><span class="n">IND_CUMPLIMIENTO</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="w">  </span><span class="k">AS</span><span class="w">  </span><span class="n">IND_CUMPLIMIENTO</span><span class="p">,</span>
<span class="w">            </span><span class="k">ISNULL</span><span class="p">(</span><span class="n">FT5</span><span class="p">.</span><span class="n">IND_EN_PROCESO</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="w">    </span><span class="k">AS</span><span class="w">  </span><span class="n">IND_EN_PROCESO</span><span class="p">,</span>
<span class="w">            </span><span class="k">ISNULL</span><span class="p">(</span><span class="n">FT5</span><span class="p">.</span><span class="n">IND_ADMITIDO</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="w">      </span><span class="k">AS</span><span class="w">  </span><span class="n">IND_ADMITIDO</span><span class="p">,</span>
<span class="w">            </span><span class="k">ISNULL</span><span class="p">(</span><span class="n">FT5</span><span class="p">.</span><span class="n">IND_NO_ADMITIDO</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="w">   </span><span class="k">AS</span><span class="w">  </span><span class="n">IND_NO_ADMITIDO</span><span class="p">,</span>
<span class="w">            </span><span class="k">ISNULL</span><span class="p">(</span><span class="n">FT5</span><span class="p">.</span><span class="n">IND_DESISTIDO</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="w">     </span><span class="k">AS</span><span class="w">  </span><span class="n">IND_DESISTIDO</span>

<span class="w">    </span><span class="k">FROM</span>
<span class="w">    </span><span class="p">(</span>

<span class="w">        </span><span class="k">SELECT</span><span class="w">  </span><span class="n">T</span><span class="p">.</span><span class="n">ID_FECHA</span><span class="p">,</span>
<span class="w">                </span><span class="n">MT</span><span class="p">.</span><span class="n">ANIO_ACADEMICO</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_ANIO_ACADEMICO</span><span class="p">,</span>
<span class="w">                </span><span class="n">MT</span><span class="p">.</span><span class="n">BP</span><span class="p">,</span>
<span class="w">                </span><span class="n">CA</span><span class="p">.</span><span class="n">ID_CATEGORIA</span><span class="p">,</span>
<span class="w">                </span><span class="n">CS</span><span class="p">.</span><span class="n">ID_CURSO</span><span class="p">,</span>
<span class="w">                </span><span class="n">ES</span><span class="p">.</span><span class="n">ID_TIPO_ESTUDIANTE</span>


<span class="w">        </span><span class="k">FROM</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Colegio</span><span class="p">].[</span><span class="n">FACT_INSCRIPCION_MATRICULAS</span><span class="p">]</span><span class="w"> </span><span class="n">MT</span><span class="w"> </span>
<span class="w">        </span><span class="k">JOIN</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Dwh</span><span class="p">].[</span><span class="n">DIM_TIEMPO</span><span class="p">]</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">T</span><span class="p">.</span><span class="n">ID_FECHA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MT</span><span class="p">.</span><span class="n">ID_FECHA</span>
<span class="w">        </span><span class="k">JOIN</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Dwh</span><span class="p">].[</span><span class="n">DIM_CATEGORIAS</span><span class="p">]</span><span class="w"> </span><span class="n">CA</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">CA</span><span class="p">.</span><span class="n">ID_CATEGORIA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MT</span><span class="p">.</span><span class="n">ID_CATEGORIA_FAMILIAR</span>
<span class="w">        </span><span class="k">JOIN</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Colegio</span><span class="p">].[</span><span class="n">DIM_ESTADO_GESTION</span><span class="p">]</span><span class="w">  </span><span class="n">EG</span><span class="w">  </span><span class="k">ON</span><span class="w">   </span><span class="n">EG</span><span class="p">.</span><span class="n">ID_ESTADO_GESTION</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MT</span><span class="p">.</span><span class="n">ID_ESTADO_GESTION</span>
<span class="w">        </span><span class="k">JOIN</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Colegio</span><span class="p">].[</span><span class="n">DIM_ESTADO_PROCESO</span><span class="p">]</span><span class="w">  </span><span class="n">EP</span><span class="w">  </span><span class="k">ON</span><span class="w">   </span><span class="n">EP</span><span class="p">.</span><span class="n">ID_ESTADO_PROCESO</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MT</span><span class="p">.</span><span class="n">ID_ESTADO_PROCESO</span>
<span class="w">        </span><span class="k">JOIN</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Colegio</span><span class="p">].[</span><span class="n">DIM_ESTADO_ADMISION</span><span class="p">]</span><span class="w"> </span><span class="n">EA</span><span class="w">  </span><span class="k">ON</span><span class="w">  </span><span class="n">EA</span><span class="p">.</span><span class="n">ID_ESTADO_ADMISION</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MT</span><span class="p">.</span><span class="n">ID_ESTADO_ADMISION</span>
<span class="w">        </span><span class="k">JOIN</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Colegio</span><span class="p">].[</span><span class="n">DIM_CURSO</span><span class="p">]</span><span class="w"> </span><span class="n">CS</span><span class="w">            </span><span class="k">ON</span><span class="w">  </span><span class="n">CS</span><span class="p">.</span><span class="n">ID_CURSO</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MT</span><span class="p">.</span><span class="n">ID_CURSO</span>
<span class="w">        </span><span class="k">JOIN</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Colegio</span><span class="p">].[</span><span class="n">DIM_TIPO_ESTUDIANTE</span><span class="p">]</span><span class="w"> </span><span class="n">ES</span><span class="w">  </span><span class="k">ON</span><span class="w">  </span><span class="n">ES</span><span class="p">.</span><span class="n">ID_TIPO_ESTUDIANTE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MT</span><span class="p">.</span><span class="n">ID_TIPO_ESTUDIANTE</span>
<span class="w">        </span><span class="k">JOIN</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Colegio</span><span class="p">].[</span><span class="n">DIM_ESTADO_CODEUDOR</span><span class="p">]</span><span class="w"> </span><span class="n">ED</span><span class="w">  </span><span class="k">ON</span><span class="w">  </span><span class="n">ED</span><span class="p">.</span><span class="n">ID_ESTADO_CODEUDOR</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MT</span><span class="p">.</span><span class="n">ID_ESTADO_CODEUDOR</span>
<span class="w">        </span><span class="k">JOIN</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Colegio</span><span class="p">].[</span><span class="n">DIM_POBLACION_MATRICULA</span><span class="p">]</span><span class="w"> </span><span class="n">EM</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">EM</span><span class="p">.</span><span class="n">PARTNER</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MT</span><span class="p">.</span><span class="n">BP</span>

<span class="w">        </span><span class="k">WHERE</span><span class="w"> </span><span class="n">MT</span><span class="p">.</span><span class="n">ID_ESTADO_PROCESO</span><span class="w"> </span><span class="o">!=</span><span class="mi">11</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">MT</span><span class="p">.</span><span class="n">ID_TIPO_ESTUDIANTE</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">2</span><span class="w">  </span>
<span class="w">        </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">T</span><span class="p">.</span><span class="n">ID_FECHA</span><span class="p">,</span>
<span class="w">                </span><span class="n">MT</span><span class="p">.</span><span class="n">ANIO_ACADEMICO</span><span class="p">,</span>
<span class="w">                </span><span class="n">MT</span><span class="p">.</span><span class="n">BP</span><span class="p">,</span>
<span class="w">                </span><span class="n">CA</span><span class="p">.</span><span class="n">ID_CATEGORIA</span><span class="p">,</span>
<span class="w">                </span><span class="n">CS</span><span class="p">.</span><span class="n">ID_CURSO</span><span class="p">,</span>
<span class="w">                </span><span class="n">ES</span><span class="p">.</span><span class="n">ID_TIPO_ESTUDIANTE</span>

<span class="w">    </span><span class="p">)</span><span class="n">FT</span>
<span class="w">    </span><span class="k">OUTER</span><span class="w"> </span><span class="n">APPLY</span>
<span class="w">    </span><span class="p">(</span>
<span class="w">        </span><span class="k">SELECT</span><span class="w"> </span><span class="p">[</span><span class="mi">1</span><span class="p">],[</span><span class="mi">3</span><span class="p">],[</span><span class="mi">4</span><span class="p">],[</span><span class="mi">5</span><span class="p">],[</span><span class="mi">11</span><span class="p">],[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="w">        </span><span class="k">FROM</span>
<span class="w">        </span><span class="p">(</span>

<span class="w">            </span><span class="k">SELECT</span><span class="w">  </span><span class="n">T</span><span class="p">.</span><span class="n">ID_FECHA</span><span class="p">,</span>
<span class="w">                    </span><span class="n">MT</span><span class="p">.</span><span class="n">ANIO_ACADEMICO</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_ANIO_ACADEMICO</span><span class="p">,</span>
<span class="w">                    </span><span class="n">MT</span><span class="p">.</span><span class="n">BP</span><span class="p">,</span>
<span class="w">                    </span><span class="n">CA</span><span class="p">.</span><span class="n">ID_CATEGORIA</span><span class="p">,</span>
<span class="w">                    </span><span class="n">CS</span><span class="p">.</span><span class="n">ID_CURSO</span><span class="p">,</span>
<span class="w">                    </span><span class="n">ES</span><span class="p">.</span><span class="n">ID_TIPO_ESTUDIANTE</span><span class="p">,</span>
<span class="w">                    </span><span class="n">EP</span><span class="p">.</span><span class="n">ID_ESTADO_PROCESO</span><span class="p">,</span>
<span class="w">                    </span><span class="k">SUM</span><span class="p">(</span><span class="n">MT</span><span class="p">.</span><span class="n">TIEMPO_GESTION_SEGUNDO_DIA_HABIL</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">TIEMPO_GESTION_SEGUNDO_DIA_HABIL</span>

<span class="w">            </span><span class="k">FROM</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Colegio</span><span class="p">].[</span><span class="n">FACT_INSCRIPCION_MATRICULAS</span><span class="p">]</span><span class="w"> </span><span class="n">MT</span><span class="w"> </span>
<span class="w">            </span><span class="k">JOIN</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Dwh</span><span class="p">].[</span><span class="n">DIM_TIEMPO</span><span class="p">]</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">T</span><span class="p">.</span><span class="n">ID_FECHA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MT</span><span class="p">.</span><span class="n">ID_FECHA</span>
<span class="w">            </span><span class="k">JOIN</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Dwh</span><span class="p">].[</span><span class="n">DIM_CATEGORIAS</span><span class="p">]</span><span class="w"> </span><span class="n">CA</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">CA</span><span class="p">.</span><span class="n">ID_CATEGORIA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MT</span><span class="p">.</span><span class="n">ID_CATEGORIA_FAMILIAR</span>
<span class="w">            </span><span class="k">JOIN</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Colegio</span><span class="p">].[</span><span class="n">DIM_ESTADO_GESTION</span><span class="p">]</span><span class="w">  </span><span class="n">EG</span><span class="w">  </span><span class="k">ON</span><span class="w">   </span><span class="n">EG</span><span class="p">.</span><span class="n">ID_ESTADO_GESTION</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MT</span><span class="p">.</span><span class="n">ID_ESTADO_GESTION</span>
<span class="w">            </span><span class="k">JOIN</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Colegio</span><span class="p">].[</span><span class="n">DIM_ESTADO_PROCESO</span><span class="p">]</span><span class="w">  </span><span class="n">EP</span><span class="w">  </span><span class="k">ON</span><span class="w">   </span><span class="n">EP</span><span class="p">.</span><span class="n">ID_ESTADO_PROCESO</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MT</span><span class="p">.</span><span class="n">ID_ESTADO_PROCESO</span>
<span class="w">            </span><span class="k">JOIN</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Colegio</span><span class="p">].[</span><span class="n">DIM_ESTADO_ADMISION</span><span class="p">]</span><span class="w"> </span><span class="n">EA</span><span class="w">  </span><span class="k">ON</span><span class="w">  </span><span class="n">EA</span><span class="p">.</span><span class="n">ID_ESTADO_ADMISION</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MT</span><span class="p">.</span><span class="n">ID_ESTADO_ADMISION</span>
<span class="w">            </span><span class="k">JOIN</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Colegio</span><span class="p">].[</span><span class="n">DIM_CURSO</span><span class="p">]</span><span class="w"> </span><span class="n">CS</span><span class="w">            </span><span class="k">ON</span><span class="w">  </span><span class="n">CS</span><span class="p">.</span><span class="n">ID_CURSO</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MT</span><span class="p">.</span><span class="n">ID_CURSO</span>
<span class="w">            </span><span class="k">JOIN</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Colegio</span><span class="p">].[</span><span class="n">DIM_TIPO_ESTUDIANTE</span><span class="p">]</span><span class="w"> </span><span class="n">ES</span><span class="w">  </span><span class="k">ON</span><span class="w">  </span><span class="n">ES</span><span class="p">.</span><span class="n">ID_TIPO_ESTUDIANTE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MT</span><span class="p">.</span><span class="n">ID_TIPO_ESTUDIANTE</span>
<span class="w">            </span><span class="k">JOIN</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Colegio</span><span class="p">].[</span><span class="n">DIM_ESTADO_CODEUDOR</span><span class="p">]</span><span class="w"> </span><span class="n">ED</span><span class="w">  </span><span class="k">ON</span><span class="w">  </span><span class="n">ED</span><span class="p">.</span><span class="n">ID_ESTADO_CODEUDOR</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MT</span><span class="p">.</span><span class="n">ID_ESTADO_CODEUDOR</span>
<span class="w">            </span><span class="k">JOIN</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Colegio</span><span class="p">].[</span><span class="n">DIM_POBLACION_MATRICULA</span><span class="p">]</span><span class="w"> </span><span class="n">EM</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">EM</span><span class="p">.</span><span class="n">PARTNER</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MT</span><span class="p">.</span><span class="n">BP</span>


<span class="w">            </span><span class="k">WHERE</span><span class="w">   </span><span class="n">MT</span><span class="p">.</span><span class="n">ID_ESTADO_PROCESO</span><span class="w"> </span><span class="o">!=</span><span class="mi">11</span>
<span class="w">                </span><span class="k">AND</span><span class="w"> </span><span class="n">FT</span><span class="p">.</span><span class="n">ID_FECHA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MT</span><span class="p">.</span><span class="n">ID_FECHA</span>
<span class="w">                </span><span class="k">AND</span><span class="w"> </span><span class="n">FT</span><span class="p">.</span><span class="n">ID_ANIO_ACADEMICO</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MT</span><span class="p">.</span><span class="n">ANIO_ACADEMICO</span>
<span class="w">                </span><span class="k">AND</span><span class="w"> </span><span class="n">FT</span><span class="p">.</span><span class="n">BP</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MT</span><span class="p">.</span><span class="n">BP</span>
<span class="w">                </span><span class="k">AND</span><span class="w"> </span><span class="n">FT</span><span class="p">.</span><span class="n">ID_CURSO</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MT</span><span class="p">.</span><span class="n">ID_CURSO</span>
<span class="w">                </span><span class="k">AND</span><span class="w"> </span><span class="n">FT</span><span class="p">.</span><span class="n">ID_TIPO_ESTUDIANTE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MT</span><span class="p">.</span><span class="n">ID_TIPO_ESTUDIANTE</span>


<span class="w">        </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">T</span><span class="p">.</span><span class="n">ID_FECHA</span><span class="p">,</span>
<span class="w">                </span><span class="n">MT</span><span class="p">.</span><span class="n">ANIO_ACADEMICO</span><span class="p">,</span>
<span class="w">                </span><span class="n">MT</span><span class="p">.</span><span class="n">BP</span><span class="p">,</span>
<span class="w">                </span><span class="n">CA</span><span class="p">.</span><span class="n">ID_CATEGORIA</span><span class="p">,</span>
<span class="w">                </span><span class="n">CS</span><span class="p">.</span><span class="n">ID_CURSO</span><span class="p">,</span>
<span class="w">                </span><span class="n">ES</span><span class="p">.</span><span class="n">ID_TIPO_ESTUDIANTE</span><span class="p">,</span>
<span class="w">                </span><span class="n">EP</span><span class="p">.</span><span class="n">ID_ESTADO_PROCESO</span>
<span class="w">        </span><span class="p">)</span><span class="n">FT1</span>
<span class="w">        </span><span class="n">PIVOT</span><span class="w"> </span><span class="p">(</span><span class="k">SUM</span><span class="p">(</span><span class="n">TIEMPO_GESTION_SEGUNDO_DIA_HABIL</span><span class="p">)</span><span class="w"> </span><span class="k">FOR</span><span class="w"> </span><span class="n">ID_ESTADO_PROCESO</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">([</span><span class="mi">1</span><span class="p">],[</span><span class="mi">3</span><span class="p">],[</span><span class="mi">4</span><span class="p">],[</span><span class="mi">5</span><span class="p">],[</span><span class="mi">11</span><span class="p">],[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">PVT</span><span class="w">   </span>

<span class="w">    </span><span class="p">)</span><span class="n">FT2</span>

<span class="w">    </span><span class="k">OUTER</span><span class="w"> </span><span class="n">APPLY</span>
<span class="w">    </span><span class="p">(</span>
<span class="w">        </span><span class="k">SELECT</span><span class="w"> </span><span class="n">IND_CUMPLIMIENTO</span>
<span class="w">        </span><span class="k">FROM</span>
<span class="w">        </span><span class="p">(</span>

<span class="w">            </span><span class="k">SELECT</span><span class="w">  </span><span class="n">T</span><span class="p">.</span><span class="n">ID_FECHA</span><span class="p">,</span>
<span class="w">                    </span><span class="n">MT</span><span class="p">.</span><span class="n">ANIO_ACADEMICO</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_ANIO_ACADEMICO</span><span class="p">,</span>
<span class="w">                    </span><span class="n">MT</span><span class="p">.</span><span class="n">BP</span><span class="p">,</span>
<span class="w">                    </span><span class="n">CA</span><span class="p">.</span><span class="n">ID_CATEGORIA</span><span class="p">,</span>
<span class="w">                    </span><span class="n">CS</span><span class="p">.</span><span class="n">ID_CURSO</span><span class="p">,</span>
<span class="w">                    </span><span class="n">ES</span><span class="p">.</span><span class="n">ID_TIPO_ESTUDIANTE</span><span class="p">,</span>
<span class="w">                    </span><span class="mi">0</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">IND_CUMPLIMIENTO</span><span class="w"> </span>


<span class="w">            </span><span class="k">FROM</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Colegio</span><span class="p">].[</span><span class="n">FACT_INSCRIPCION_MATRICULAS</span><span class="p">]</span><span class="w"> </span><span class="n">MT</span><span class="w"> </span>
<span class="w">            </span><span class="k">JOIN</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Dwh</span><span class="p">].[</span><span class="n">DIM_TIEMPO</span><span class="p">]</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">T</span><span class="p">.</span><span class="n">ID_FECHA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MT</span><span class="p">.</span><span class="n">ID_FECHA</span>
<span class="w">            </span><span class="k">JOIN</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Dwh</span><span class="p">].[</span><span class="n">DIM_CATEGORIAS</span><span class="p">]</span><span class="w"> </span><span class="n">CA</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">CA</span><span class="p">.</span><span class="n">ID_CATEGORIA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MT</span><span class="p">.</span><span class="n">ID_CATEGORIA_FAMILIAR</span>
<span class="w">            </span><span class="k">JOIN</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Colegio</span><span class="p">].[</span><span class="n">DIM_ESTADO_GESTION</span><span class="p">]</span><span class="w">  </span><span class="n">EG</span><span class="w">  </span><span class="k">ON</span><span class="w">   </span><span class="n">EG</span><span class="p">.</span><span class="n">ID_ESTADO_GESTION</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MT</span><span class="p">.</span><span class="n">ID_ESTADO_GESTION</span>
<span class="w">            </span><span class="k">JOIN</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Colegio</span><span class="p">].[</span><span class="n">DIM_ESTADO_PROCESO</span><span class="p">]</span><span class="w">  </span><span class="n">EP</span><span class="w">  </span><span class="k">ON</span><span class="w">   </span><span class="n">EP</span><span class="p">.</span><span class="n">ID_ESTADO_PROCESO</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MT</span><span class="p">.</span><span class="n">ID_ESTADO_PROCESO</span>
<span class="w">            </span><span class="k">JOIN</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Colegio</span><span class="p">].[</span><span class="n">DIM_ESTADO_ADMISION</span><span class="p">]</span><span class="w"> </span><span class="n">EA</span><span class="w">  </span><span class="k">ON</span><span class="w">  </span><span class="n">EA</span><span class="p">.</span><span class="n">ID_ESTADO_ADMISION</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MT</span><span class="p">.</span><span class="n">ID_ESTADO_ADMISION</span>
<span class="w">            </span><span class="k">JOIN</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Colegio</span><span class="p">].[</span><span class="n">DIM_CURSO</span><span class="p">]</span><span class="w"> </span><span class="n">CS</span><span class="w">            </span><span class="k">ON</span><span class="w">  </span><span class="n">CS</span><span class="p">.</span><span class="n">ID_CURSO</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MT</span><span class="p">.</span><span class="n">ID_CURSO</span>
<span class="w">            </span><span class="k">JOIN</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Colegio</span><span class="p">].[</span><span class="n">DIM_TIPO_ESTUDIANTE</span><span class="p">]</span><span class="w"> </span><span class="n">ES</span><span class="w">  </span><span class="k">ON</span><span class="w">  </span><span class="n">ES</span><span class="p">.</span><span class="n">ID_TIPO_ESTUDIANTE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MT</span><span class="p">.</span><span class="n">ID_TIPO_ESTUDIANTE</span>
<span class="w">            </span><span class="k">JOIN</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Colegio</span><span class="p">].[</span><span class="n">DIM_ESTADO_CODEUDOR</span><span class="p">]</span><span class="w"> </span><span class="n">ED</span><span class="w">  </span><span class="k">ON</span><span class="w">  </span><span class="n">ED</span><span class="p">.</span><span class="n">ID_ESTADO_CODEUDOR</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MT</span><span class="p">.</span><span class="n">ID_ESTADO_CODEUDOR</span>
<span class="w">            </span><span class="k">JOIN</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Colegio</span><span class="p">].[</span><span class="n">DIM_POBLACION_MATRICULA</span><span class="p">]</span><span class="w"> </span><span class="n">EM</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">EM</span><span class="p">.</span><span class="n">PARTNER</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MT</span><span class="p">.</span><span class="n">BP</span>


<span class="w">            </span><span class="k">WHERE</span><span class="w">   </span><span class="n">MT</span><span class="p">.</span><span class="n">ID_ESTADO_PROCESO</span><span class="w"> </span><span class="o">!=</span><span class="mi">11</span>
<span class="w">                </span><span class="k">AND</span><span class="w"> </span><span class="n">FT</span><span class="p">.</span><span class="n">ID_FECHA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MT</span><span class="p">.</span><span class="n">ID_FECHA</span>
<span class="w">                </span><span class="k">AND</span><span class="w"> </span><span class="n">FT</span><span class="p">.</span><span class="n">ID_ANIO_ACADEMICO</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MT</span><span class="p">.</span><span class="n">ANIO_ACADEMICO</span>
<span class="w">                </span><span class="k">AND</span><span class="w"> </span><span class="n">FT</span><span class="p">.</span><span class="n">BP</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MT</span><span class="p">.</span><span class="n">BP</span>
<span class="w">                </span><span class="k">AND</span><span class="w"> </span><span class="n">FT</span><span class="p">.</span><span class="n">ID_CURSO</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MT</span><span class="p">.</span><span class="n">ID_CURSO</span>
<span class="w">                </span><span class="k">AND</span><span class="w"> </span><span class="n">FT</span><span class="p">.</span><span class="n">ID_TIPO_ESTUDIANTE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MT</span><span class="p">.</span><span class="n">ID_TIPO_ESTUDIANTE</span>
<span class="w">                </span><span class="k">AND</span><span class="w"> </span><span class="k">cast</span><span class="p">(</span><span class="n">mt</span><span class="p">.</span><span class="n">FECHA_GESTION</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="nb">date</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;1900-01-01&#39;</span>


<span class="w">        </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">T</span><span class="p">.</span><span class="n">ID_FECHA</span><span class="p">,</span>
<span class="w">                </span><span class="n">MT</span><span class="p">.</span><span class="n">ANIO_ACADEMICO</span><span class="p">,</span>
<span class="w">                </span><span class="n">MT</span><span class="p">.</span><span class="n">BP</span><span class="p">,</span>
<span class="w">                </span><span class="n">CA</span><span class="p">.</span><span class="n">ID_CATEGORIA</span><span class="p">,</span>
<span class="w">                </span><span class="n">CS</span><span class="p">.</span><span class="n">ID_CURSO</span><span class="p">,</span>
<span class="w">                </span><span class="n">ES</span><span class="p">.</span><span class="n">ID_TIPO_ESTUDIANTE</span>

<span class="w">        </span><span class="p">)</span><span class="n">FT1</span>

<span class="w">    </span><span class="p">)</span><span class="n">FT3</span>

<span class="w">    </span><span class="k">OUTER</span><span class="w"> </span><span class="n">APPLY</span>
<span class="w">    </span><span class="p">(</span>
<span class="w">        </span><span class="k">SELECT</span><span class="w"> </span><span class="n">T_TOTAL_GESTION</span>
<span class="w">        </span><span class="k">FROM</span>
<span class="w">        </span><span class="p">(</span>

<span class="w">            </span><span class="k">SELECT</span><span class="w">  </span><span class="n">T</span><span class="p">.</span><span class="n">ID_FECHA</span><span class="p">,</span>
<span class="w">                    </span><span class="n">MT</span><span class="p">.</span><span class="n">ANIO_ACADEMICO</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_ANIO_ACADEMICO</span><span class="p">,</span>
<span class="w">                    </span><span class="n">MT</span><span class="p">.</span><span class="n">BP</span><span class="p">,</span>
<span class="w">                    </span><span class="n">CA</span><span class="p">.</span><span class="n">ID_CATEGORIA</span><span class="p">,</span>
<span class="w">                    </span><span class="n">CS</span><span class="p">.</span><span class="n">ID_CURSO</span><span class="p">,</span>
<span class="w">                    </span><span class="n">ES</span><span class="p">.</span><span class="n">ID_TIPO_ESTUDIANTE</span><span class="p">,</span>
<span class="w">                    </span><span class="k">MAX</span><span class="p">(</span><span class="n">TIEMPO_GESTION_SEGUNDO_DIA_HABIL</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">T_TOTAL_GESTION</span>


<span class="w">            </span><span class="k">FROM</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Colegio</span><span class="p">].[</span><span class="n">FACT_INSCRIPCION_MATRICULAS</span><span class="p">]</span><span class="w"> </span><span class="n">MT</span><span class="w"> </span>
<span class="w">            </span><span class="k">JOIN</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Dwh</span><span class="p">].[</span><span class="n">DIM_TIEMPO</span><span class="p">]</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">T</span><span class="p">.</span><span class="n">ID_FECHA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MT</span><span class="p">.</span><span class="n">ID_FECHA</span>
<span class="w">            </span><span class="k">JOIN</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Dwh</span><span class="p">].[</span><span class="n">DIM_CATEGORIAS</span><span class="p">]</span><span class="w"> </span><span class="n">CA</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">CA</span><span class="p">.</span><span class="n">ID_CATEGORIA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MT</span><span class="p">.</span><span class="n">ID_CATEGORIA_FAMILIAR</span>
<span class="w">            </span><span class="k">JOIN</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Colegio</span><span class="p">].[</span><span class="n">DIM_ESTADO_GESTION</span><span class="p">]</span><span class="w">  </span><span class="n">EG</span><span class="w">  </span><span class="k">ON</span><span class="w">   </span><span class="n">EG</span><span class="p">.</span><span class="n">ID_ESTADO_GESTION</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MT</span><span class="p">.</span><span class="n">ID_ESTADO_GESTION</span>
<span class="w">            </span><span class="k">JOIN</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Colegio</span><span class="p">].[</span><span class="n">DIM_ESTADO_PROCESO</span><span class="p">]</span><span class="w">  </span><span class="n">EP</span><span class="w">  </span><span class="k">ON</span><span class="w">   </span><span class="n">EP</span><span class="p">.</span><span class="n">ID_ESTADO_PROCESO</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MT</span><span class="p">.</span><span class="n">ID_ESTADO_PROCESO</span>
<span class="w">            </span><span class="k">JOIN</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Colegio</span><span class="p">].[</span><span class="n">DIM_ESTADO_ADMISION</span><span class="p">]</span><span class="w"> </span><span class="n">EA</span><span class="w">  </span><span class="k">ON</span><span class="w">  </span><span class="n">EA</span><span class="p">.</span><span class="n">ID_ESTADO_ADMISION</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MT</span><span class="p">.</span><span class="n">ID_ESTADO_ADMISION</span>
<span class="w">            </span><span class="k">JOIN</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Colegio</span><span class="p">].[</span><span class="n">DIM_CURSO</span><span class="p">]</span><span class="w"> </span><span class="n">CS</span><span class="w">            </span><span class="k">ON</span><span class="w">  </span><span class="n">CS</span><span class="p">.</span><span class="n">ID_CURSO</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MT</span><span class="p">.</span><span class="n">ID_CURSO</span>
<span class="w">            </span><span class="k">JOIN</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Colegio</span><span class="p">].[</span><span class="n">DIM_TIPO_ESTUDIANTE</span><span class="p">]</span><span class="w"> </span><span class="n">ES</span><span class="w">  </span><span class="k">ON</span><span class="w">  </span><span class="n">ES</span><span class="p">.</span><span class="n">ID_TIPO_ESTUDIANTE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MT</span><span class="p">.</span><span class="n">ID_TIPO_ESTUDIANTE</span>
<span class="w">            </span><span class="k">JOIN</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Colegio</span><span class="p">].[</span><span class="n">DIM_ESTADO_CODEUDOR</span><span class="p">]</span><span class="w"> </span><span class="n">ED</span><span class="w">  </span><span class="k">ON</span><span class="w">  </span><span class="n">ED</span><span class="p">.</span><span class="n">ID_ESTADO_CODEUDOR</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MT</span><span class="p">.</span><span class="n">ID_ESTADO_CODEUDOR</span>
<span class="w">            </span><span class="k">JOIN</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Colegio</span><span class="p">].[</span><span class="n">DIM_POBLACION_MATRICULA</span><span class="p">]</span><span class="w"> </span><span class="n">EM</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">EM</span><span class="p">.</span><span class="n">PARTNER</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MT</span><span class="p">.</span><span class="n">BP</span>


<span class="w">            </span><span class="k">WHERE</span><span class="w">   </span><span class="n">MT</span><span class="p">.</span><span class="n">ID_ESTADO_PROCESO</span><span class="w"> </span><span class="o">!=</span><span class="mi">11</span>
<span class="w">                </span><span class="k">AND</span><span class="w"> </span><span class="n">FT</span><span class="p">.</span><span class="n">ID_FECHA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MT</span><span class="p">.</span><span class="n">ID_FECHA</span>
<span class="w">                </span><span class="k">AND</span><span class="w"> </span><span class="n">FT</span><span class="p">.</span><span class="n">ID_ANIO_ACADEMICO</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MT</span><span class="p">.</span><span class="n">ANIO_ACADEMICO</span>
<span class="w">                </span><span class="k">AND</span><span class="w"> </span><span class="n">FT</span><span class="p">.</span><span class="n">BP</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MT</span><span class="p">.</span><span class="n">BP</span>
<span class="w">                </span><span class="k">AND</span><span class="w"> </span><span class="n">FT</span><span class="p">.</span><span class="n">ID_CURSO</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MT</span><span class="p">.</span><span class="n">ID_CURSO</span>
<span class="w">                </span><span class="k">AND</span><span class="w"> </span><span class="n">FT</span><span class="p">.</span><span class="n">ID_TIPO_ESTUDIANTE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MT</span><span class="p">.</span><span class="n">ID_TIPO_ESTUDIANTE</span>


<span class="w">        </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">T</span><span class="p">.</span><span class="n">ID_FECHA</span><span class="p">,</span>
<span class="w">                </span><span class="n">MT</span><span class="p">.</span><span class="n">ANIO_ACADEMICO</span><span class="p">,</span>
<span class="w">                </span><span class="n">MT</span><span class="p">.</span><span class="n">BP</span><span class="p">,</span>
<span class="w">                </span><span class="n">CA</span><span class="p">.</span><span class="n">ID_CATEGORIA</span><span class="p">,</span>
<span class="w">                </span><span class="n">CS</span><span class="p">.</span><span class="n">ID_CURSO</span><span class="p">,</span>
<span class="w">                </span><span class="n">ES</span><span class="p">.</span><span class="n">ID_TIPO_ESTUDIANTE</span>

<span class="w">        </span><span class="p">)</span><span class="n">FT1</span>

<span class="w">    </span><span class="p">)</span><span class="n">FT4</span>
<span class="w">        </span><span class="k">OUTER</span><span class="w"> </span><span class="n">APPLY</span>
<span class="w">    </span><span class="p">(</span>
<span class="w">        </span><span class="k">SELECT</span><span class="w">  </span><span class="k">ISNULL</span><span class="w"> </span><span class="p">([</span><span class="n">EN</span><span class="w"> </span><span class="n">PROCESO</span><span class="p">],</span><span class="mi">0</span><span class="p">)</span><span class="w">         </span><span class="k">AS</span><span class="w">  </span><span class="n">IND_EN_PROCESO</span><span class="p">,</span>
<span class="w">                </span><span class="k">ISNULL</span><span class="w"> </span><span class="p">([</span><span class="n">ADMITIDO</span><span class="p">],</span><span class="mi">0</span><span class="p">)</span><span class="w">           </span><span class="k">AS</span><span class="w">  </span><span class="n">IND_ADMITIDO</span><span class="p">,</span>
<span class="w">                </span><span class="k">ISNULL</span><span class="w"> </span><span class="p">([</span><span class="k">NO</span><span class="w"> </span><span class="n">ADMITIDO</span><span class="p">],</span><span class="mi">0</span><span class="p">)</span><span class="w">        </span><span class="k">AS</span><span class="w">  </span><span class="n">IND_NO_ADMITIDO</span><span class="p">,</span>
<span class="w">                </span><span class="k">ISNULL</span><span class="w"> </span><span class="p">([</span><span class="n">PROCESO</span><span class="w"> </span><span class="n">DESISTIDO</span><span class="p">],</span><span class="mi">0</span><span class="p">)</span><span class="w">  </span><span class="k">AS</span><span class="w">  </span><span class="n">IND_DESISTIDO</span>
<span class="w">        </span><span class="k">FROM</span>
<span class="w">        </span><span class="p">(</span>

<span class="w">            </span><span class="k">SELECT</span><span class="w">  </span><span class="n">T</span><span class="p">.</span><span class="n">ID_FECHA</span><span class="p">,</span>
<span class="w">                    </span><span class="n">MT</span><span class="p">.</span><span class="n">ANIO_ACADEMICO</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_ANIO_ACADEMICO</span><span class="p">,</span>
<span class="w">                    </span><span class="n">MT</span><span class="p">.</span><span class="n">BP</span><span class="p">,</span>
<span class="w">                    </span><span class="n">CA</span><span class="p">.</span><span class="n">ID_CATEGORIA</span><span class="p">,</span>
<span class="w">                    </span><span class="n">CS</span><span class="p">.</span><span class="n">ID_CURSO</span><span class="p">,</span>
<span class="w">                    </span><span class="n">ES</span><span class="p">.</span><span class="n">ID_TIPO_ESTUDIANTE</span><span class="p">,</span>
<span class="w">                    </span><span class="n">EA</span><span class="p">.</span><span class="n">DESC_ESTADO_ADMISION</span><span class="p">,</span>
<span class="w">                    </span><span class="k">COUNT</span><span class="p">(</span><span class="n">MT</span><span class="p">.</span><span class="n">BP</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">IND_ADMISION</span>


<span class="w">            </span><span class="k">FROM</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Colegio</span><span class="p">].[</span><span class="n">FACT_INSCRIPCION_MATRICULAS</span><span class="p">]</span><span class="w"> </span><span class="n">MT</span><span class="w"> </span>
<span class="w">            </span><span class="k">JOIN</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Dwh</span><span class="p">].[</span><span class="n">DIM_TIEMPO</span><span class="p">]</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">T</span><span class="p">.</span><span class="n">ID_FECHA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MT</span><span class="p">.</span><span class="n">ID_FECHA</span>
<span class="w">            </span><span class="k">JOIN</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Dwh</span><span class="p">].[</span><span class="n">DIM_CATEGORIAS</span><span class="p">]</span><span class="w"> </span><span class="n">CA</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">CA</span><span class="p">.</span><span class="n">ID_CATEGORIA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MT</span><span class="p">.</span><span class="n">ID_CATEGORIA_FAMILIAR</span>
<span class="w">            </span><span class="k">JOIN</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Colegio</span><span class="p">].[</span><span class="n">DIM_ESTADO_GESTION</span><span class="p">]</span><span class="w">  </span><span class="n">EG</span><span class="w">  </span><span class="k">ON</span><span class="w">   </span><span class="n">EG</span><span class="p">.</span><span class="n">ID_ESTADO_GESTION</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MT</span><span class="p">.</span><span class="n">ID_ESTADO_GESTION</span>
<span class="w">            </span><span class="k">JOIN</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Colegio</span><span class="p">].[</span><span class="n">DIM_ESTADO_PROCESO</span><span class="p">]</span><span class="w">  </span><span class="n">EP</span><span class="w">  </span><span class="k">ON</span><span class="w">   </span><span class="n">EP</span><span class="p">.</span><span class="n">ID_ESTADO_PROCESO</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MT</span><span class="p">.</span><span class="n">ID_ESTADO_PROCESO</span>
<span class="w">            </span><span class="k">JOIN</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Colegio</span><span class="p">].[</span><span class="n">DIM_ESTADO_ADMISION</span><span class="p">]</span><span class="w"> </span><span class="n">EA</span><span class="w">  </span><span class="k">ON</span><span class="w">  </span><span class="n">EA</span><span class="p">.</span><span class="n">ID_ESTADO_ADMISION</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MT</span><span class="p">.</span><span class="n">ID_ESTADO_ADMISION</span>
<span class="w">            </span><span class="k">JOIN</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Colegio</span><span class="p">].[</span><span class="n">DIM_CURSO</span><span class="p">]</span><span class="w"> </span><span class="n">CS</span><span class="w">            </span><span class="k">ON</span><span class="w">  </span><span class="n">CS</span><span class="p">.</span><span class="n">ID_CURSO</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MT</span><span class="p">.</span><span class="n">ID_CURSO</span>
<span class="w">            </span><span class="k">JOIN</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Colegio</span><span class="p">].[</span><span class="n">DIM_TIPO_ESTUDIANTE</span><span class="p">]</span><span class="w"> </span><span class="n">ES</span><span class="w">  </span><span class="k">ON</span><span class="w">  </span><span class="n">ES</span><span class="p">.</span><span class="n">ID_TIPO_ESTUDIANTE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MT</span><span class="p">.</span><span class="n">ID_TIPO_ESTUDIANTE</span>
<span class="w">            </span><span class="k">JOIN</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Colegio</span><span class="p">].[</span><span class="n">DIM_ESTADO_CODEUDOR</span><span class="p">]</span><span class="w"> </span><span class="n">ED</span><span class="w">  </span><span class="k">ON</span><span class="w">  </span><span class="n">ED</span><span class="p">.</span><span class="n">ID_ESTADO_CODEUDOR</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MT</span><span class="p">.</span><span class="n">ID_ESTADO_CODEUDOR</span>
<span class="w">            </span><span class="k">JOIN</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Colegio</span><span class="p">].[</span><span class="n">DIM_POBLACION_MATRICULA</span><span class="p">]</span><span class="w"> </span><span class="n">EM</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">EM</span><span class="p">.</span><span class="n">PARTNER</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MT</span><span class="p">.</span><span class="n">BP</span>


<span class="w">            </span><span class="k">WHERE</span><span class="w">   </span><span class="n">MT</span><span class="p">.</span><span class="n">ID_ESTADO_PROCESO</span><span class="w"> </span><span class="o">!=</span><span class="mi">11</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">EA</span><span class="p">.</span><span class="n">DESC_ESTADO_ADMISION</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;EN PROCESO&#39;</span><span class="p">,</span><span class="s1">&#39;ADMITIDO&#39;</span><span class="p">,</span><span class="s1">&#39;NO ADMITIDO&#39;</span><span class="p">,</span><span class="s1">&#39;PROCESO DESISTIDO&#39;</span><span class="p">)</span>
<span class="w">                </span><span class="k">AND</span><span class="w"> </span><span class="n">FT</span><span class="p">.</span><span class="n">ID_FECHA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MT</span><span class="p">.</span><span class="n">ID_FECHA</span>
<span class="w">                </span><span class="k">AND</span><span class="w"> </span><span class="n">FT</span><span class="p">.</span><span class="n">ID_ANIO_ACADEMICO</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MT</span><span class="p">.</span><span class="n">ANIO_ACADEMICO</span>
<span class="w">                </span><span class="k">AND</span><span class="w"> </span><span class="n">FT</span><span class="p">.</span><span class="n">BP</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MT</span><span class="p">.</span><span class="n">BP</span>
<span class="w">                </span><span class="k">AND</span><span class="w"> </span><span class="n">FT</span><span class="p">.</span><span class="n">ID_CURSO</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MT</span><span class="p">.</span><span class="n">ID_CURSO</span>
<span class="w">                </span><span class="k">AND</span><span class="w"> </span><span class="n">FT</span><span class="p">.</span><span class="n">ID_TIPO_ESTUDIANTE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MT</span><span class="p">.</span><span class="n">ID_TIPO_ESTUDIANTE</span>


<span class="w">        </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">T</span><span class="p">.</span><span class="n">ID_FECHA</span><span class="p">,</span>
<span class="w">                </span><span class="n">MT</span><span class="p">.</span><span class="n">ANIO_ACADEMICO</span><span class="p">,</span>
<span class="w">                </span><span class="n">MT</span><span class="p">.</span><span class="n">BP</span><span class="p">,</span>
<span class="w">                </span><span class="n">CA</span><span class="p">.</span><span class="n">ID_CATEGORIA</span><span class="p">,</span>
<span class="w">                </span><span class="n">CS</span><span class="p">.</span><span class="n">ID_CURSO</span><span class="p">,</span>
<span class="w">                </span><span class="n">ES</span><span class="p">.</span><span class="n">ID_TIPO_ESTUDIANTE</span><span class="p">,</span>
<span class="w">                </span><span class="n">EA</span><span class="p">.</span><span class="n">DESC_ESTADO_ADMISION</span>

<span class="w">        </span><span class="p">)</span><span class="n">FT1</span>
<span class="w">        </span><span class="n">PIVOT</span><span class="w"> </span><span class="p">(</span><span class="k">COUNT</span><span class="p">(</span><span class="n">FT1</span><span class="p">.</span><span class="n">BP</span><span class="p">)</span><span class="w"> </span><span class="k">FOR</span><span class="w"> </span><span class="n">FT1</span><span class="p">.</span><span class="n">DESC_ESTADO_ADMISION</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">([</span><span class="n">EN</span><span class="w"> </span><span class="n">PROCESO</span><span class="p">],[</span><span class="n">ADMITIDO</span><span class="p">],[</span><span class="k">NO</span><span class="w"> </span><span class="n">ADMITIDO</span><span class="p">],[</span><span class="n">PROCESO</span><span class="w"> </span><span class="n">DESISTIDO</span><span class="p">]))</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">PVT</span><span class="w">    </span>

<span class="w">    </span><span class="p">)</span><span class="n">FT5</span>
</code></pre></div>
<h3 id="fact_mineriamineria_colegiogestion-matriculas"><strong>FACT_MINERIA\MINERIA_COLEGIO\Gestion Matriculas</strong><a class="headerlink" href="#fact_mineriamineria_colegiogestion-matriculas" title="Permanent link">&para;</a></h3>
<hr />
<h4 id="descripcion-general_25"><strong>Descripción General</strong><a class="headerlink" href="#descripcion-general_25" title="Permanent link">&para;</a></h4>
<p>El componente <strong>Gestion Matriculas</strong> del paquete SSIS tiene como función la integración de registros asociados al proceso de matrícula en colegios del dominio educativo, estructurando información operacional que describe el tipo de gestión realizada, su duración y atributos académicos asociados, para su incorporación en la tabla de hechos <code>FACT_MINERIA</code>.</p>
<hr />
<h4 id="ubicacion-del-componente_1"><strong>Ubicación del Componente</strong><a class="headerlink" href="#ubicacion-del-componente_1" title="Permanent link">&para;</a></h4>
<p><code>FACT_MINERIA.dtsx &gt; MINERIA_COLEGIO &gt; Gestion Matriculas</code></p>
<hr />
<h4 id="proposito_23"><strong>Propósito</strong><a class="headerlink" href="#proposito_23" title="Permanent link">&para;</a></h4>
<p>Consolidar eventos del proceso de matrícula de estudiantes (como atención por psicología, coordinación académica, secretaría, etc.), asignando el tipo de actividad, duración y fecha para permitir análisis operativos y de eficiencia institucional.</p>
<hr />
<h4 id="detalles-de-implementacion_28"><strong>Detalles de Implementación</strong><a class="headerlink" href="#detalles-de-implementacion_28" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p><strong>Fuente de Datos:</strong>
  <code>[STAGE_AREA].[Transversal].[TMP_PROCESO_MATRICULA_COLEGIO]</code>
  con enriquecimiento por <code>[DWH_COMFENALCO].[Transversal].[DIM_TIEMPO_MENSUAL]</code>.</p>
</li>
<li>
<p><strong>Destino:</strong>
  <code>"Transversal"."FACT_MINERIA"</code></p>
</li>
<li>
<p><strong>Tipo de Componente:</strong>
  Flujo de datos ADO.NET Source + ADO.NET Destination</p>
</li>
<li>
<p><strong>Carga:</strong>
  Inserción directa con <code>SqlBulkCopy</code>, sin particionamiento (<code>BatchSize = 0</code>).</p>
</li>
</ul>
<hr />
<h4 id="logica-de-negocio_27"><strong>Lógica de Negocio</strong><a class="headerlink" href="#logica-de-negocio_27" title="Permanent link">&para;</a></h4>
<ol>
<li>
<p><strong>Extracción:</strong>
   Se seleccionan múltiples subconjuntos de datos según los diferentes puntos de contacto del proceso de matrícula (codeudor, secretaría académica, psicología, coordinación académica).</p>
</li>
<li>
<p><strong>Transformación:</strong></p>
<ul>
<li>Se crea la columna <code>ACTIVIDAD</code> para diferenciar el tipo de gestión.</li>
<li><code>TIEMPO_SEGUNDOS</code> se calcula con base en columnas temporales específicas (<code>T_CODEUDOR</code>, <code>T_PSICOLOGIA</code>, etc.).</li>
<li>Se generan <code>FECHA_INICIAL</code> y <code>FECHA_FINAL</code> basados en <code>ID_FECHA</code> y los segundos de gestión.</li>
</ul>
</li>
<li>
<p><strong>Carga:</strong>
   La información se inserta en <code>FACT_MINERIA</code>, incluyendo datos de tiempo, curso, categoría, tipo de estudiante y tipo de actividad.</p>
</li>
</ol>
<hr />
<h4 id="relacion-con-otros-componentes_26"><strong>Relación con Otros Componentes</strong><a class="headerlink" href="#relacion-con-otros-componentes_26" title="Permanent link">&para;</a></h4>
<p>Este flujo alimenta la tabla <code>FACT_MINERIA</code>, la cual también es utilizada por otros componentes de minería educativa. Se vincula con dimensiones temporales y académicas que permiten análisis transversales.</p>
<hr />
<h4 id="script-sql-completo_2"><strong>Script SQL Completo</strong><a class="headerlink" href="#script-sql-completo_2" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span>
<span class="w">    </span><span class="n">BP</span>
<span class="w">    </span><span class="p">,</span><span class="n">ID_FECHA_MENSUAL</span>
<span class="w">    </span><span class="p">,</span><span class="n">ID_ANIO_ACADEMICO</span>
<span class="w">    </span><span class="c1">--,CONVERT(INT, LEFT(CAST(ID_FECHA AS VARCHAR), 6) + &#39;01&#39;) AS ID_FECHA_MENSUAL</span>
<span class="w">    </span><span class="p">,</span><span class="mi">1</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_UNIDAD</span><span class="p">,</span>
<span class="w">    </span><span class="k">CAST</span><span class="p">(</span><span class="k">CONVERT</span><span class="p">(</span><span class="nb">varchar</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="n">ID_FECHA</span><span class="p">])</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">datetime</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">FECHA_INICIAL</span><span class="p">,</span>
<span class="w">    </span><span class="n">DATEADD</span><span class="p">(</span><span class="k">SECOND</span><span class="p">,</span><span class="w"> </span><span class="n">TIEMPO_SEGUNDOS</span><span class="p">,</span><span class="w"> </span><span class="k">CAST</span><span class="p">(</span><span class="k">CONVERT</span><span class="p">(</span><span class="nb">varchar</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="n">ID_FECHA</span><span class="p">])</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">datetime</span><span class="p">))</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">FECHA_FINAL</span><span class="p">,</span>
<span class="w">    </span><span class="n">ACTIVIDAD</span><span class="p">,</span>
<span class="w">    </span><span class="n">TIEMPO_SEGUNDOS</span><span class="p">,</span>
<span class="w">    </span><span class="mi">0</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">VALOR_PAGADO</span><span class="p">,</span>
<span class="w">    </span><span class="n">ID_CATEGORIA</span><span class="p">,</span>
<span class="w">    </span><span class="n">ID_CURSO</span><span class="p">,</span>
<span class="w">    </span><span class="n">ID_TIPO_ESTUDIANTE</span><span class="p">,</span>
<span class="w">    </span><span class="s1">&#39;Consulta Proceso Matricula CEC Comfenalco&#39;</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">FUENTE_PRINCIPAL</span>
<span class="w">    </span><span class="c1">--P_CODEUDOR,</span>
<span class="w">    </span><span class="c1">--P_PSICOLOGIA,</span>
<span class="w">    </span><span class="c1">--P_SECRETARIA_ACADEMICA,</span>
<span class="w">    </span><span class="c1">--P_COORDINACION_ACADEMICA,    </span>
<span class="w">    </span><span class="cm">/*CASE </span>
<span class="cm">        WHEN IND_EN_PROCESO + IND_ADMITIDO + IND_NO_ADMITIDO + IND_DESISTIDO = 0 THEN 1 </span>
<span class="cm">        ELSE IND_EN_PROCESO </span>
<span class="cm">    END AS IND_EN_PROCESO,*/</span>
<span class="w">    </span><span class="c1">--IND_ADMITIDO,</span>
<span class="w">    </span><span class="c1">--IND_NO_ADMITIDO,</span>
<span class="w">    </span><span class="c1">--IND_DESISTIDO</span>
<span class="k">FROM</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="k">SELECT</span><span class="w"> </span>
<span class="w">        </span><span class="n">BP</span><span class="p">,</span>
<span class="w">        </span><span class="n">pm</span><span class="p">.</span><span class="n">ID_FECHA</span><span class="p">,</span>
<span class="w">        </span><span class="n">ID_ANIO_ACADEMICO</span><span class="p">,</span>
<span class="w">        </span><span class="k">CONVERT</span><span class="p">(</span><span class="nb">INT</span><span class="p">,</span><span class="w"> </span><span class="k">CAST</span><span class="p">(</span><span class="n">ID_ANIO_ACADEMICO</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;0101&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_FECHA_MENSUAL</span><span class="p">,</span>
<span class="w">        </span><span class="n">ID_CATEGORIA</span><span class="p">,</span>
<span class="w">        </span><span class="n">ID_CURSO</span><span class="p">,</span>
<span class="w">        </span><span class="n">ID_TIPO_ESTUDIANTE</span><span class="p">,</span>
<span class="w">        </span><span class="n">P_CODEUDOR</span><span class="p">,</span>
<span class="w">        </span><span class="n">P_PSICOLOGIA</span><span class="p">,</span>
<span class="w">        </span><span class="n">P_SECRETARIA_ACADEMICA</span><span class="p">,</span>
<span class="w">        </span><span class="n">P_COORDINACION_ACADEMICA</span><span class="p">,</span>
<span class="w">        </span><span class="s1">&#39;Gestión Codeudor&#39;</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ACTIVIDAD</span><span class="p">,</span><span class="w"> </span>
<span class="w">        </span><span class="k">ISNULL</span><span class="p">(</span><span class="n">T_CODEUDOR</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">TIEMPO_SEGUNDOS</span><span class="p">,</span>
<span class="w">        </span><span class="n">IND_EN_PROCESO</span><span class="p">,</span>
<span class="w">        </span><span class="n">IND_ADMITIDO</span><span class="p">,</span>
<span class="w">        </span><span class="n">IND_NO_ADMITIDO</span><span class="p">,</span>
<span class="w">        </span><span class="n">IND_DESISTIDO</span>
<span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="p">[</span><span class="n">STAGE_AREA</span><span class="p">].[</span><span class="n">Transversal</span><span class="p">].[</span><span class="n">TMP_PROCESO_MATRICULA_COLEGIO</span><span class="p">]</span><span class="w"> </span><span class="n">pm</span>
<span class="w">    </span><span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Transversal</span><span class="p">].[</span><span class="n">DIM_TIEMPO_MENSUAL</span><span class="p">]</span><span class="w"> </span><span class="n">tm</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">tm</span><span class="p">.[</span><span class="n">ID_FECHA</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">CONVERT</span><span class="p">(</span><span class="nb">INT</span><span class="p">,</span><span class="w"> </span><span class="k">LEFT</span><span class="p">(</span><span class="k">CAST</span><span class="p">(</span><span class="n">pm</span><span class="p">.</span><span class="n">ID_FECHA</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">),</span><span class="w"> </span><span class="mi">6</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;01&#39;</span><span class="p">)</span>
<span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="n">P_CODEUDOR</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span>

<span class="w">    </span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span>

<span class="w">    </span><span class="k">SELECT</span><span class="w"> </span>
<span class="w">        </span><span class="n">BP</span><span class="p">,</span>
<span class="w">        </span><span class="n">pm</span><span class="p">.</span><span class="n">ID_FECHA</span><span class="p">,</span>
<span class="w">        </span><span class="n">ID_ANIO_ACADEMICO</span><span class="p">,</span>
<span class="w">        </span><span class="k">CONVERT</span><span class="p">(</span><span class="nb">INT</span><span class="p">,</span><span class="w"> </span><span class="k">CAST</span><span class="p">(</span><span class="n">ID_ANIO_ACADEMICO</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;0101&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_FECHA_MENSUAL</span><span class="p">,</span>
<span class="w">        </span><span class="n">ID_CATEGORIA</span><span class="p">,</span>
<span class="w">        </span><span class="n">ID_CURSO</span><span class="p">,</span>
<span class="w">        </span><span class="n">ID_TIPO_ESTUDIANTE</span><span class="p">,</span>
<span class="w">        </span><span class="n">P_CODEUDOR</span><span class="p">,</span>
<span class="w">        </span><span class="n">P_PSICOLOGIA</span><span class="p">,</span>
<span class="w">        </span><span class="n">P_SECRETARIA_ACADEMICA</span><span class="p">,</span>
<span class="w">        </span><span class="n">P_COORDINACION_ACADEMICA</span><span class="p">,</span>
<span class="w">        </span><span class="s1">&#39;Gestión Secretaria Académica&#39;</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ACTIVIDAD</span><span class="p">,</span><span class="w"> </span>
<span class="w">        </span><span class="k">ISNULL</span><span class="p">(</span><span class="n">T_SECRETARIA_ACADEMICA</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">TIEMPO_SEGUNDOS</span><span class="p">,</span>
<span class="w">        </span><span class="n">IND_EN_PROCESO</span><span class="p">,</span>
<span class="w">        </span><span class="n">IND_ADMITIDO</span><span class="p">,</span>
<span class="w">        </span><span class="n">IND_NO_ADMITIDO</span><span class="p">,</span>
<span class="w">        </span><span class="n">IND_DESISTIDO</span>
<span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="p">[</span><span class="n">STAGE_AREA</span><span class="p">].[</span><span class="n">Transversal</span><span class="p">].[</span><span class="n">TMP_PROCESO_MATRICULA_COLEGIO</span><span class="p">]</span><span class="w"> </span><span class="n">pm</span>
<span class="w">    </span><span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Transversal</span><span class="p">].[</span><span class="n">DIM_TIEMPO_MENSUAL</span><span class="p">]</span><span class="w"> </span><span class="n">tm</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">tm</span><span class="p">.[</span><span class="n">ID_FECHA</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">CONVERT</span><span class="p">(</span><span class="nb">INT</span><span class="p">,</span><span class="w"> </span><span class="k">LEFT</span><span class="p">(</span><span class="k">CAST</span><span class="p">(</span><span class="n">pm</span><span class="p">.</span><span class="n">ID_FECHA</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">),</span><span class="w"> </span><span class="mi">6</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;01&#39;</span><span class="p">)</span>
<span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="n">P_SECRETARIA_ACADEMICA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span>

<span class="w">    </span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span>

<span class="w">    </span><span class="k">SELECT</span><span class="w"> </span>
<span class="w">        </span><span class="n">BP</span><span class="p">,</span>
<span class="w">        </span><span class="n">pm</span><span class="p">.</span><span class="n">ID_FECHA</span><span class="p">,</span>
<span class="w">        </span><span class="n">ID_ANIO_ACADEMICO</span><span class="p">,</span>
<span class="w">        </span><span class="k">CONVERT</span><span class="p">(</span><span class="nb">INT</span><span class="p">,</span><span class="w"> </span><span class="k">CAST</span><span class="p">(</span><span class="n">ID_ANIO_ACADEMICO</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;0101&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_FECHA_MENSUAL</span><span class="p">,</span>
<span class="w">        </span><span class="n">ID_CATEGORIA</span><span class="p">,</span>
<span class="w">        </span><span class="n">ID_CURSO</span><span class="p">,</span>
<span class="w">        </span><span class="n">ID_TIPO_ESTUDIANTE</span><span class="p">,</span>
<span class="w">        </span><span class="n">P_CODEUDOR</span><span class="p">,</span>
<span class="w">        </span><span class="n">P_PSICOLOGIA</span><span class="p">,</span>
<span class="w">        </span><span class="n">P_SECRETARIA_ACADEMICA</span><span class="p">,</span>
<span class="w">        </span><span class="n">P_COORDINACION_ACADEMICA</span><span class="p">,</span>
<span class="w">        </span><span class="s1">&#39;Gestión Psicología&#39;</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ACTIVIDAD</span><span class="p">,</span><span class="w"> </span>
<span class="w">        </span><span class="k">ISNULL</span><span class="p">(</span><span class="n">T_PSICOLOGIA</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">TIEMPO_SEGUNDOS</span><span class="p">,</span>
<span class="w">        </span><span class="n">IND_EN_PROCESO</span><span class="p">,</span>
<span class="w">        </span><span class="n">IND_ADMITIDO</span><span class="p">,</span>
<span class="w">        </span><span class="n">IND_NO_ADMITIDO</span><span class="p">,</span>
<span class="w">        </span><span class="n">IND_DESISTIDO</span>
<span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="p">[</span><span class="n">STAGE_AREA</span><span class="p">].[</span><span class="n">Transversal</span><span class="p">].[</span><span class="n">TMP_PROCESO_MATRICULA_COLEGIO</span><span class="p">]</span><span class="w"> </span><span class="n">pm</span>
<span class="w">    </span><span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Transversal</span><span class="p">].[</span><span class="n">DIM_TIEMPO_MENSUAL</span><span class="p">]</span><span class="w"> </span><span class="n">tm</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">tm</span><span class="p">.[</span><span class="n">ID_FECHA</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">CONVERT</span><span class="p">(</span><span class="nb">INT</span><span class="p">,</span><span class="w"> </span><span class="k">LEFT</span><span class="p">(</span><span class="k">CAST</span><span class="p">(</span><span class="n">pm</span><span class="p">.</span><span class="n">ID_FECHA</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">),</span><span class="w"> </span><span class="mi">6</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;01&#39;</span><span class="p">)</span>
<span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="n">P_PSICOLOGIA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span>

<span class="w">    </span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span>

<span class="w">    </span><span class="k">SELECT</span><span class="w"> </span>
<span class="w">        </span><span class="n">BP</span><span class="p">,</span>
<span class="w">        </span><span class="n">pm</span><span class="p">.</span><span class="n">ID_FECHA</span><span class="p">,</span>
<span class="w">        </span><span class="n">ID_ANIO_ACADEMICO</span><span class="p">,</span>
<span class="w">        </span><span class="k">CONVERT</span><span class="p">(</span><span class="nb">INT</span><span class="p">,</span><span class="w"> </span><span class="k">CAST</span><span class="p">(</span><span class="n">ID_ANIO_ACADEMICO</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;0101&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_FECHA_MENSUAL</span><span class="p">,</span>
<span class="w">        </span><span class="n">ID_CATEGORIA</span><span class="p">,</span>
<span class="w">        </span><span class="n">ID_CURSO</span><span class="p">,</span>
<span class="w">        </span><span class="n">ID_TIPO_ESTUDIANTE</span><span class="p">,</span>
<span class="w">        </span><span class="n">P_CODEUDOR</span><span class="p">,</span>
<span class="w">        </span><span class="n">P_PSICOLOGIA</span><span class="p">,</span>
<span class="w">        </span><span class="n">P_SECRETARIA_ACADEMICA</span><span class="p">,</span>
<span class="w">        </span><span class="n">P_COORDINACION_ACADEMICA</span><span class="p">,</span>
<span class="w">        </span><span class="s1">&#39;Gestión Coordinación Académica&#39;</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ACTIVIDAD</span><span class="p">,</span><span class="w"> </span>
<span class="w">        </span><span class="k">ISNULL</span><span class="p">(</span><span class="n">T_COORDINACION_ACADEMICA</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">TIEMPO_SEGUNDOS</span><span class="p">,</span>
<span class="w">        </span><span class="n">IND_EN_PROCESO</span><span class="p">,</span>
<span class="w">        </span><span class="n">IND_ADMITIDO</span><span class="p">,</span>
<span class="w">        </span><span class="n">IND_NO_ADMITIDO</span><span class="p">,</span>
<span class="w">        </span><span class="n">IND_DESISTIDO</span>
<span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="p">[</span><span class="n">STAGE_AREA</span><span class="p">].[</span><span class="n">Transversal</span><span class="p">].[</span><span class="n">TMP_PROCESO_MATRICULA_COLEGIO</span><span class="p">]</span><span class="w"> </span><span class="n">pm</span>
<span class="w">    </span><span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Transversal</span><span class="p">].[</span><span class="n">DIM_TIEMPO_MENSUAL</span><span class="p">]</span><span class="w"> </span><span class="n">tm</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">tm</span><span class="p">.[</span><span class="n">ID_FECHA</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">CONVERT</span><span class="p">(</span><span class="nb">INT</span><span class="p">,</span><span class="w"> </span><span class="k">LEFT</span><span class="p">(</span><span class="k">CAST</span><span class="p">(</span><span class="n">pm</span><span class="p">.</span><span class="n">ID_FECHA</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">),</span><span class="w"> </span><span class="mi">6</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;01&#39;</span><span class="p">)</span>
<span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="n">P_COORDINACION_ACADEMICA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span>

<span class="w">    </span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span>

<span class="w">    </span><span class="k">SELECT</span><span class="w"> </span>
<span class="w">        </span><span class="n">BP</span><span class="p">,</span>
<span class="w">        </span><span class="n">pm</span><span class="p">.</span><span class="n">ID_FECHA</span><span class="p">,</span>
<span class="w">        </span><span class="n">ID_ANIO_ACADEMICO</span><span class="p">,</span>
<span class="w">        </span><span class="k">CONVERT</span><span class="p">(</span><span class="nb">INT</span><span class="p">,</span><span class="w"> </span><span class="k">CAST</span><span class="p">(</span><span class="n">ID_ANIO_ACADEMICO</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;0101&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_FECHA_MENSUAL</span><span class="p">,</span>
<span class="w">        </span><span class="n">ID_CATEGORIA</span><span class="p">,</span>
<span class="w">        </span><span class="n">ID_CURSO</span><span class="p">,</span>
<span class="w">        </span><span class="n">ID_TIPO_ESTUDIANTE</span><span class="p">,</span>
<span class="w">        </span><span class="n">P_CODEUDOR</span><span class="p">,</span>
<span class="w">        </span><span class="n">P_PSICOLOGIA</span><span class="p">,</span>
<span class="w">        </span><span class="n">P_SECRETARIA_ACADEMICA</span><span class="p">,</span>
<span class="w">        </span><span class="n">P_COORDINACION_ACADEMICA</span><span class="p">,</span>
<span class="w">        </span><span class="s1">&#39;En Proceso&#39;</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ACTIVIDAD</span><span class="p">,</span><span class="w"> </span>
<span class="w">        </span><span class="n">T_TOTAL_GESTION</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">TIEMPO_SEGUNDOS</span><span class="p">,</span>
<span class="w">        </span><span class="n">IND_EN_PROCESO</span><span class="p">,</span>
<span class="w">        </span><span class="n">IND_ADMITIDO</span><span class="p">,</span>
<span class="w">        </span><span class="n">IND_NO_ADMITIDO</span><span class="p">,</span>
<span class="w">        </span><span class="n">IND_DESISTIDO</span>
<span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="p">[</span><span class="n">STAGE_AREA</span><span class="p">].[</span><span class="n">Transversal</span><span class="p">].[</span><span class="n">TMP_PROCESO_MATRICULA_COLEGIO</span><span class="p">]</span><span class="w"> </span><span class="n">pm</span>
<span class="w">    </span><span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Transversal</span><span class="p">].[</span><span class="n">DIM_TIEMPO_MENSUAL</span><span class="p">]</span><span class="w"> </span><span class="n">tm</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">tm</span><span class="p">.[</span><span class="n">ID_FECHA</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">CONVERT</span><span class="p">(</span><span class="nb">INT</span><span class="p">,</span><span class="w"> </span><span class="k">LEFT</span><span class="p">(</span><span class="k">CAST</span><span class="p">(</span><span class="n">pm</span><span class="p">.</span><span class="n">ID_FECHA</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">),</span><span class="w"> </span><span class="mi">6</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;01&#39;</span><span class="p">)</span>
<span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="n">IND_EN_PROCESO</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">OR</span><span class="w"> </span><span class="n">IND_EN_PROCESO</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">IND_ADMITIDO</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">IND_NO_ADMITIDO</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">IND_DESISTIDO</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>

<span class="w">    </span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span>

<span class="w">    </span><span class="k">SELECT</span><span class="w"> </span>
<span class="w">        </span><span class="n">BP</span><span class="p">,</span>
<span class="w">        </span><span class="n">pm</span><span class="p">.</span><span class="n">ID_FECHA</span><span class="p">,</span>
<span class="w">        </span><span class="n">ID_ANIO_ACADEMICO</span><span class="p">,</span>
<span class="w">        </span><span class="k">CONVERT</span><span class="p">(</span><span class="nb">INT</span><span class="p">,</span><span class="w"> </span><span class="k">CAST</span><span class="p">(</span><span class="n">ID_ANIO_ACADEMICO</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;0101&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_FECHA_MENSUAL</span><span class="p">,</span>
<span class="w">        </span><span class="n">ID_CATEGORIA</span><span class="p">,</span>
<span class="w">        </span><span class="n">ID_CURSO</span><span class="p">,</span>
<span class="w">        </span><span class="n">ID_TIPO_ESTUDIANTE</span><span class="p">,</span>
<span class="w">        </span><span class="n">P_CODEUDOR</span><span class="p">,</span>
<span class="w">        </span><span class="n">P_PSICOLOGIA</span><span class="p">,</span>
<span class="w">        </span><span class="n">P_SECRETARIA_ACADEMICA</span><span class="p">,</span>
<span class="w">        </span><span class="n">P_COORDINACION_ACADEMICA</span><span class="p">,</span>
<span class="w">        </span><span class="s1">&#39;Estudiante Admitido&#39;</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ACTIVIDAD</span><span class="p">,</span><span class="w"> </span>
<span class="w">        </span><span class="n">T_TOTAL_GESTION</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">TIEMPO_SEGUNDOS</span><span class="p">,</span>
<span class="w">        </span><span class="n">IND_EN_PROCESO</span><span class="p">,</span>
<span class="w">        </span><span class="n">IND_ADMITIDO</span><span class="p">,</span>
<span class="w">        </span><span class="n">IND_NO_ADMITIDO</span><span class="p">,</span>
<span class="w">        </span><span class="n">IND_DESISTIDO</span>
<span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="p">[</span><span class="n">STAGE_AREA</span><span class="p">].[</span><span class="n">Transversal</span><span class="p">].[</span><span class="n">TMP_PROCESO_MATRICULA_COLEGIO</span><span class="p">]</span><span class="w"> </span><span class="n">pm</span>
<span class="w">    </span><span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Transversal</span><span class="p">].[</span><span class="n">DIM_TIEMPO_MENSUAL</span><span class="p">]</span><span class="w"> </span><span class="n">tm</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">tm</span><span class="p">.[</span><span class="n">ID_FECHA</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">CONVERT</span><span class="p">(</span><span class="nb">INT</span><span class="p">,</span><span class="w"> </span><span class="k">LEFT</span><span class="p">(</span><span class="k">CAST</span><span class="p">(</span><span class="n">pm</span><span class="p">.</span><span class="n">ID_FECHA</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">),</span><span class="w"> </span><span class="mi">6</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;01&#39;</span><span class="p">)</span>
<span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="n">IND_ADMITIDO</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span>

<span class="w">    </span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span>

<span class="w">    </span><span class="k">SELECT</span><span class="w"> </span>
<span class="w">        </span><span class="n">BP</span><span class="p">,</span>
<span class="w">        </span><span class="n">pm</span><span class="p">.</span><span class="n">ID_FECHA</span><span class="p">,</span>
<span class="w">        </span><span class="n">ID_ANIO_ACADEMICO</span><span class="p">,</span>
<span class="w">        </span><span class="k">CONVERT</span><span class="p">(</span><span class="nb">INT</span><span class="p">,</span><span class="w"> </span><span class="k">CAST</span><span class="p">(</span><span class="n">ID_ANIO_ACADEMICO</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;0101&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_FECHA_MENSUAL</span><span class="p">,</span>
<span class="w">        </span><span class="n">ID_CATEGORIA</span><span class="p">,</span>
<span class="w">        </span><span class="n">ID_CURSO</span><span class="p">,</span>
<span class="w">        </span><span class="n">ID_TIPO_ESTUDIANTE</span><span class="p">,</span>
<span class="w">        </span><span class="n">P_CODEUDOR</span><span class="p">,</span>
<span class="w">        </span><span class="n">P_PSICOLOGIA</span><span class="p">,</span>
<span class="w">        </span><span class="n">P_SECRETARIA_ACADEMICA</span><span class="p">,</span>
<span class="w">        </span><span class="n">P_COORDINACION_ACADEMICA</span><span class="p">,</span>
<span class="w">        </span><span class="s1">&#39;Estudiante No Admitido&#39;</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ACTIVIDAD</span><span class="p">,</span><span class="w"> </span>
<span class="w">        </span><span class="n">T_TOTAL_GESTION</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">TIEMPO_SEGUNDOS</span><span class="p">,</span>
<span class="w">        </span><span class="n">IND_EN_PROCESO</span><span class="p">,</span>
<span class="w">        </span><span class="n">IND_ADMITIDO</span><span class="p">,</span>
<span class="w">        </span><span class="n">IND_NO_ADMITIDO</span><span class="p">,</span>
<span class="w">        </span><span class="n">IND_DESISTIDO</span>
<span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="p">[</span><span class="n">STAGE_AREA</span><span class="p">].[</span><span class="n">Transversal</span><span class="p">].[</span><span class="n">TMP_PROCESO_MATRICULA_COLEGIO</span><span class="p">]</span><span class="w"> </span><span class="n">pm</span>
<span class="w">    </span><span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Transversal</span><span class="p">].[</span><span class="n">DIM_TIEMPO_MENSUAL</span><span class="p">]</span><span class="w"> </span><span class="n">tm</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">tm</span><span class="p">.[</span><span class="n">ID_FECHA</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">CONVERT</span><span class="p">(</span><span class="nb">INT</span><span class="p">,</span><span class="w"> </span><span class="k">LEFT</span><span class="p">(</span><span class="k">CAST</span><span class="p">(</span><span class="n">pm</span><span class="p">.</span><span class="n">ID_FECHA</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">),</span><span class="w"> </span><span class="mi">6</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;01&#39;</span><span class="p">)</span>
<span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="n">IND_NO_ADMITIDO</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span>

<span class="w">    </span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span>

<span class="w">    </span><span class="k">SELECT</span><span class="w"> </span>
<span class="w">        </span><span class="n">BP</span><span class="p">,</span>
<span class="w">        </span><span class="n">pm</span><span class="p">.</span><span class="n">ID_FECHA</span><span class="p">,</span>
<span class="w">        </span><span class="n">ID_ANIO_ACADEMICO</span><span class="p">,</span>
<span class="w">        </span><span class="k">CONVERT</span><span class="p">(</span><span class="nb">INT</span><span class="p">,</span><span class="w"> </span><span class="k">CAST</span><span class="p">(</span><span class="n">ID_ANIO_ACADEMICO</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;0101&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_FECHA_MENSUAL</span><span class="p">,</span>
<span class="w">        </span><span class="n">ID_CATEGORIA</span><span class="p">,</span>
<span class="w">        </span><span class="n">ID_CURSO</span><span class="p">,</span>
<span class="w">        </span><span class="n">ID_TIPO_ESTUDIANTE</span><span class="p">,</span>
<span class="w">        </span><span class="n">P_CODEUDOR</span><span class="p">,</span>
<span class="w">        </span><span class="n">P_PSICOLOGIA</span><span class="p">,</span>
<span class="w">        </span><span class="n">P_SECRETARIA_ACADEMICA</span><span class="p">,</span>
<span class="w">        </span><span class="n">P_COORDINACION_ACADEMICA</span><span class="p">,</span>
<span class="w">        </span><span class="s1">&#39;Estudiante Con Proceso Desistido&#39;</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ACTIVIDAD</span><span class="p">,</span><span class="w"> </span>
<span class="w">        </span><span class="n">T_TOTAL_GESTION</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">TIEMPO_SEGUNDOS</span><span class="p">,</span>
<span class="w">        </span><span class="n">IND_EN_PROCESO</span><span class="p">,</span>
<span class="w">        </span><span class="n">IND_ADMITIDO</span><span class="p">,</span>
<span class="w">        </span><span class="n">IND_NO_ADMITIDO</span><span class="p">,</span>
<span class="w">        </span><span class="n">IND_DESISTIDO</span>
<span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="p">[</span><span class="n">STAGE_AREA</span><span class="p">].[</span><span class="n">Transversal</span><span class="p">].[</span><span class="n">TMP_PROCESO_MATRICULA_COLEGIO</span><span class="p">]</span><span class="w"> </span><span class="n">pm</span>
<span class="w">    </span><span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Transversal</span><span class="p">].[</span><span class="n">DIM_TIEMPO_MENSUAL</span><span class="p">]</span><span class="w"> </span><span class="n">tm</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">tm</span><span class="p">.[</span><span class="n">ID_FECHA</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">CONVERT</span><span class="p">(</span><span class="nb">INT</span><span class="p">,</span><span class="w"> </span><span class="k">LEFT</span><span class="p">(</span><span class="k">CAST</span><span class="p">(</span><span class="n">pm</span><span class="p">.</span><span class="n">ID_FECHA</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">),</span><span class="w"> </span><span class="mi">6</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;01&#39;</span><span class="p">)</span>
<span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="n">IND_DESISTIDO</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span>

<span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">MATRICULAS_COLEGIO</span>
</code></pre></div>
<h3 id="fact_mineriamineria_colegiopagos-matriculas"><strong>FACT_MINERIA\MINERIA_COLEGIO\Pagos Matriculas</strong><a class="headerlink" href="#fact_mineriamineria_colegiopagos-matriculas" title="Permanent link">&para;</a></h3>
<hr />
<h4 id="descripcion-general_26"><strong>Descripción General</strong><a class="headerlink" href="#descripcion-general_26" title="Permanent link">&para;</a></h4>
<p>Este componente del paquete SSIS realiza la extracción, transformación y carga de información relacionada con los pagos de matrículas escolares. Extrae los datos desde la facturación e inscripciones académicas del dominio Colegio en el DWH, clasifica el estado de pago por tipo de matrícula (ordinaria o subsidiada), y los consolida en la tabla <code>Transversal.FACT_MINERIA</code>.</p>
<hr />
<h4 id="ubicacion-del-paquete_5"><strong>Ubicación del Paquete</strong><a class="headerlink" href="#ubicacion-del-paquete_5" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>Carpeta:</strong> <code>FACT_MINERIA\MINERIA_COLEGIO</code></li>
<li><strong>Nombre del componente:</strong> <code>Pagos Matriculas</code></li>
<li><strong>Tipo:</strong> Tarea de flujo de datos (Data Flow Task)</li>
</ul>
<hr />
<h4 id="proposito_24"><strong>Propósito</strong><a class="headerlink" href="#proposito_24" title="Permanent link">&para;</a></h4>
<p>Permite registrar mensualmente los pagos de matrícula (ordinarios y subsidiados), su estado (pagado, sin pagar o anulado) y la categorización académica del beneficiario, todo en una estructura unificada para análisis transversales y de cobertura.</p>
<hr />
<h4 id="detalles-de-implementacion_29"><strong>Detalles de Implementación</strong><a class="headerlink" href="#detalles-de-implementacion_29" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p><strong>Fuente de Datos:</strong>
  <code>DWH_COMFENALCO.Colegio.FACT_FACTURACION_MATRICULAS</code>
  <code>DWH_COMFENALCO.Colegio.FACT_INSCRIPCION_MATRICULAS</code>
  <code>DWH_COMFENALCO.Colegio.DIM_CONCEPTO_FACT</code>
  <code>DWH_COMFENALCO.Transversal.DIM_TIEMPO_MENSUAL</code></p>
</li>
<li>
<p><strong>Destino de Carga:</strong>
  Tabla: <code>Transversal.FACT_MINERIA</code>
  Tipo: ADO.NET Destination</p>
</li>
<li>
<p><strong>Transformaciones Aplicadas:</strong></p>
<ul>
<li>Cálculo del ID de fecha mensual y año académico.</li>
<li>Clasificación del tipo de actividad (Pago Matrícula, Anulado, Subsidio, etc.).</li>
<li>Unión con dimensiones categóricas (curso, categoría, tipo de estudiante).</li>
<li>Validación para no incluir conceptos no relevantes (<code>BIBLIOBANCO</code>).</li>
<li>Asignación por defecto para valores nulos.</li>
</ul>
</li>
<li>
<p><strong>Configuración Técnica:</strong></p>
<ul>
<li><code>UseBulkInsertWhenPossible = true</code></li>
<li><code>CommandTimeout = 30</code></li>
<li><code>BatchSize = 0</code> (usa el tamaño de buffer por defecto de SSIS)</li>
</ul>
</li>
</ul>
<hr />
<h4 id="logica-de-negocio_28"><strong>Lógica de Negocio</strong><a class="headerlink" href="#logica-de-negocio_28" title="Permanent link">&para;</a></h4>
<p>El componente determina la actividad de pago de matrícula en función del concepto y estado del pago. Clasifica los registros como "Pago Matrícula", "Sin Pago Matrícula", o "Anulado", y aplica las mismas reglas para subsidios. Se asegura de mantener una única inscripción por beneficiario y año, y agrega atributos categóricos relacionados con el beneficiario.</p>
<hr />
<h4 id="relacion-con-otros-componentes_27"><strong>Relación con Otros Componentes</strong><a class="headerlink" href="#relacion-con-otros-componentes_27" title="Permanent link">&para;</a></h4>
<p>Este componente complementa otros procesos del dominio <code>MINERIA_COLEGIO</code> como coberturas y actividades, alimentando la tabla <code>FACT_MINERIA</code> para análisis integrales que incluyan comportamiento financiero, asistencia y participación académica.</p>
<hr />
<h4 id="script-sql-utilizado_6"><strong>Script SQL Utilizado</strong><a class="headerlink" href="#script-sql-utilizado_6" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="k">WITH</span><span class="w"> </span><span class="n">Facturacion</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="k">SELECT</span><span class="w"> </span>
<span class="w">        </span><span class="n">i</span><span class="p">.</span><span class="n">BP</span><span class="p">,</span>
<span class="w">        </span><span class="k">CONVERT</span><span class="p">(</span><span class="nb">INT</span><span class="p">,</span><span class="w"> </span><span class="k">CAST</span><span class="p">(</span><span class="k">CASE</span><span class="w"> </span>
<span class="w">            </span><span class="k">WHEN</span><span class="w"> </span><span class="k">MONTH</span><span class="p">(</span><span class="n">i</span><span class="p">.</span><span class="n">FECHA_CONTABLE</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="k">YEAR</span><span class="p">(</span><span class="n">i</span><span class="p">.</span><span class="n">FECHA_CONTABLE</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
<span class="w">            </span><span class="k">ELSE</span><span class="w"> </span><span class="k">YEAR</span><span class="p">(</span><span class="n">i</span><span class="p">.</span><span class="n">FECHA_CONTABLE</span><span class="p">)</span>
<span class="w">        </span><span class="k">END</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;0101&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_FECHA_MENSUAL</span><span class="p">,</span>
<span class="w">        </span><span class="k">CASE</span><span class="w"> </span>
<span class="w">            </span><span class="k">WHEN</span><span class="w"> </span><span class="k">MONTH</span><span class="p">(</span><span class="n">i</span><span class="p">.</span><span class="n">FECHA_CONTABLE</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="k">YEAR</span><span class="p">(</span><span class="n">i</span><span class="p">.</span><span class="n">FECHA_CONTABLE</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
<span class="w">            </span><span class="k">ELSE</span><span class="w"> </span><span class="k">YEAR</span><span class="p">(</span><span class="n">i</span><span class="p">.</span><span class="n">FECHA_CONTABLE</span><span class="p">)</span>
<span class="w">        </span><span class="k">END</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_ANIO_ACADEMICO</span><span class="p">,</span>
<span class="w">        </span><span class="mi">1</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_UNIDAD</span><span class="p">,</span>
<span class="w">        </span><span class="k">CAST</span><span class="p">(</span><span class="k">CONVERT</span><span class="p">(</span><span class="nb">varchar</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">.</span><span class="n">FECHA_CONTABLE</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">datetime</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">FECHA_INICIAL</span><span class="p">,</span>
<span class="w">        </span><span class="k">CAST</span><span class="p">(</span><span class="k">CONVERT</span><span class="p">(</span><span class="nb">varchar</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">.</span><span class="n">FECHA_CONTABLE</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">datetime</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">FECHA_FINAL</span><span class="p">,</span>
<span class="w">        </span><span class="k">CASE</span>
<span class="w">            </span><span class="k">WHEN</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">DESC_CONCEPTO</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;MATRICULA&#39;</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">i</span><span class="p">.</span><span class="n">ESTADO_PAGO</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;ANULADO&#39;</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="s1">&#39;Pago Matrícula Anulado&#39;</span>
<span class="w">            </span><span class="k">WHEN</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">DESC_CONCEPTO</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;MATRICULA&#39;</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">i</span><span class="p">.</span><span class="n">ESTADO_PAGO</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;PAGADO&#39;</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="s1">&#39;Pago Matrícula&#39;</span>
<span class="w">            </span><span class="k">WHEN</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">DESC_CONCEPTO</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;MATRICULA&#39;</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">i</span><span class="p">.</span><span class="n">ESTADO_PAGO</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;SIN PAGO&#39;</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="s1">&#39;Sin Pago Matrícula&#39;</span>
<span class="w">            </span><span class="k">WHEN</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">DESC_CONCEPTO</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;SUBSIDIO MATRICULA&#39;</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">i</span><span class="p">.</span><span class="n">ESTADO_PAGO</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;ANULADO&#39;</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="s1">&#39;Pago Matrícula Subsidio Anulado&#39;</span>
<span class="w">            </span><span class="k">WHEN</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">DESC_CONCEPTO</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;SUBSIDIO MATRICULA&#39;</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">i</span><span class="p">.</span><span class="n">ESTADO_PAGO</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;PAGADO&#39;</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="s1">&#39;Pago Matrícula Subsidio&#39;</span>
<span class="w">            </span><span class="k">WHEN</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">DESC_CONCEPTO</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;SUBSIDIO MATRICULA&#39;</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">i</span><span class="p">.</span><span class="n">ESTADO_PAGO</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;SIN PAGO&#39;</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="s1">&#39;Sin Pago Matrícula Subsidio&#39;</span>
<span class="w">            </span><span class="k">ELSE</span><span class="w"> </span><span class="s1">&#39;Sin Identificar&#39;</span>
<span class="w">        </span><span class="k">END</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ACTIVIDAD</span><span class="p">,</span>
<span class="w">        </span><span class="mi">0</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">TIEMPO_SEGUNDOS</span><span class="p">,</span>
<span class="w">        </span><span class="n">i</span><span class="p">.</span><span class="n">VALOR_PAGADO</span>
<span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">DWH_COMFENALCO</span><span class="p">.</span><span class="n">Colegio</span><span class="p">.</span><span class="n">FACT_FACTURACION_MATRICULAS</span><span class="w"> </span><span class="n">i</span>
<span class="w">    </span><span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">DWH_COMFENALCO</span><span class="p">.</span><span class="n">Colegio</span><span class="p">.</span><span class="n">FACT_INSCRIPCION_MATRICULAS</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">i</span><span class="p">.</span><span class="n">ID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">f</span><span class="p">.</span><span class="n">ID</span>
<span class="w">    </span><span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">DWH_COMFENALCO</span><span class="p">.</span><span class="n">Colegio</span><span class="p">.</span><span class="n">DIM_CONCEPTO_FACT</span><span class="w"> </span><span class="n">e</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">i</span><span class="p">.</span><span class="n">ID_CONCEPTO</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">ID_CONCEPTO</span>
<span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">DESC_CONCEPTO</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;BIBLIOBANCO&#39;</span><span class="p">)</span>
<span class="p">),</span>
<span class="n">UniqueRows</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="k">SELECT</span><span class="w"> </span>
<span class="w">        </span><span class="p">[</span><span class="n">BP</span><span class="p">],</span>
<span class="w">        </span><span class="p">[</span><span class="n">ANIO_ACADEMICO</span><span class="p">],</span>
<span class="w">        </span><span class="p">[</span><span class="n">ID_CATEGORIA_FAMILIAR</span><span class="p">]</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_CATEGORIA</span><span class="p">,</span>
<span class="w">        </span><span class="p">[</span><span class="n">ID_CURSO</span><span class="p">],</span>
<span class="w">        </span><span class="p">[</span><span class="n">ID_TIPO_ESTUDIANTE</span><span class="p">],</span>
<span class="w">        </span><span class="n">ROW_NUMBER</span><span class="p">()</span><span class="w"> </span><span class="n">OVER</span><span class="w"> </span><span class="p">(</span><span class="n">PARTITION</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="p">[</span><span class="n">BP</span><span class="p">],</span><span class="w"> </span><span class="p">[</span><span class="n">ANIO_ACADEMICO</span><span class="p">]</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="p">[</span><span class="n">ID</span><span class="p">]</span><span class="w"> </span><span class="k">DESC</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">RowNum</span>
<span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Colegio</span><span class="p">].[</span><span class="n">FACT_INSCRIPCION_MATRICULAS</span><span class="p">]</span>
<span class="p">),</span>
<span class="n">Inscripcion_Matriculas</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="k">SELECT</span><span class="w"> </span>
<span class="w">        </span><span class="p">[</span><span class="n">BP</span><span class="p">],</span>
<span class="w">        </span><span class="p">[</span><span class="n">ANIO_ACADEMICO</span><span class="p">],</span>
<span class="w">        </span><span class="p">[</span><span class="n">ID_CATEGORIA</span><span class="p">],</span>
<span class="w">        </span><span class="p">[</span><span class="n">ID_CURSO</span><span class="p">],</span>
<span class="w">        </span><span class="p">[</span><span class="n">ID_TIPO_ESTUDIANTE</span><span class="p">]</span>
<span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">UniqueRows</span>
<span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="n">RowNum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span>
<span class="p">)</span>
<span class="k">SELECT</span><span class="w"> </span><span class="n">f</span><span class="p">.</span><span class="o">*</span><span class="p">,</span>
<span class="w">       </span><span class="k">ISNULL</span><span class="p">(</span><span class="n">im</span><span class="p">.</span><span class="n">ID_CATEGORIA</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_CATEGORIA</span><span class="p">,</span>
<span class="w">       </span><span class="k">ISNULL</span><span class="p">(</span><span class="n">im</span><span class="p">.</span><span class="n">ID_CURSO</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_CURSO</span><span class="p">,</span>
<span class="w">       </span><span class="k">ISNULL</span><span class="p">(</span><span class="n">im</span><span class="p">.</span><span class="n">ID_TIPO_ESTUDIANTE</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_TIPO_ESTUDIANTE</span><span class="p">,</span>
<span class="w">       </span><span class="s1">&#39;DWH_COMFENALCO.Colegio.FACT_FACTURACION_MATRICULAS&#39;</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">FUENTE_PRINCIPAL</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">Facturacion</span><span class="w"> </span><span class="n">f</span>
<span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Transversal</span><span class="p">].[</span><span class="n">DIM_TIEMPO_MENSUAL</span><span class="p">]</span><span class="w"> </span><span class="n">tm</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">tm</span><span class="p">.[</span><span class="n">ID_FECHA</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">f</span><span class="p">.[</span><span class="n">ID_FECHA_MENSUAL</span><span class="p">]</span>
<span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">Inscripcion_Matriculas</span><span class="w"> </span><span class="n">im</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">im</span><span class="p">.[</span><span class="n">BP</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">f</span><span class="p">.[</span><span class="n">BP</span><span class="p">]</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">im</span><span class="p">.[</span><span class="n">ANIO_ACADEMICO</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">f</span><span class="p">.[</span><span class="n">ID_ANIO_ACADEMICO</span><span class="p">]</span>
</code></pre></div>
<hr />
<h3 id="fact_mineriamineria_colegiopqrs-colegio"><strong>FACT_MINERIA\MINERIA_COLEGIO\PQRs Colegio</strong><a class="headerlink" href="#fact_mineriamineria_colegiopqrs-colegio" title="Permanent link">&para;</a></h3>
<hr />
<h4 id="descripcion-general_27">Descripción General<a class="headerlink" href="#descripcion-general_27" title="Permanent link">&para;</a></h4>
<p>Este componente integra solicitudes PQR (Peticiones, Quejas y Reclamos) relacionadas con estudiantes del Colegio, mediante el cruce de múltiples fuentes transversales y académicas del Data Warehouse <code>DWH_COMFENALCO</code>. El flujo transforma y enriquece la información con categorías, curso y tipo de estudiante, y finalmente la carga en la tabla <code>Transversal.FACT_MINERIA</code>.</p>
<hr />
<h4 id="ubicacion-en-el-paquete_14">Ubicación en el Paquete<a class="headerlink" href="#ubicacion-en-el-paquete_14" title="Permanent link">&para;</a></h4>
<p><code>FACT_MINERIA\MINERIA_COLEGIO\PQRs Colegio</code></p>
<hr />
<h4 id="proposito_25">Propósito<a class="headerlink" href="#proposito_25" title="Permanent link">&para;</a></h4>
<p>Consolidar en una única fuente los eventos de tipo PQR de estudiantes de colegio, asociados a acudientes, categorizando por curso, tipo y año académico, para su análisis como parte de las actividades de minería de datos institucional.</p>
<hr />
<h4 id="detalles-de-implementacion_30">Detalles de Implementación<a class="headerlink" href="#detalles-de-implementacion_30" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p><strong>Origen de Datos:</strong>
  <code>DWH_COMFENALCO.Transversal.FACT_PQRS</code>
  Enlazado a través de relaciones con <code>DIM_TIEMPO_MENSUAL</code>, <code>DIM_AFILIADOS</code> y <code>DIM_ACUDIENTES</code>.</p>
</li>
<li>
<p><strong>Transformaciones Aplicadas:</strong></p>
<ul>
<li>Cálculo de <code>ID_FECHA_MENSUAL</code> y <code>ID_ANIO_ACADEMICO</code>.</li>
<li>Categorización de la actividad como <code>PQR</code> concatenada con causa.</li>
<li>Cálculo de duración en segundos (<code>TIEMPO_SEGUNDOS</code>).</li>
<li>Enriquecimiento con <code>ID_CATEGORIA</code>, <code>ID_CURSO</code>, y <code>ID_TIPO_ESTUDIANTE</code> desde <code>FACT_INSCRIPCION_MATRICULAS</code>.</li>
</ul>
</li>
<li>
<p><strong>Carga de Datos:</strong>
  Destino: <code>Transversal.FACT_MINERIA</code> (por ADO.NET)
  Modo: Inserción directa con opción de Bulk Insert habilitada.</p>
</li>
</ul>
<hr />
<h4 id="logica-de-negocio_29">Lógica de Negocio<a class="headerlink" href="#logica-de-negocio_29" title="Permanent link">&para;</a></h4>
<ul>
<li>Se consideran únicamente registros de PQR con <code>ID_UNIDAD = 1</code> (Colegio).</li>
<li>La relación con estudiantes se infiere desde el acudiente vinculado al afiliado del PQR.</li>
<li>Para cada combinación <code>BP</code> y año académico, se selecciona la inscripción más reciente (<code>ROW_NUMBER()</code>).</li>
<li>Las PQR se documentan como actividades del beneficiario en FACT_MINERIA, bajo el dominio del Colegio.</li>
</ul>
<hr />
<h4 id="relacion-con-otros-componentes_28">Relación con Otros Componentes<a class="headerlink" href="#relacion-con-otros-componentes_28" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>Consulta de Inscripciones:</strong> <code>FACT_INSCRIPCION_MATRICULAS</code></li>
<li><strong>Referencia de Lookup:</strong> <code>FACT_MINERIA</code></li>
<li><strong>Carga en destino común:</strong> <code>FACT_MINERIA</code>, junto con otros procesos educativos.</li>
</ul>
<hr />
<h4 id="script-sql-completo_3">Script SQL (completo)<a class="headerlink" href="#script-sql-completo_3" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="k">WITH</span><span class="w"> </span><span class="n">PQRS_ACUDIENTES</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="k">SELECT</span><span class="w"> </span>
<span class="w">        </span><span class="n">ac</span><span class="p">.[</span><span class="n">BP_ESTUDIANTE</span><span class="p">]</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">BP</span><span class="p">,</span>
<span class="w">        </span><span class="k">CONVERT</span><span class="p">(</span><span class="nb">INT</span><span class="p">,</span><span class="w"> </span><span class="k">LEFT</span><span class="p">(</span><span class="k">CAST</span><span class="p">(</span><span class="n">f</span><span class="p">.</span><span class="n">ID_FECHA</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">),</span><span class="w"> </span><span class="mi">6</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;01&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_FECHA_MENSUAL</span><span class="p">,</span>
<span class="w">        </span><span class="k">CONVERT</span><span class="p">(</span><span class="nb">INT</span><span class="p">,</span><span class="w"> </span><span class="k">LEFT</span><span class="p">(</span><span class="k">CAST</span><span class="p">(</span><span class="n">f</span><span class="p">.</span><span class="n">ID_FECHA</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">),</span><span class="w"> </span><span class="mi">4</span><span class="p">))</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_ANIO_ACADEMICO</span><span class="p">,</span>
<span class="w">        </span><span class="p">[</span><span class="n">ID_UNIDAD</span><span class="p">],</span>
<span class="w">        </span><span class="p">[</span><span class="n">FECHA_CREACION</span><span class="p">]</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">FECHA_INICIAL</span><span class="p">,</span>
<span class="w">        </span><span class="p">[</span><span class="n">FECHA_RESOLUCION</span><span class="p">]</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">FECHA_FINAL</span><span class="p">,</span>
<span class="w">        </span><span class="n">CONCAT</span><span class="p">(</span><span class="s1">&#39;PQR &#39;</span><span class="p">,</span><span class="w"> </span><span class="k">LOWER</span><span class="p">([</span><span class="n">CAUSA</span><span class="p">]))</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ACTIVIDAD</span><span class="p">,</span>
<span class="w">        </span><span class="n">DATEDIFF</span><span class="p">(</span><span class="k">SECOND</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="n">FECHA_CREACION</span><span class="p">],</span><span class="w"> </span><span class="p">[</span><span class="n">FECHA_RESOLUCION</span><span class="p">])</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">TIEMPO_SEGUNDOS</span><span class="p">,</span>
<span class="w">        </span><span class="mi">0</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">VALOR_PAGADO</span>
<span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Transversal</span><span class="p">].[</span><span class="n">FACT_PQRS</span><span class="p">]</span><span class="w"> </span><span class="n">f</span>
<span class="w">    </span><span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Transversal</span><span class="p">].[</span><span class="n">DIM_TIEMPO_MENSUAL</span><span class="p">]</span><span class="w"> </span><span class="n">tm</span><span class="w"> </span>
<span class="w">        </span><span class="k">ON</span><span class="w"> </span><span class="n">tm</span><span class="p">.[</span><span class="n">ID_FECHA</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">CONVERT</span><span class="p">(</span><span class="nb">INT</span><span class="p">,</span><span class="w"> </span><span class="k">LEFT</span><span class="p">(</span><span class="k">CAST</span><span class="p">(</span><span class="n">f</span><span class="p">.</span><span class="n">ID_FECHA</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">),</span><span class="w"> </span><span class="mi">6</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;01&#39;</span><span class="p">)</span>
<span class="w">    </span><span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Transversal</span><span class="p">].[</span><span class="n">DIM_AFILIADOS</span><span class="p">]</span><span class="w"> </span><span class="n">a</span><span class="w"> </span>
<span class="w">        </span><span class="k">ON</span><span class="w"> </span><span class="n">f</span><span class="p">.[</span><span class="n">ID_AFILIADO</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="p">.[</span><span class="n">ID_AFILIADO</span><span class="p">]</span>
<span class="w">    </span><span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Colegio</span><span class="p">].[</span><span class="n">DIM_ACUDIENTES</span><span class="p">]</span><span class="w"> </span><span class="n">ac</span><span class="w"> </span>
<span class="w">        </span><span class="k">ON</span><span class="w"> </span><span class="n">ac</span><span class="p">.[</span><span class="n">BP_ACUDIENTE</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="p">.[</span><span class="n">PARTNER</span><span class="p">]</span>
<span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="n">f</span><span class="p">.</span><span class="n">ID_AFILIADO</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">ID_UNIDAD</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span>
<span class="p">),</span>
<span class="n">UniqueRows</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="k">SELECT</span><span class="w"> </span>
<span class="w">        </span><span class="p">[</span><span class="n">BP</span><span class="p">],</span>
<span class="w">        </span><span class="p">[</span><span class="n">ANIO_ACADEMICO</span><span class="p">],</span>
<span class="w">        </span><span class="p">[</span><span class="n">ID_CATEGORIA_FAMILIAR</span><span class="p">]</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_CATEGORIA</span><span class="p">,</span>
<span class="w">        </span><span class="p">[</span><span class="n">ID_CURSO</span><span class="p">],</span>
<span class="w">        </span><span class="p">[</span><span class="n">ID_TIPO_ESTUDIANTE</span><span class="p">],</span>
<span class="w">        </span><span class="n">ROW_NUMBER</span><span class="p">()</span><span class="w"> </span><span class="n">OVER</span><span class="w"> </span><span class="p">(</span><span class="n">PARTITION</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="p">[</span><span class="n">BP</span><span class="p">],</span><span class="w"> </span><span class="p">[</span><span class="n">ANIO_ACADEMICO</span><span class="p">]</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="p">[</span><span class="n">ID</span><span class="p">]</span><span class="w"> </span><span class="k">DESC</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">RowNum</span>
<span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Colegio</span><span class="p">].[</span><span class="n">FACT_INSCRIPCION_MATRICULAS</span><span class="p">]</span>
<span class="p">),</span>
<span class="n">Inscripcion_Matriculas</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="k">SELECT</span><span class="w"> </span>
<span class="w">        </span><span class="p">[</span><span class="n">BP</span><span class="p">],</span>
<span class="w">        </span><span class="p">[</span><span class="n">ANIO_ACADEMICO</span><span class="p">],</span>
<span class="w">        </span><span class="p">[</span><span class="n">ID_CATEGORIA</span><span class="p">],</span>
<span class="w">        </span><span class="p">[</span><span class="n">ID_CURSO</span><span class="p">],</span>
<span class="w">        </span><span class="p">[</span><span class="n">ID_TIPO_ESTUDIANTE</span><span class="p">]</span>
<span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">UniqueRows</span>
<span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="n">RowNum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span>
<span class="p">)</span>
<span class="k">SELECT</span><span class="w"> </span>
<span class="w">    </span><span class="n">pa</span><span class="p">.</span><span class="o">*</span><span class="p">,</span>
<span class="w">    </span><span class="k">ISNULL</span><span class="p">(</span><span class="n">im</span><span class="p">.</span><span class="n">ID_CATEGORIA</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_CATEGORIA</span><span class="p">,</span>
<span class="w">    </span><span class="k">ISNULL</span><span class="p">(</span><span class="n">im</span><span class="p">.</span><span class="n">ID_CURSO</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_CURSO</span><span class="p">,</span>
<span class="w">    </span><span class="k">ISNULL</span><span class="p">(</span><span class="n">im</span><span class="p">.</span><span class="n">ID_TIPO_ESTUDIANTE</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_TIPO_ESTUDIANTE</span><span class="p">,</span>
<span class="w">    </span><span class="s1">&#39;[DWH_COMFENALCO].[Transversal].[FACT_PQRS]&#39;</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">FUENTE_PRINCIPAL</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">PQRS_ACUDIENTES</span><span class="w"> </span><span class="n">pa</span>
<span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">Inscripcion_Matriculas</span><span class="w"> </span><span class="n">im</span><span class="w"> </span>
<span class="w">    </span><span class="k">ON</span><span class="w"> </span><span class="n">im</span><span class="p">.[</span><span class="n">BP</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pa</span><span class="p">.[</span><span class="n">BP</span><span class="p">]</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">im</span><span class="p">.[</span><span class="n">ANIO_ACADEMICO</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pa</span><span class="p">.[</span><span class="n">ID_ANIO_ACADEMICO</span><span class="p">]</span>
</code></pre></div>
<h3 id="fact_mineriamineria_educacion_tecnica_y_continuainscripcion"><strong>FACT_MINERIA\MINERIA_EDUCACION_TECNICA_Y_CONTINUA\Inscripcion</strong><a class="headerlink" href="#fact_mineriamineria_educacion_tecnica_y_continuainscripcion" title="Permanent link">&para;</a></h3>
<hr />
<h4 id="descripcion-general_28">Descripción General<a class="headerlink" href="#descripcion-general_28" title="Permanent link">&para;</a></h4>
<p>Este componente SSIS realiza la extracción, transformación y carga (ETL) de datos relacionados con inscripciones en programas de educación técnica y continua. La fuente principal es la tabla <code>FACT_INSCRIPCION_MATRICULAS</code>, y el destino es la tabla consolidada <code>Transversal.FACT_MINERIA</code>.</p>
<hr />
<h4 id="ubicacion-dentro-del-paquete_9">Ubicación dentro del Paquete<a class="headerlink" href="#ubicacion-dentro-del-paquete_9" title="Permanent link">&para;</a></h4>
<p><code>FACT_MINERIA</code> &gt; <code>MINERIA_EDUCACION_TECNICA_Y_CONTINUA</code> &gt; <code>Inscripcion</code></p>
<hr />
<h4 id="proposito-del-componente_6">Propósito del Componente<a class="headerlink" href="#proposito-del-componente_6" title="Permanent link">&para;</a></h4>
<p>Unificar registros de inscripción provenientes de afiliados, beneficiarios, empresas y no aportantes, clasificando la actividad educativa y otras dimensiones relevantes para análisis longitudinales e integraciones con otros dominios del DWH.</p>
<hr />
<h4 id="detalles-de-implementacion_31">Detalles de Implementación<a class="headerlink" href="#detalles-de-implementacion_31" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>Origen</strong>: <code>FACT_INSCRIPCION_MATRICULAS</code> (Cedesarrollo)</li>
<li><strong>Destino</strong>: <code>Transversal.FACT_MINERIA</code></li>
<li><strong>Tipo de extracción</strong>: ADO.NET Source</li>
<li><strong>Tipo de carga</strong>: ADO.NET Destination con <code>BulkInsert</code> habilitado</li>
<li><strong>Conexión</strong>: <code>Project.ConnectionManagers[DWH_COMFENALCO]</code></li>
<li><strong>Lógica de carga</strong>: Directa sin transformación intermedia.</li>
</ul>
<hr />
<h4 id="logica-de-negocio_30">Lógica de Negocio<a class="headerlink" href="#logica-de-negocio_30" title="Permanent link">&para;</a></h4>
<p>La extracción se realiza mediante un query unificado (con <code>UNION ALL</code>) que agrupa la inscripción de:</p>
<ol>
<li>Afiliados</li>
<li>Beneficiarios</li>
<li>Empresas</li>
<li>No aportantes</li>
</ol>
<p>Cada grupo se identifica por su relación jerárquica con estudiantes y se asignan valores categóricos fijos para facilitar su integración analítica:</p>
<ul>
<li><code>BP</code>: Identificador de partner según la fuente</li>
<li><code>ID_CATEGORIA</code>: Se asignan valores predeterminados según el tipo de origen</li>
<li><code>ID_CURSO</code> e <code>ID_TIPO_ESTUDIANTE</code>: se establecen en <code>-1</code> (no definidos)</li>
<li><code>ACTIVIDAD</code>: Se clasifica como <em>Estudiante Inscrito</em>, <em>Proceso Desistido</em>, o <em>Sin Identificar</em></li>
<li><code>FUENTE_PRINCIPAL</code>: campo trazable para auditoría (<code>[DWH_COMFENALCO].[Cedesarrollo].[FACT_INSCRIPCION_MATRICULAS]</code>)</li>
</ul>
<hr />
<h4 id="sql-completo">SQL Completo<a class="headerlink" href="#sql-completo" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="c1">-- Afiliados</span>
<span class="k">SELECT</span><span class="w"> </span>
<span class="w">    </span><span class="n">a</span><span class="p">.[</span><span class="n">PARTNER</span><span class="p">]</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">BP</span><span class="p">,</span>
<span class="w">    </span><span class="k">CAST</span><span class="p">(</span><span class="n">FORMAT</span><span class="p">(</span><span class="n">im</span><span class="p">.[</span><span class="n">FECHA</span><span class="p">],</span><span class="w"> </span><span class="s1">&#39;yyyyMM01&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="nb">INT</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_FECHA_MENSUAL</span><span class="p">,</span>
<span class="w">    </span><span class="k">YEAR</span><span class="p">(</span><span class="n">im</span><span class="p">.[</span><span class="n">FECHA</span><span class="p">])</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_ANIO_ACADEMICO</span><span class="p">,</span>
<span class="w">    </span><span class="n">j</span><span class="p">.[</span><span class="n">ID_UNIDAD</span><span class="p">],</span>
<span class="w">    </span><span class="n">im</span><span class="p">.[</span><span class="n">FECHA</span><span class="p">]</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">FECHA_INICIAL</span><span class="p">,</span>
<span class="w">    </span><span class="n">im</span><span class="p">.[</span><span class="n">FECHA</span><span class="p">]</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">FECHA_FINAL</span><span class="p">,</span>
<span class="w">    </span><span class="k">CASE</span>
<span class="w">        </span><span class="k">WHEN</span><span class="w"> </span><span class="n">im</span><span class="p">.[</span><span class="n">ESTADO</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;INSCRITO&#39;</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="s1">&#39;Estudiante Inscrito&#39;</span>
<span class="w">        </span><span class="k">WHEN</span><span class="w"> </span><span class="n">im</span><span class="p">.[</span><span class="n">ESTADO</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;NO INSCRITO&#39;</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="s1">&#39;Estudiante con Proceso Desistido&#39;</span>
<span class="w">        </span><span class="k">ELSE</span><span class="w"> </span><span class="s1">&#39;Sin Identificar&#39;</span>
<span class="w">    </span><span class="k">END</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ACTIVIDAD</span><span class="p">,</span>
<span class="w">    </span><span class="mi">0</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">TIEMPO_SEGUNDOS</span><span class="p">,</span>
<span class="w">    </span><span class="mi">0</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">VALOR_PAGADO</span><span class="p">,</span>
<span class="w">    </span><span class="n">a</span><span class="p">.[</span><span class="n">ID_CATEGORIA</span><span class="p">],</span>
<span class="w">    </span><span class="o">-</span><span class="mi">1</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_CURSO</span><span class="p">,</span>
<span class="w">    </span><span class="o">-</span><span class="mi">1</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_TIPO_ESTUDIANTE</span><span class="p">,</span>
<span class="w">    </span><span class="n">im</span><span class="p">.[</span><span class="n">ID_PROGRAMA</span><span class="p">],</span>
<span class="w">    </span><span class="s1">&#39;[DWH_COMFENALCO].[Cedesarrollo].[FACT_INSCRIPCION_MATRICULAS]&#39;</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">FUENTE_PRINCIPAL</span>
<span class="k">FROM</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Cedesarrollo</span><span class="p">].[</span><span class="n">FACT_INSCRIPCION_MATRICULAS</span><span class="p">]</span><span class="w"> </span><span class="n">im</span>
<span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Cedesarrollo</span><span class="p">].[</span><span class="n">DIM_ESTUDIANTES</span><span class="p">]</span><span class="w"> </span><span class="n">e</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">im</span><span class="p">.[</span><span class="n">ID_ESTUDIANTE</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">e</span><span class="p">.[</span><span class="n">ID_ESTUDIANTE</span><span class="p">]</span>
<span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Transversal</span><span class="p">].[</span><span class="n">DIM_AFILIADOS</span><span class="p">]</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">e</span><span class="p">.[</span><span class="n">ID_AFILIADO</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="p">.[</span><span class="n">ID_AFILIADO</span><span class="p">]</span>
<span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Cedesarrollo</span><span class="p">].[</span><span class="n">DIM_JORNADA</span><span class="p">]</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">im</span><span class="p">.[</span><span class="n">ID_JORNADA</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">j</span><span class="p">.[</span><span class="n">ID_JORNADA</span><span class="p">]</span>
<span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Transversal</span><span class="p">].[</span><span class="n">DIM_TIEMPO_MENSUAL</span><span class="p">]</span><span class="w"> </span><span class="n">tm</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">tm</span><span class="p">.[</span><span class="n">ID_FECHA</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">CAST</span><span class="p">(</span><span class="n">FORMAT</span><span class="p">(</span><span class="n">im</span><span class="p">.[</span><span class="n">FECHA</span><span class="p">],</span><span class="w"> </span><span class="s1">&#39;yyyyMM01&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="nb">INT</span><span class="p">)</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">ID_AFILIADO</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span>

<span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span>

<span class="c1">-- Beneficiarios</span>
<span class="k">SELECT</span><span class="w"> </span>
<span class="w">    </span><span class="n">b</span><span class="p">.[</span><span class="n">PARTNER</span><span class="p">],</span><span class="w"> </span><span class="k">CAST</span><span class="p">(</span><span class="n">FORMAT</span><span class="p">(</span><span class="n">im</span><span class="p">.[</span><span class="n">FECHA</span><span class="p">],</span><span class="w"> </span><span class="s1">&#39;yyyyMM01&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="nb">INT</span><span class="p">),</span><span class="w"> </span><span class="k">YEAR</span><span class="p">(</span><span class="n">im</span><span class="p">.[</span><span class="n">FECHA</span><span class="p">]),</span>
<span class="w">    </span><span class="n">j</span><span class="p">.[</span><span class="n">ID_UNIDAD</span><span class="p">],</span><span class="w"> </span><span class="n">im</span><span class="p">.[</span><span class="n">FECHA</span><span class="p">],</span><span class="w"> </span><span class="n">im</span><span class="p">.[</span><span class="n">FECHA</span><span class="p">],</span>
<span class="w">    </span><span class="k">CASE</span>
<span class="w">        </span><span class="k">WHEN</span><span class="w"> </span><span class="n">im</span><span class="p">.[</span><span class="n">ESTADO</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;INSCRITO&#39;</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="s1">&#39;Estudiante Inscrito&#39;</span>
<span class="w">        </span><span class="k">WHEN</span><span class="w"> </span><span class="n">im</span><span class="p">.[</span><span class="n">ESTADO</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;NO INSCRITO&#39;</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="s1">&#39;Estudiante con Proceso Desistido&#39;</span>
<span class="w">        </span><span class="k">ELSE</span><span class="w"> </span><span class="s1">&#39;Sin Identificar&#39;</span>
<span class="w">    </span><span class="k">END</span><span class="p">,</span>
<span class="w">    </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="k">ISNULL</span><span class="p">(</span><span class="n">a</span><span class="p">.[</span><span class="n">ID_CATEGORIA</span><span class="p">],</span><span class="w"> </span><span class="mi">4</span><span class="p">),</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">im</span><span class="p">.[</span><span class="n">ID_PROGRAMA</span><span class="p">],</span>
<span class="w">    </span><span class="s1">&#39;[DWH_COMFENALCO].[Cedesarrollo].[FACT_INSCRIPCION_MATRICULAS]&#39;</span>
<span class="k">FROM</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Cedesarrollo</span><span class="p">].[</span><span class="n">FACT_INSCRIPCION_MATRICULAS</span><span class="p">]</span><span class="w"> </span><span class="n">im</span>
<span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Cedesarrollo</span><span class="p">].[</span><span class="n">DIM_ESTUDIANTES</span><span class="p">]</span><span class="w"> </span><span class="n">e</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">im</span><span class="p">.[</span><span class="n">ID_ESTUDIANTE</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">e</span><span class="p">.[</span><span class="n">ID_ESTUDIANTE</span><span class="p">]</span>
<span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Transversal</span><span class="p">].[</span><span class="n">DIM_BENEFICIARIOS</span><span class="p">]</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">e</span><span class="p">.[</span><span class="n">ID_BENEFICIARIO</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="p">.[</span><span class="n">ID_BENEFICIARIO</span><span class="p">]</span>
<span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Cedesarrollo</span><span class="p">].[</span><span class="n">DIM_JORNADA</span><span class="p">]</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">im</span><span class="p">.[</span><span class="n">ID_JORNADA</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">j</span><span class="p">.[</span><span class="n">ID_JORNADA</span><span class="p">]</span>
<span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Transversal</span><span class="p">].[</span><span class="n">DIM_TIEMPO_MENSUAL</span><span class="p">]</span><span class="w"> </span><span class="n">tm</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">tm</span><span class="p">.[</span><span class="n">ID_FECHA</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">CAST</span><span class="p">(</span><span class="n">FORMAT</span><span class="p">(</span><span class="n">im</span><span class="p">.[</span><span class="n">FECHA</span><span class="p">],</span><span class="w"> </span><span class="s1">&#39;yyyyMM01&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="nb">INT</span><span class="p">)</span>
<span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Transversal</span><span class="p">].[</span><span class="n">DIM_AFILIADOS</span><span class="p">]</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">b</span><span class="p">.[</span><span class="n">ID_AFILIADO</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="p">.[</span><span class="n">ID_AFILIADO</span><span class="p">]</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">ID_BENEFICIARIO</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span>

<span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span>

<span class="c1">-- Empresas</span>
<span class="k">SELECT</span><span class="w"> </span>
<span class="w">    </span><span class="n">em</span><span class="p">.[</span><span class="n">PARTNER</span><span class="p">],</span><span class="w"> </span><span class="k">CAST</span><span class="p">(</span><span class="n">FORMAT</span><span class="p">(</span><span class="n">im</span><span class="p">.[</span><span class="n">FECHA</span><span class="p">],</span><span class="w"> </span><span class="s1">&#39;yyyyMM01&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="nb">INT</span><span class="p">),</span><span class="w"> </span><span class="k">YEAR</span><span class="p">(</span><span class="n">im</span><span class="p">.[</span><span class="n">FECHA</span><span class="p">]),</span>
<span class="w">    </span><span class="n">j</span><span class="p">.[</span><span class="n">ID_UNIDAD</span><span class="p">],</span><span class="w"> </span><span class="n">im</span><span class="p">.[</span><span class="n">FECHA</span><span class="p">],</span><span class="w"> </span><span class="n">im</span><span class="p">.[</span><span class="n">FECHA</span><span class="p">],</span>
<span class="w">    </span><span class="k">CASE</span>
<span class="w">        </span><span class="k">WHEN</span><span class="w"> </span><span class="n">im</span><span class="p">.[</span><span class="n">ESTADO</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;INSCRITO&#39;</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="s1">&#39;Estudiante Inscrito&#39;</span>
<span class="w">        </span><span class="k">WHEN</span><span class="w"> </span><span class="n">im</span><span class="p">.[</span><span class="n">ESTADO</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;NO INSCRITO&#39;</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="s1">&#39;Estudiante con Proceso Desistido&#39;</span>
<span class="w">        </span><span class="k">ELSE</span><span class="w"> </span><span class="s1">&#39;Sin Identificar&#39;</span>
<span class="w">    </span><span class="k">END</span><span class="p">,</span>
<span class="w">    </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">im</span><span class="p">.[</span><span class="n">ID_PROGRAMA</span><span class="p">],</span>
<span class="w">    </span><span class="s1">&#39;[DWH_COMFENALCO].[Cedesarrollo].[FACT_INSCRIPCION_MATRICULAS]&#39;</span>
<span class="k">FROM</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Cedesarrollo</span><span class="p">].[</span><span class="n">FACT_INSCRIPCION_MATRICULAS</span><span class="p">]</span><span class="w"> </span><span class="n">im</span>
<span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Cedesarrollo</span><span class="p">].[</span><span class="n">DIM_ESTUDIANTES</span><span class="p">]</span><span class="w"> </span><span class="n">e</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">im</span><span class="p">.[</span><span class="n">ID_ESTUDIANTE</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">e</span><span class="p">.[</span><span class="n">ID_ESTUDIANTE</span><span class="p">]</span>
<span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Transversal</span><span class="p">].[</span><span class="n">DIM_EMPRESAS</span><span class="p">]</span><span class="w"> </span><span class="n">em</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">e</span><span class="p">.[</span><span class="n">ID_EMPRESA</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">em</span><span class="p">.[</span><span class="n">ID_EMPRESA</span><span class="p">]</span>
<span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Cedesarrollo</span><span class="p">].[</span><span class="n">DIM_JORNADA</span><span class="p">]</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">im</span><span class="p">.[</span><span class="n">ID_JORNADA</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">j</span><span class="p">.[</span><span class="n">ID_JORNADA</span><span class="p">]</span>
<span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Transversal</span><span class="p">].[</span><span class="n">DIM_TIEMPO_MENSUAL</span><span class="p">]</span><span class="w"> </span><span class="n">tm</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">tm</span><span class="p">.[</span><span class="n">ID_FECHA</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">CAST</span><span class="p">(</span><span class="n">FORMAT</span><span class="p">(</span><span class="n">im</span><span class="p">.[</span><span class="n">FECHA</span><span class="p">],</span><span class="w"> </span><span class="s1">&#39;yyyyMM01&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="nb">INT</span><span class="p">)</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">ID_EMPRESA</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span>

<span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span>

<span class="c1">-- No aportante</span>
<span class="k">SELECT</span><span class="w"> </span>
<span class="w">    </span><span class="s1">&#39;0000000000&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">CAST</span><span class="p">(</span><span class="n">FORMAT</span><span class="p">(</span><span class="n">im</span><span class="p">.[</span><span class="n">FECHA</span><span class="p">],</span><span class="w"> </span><span class="s1">&#39;yyyyMM01&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="nb">INT</span><span class="p">),</span><span class="w"> </span><span class="k">YEAR</span><span class="p">(</span><span class="n">im</span><span class="p">.[</span><span class="n">FECHA</span><span class="p">]),</span>
<span class="w">    </span><span class="n">j</span><span class="p">.[</span><span class="n">ID_UNIDAD</span><span class="p">],</span><span class="w"> </span><span class="n">im</span><span class="p">.[</span><span class="n">FECHA</span><span class="p">],</span><span class="w"> </span><span class="n">im</span><span class="p">.[</span><span class="n">FECHA</span><span class="p">],</span>
<span class="w">    </span><span class="k">CASE</span>
<span class="w">        </span><span class="k">WHEN</span><span class="w"> </span><span class="n">im</span><span class="p">.[</span><span class="n">ESTADO</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;INSCRITO&#39;</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="s1">&#39;Estudiante Inscrito&#39;</span>
<span class="w">        </span><span class="k">WHEN</span><span class="w"> </span><span class="n">im</span><span class="p">.[</span><span class="n">ESTADO</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;NO INSCRITO&#39;</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="s1">&#39;Estudiante con Proceso Desistido&#39;</span>
<span class="w">        </span><span class="k">ELSE</span><span class="w"> </span><span class="s1">&#39;Sin Identificar&#39;</span>
<span class="w">    </span><span class="k">END</span><span class="p">,</span>
<span class="w">    </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">    </span><span class="k">CASE</span>
<span class="w">        </span><span class="k">WHEN</span><span class="w"> </span><span class="n">e</span><span class="p">.[</span><span class="n">TIPO_DOCUMENTO</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;NI&#39;</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="mi">12</span>
<span class="w">        </span><span class="k">ELSE</span><span class="w"> </span><span class="mi">4</span>
<span class="w">    </span><span class="k">END</span><span class="p">,</span>
<span class="w">    </span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">im</span><span class="p">.[</span><span class="n">ID_PROGRAMA</span><span class="p">],</span>
<span class="w">    </span><span class="s1">&#39;[DWH_COMFENALCO].[Cedesarrollo].[FACT_INSCRIPCION_MATRICULAS]&#39;</span>
<span class="k">FROM</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Cedesarrollo</span><span class="p">].[</span><span class="n">FACT_INSCRIPCION_MATRICULAS</span><span class="p">]</span><span class="w"> </span><span class="n">im</span>
<span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Cedesarrollo</span><span class="p">].[</span><span class="n">DIM_ESTUDIANTES</span><span class="p">]</span><span class="w"> </span><span class="n">e</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">im</span><span class="p">.[</span><span class="n">ID_ESTUDIANTE</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">e</span><span class="p">.[</span><span class="n">ID_ESTUDIANTE</span><span class="p">]</span>
<span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Cedesarrollo</span><span class="p">].[</span><span class="n">DIM_JORNADA</span><span class="p">]</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">im</span><span class="p">.[</span><span class="n">ID_JORNADA</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">j</span><span class="p">.[</span><span class="n">ID_JORNADA</span><span class="p">]</span>
<span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Transversal</span><span class="p">].[</span><span class="n">DIM_TIEMPO_MENSUAL</span><span class="p">]</span><span class="w"> </span><span class="n">tm</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">tm</span><span class="p">.[</span><span class="n">ID_FECHA</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">CAST</span><span class="p">(</span><span class="n">FORMAT</span><span class="p">(</span><span class="n">im</span><span class="p">.[</span><span class="n">FECHA</span><span class="p">],</span><span class="w"> </span><span class="s1">&#39;yyyyMM01&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="nb">INT</span><span class="p">)</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">ID_AFILIADO</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">ID_EMPRESA</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">ID_BENEFICIARIO</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">3</span>
</code></pre></div>
<hr />
<h4 id="relacion-con-otros-componentes_29">Relación con Otros Componentes<a class="headerlink" href="#relacion-con-otros-componentes_29" title="Permanent link">&para;</a></h4>
<ul>
<li>Este componente se conecta directamente al destino <code>Transversal.FACT_MINERIA</code>.</li>
<li>Comparte lógica y fuentes similares a otros componentes del paquete <code>MINERIA_EDUCACION_TECNICA_Y_CONTINUA</code>.</li>
</ul>
<h3 id="fact_mineriamineria_educacion_tecnica_y_continuaadmision"><strong>FACT_MINERIA\MINERIA_EDUCACION_TECNICA_Y_CONTINUA\Admision</strong><a class="headerlink" href="#fact_mineriamineria_educacion_tecnica_y_continuaadmision" title="Permanent link">&para;</a></h3>
<hr />
<h4 id="descripcion-general_29"><strong>Descripción General</strong><a class="headerlink" href="#descripcion-general_29" title="Permanent link">&para;</a></h4>
<p>Este componente es un <em>Data Flow Task</em> del paquete <code>FACT_MINERIA</code>, orientado a la integración de información de admisiones en programas de educación técnica y continua. Extrae registros desde la tabla de hechos <code>FACT_ESTADO_MATRICULAS</code> y los clasifica en función de su origen (afiliado, beneficiario, empresa o no aportante), generando una tabla consolidada de admisiones con metadatos educativos y organizacionales.</p>
<hr />
<h4 id="ubicacion-del-componente_2"><strong>Ubicación del Componente</strong><a class="headerlink" href="#ubicacion-del-componente_2" title="Permanent link">&para;</a></h4>
<p><code>FACT_MINERIA\MINERIA_EDUCACION_TECNICA_Y_CONTINUA\Admision</code></p>
<hr />
<h4 id="proposito_26"><strong>Propósito</strong><a class="headerlink" href="#proposito_26" title="Permanent link">&para;</a></h4>
<p>Integrar información de admisiones en programas de educación técnica y continua desde múltiples fuentes (afiliados, beneficiarios, empresas, no aportantes), estructurándola con base en fechas académicas, categorías y programas, para ser cargada en la tabla <code>Transversal.FACT_MINERIA</code>.</p>
<hr />
<h4 id="detalles-de-implementacion_32"><strong>Detalles de Implementación</strong><a class="headerlink" href="#detalles-de-implementacion_32" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>Origen de Datos</strong>: Consulta SQL sobre <code>[DWH_COMFENALCO].[Cedesarrollo].[FACT_ESTADO_MATRICULAS]</code> unida a múltiples dimensiones.</li>
<li><strong>Destino de Datos</strong>: Tabla <code>Transversal.FACT_MINERIA</code> mediante componente <code>Destino de ADO.NET</code>.</li>
<li>
<p><strong>Transformaciones</strong>:</p>
<ul>
<li>Agrupación de admisiones por tipo de actor (afiliado, beneficiario, empresa, no aportante).</li>
<li>Mapeo de campos claves como fechas, unidades, programas, actividad y categoría.</li>
<li>Asignación de valores fijos a campos como <code>TIEMPO_SEGUNDOS</code>, <code>VALOR_PAGADO</code>, <code>ID_CURSO</code>, <code>ID_TIPO_ESTUDIANTE</code>.</li>
</ul>
</li>
</ul>
<hr />
<h4 id="logica-de-negocio_31"><strong>Lógica de Negocio</strong><a class="headerlink" href="#logica-de-negocio_31" title="Permanent link">&para;</a></h4>
<ul>
<li>Clasificación de admisiones en función de la relación institucional del estudiante (afiliado, beneficiario, empresa o no aportante).</li>
<li>Normalización de fechas de matrícula para obtener claves temporales (<code>ID_FECHA_MENSUAL</code>, <code>ID_ANIO_ACADEMICO</code>).</li>
<li>Determinación de la actividad según semestre de matrícula (<code>Estudiante Admitido Nuevo</code> vs <code>Antiguo</code>).</li>
<li>En caso de no aportantes, asignación de categoría basada en tipo de documento.</li>
</ul>
<hr />
<h4 id="relacion-con-otros-componentes_30"><strong>Relación con Otros Componentes</strong><a class="headerlink" href="#relacion-con-otros-componentes_30" title="Permanent link">&para;</a></h4>
<ul>
<li>Fuente principal de datos: <code>FACT_ESTADO_MATRICULAS</code>.</li>
<li>Apoya la construcción del modelo de minería de datos educativos de Comfenalco.</li>
<li>Se integra con otras transformaciones del paquete <code>FACT_MINERIA</code> para consolidación transversal.</li>
</ul>
<hr />
<h4 id="script-sql-del-origen"><strong>Script SQL del Origen</strong><a class="headerlink" href="#script-sql-del-origen" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="c1">-- Afiliados</span>
<span class="k">SELECT</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">PARTNER</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">BP</span><span class="p">,</span>
<span class="w">       </span><span class="k">CAST</span><span class="p">(</span><span class="n">FORMAT</span><span class="p">(</span><span class="n">fm</span><span class="p">.</span><span class="n">FECHA_MATRICULA</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;yyyyMM01&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="nb">INT</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_FECHA_MENSUAL</span><span class="p">,</span>
<span class="w">       </span><span class="k">YEAR</span><span class="p">(</span><span class="n">fm</span><span class="p">.</span><span class="n">FECHA_MATRICULA</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_ANIO_ACADEMICO</span><span class="p">,</span>
<span class="w">       </span><span class="n">j</span><span class="p">.</span><span class="n">ID_UNIDAD</span><span class="p">,</span>
<span class="w">       </span><span class="n">fm</span><span class="p">.</span><span class="n">FECHA_MATRICULA</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">FECHA_INICIAL</span><span class="p">,</span>
<span class="w">       </span><span class="n">fm</span><span class="p">.</span><span class="n">FECHA_MATRICULA</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">FECHA_FINAL</span><span class="p">,</span>
<span class="w">       </span><span class="k">CASE</span><span class="w"> </span><span class="k">WHEN</span><span class="w"> </span><span class="n">fm</span><span class="p">.</span><span class="n">SEMESTRE</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;Único&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;1&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="s1">&#39;Estudiante Admitido Nuevo&#39;</span><span class="w"> </span><span class="k">ELSE</span><span class="w"> </span><span class="s1">&#39;Estudiante Admitido Antiguo&#39;</span><span class="w"> </span><span class="k">END</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ACTIVIDAD</span><span class="p">,</span>
<span class="w">       </span><span class="mi">0</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">TIEMPO_SEGUNDOS</span><span class="p">,</span>
<span class="w">       </span><span class="mi">0</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">VALOR_PAGADO</span><span class="p">,</span>
<span class="w">       </span><span class="k">ISNULL</span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">ID_CATEGORIA</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_CATEGORIA</span><span class="p">,</span>
<span class="w">       </span><span class="o">-</span><span class="mi">1</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_CURSO</span><span class="p">,</span>
<span class="w">       </span><span class="o">-</span><span class="mi">1</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_TIPO_ESTUDIANTE</span><span class="p">,</span>
<span class="w">       </span><span class="n">fm</span><span class="p">.</span><span class="n">ID_PROGRAMA</span><span class="p">,</span>
<span class="w">       </span><span class="s1">&#39;[DWH_COMFENALCO].[Cedesarrollo].[FACT_ESTADO_MATRICULAS]&#39;</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">FUENTE_PRINCIPAL</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">DWH_COMFENALCO</span><span class="p">.</span><span class="n">Cedesarrollo</span><span class="p">.</span><span class="n">FACT_ESTADO_MATRICULAS</span><span class="w"> </span><span class="n">fm</span>
<span class="k">JOIN</span><span class="w"> </span><span class="n">DWH_COMFENALCO</span><span class="p">.</span><span class="n">Cedesarrollo</span><span class="p">.</span><span class="n">DIM_ESTUDIANTES</span><span class="w"> </span><span class="n">e</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">fm</span><span class="p">.</span><span class="n">ID_ESTUDIANTE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">ID_ESTUDIANTE</span>
<span class="k">JOIN</span><span class="w"> </span><span class="n">DWH_COMFENALCO</span><span class="p">.</span><span class="n">Transversal</span><span class="p">.</span><span class="n">DIM_AFILIADOS</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">ID_AFILIADO</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">ID_AFILIADO</span>
<span class="k">JOIN</span><span class="w"> </span><span class="n">DWH_COMFENALCO</span><span class="p">.</span><span class="n">Cedesarrollo</span><span class="p">.</span><span class="n">DIM_JORNADA</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">fm</span><span class="p">.</span><span class="n">ID_JORNADA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">j</span><span class="p">.</span><span class="n">ID_JORNADA</span>
<span class="k">JOIN</span><span class="w"> </span><span class="n">DWH_COMFENALCO</span><span class="p">.</span><span class="n">Transversal</span><span class="p">.</span><span class="n">DIM_TIEMPO_MENSUAL</span><span class="w"> </span><span class="n">tm</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">tm</span><span class="p">.</span><span class="n">ID_FECHA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">CAST</span><span class="p">(</span><span class="n">FORMAT</span><span class="p">(</span><span class="n">fm</span><span class="p">.</span><span class="n">FECHA_MATRICULA</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;yyyyMM01&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="nb">INT</span><span class="p">)</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">ID_AFILIADO</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span>

<span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span>

<span class="c1">-- Beneficiarios</span>
<span class="k">SELECT</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">PARTNER</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">BP</span><span class="p">,</span><span class="w"> </span><span class="p">...</span>
<span class="c1">-- (continúa igual lógica con JOIN a DIM_BENEFICIARIOS)</span>

<span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span>

<span class="c1">-- Empresas</span>
<span class="k">SELECT</span><span class="w"> </span><span class="n">em</span><span class="p">.</span><span class="n">PARTNER</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">BP</span><span class="p">,</span><span class="w"> </span><span class="p">...</span>
<span class="c1">-- (continúa con lógica similar y categoría fija 5)</span>

<span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span>

<span class="c1">-- No aportante</span>
<span class="k">SELECT</span><span class="w"> </span><span class="s1">&#39;0000000000&#39;</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">BP</span><span class="p">,</span>
<span class="w">       </span><span class="p">...</span>
<span class="w">       </span><span class="k">CASE</span><span class="w"> </span><span class="k">WHEN</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">TIPO_DOCUMENTO</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;NI&#39;</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="mi">12</span><span class="w"> </span><span class="k">ELSE</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="k">END</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_CATEGORIA</span><span class="p">,</span>
<span class="w">       </span><span class="p">...</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">ID_AFILIADO</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">ID_EMPRESA</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">ID_BENEFICIARIO</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">3</span>
</code></pre></div>
<h3 id="fact_mineriamineria_educacion_tecnica_y_continuapago"><strong>FACT_MINERIA\MINERIA_EDUCACION_TECNICA_Y_CONTINUA\Pago</strong><a class="headerlink" href="#fact_mineriamineria_educacion_tecnica_y_continuapago" title="Permanent link">&para;</a></h3>
<hr />
<h4 id="descripcion-general_30">Descripción General<a class="headerlink" href="#descripcion-general_30" title="Permanent link">&para;</a></h4>
<p>Este componente del flujo de datos del paquete <code>FACT_MINERIA</code> extrae, transforma y carga información relacionada con pagos realizados por diferentes tipos de beneficiarios en procesos de formación técnica y continua. Se enfoca en la actividad "Pago Matrícula", obtenida desde la tabla <code>FACT_FACTURACION</code> del área de Cedesarrollo, y consolida dicha información en la tabla de hechos <code>Transversal.FACT_MINERIA</code>.</p>
<hr />
<h4 id="ubicacion">Ubicación<a class="headerlink" href="#ubicacion" title="Permanent link">&para;</a></h4>
<p><code>Package\FACT_MINERIA\MINERIA_EDUCACION_TECNICA_Y_CONTINUA\Pago</code></p>
<hr />
<h4 id="proposito_27">Propósito<a class="headerlink" href="#proposito_27" title="Permanent link">&para;</a></h4>
<p>Consolidar pagos de matrícula provenientes de diversas categorías de participantes (afiliados, beneficiarios, empresas y no aportantes) en un solo flujo estandarizado, permitiendo su análisis en el contexto de minería educativa.</p>
<hr />
<h4 id="detalles-de-implementacion_33">Detalles de Implementación<a class="headerlink" href="#detalles-de-implementacion_33" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>Origen de datos:</strong> <code>DWH_COMFENALCO.Cedesarrollo.FACT_FACTURACION</code>, junto con dimensiones de estudiantes, afiliados, beneficiarios, empresas y tiempo mensual.</li>
<li><strong>Tipo de Origen:</strong> ADO.NET Source con consulta SQL personalizada.</li>
<li><strong>Destino:</strong> Tabla <code>Transversal.FACT_MINERIA</code> mediante componente ADO.NET Destination con inserciones masivas habilitadas (<code>UseBulkInsertWhenPossible = true</code>).</li>
<li><strong>Conexión:</strong> Usa el administrador de conexiones <code>Project.ConnectionManagers[DWH_COMFENALCO]</code>.</li>
</ul>
<hr />
<h4 id="logica-de-negocio_32">Lógica de Negocio<a class="headerlink" href="#logica-de-negocio_32" title="Permanent link">&para;</a></h4>
<ul>
<li>Se generan 4 bloques de datos según la categoría del participante: afiliado, beneficiario, empresa o no aportante.</li>
<li>Se filtran conceptos irrelevantes (<code>CERTIFICADO</code>, <code>DERECHO GRADO</code>).</li>
<li>Se estandarizan campos no disponibles con valores por defecto (<code>ID_CURSO</code>, <code>ID_PROGRAMA</code>, etc.).</li>
<li>Se derivan columnas como <code>ID_FECHA_MENSUAL</code>, <code>ID_ANIO_ACADEMICO</code> y <code>ID_UNIDAD</code> a partir de la fecha contable.</li>
<li>Se asigna la fuente como <code>'[DWH_COMFENALCO].[Cedesarrollo].[FACT_FACTURACION]'</code>.</li>
</ul>
<hr />
<h4 id="relacion-con-otros-componentes_31">Relación con Otros Componentes<a class="headerlink" href="#relacion-con-otros-componentes_31" title="Permanent link">&para;</a></h4>
<p>Este componente forma parte del proceso de consolidación educativa técnica y continua, y alimenta la tabla transversal <code>FACT_MINERIA</code>, usada por otros procesos analíticos del dominio educativo.</p>
<hr />
<h4 id="script-sql_5">Script SQL<a class="headerlink" href="#script-sql_5" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="c1">-- Afiliados</span>
<span class="k">SELECT</span><span class="w"> </span><span class="k">distinct</span>
<span class="w">      </span><span class="n">a</span><span class="p">.[</span><span class="n">PARTNER</span><span class="p">]</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">BP</span>
<span class="w">      </span><span class="c1">--,ff.[TIPO_DOCUMENTO_PAGO]</span>
<span class="w">      </span><span class="c1">--,ff.[DOCUMENTO_PAGO]</span>
<span class="w">      </span><span class="p">,</span><span class="k">CAST</span><span class="p">(</span><span class="n">FORMAT</span><span class="p">(</span><span class="n">ff</span><span class="p">.[</span><span class="n">FECHA_CONTABLE</span><span class="p">],</span><span class="w"> </span><span class="s1">&#39;yyyyMM01&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="nb">INT</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_FECHA_MENSUAL</span>
<span class="w">      </span><span class="p">,</span><span class="k">YEAR</span><span class="p">(</span><span class="n">ff</span><span class="p">.[</span><span class="n">FECHA_CONTABLE</span><span class="p">])</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_ANIO_ACADEMICO</span>
<span class="w">      </span><span class="p">,</span><span class="k">CASE</span>
<span class="w">            </span><span class="k">WHEN</span><span class="w"> </span><span class="n">LEN</span><span class="p">(</span><span class="n">NO_RECIBO</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">6</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="mi">2</span>
<span class="w">            </span><span class="k">ELSE</span><span class="w"> </span><span class="mi">3</span>
<span class="w">        </span><span class="k">END</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_UNIDAD</span>
<span class="w">      </span><span class="p">,</span><span class="n">ff</span><span class="p">.[</span><span class="n">FECHA_CONTABLE</span><span class="p">]</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">FECHA_INICIAL</span>
<span class="w">      </span><span class="p">,</span><span class="n">ff</span><span class="p">.[</span><span class="n">FECHA_CONTABLE</span><span class="p">]</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">FECHA_FINAL</span>
<span class="w">      </span><span class="p">,</span><span class="s1">&#39;Pago Matrícula&#39;</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ACTIVIDAD</span>
<span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">TIEMPO_SEGUNDOS</span>
<span class="w">      </span><span class="c1">--,ff.[CONCEPTO]</span>
<span class="w">      </span><span class="p">,</span><span class="n">ff</span><span class="p">.[</span><span class="n">VALOR_PAGADO</span><span class="p">]</span>
<span class="w">      </span><span class="p">,</span><span class="k">ISNULL</span><span class="p">(</span><span class="n">a</span><span class="p">.[</span><span class="n">ID_CATEGORIA</span><span class="p">],</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_CATEGORIA</span>
<span class="w">      </span><span class="c1">--,im.[ID_PERIODO]</span>
<span class="w">      </span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_CURSO</span>
<span class="w">      </span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_TIPO_ESTUDIANTE</span>
<span class="w">      </span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_PROGRAMA</span>
<span class="w">      </span><span class="p">,</span><span class="s1">&#39;[DWH_COMFENALCO].[Cedesarrollo].[FACT_FACTURACION]&#39;</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">FUENTE_PRINCIPAL</span>
<span class="w">  </span><span class="k">FROM</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Cedesarrollo</span><span class="p">].[</span><span class="n">FACT_FACTURACION</span><span class="p">]</span><span class="w"> </span><span class="n">ff</span>
<span class="w">  </span><span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Cedesarrollo</span><span class="p">].[</span><span class="n">DIM_ESTUDIANTES</span><span class="p">]</span><span class="w"> </span><span class="n">e</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">ff</span><span class="p">.[</span><span class="n">TIPO_DOCUMENTO_PAGO</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">e</span><span class="p">.[</span><span class="n">TIPO_DOCUMENTO</span><span class="p">]</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">ff</span><span class="p">.[</span><span class="n">DOCUMENTO_PAGO</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">e</span><span class="p">.[</span><span class="n">DOCUMENTO</span><span class="p">]</span>
<span class="w">  </span><span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Transversal</span><span class="p">].[</span><span class="n">DIM_AFILIADOS</span><span class="p">]</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">e</span><span class="p">.[</span><span class="n">ID_AFILIADO</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="p">.[</span><span class="n">ID_AFILIADO</span><span class="p">]</span>
<span class="w">  </span><span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Transversal</span><span class="p">].[</span><span class="n">DIM_TIEMPO_MENSUAL</span><span class="p">]</span><span class="w"> </span><span class="n">tm</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">tm</span><span class="p">.[</span><span class="n">ID_FECHA</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">CAST</span><span class="p">(</span><span class="n">FORMAT</span><span class="p">(</span><span class="n">ff</span><span class="p">.[</span><span class="n">FECHA_CONTABLE</span><span class="p">],</span><span class="w"> </span><span class="s1">&#39;yyyyMM01&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="nb">INT</span><span class="p">)</span>
<span class="w">  </span><span class="k">WHERE</span><span class="w"> </span>
<span class="w">    </span><span class="p">[</span><span class="n">CONCEPTO</span><span class="p">]</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">LIKE</span><span class="w"> </span><span class="s1">&#39;%CERTIFICADO%&#39;</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="p">[</span><span class="n">CONCEPTO</span><span class="p">]</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">LIKE</span><span class="w"> </span><span class="s1">&#39;%DERECHO GRADO%&#39;</span>
<span class="w">    </span><span class="k">AND</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">ID_AFILIADO</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span>

<span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span>
<span class="c1">-- Beneficiarios</span>
<span class="k">SELECT</span><span class="w"> </span><span class="k">distinct</span>
<span class="w">      </span><span class="n">b</span><span class="p">.[</span><span class="n">PARTNER</span><span class="p">]</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">BP</span>
<span class="w">      </span><span class="c1">--,ff.[TIPO_DOCUMENTO_PAGO]</span>
<span class="w">      </span><span class="c1">--,ff.[DOCUMENTO_PAGO]</span>
<span class="w">      </span><span class="p">,</span><span class="k">CAST</span><span class="p">(</span><span class="n">FORMAT</span><span class="p">(</span><span class="n">ff</span><span class="p">.[</span><span class="n">FECHA_CONTABLE</span><span class="p">],</span><span class="w"> </span><span class="s1">&#39;yyyyMM01&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="nb">INT</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_FECHA_MENSUAL</span>
<span class="w">      </span><span class="p">,</span><span class="k">YEAR</span><span class="p">(</span><span class="n">ff</span><span class="p">.[</span><span class="n">FECHA_CONTABLE</span><span class="p">])</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_ANIO_ACADEMICO</span>
<span class="w">      </span><span class="p">,</span><span class="k">CASE</span>
<span class="w">            </span><span class="k">WHEN</span><span class="w"> </span><span class="n">LEN</span><span class="p">(</span><span class="n">NO_RECIBO</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">6</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="mi">2</span>
<span class="w">            </span><span class="k">ELSE</span><span class="w"> </span><span class="mi">3</span>
<span class="w">        </span><span class="k">END</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_UNIDAD</span>
<span class="w">      </span><span class="p">,</span><span class="n">ff</span><span class="p">.[</span><span class="n">FECHA_CONTABLE</span><span class="p">]</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">FECHA_INICIAL</span>
<span class="w">      </span><span class="p">,</span><span class="n">ff</span><span class="p">.[</span><span class="n">FECHA_CONTABLE</span><span class="p">]</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">FECHA_FINAL</span>
<span class="w">      </span><span class="p">,</span><span class="s1">&#39;Pago Matrícula&#39;</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ACTIVIDAD</span>
<span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">TIEMPO_SEGUNDOS</span>
<span class="w">      </span><span class="c1">--,ff.[CONCEPTO]</span>
<span class="w">      </span><span class="p">,</span><span class="n">ff</span><span class="p">.[</span><span class="n">VALOR_PAGADO</span><span class="p">]</span>
<span class="w">      </span><span class="p">,</span><span class="k">ISNULL</span><span class="p">(</span><span class="n">a</span><span class="p">.[</span><span class="n">ID_CATEGORIA</span><span class="p">],</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_CATEGORIA</span>
<span class="w">      </span><span class="c1">--,im.[ID_PERIODO]</span>
<span class="w">      </span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_CURSO</span>
<span class="w">      </span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_TIPO_ESTUDIANTE</span>
<span class="w">      </span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_PROGRAMA</span>
<span class="w">      </span><span class="p">,</span><span class="s1">&#39;[DWH_COMFENALCO].[Cedesarrollo].[FACT_FACTURACION]&#39;</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">FUENTE_PRINCIPAL</span>
<span class="w">  </span><span class="k">FROM</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Cedesarrollo</span><span class="p">].[</span><span class="n">FACT_FACTURACION</span><span class="p">]</span><span class="w"> </span><span class="n">ff</span>
<span class="w">  </span><span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Cedesarrollo</span><span class="p">].[</span><span class="n">DIM_ESTUDIANTES</span><span class="p">]</span><span class="w"> </span><span class="n">e</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">ff</span><span class="p">.[</span><span class="n">TIPO_DOCUMENTO_PAGO</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">e</span><span class="p">.[</span><span class="n">TIPO_DOCUMENTO</span><span class="p">]</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">ff</span><span class="p">.[</span><span class="n">DOCUMENTO_PAGO</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">e</span><span class="p">.[</span><span class="n">DOCUMENTO</span><span class="p">]</span>
<span class="w">  </span><span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Transversal</span><span class="p">].[</span><span class="n">DIM_BENEFICIARIOS</span><span class="p">]</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">e</span><span class="p">.[</span><span class="n">ID_BENEFICIARIO</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="n">b</span><span class="p">.[</span><span class="n">ID_BENEFICIARIO</span><span class="p">]</span>
<span class="w">  </span><span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Transversal</span><span class="p">].[</span><span class="n">DIM_TIEMPO_MENSUAL</span><span class="p">]</span><span class="w"> </span><span class="n">tm</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">tm</span><span class="p">.[</span><span class="n">ID_FECHA</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">CAST</span><span class="p">(</span><span class="n">FORMAT</span><span class="p">(</span><span class="n">ff</span><span class="p">.[</span><span class="n">FECHA_CONTABLE</span><span class="p">],</span><span class="w"> </span><span class="s1">&#39;yyyyMM01&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="nb">INT</span><span class="p">)</span>
<span class="w">  </span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Transversal</span><span class="p">].[</span><span class="n">DIM_AFILIADOS</span><span class="p">]</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">b</span><span class="p">.[</span><span class="n">ID_AFILIADO</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="p">.[</span><span class="n">ID_AFILIADO</span><span class="p">]</span>
<span class="w">  </span><span class="k">WHERE</span><span class="w"> </span>
<span class="w">    </span><span class="p">[</span><span class="n">CONCEPTO</span><span class="p">]</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">LIKE</span><span class="w"> </span><span class="s1">&#39;%CERTIFICADO%&#39;</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="p">[</span><span class="n">CONCEPTO</span><span class="p">]</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">LIKE</span><span class="w"> </span><span class="s1">&#39;%DERECHO GRADO%&#39;</span>
<span class="w">    </span><span class="k">AND</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">ID_BENEFICIARIO</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span>

<span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span>
<span class="w">   </span><span class="c1">-- Empresas</span>
<span class="k">SELECT</span><span class="w"> </span><span class="k">distinct</span>
<span class="w">      </span><span class="n">em</span><span class="p">.[</span><span class="n">PARTNER</span><span class="p">]</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">BP</span>
<span class="w">      </span><span class="c1">--,ff.[TIPO_DOCUMENTO_PAGO]</span>
<span class="w">      </span><span class="c1">--,ff.[DOCUMENTO_PAGO]</span>
<span class="w">      </span><span class="p">,</span><span class="k">CAST</span><span class="p">(</span><span class="n">FORMAT</span><span class="p">(</span><span class="n">ff</span><span class="p">.[</span><span class="n">FECHA_CONTABLE</span><span class="p">],</span><span class="w"> </span><span class="s1">&#39;yyyyMM01&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="nb">INT</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_FECHA_MENSUAL</span>
<span class="w">      </span><span class="p">,</span><span class="k">YEAR</span><span class="p">(</span><span class="n">ff</span><span class="p">.[</span><span class="n">FECHA_CONTABLE</span><span class="p">])</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_ANIO_ACADEMICO</span>
<span class="w">      </span><span class="p">,</span><span class="k">CASE</span>
<span class="w">            </span><span class="k">WHEN</span><span class="w"> </span><span class="n">LEN</span><span class="p">(</span><span class="n">NO_RECIBO</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">6</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="mi">2</span>
<span class="w">            </span><span class="k">ELSE</span><span class="w"> </span><span class="mi">3</span>
<span class="w">        </span><span class="k">END</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_UNIDAD</span>
<span class="w">      </span><span class="p">,</span><span class="n">ff</span><span class="p">.[</span><span class="n">FECHA_CONTABLE</span><span class="p">]</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">FECHA_INICIAL</span>
<span class="w">      </span><span class="p">,</span><span class="n">ff</span><span class="p">.[</span><span class="n">FECHA_CONTABLE</span><span class="p">]</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">FECHA_FINAL</span>
<span class="w">      </span><span class="p">,</span><span class="s1">&#39;Pago Matrícula&#39;</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ACTIVIDAD</span>
<span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">TIEMPO_SEGUNDOS</span>
<span class="w">      </span><span class="c1">--,ff.[CONCEPTO]</span>
<span class="w">      </span><span class="p">,</span><span class="n">ff</span><span class="p">.[</span><span class="n">VALOR_PAGADO</span><span class="p">]</span>
<span class="w">      </span><span class="p">,</span><span class="mi">5</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_CATEGORIA</span>
<span class="w">      </span><span class="c1">--,im.[ID_PERIODO]</span>
<span class="w">      </span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_CURSO</span>
<span class="w">      </span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_TIPO_ESTUDIANTE</span>
<span class="w">      </span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_PROGRAMA</span>
<span class="w">      </span><span class="p">,</span><span class="s1">&#39;[DWH_COMFENALCO].[Cedesarrollo].[FACT_FACTURACION]&#39;</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">FUENTE_PRINCIPAL</span>
<span class="w">  </span><span class="k">FROM</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Cedesarrollo</span><span class="p">].[</span><span class="n">FACT_FACTURACION</span><span class="p">]</span><span class="w"> </span><span class="n">ff</span>
<span class="w">  </span><span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Cedesarrollo</span><span class="p">].[</span><span class="n">DIM_ESTUDIANTES</span><span class="p">]</span><span class="w"> </span><span class="n">e</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">ff</span><span class="p">.[</span><span class="n">TIPO_DOCUMENTO_PAGO</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">e</span><span class="p">.[</span><span class="n">TIPO_DOCUMENTO</span><span class="p">]</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">ff</span><span class="p">.[</span><span class="n">DOCUMENTO_PAGO</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">e</span><span class="p">.[</span><span class="n">DOCUMENTO</span><span class="p">]</span>
<span class="w">  </span><span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Transversal</span><span class="p">].[</span><span class="n">DIM_EMPRESAS</span><span class="p">]</span><span class="w"> </span><span class="n">em</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">e</span><span class="p">.[</span><span class="n">ID_EMPRESA</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="n">em</span><span class="p">.[</span><span class="n">ID_EMPRESA</span><span class="p">]</span>
<span class="w">  </span><span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Transversal</span><span class="p">].[</span><span class="n">DIM_TIEMPO_MENSUAL</span><span class="p">]</span><span class="w"> </span><span class="n">tm</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">tm</span><span class="p">.[</span><span class="n">ID_FECHA</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">CAST</span><span class="p">(</span><span class="n">FORMAT</span><span class="p">(</span><span class="n">ff</span><span class="p">.[</span><span class="n">FECHA_CONTABLE</span><span class="p">],</span><span class="w"> </span><span class="s1">&#39;yyyyMM01&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="nb">INT</span><span class="p">)</span>
<span class="w">  </span><span class="k">WHERE</span><span class="w"> </span>
<span class="w">    </span><span class="p">[</span><span class="n">CONCEPTO</span><span class="p">]</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">LIKE</span><span class="w"> </span><span class="s1">&#39;%CERTIFICADO%&#39;</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="p">[</span><span class="n">CONCEPTO</span><span class="p">]</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">LIKE</span><span class="w"> </span><span class="s1">&#39;%DERECHO GRADO%&#39;</span>
<span class="w">    </span><span class="k">AND</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">ID_EMPRESA</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span>

<span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span>

<span class="c1">-- No aportante</span>
<span class="k">SELECT</span><span class="w"> </span><span class="k">distinct</span>
<span class="w">      </span><span class="s1">&#39;0000000000&#39;</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">BP</span>
<span class="w">      </span><span class="c1">--,ff.[TIPO_DOCUMENTO_PAGO]</span>
<span class="w">      </span><span class="c1">--,ff.[DOCUMENTO_PAGO]</span>
<span class="w">      </span><span class="p">,</span><span class="k">CAST</span><span class="p">(</span><span class="n">FORMAT</span><span class="p">(</span><span class="n">ff</span><span class="p">.[</span><span class="n">FECHA_CONTABLE</span><span class="p">],</span><span class="w"> </span><span class="s1">&#39;yyyyMM01&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="nb">INT</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_FECHA_MENSUAL</span>
<span class="w">      </span><span class="p">,</span><span class="k">YEAR</span><span class="p">(</span><span class="n">ff</span><span class="p">.[</span><span class="n">FECHA_CONTABLE</span><span class="p">])</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_ANIO_ACADEMICO</span>
<span class="w">      </span><span class="p">,</span><span class="k">CASE</span>
<span class="w">            </span><span class="k">WHEN</span><span class="w"> </span><span class="n">LEN</span><span class="p">(</span><span class="n">NO_RECIBO</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">6</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="mi">2</span>
<span class="w">            </span><span class="k">ELSE</span><span class="w"> </span><span class="mi">3</span>
<span class="w">        </span><span class="k">END</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_UNIDAD</span>
<span class="w">      </span><span class="p">,</span><span class="n">ff</span><span class="p">.[</span><span class="n">FECHA_CONTABLE</span><span class="p">]</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">FECHA_INICIAL</span>
<span class="w">      </span><span class="p">,</span><span class="n">ff</span><span class="p">.[</span><span class="n">FECHA_CONTABLE</span><span class="p">]</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">FECHA_FINAL</span>
<span class="w">      </span><span class="p">,</span><span class="s1">&#39;Pago Matrícula&#39;</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ACTIVIDAD</span>
<span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">TIEMPO_SEGUNDOS</span>
<span class="w">      </span><span class="c1">--,ff.[CONCEPTO]</span>
<span class="w">      </span><span class="p">,</span><span class="n">ff</span><span class="p">.[</span><span class="n">VALOR_PAGADO</span><span class="p">]</span>
<span class="w">      </span><span class="p">,</span><span class="k">CASE</span>
<span class="w">            </span><span class="k">WHEN</span><span class="w"> </span><span class="n">e</span><span class="p">.[</span><span class="n">TIPO_DOCUMENTO</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;NI&#39;</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="mi">12</span>
<span class="w">            </span><span class="k">ELSE</span><span class="w"> </span><span class="mi">4</span>
<span class="w">        </span><span class="k">END</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_CATEGORIA</span>
<span class="w">      </span><span class="c1">--,im.[ID_PERIODO]</span>
<span class="w">      </span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_CURSO</span>
<span class="w">      </span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_TIPO_ESTUDIANTE</span>
<span class="w">      </span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_PROGRAMA</span>
<span class="w">      </span><span class="p">,</span><span class="s1">&#39;[DWH_COMFENALCO].[Cedesarrollo].[FACT_FACTURACION]&#39;</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">FUENTE_PRINCIPAL</span>
<span class="w">  </span><span class="k">FROM</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Cedesarrollo</span><span class="p">].[</span><span class="n">FACT_FACTURACION</span><span class="p">]</span><span class="w"> </span><span class="n">ff</span>
<span class="w">  </span><span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Cedesarrollo</span><span class="p">].[</span><span class="n">DIM_ESTUDIANTES</span><span class="p">]</span><span class="w"> </span><span class="n">e</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">ff</span><span class="p">.[</span><span class="n">TIPO_DOCUMENTO_PAGO</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">e</span><span class="p">.[</span><span class="n">TIPO_DOCUMENTO</span><span class="p">]</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">ff</span><span class="p">.[</span><span class="n">DOCUMENTO_PAGO</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">e</span><span class="p">.[</span><span class="n">DOCUMENTO</span><span class="p">]</span>
<span class="w">  </span><span class="c1">--INNER JOIN [DWH_COMFENALCO].[Transversal].[DIM_EMPRESAS] em on e.[ID_EMPRESA] =  em.[ID_EMPRESA]</span>
<span class="w">  </span><span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Transversal</span><span class="p">].[</span><span class="n">DIM_TIEMPO_MENSUAL</span><span class="p">]</span><span class="w"> </span><span class="n">tm</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">tm</span><span class="p">.[</span><span class="n">ID_FECHA</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">CAST</span><span class="p">(</span><span class="n">FORMAT</span><span class="p">(</span><span class="n">ff</span><span class="p">.[</span><span class="n">FECHA_CONTABLE</span><span class="p">],</span><span class="w"> </span><span class="s1">&#39;yyyyMM01&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="nb">INT</span><span class="p">)</span>
<span class="w">  </span><span class="k">WHERE</span><span class="w"> </span>
<span class="w">    </span><span class="p">[</span><span class="n">CONCEPTO</span><span class="p">]</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">LIKE</span><span class="w"> </span><span class="s1">&#39;%CERTIFICADO%&#39;</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="p">[</span><span class="n">CONCEPTO</span><span class="p">]</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">LIKE</span><span class="w"> </span><span class="s1">&#39;%DERECHO GRADO%&#39;</span>
<span class="w">    </span><span class="k">AND</span><span class="w"> </span><span class="n">ID_AFILIADO</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">ID_EMPRESA</span><span class="o">+</span><span class="w"> </span><span class="n">ID_BENEFICIARIO</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">3</span>
</code></pre></div>
<h3 id="fact_mineriamineria_educacion_tecnica_y_continuapqrs"><strong>FACT_MINERIA\MINERIA_EDUCACION_TECNICA_Y_CONTINUA\PQRs</strong><a class="headerlink" href="#fact_mineriamineria_educacion_tecnica_y_continuapqrs" title="Permanent link">&para;</a></h3>
<hr />
<h4 id="descripcion-general_31"><strong>Descripción General</strong><a class="headerlink" href="#descripcion-general_31" title="Permanent link">&para;</a></h4>
<p>Este componente realiza la extracción, transformación y carga de datos asociados a las PQRs (Peticiones, Quejas y Reclamos) en el contexto de la educación técnica y continua, consolidando los registros en la tabla <code>Transversal.FACT_MINERIA</code>. Utiliza información de beneficiarios y afiliados para clasificar y categorizar los eventos, integrando múltiples tablas del DWH.</p>
<hr />
<h4 id="ubicacion-en-el-paquete_15"><strong>Ubicación en el Paquete</strong><a class="headerlink" href="#ubicacion-en-el-paquete_15" title="Permanent link">&para;</a></h4>
<p><code>FACT_MINERIA \ MINERIA_EDUCACION_TECNICA_Y_CONTINUA \ PQRs</code></p>
<hr />
<h4 id="proposito_28"><strong>Propósito</strong><a class="headerlink" href="#proposito_28" title="Permanent link">&para;</a></h4>
<p>Permitir el análisis mensual de actividades relacionadas con la gestión de PQRs, calculando tiempos de resolución, categorizaciones y trazabilidad por unidad académica, periodo y beneficiario o afiliado.</p>
<hr />
<h4 id="implementacion-tecnica_1"><strong>Implementación Técnica</strong><a class="headerlink" href="#implementacion-tecnica_1" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>Origen:</strong> ADO.NET Source con consulta SQL que hace <code>UNION</code> de registros según la relación con <code>DIM_AFILIADOS</code> y <code>DIM_BENEFICIARIOS</code>.</li>
<li>
<p><strong>Transformaciones:</strong></p>
<ul>
<li><code>Lookup</code>: verifica existencia previa en <code>FACT_MINERIA</code> usando <code>BP</code>.</li>
</ul>
</li>
<li>
<p><strong>Destino:</strong> ADO.NET Destination hacia la tabla <code>Transversal.FACT_MINERIA</code>.</p>
</li>
<li>
<p><strong>Conexiones:</strong></p>
<ul>
<li><code>DWH_COMFENALCO</code> (ADO.NET)</li>
<li><code>DWH_COMFENALCO_OLEDB</code> (OLEDB para Lookup)</li>
</ul>
</li>
<li>
<p><strong>Columnas procesadas:</strong></p>
<ul>
<li>BP, ID_FECHA_MENSUAL, ID_ANIO_ACADEMICO, ID_UNIDAD, FECHA_INICIAL, FECHA_FINAL, ACTIVIDAD, TIEMPO_SEGUNDOS, VALOR_PAGADO, ID_CATEGORIA, ID_CURSO, ID_TIPO_ESTUDIANTE, FUENTE_PRINCIPAL</li>
</ul>
</li>
</ul>
<hr />
<h4 id="logica-de-negocio_33"><strong>Lógica de Negocio</strong><a class="headerlink" href="#logica-de-negocio_33" title="Permanent link">&para;</a></h4>
<ul>
<li>Registra eventos de PQR por afiliados y beneficiarios con ID_UNIDAD en (2,3).</li>
<li>Calcula el tiempo de resolución en segundos.</li>
<li>Clasifica el tipo de actividad según la causa (<code>'PQR ' + lower(CAUSA)</code>).</li>
<li>Asigna valores constantes a campos que no aplican (<code>ID_CURSO = -1</code>, <code>VALOR_PAGADO = 0</code>, etc.).</li>
<li>Determina categoría por afiliado cuando está disponible, o usa valor por defecto.</li>
<li>Aplica lógica de actualización solo si el <code>BP</code> ya existe en <code>FACT_MINERIA</code>.</li>
</ul>
<hr />
<h4 id="relacion-con-otros-componentes_32"><strong>Relación con Otros Componentes</strong><a class="headerlink" href="#relacion-con-otros-componentes_32" title="Permanent link">&para;</a></h4>
<ul>
<li>Este flujo se alimenta de la tabla <code>FACT_PQRS</code> pero escribe en <code>FACT_MINERIA</code>, por lo que su salida debe integrarse con otros procesos que también alimentan dicha tabla desde otros dominios.</li>
</ul>
<hr />
<h4 id="script-sql_6"><strong>Script SQL</strong><a class="headerlink" href="#script-sql_6" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span>
<span class="w">    </span><span class="n">a</span><span class="p">.[</span><span class="n">PARTNER</span><span class="p">]</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">BP</span><span class="p">,</span>
<span class="w">    </span><span class="k">CONVERT</span><span class="p">(</span><span class="nb">INT</span><span class="p">,</span><span class="w"> </span><span class="k">LEFT</span><span class="p">(</span><span class="k">CAST</span><span class="p">(</span><span class="n">f</span><span class="p">.</span><span class="n">ID_FECHA</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">),</span><span class="w"> </span><span class="mi">6</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;01&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_FECHA_MENSUAL</span><span class="p">,</span>
<span class="w">    </span><span class="k">CONVERT</span><span class="p">(</span><span class="nb">INT</span><span class="p">,</span><span class="w"> </span><span class="k">LEFT</span><span class="p">(</span><span class="k">CAST</span><span class="p">(</span><span class="n">f</span><span class="p">.</span><span class="n">ID_FECHA</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">),</span><span class="w"> </span><span class="mi">4</span><span class="p">))</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_ANIO_ACADEMICO</span><span class="p">,</span>
<span class="w">    </span><span class="p">[</span><span class="n">ID_UNIDAD</span><span class="p">],</span>
<span class="w">    </span><span class="p">[</span><span class="n">FECHA_CREACION</span><span class="p">]</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">FECHA_INICIAL</span><span class="p">,</span>
<span class="w">    </span><span class="p">[</span><span class="n">FECHA_RESOLUCION</span><span class="p">]</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">FECHA_FINAL</span><span class="p">,</span>
<span class="w">    </span><span class="n">CONCAT</span><span class="p">(</span><span class="s1">&#39;PQR &#39;</span><span class="p">,</span><span class="w"> </span><span class="k">LOWER</span><span class="p">([</span><span class="n">CAUSA</span><span class="p">]))</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ACTIVIDAD</span><span class="p">,</span>
<span class="w">    </span><span class="n">DATEDIFF</span><span class="p">(</span><span class="k">SECOND</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="n">FECHA_CREACION</span><span class="p">],</span><span class="w"> </span><span class="p">[</span><span class="n">FECHA_RESOLUCION</span><span class="p">])</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">TIEMPO_SEGUNDOS</span><span class="p">,</span>
<span class="w">    </span><span class="mi">0</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">VALOR_PAGADO</span><span class="p">,</span>
<span class="w">    </span><span class="p">[</span><span class="n">ID_CATEGORIA</span><span class="p">],</span>
<span class="w">    </span><span class="o">-</span><span class="mi">1</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_CURSO</span><span class="p">,</span>
<span class="w">    </span><span class="o">-</span><span class="mi">1</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_TIPO_ESTUDIANTE</span><span class="p">,</span>
<span class="w">    </span><span class="s1">&#39;[DWH_COMFENALCO].[Transversal].[FACT_PQRS]&#39;</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">FUENTE_PRINCIPAL</span>
<span class="k">FROM</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Transversal</span><span class="p">].[</span><span class="n">FACT_PQRS</span><span class="p">]</span><span class="w"> </span><span class="n">f</span>
<span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Transversal</span><span class="p">].[</span><span class="n">DIM_TIEMPO_MENSUAL</span><span class="p">]</span><span class="w"> </span><span class="n">tm</span><span class="w"> </span>
<span class="w">    </span><span class="k">ON</span><span class="w"> </span><span class="n">tm</span><span class="p">.[</span><span class="n">ID_FECHA</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">CONVERT</span><span class="p">(</span><span class="nb">INT</span><span class="p">,</span><span class="w"> </span><span class="k">LEFT</span><span class="p">(</span><span class="k">CAST</span><span class="p">(</span><span class="n">f</span><span class="p">.</span><span class="n">ID_FECHA</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">),</span><span class="w"> </span><span class="mi">6</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;01&#39;</span><span class="p">)</span>
<span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Transversal</span><span class="p">].[</span><span class="n">DIM_AFILIADOS</span><span class="p">]</span><span class="w"> </span><span class="n">a</span><span class="w"> </span>
<span class="w">    </span><span class="k">ON</span><span class="w"> </span><span class="n">f</span><span class="p">.[</span><span class="n">ID_AFILIADO</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="p">.[</span><span class="n">ID_AFILIADO</span><span class="p">]</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">f</span><span class="p">.</span><span class="n">ID_AFILIADO</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">ID_UNIDAD</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>

<span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span>

<span class="k">SELECT</span><span class="w"> </span>
<span class="w">    </span><span class="n">b</span><span class="p">.[</span><span class="n">PARTNER</span><span class="p">]</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">BP</span><span class="p">,</span>
<span class="w">    </span><span class="k">CONVERT</span><span class="p">(</span><span class="nb">INT</span><span class="p">,</span><span class="w"> </span><span class="k">LEFT</span><span class="p">(</span><span class="k">CAST</span><span class="p">(</span><span class="n">f</span><span class="p">.</span><span class="n">ID_FECHA</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">),</span><span class="w"> </span><span class="mi">6</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;01&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_FECHA_MENSUAL</span><span class="p">,</span>
<span class="w">    </span><span class="k">CONVERT</span><span class="p">(</span><span class="nb">INT</span><span class="p">,</span><span class="w"> </span><span class="k">LEFT</span><span class="p">(</span><span class="k">CAST</span><span class="p">(</span><span class="n">f</span><span class="p">.</span><span class="n">ID_FECHA</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">),</span><span class="w"> </span><span class="mi">4</span><span class="p">))</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_ANIO_ACADEMICO</span><span class="p">,</span>
<span class="w">    </span><span class="p">[</span><span class="n">ID_UNIDAD</span><span class="p">],</span>
<span class="w">    </span><span class="p">[</span><span class="n">FECHA_CREACION</span><span class="p">]</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">FECHA_INICIAL</span><span class="p">,</span>
<span class="w">    </span><span class="p">[</span><span class="n">FECHA_RESOLUCION</span><span class="p">]</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">FECHA_FINAL</span><span class="p">,</span>
<span class="w">    </span><span class="n">CONCAT</span><span class="p">(</span><span class="s1">&#39;PQR &#39;</span><span class="p">,</span><span class="w"> </span><span class="k">LOWER</span><span class="p">([</span><span class="n">CAUSA</span><span class="p">]))</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ACTIVIDAD</span><span class="p">,</span>
<span class="w">    </span><span class="n">DATEDIFF</span><span class="p">(</span><span class="k">SECOND</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="n">FECHA_CREACION</span><span class="p">],</span><span class="w"> </span><span class="p">[</span><span class="n">FECHA_RESOLUCION</span><span class="p">])</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">TIEMPO_SEGUNDOS</span><span class="p">,</span>
<span class="w">    </span><span class="mi">0</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">VALOR_PAGADO</span><span class="p">,</span>
<span class="w">    </span><span class="k">ISNULL</span><span class="p">(</span><span class="n">a</span><span class="p">.[</span><span class="n">ID_CATEGORIA</span><span class="p">],</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_CATEGORIA</span><span class="p">,</span>
<span class="w">    </span><span class="o">-</span><span class="mi">1</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_CURSO</span><span class="p">,</span>
<span class="w">    </span><span class="o">-</span><span class="mi">1</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID_TIPO_ESTUDIANTE</span><span class="p">,</span>
<span class="w">    </span><span class="s1">&#39;[DWH_COMFENALCO].[Transversal].[FACT_PQRS]&#39;</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">FUENTE_PRINCIPAL</span>
<span class="k">FROM</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Transversal</span><span class="p">].[</span><span class="n">FACT_PQRS</span><span class="p">]</span><span class="w"> </span><span class="n">f</span>
<span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Transversal</span><span class="p">].[</span><span class="n">DIM_TIEMPO_MENSUAL</span><span class="p">]</span><span class="w"> </span><span class="n">tm</span><span class="w"> </span>
<span class="w">    </span><span class="k">ON</span><span class="w"> </span><span class="n">tm</span><span class="p">.[</span><span class="n">ID_FECHA</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">CONVERT</span><span class="p">(</span><span class="nb">INT</span><span class="p">,</span><span class="w"> </span><span class="k">LEFT</span><span class="p">(</span><span class="k">CAST</span><span class="p">(</span><span class="n">f</span><span class="p">.</span><span class="n">ID_FECHA</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">),</span><span class="w"> </span><span class="mi">6</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;01&#39;</span><span class="p">)</span>
<span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Transversal</span><span class="p">].[</span><span class="n">DIM_BENEFICIARIOS</span><span class="p">]</span><span class="w"> </span><span class="n">b</span><span class="w"> </span>
<span class="w">    </span><span class="k">ON</span><span class="w"> </span><span class="n">f</span><span class="p">.[</span><span class="n">ID_BENEFICIARIO</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="n">b</span><span class="p">.[</span><span class="n">ID_BENEFICIARIO</span><span class="p">]</span>
<span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="p">[</span><span class="n">DWH_COMFENALCO</span><span class="p">].[</span><span class="n">Transversal</span><span class="p">].[</span><span class="n">DIM_AFILIADOS</span><span class="p">]</span><span class="w"> </span><span class="n">a</span><span class="w"> </span>
<span class="w">    </span><span class="k">ON</span><span class="w"> </span><span class="n">b</span><span class="p">.[</span><span class="n">ID_AFILIADO</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="p">.[</span><span class="n">ID_AFILIADO</span><span class="p">]</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">f</span><span class="p">.</span><span class="n">ID_BENEFICIARIO</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">ID_UNIDAD</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
</code></pre></div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["navigation"], "search": "../../assets/javascripts/workers/search.f8cc74c7.min.js", "tags": null, "translations": {"clipboard.copied": "Copiado al portapapeles", "clipboard.copy": "Copiar al portapapeles", "search.result.more.one": "1 m\u00e1s en esta p\u00e1gina", "search.result.more.other": "# m\u00e1s en esta p\u00e1gina", "search.result.none": "No se encontraron documentos", "search.result.one": "1 documento encontrado", "search.result.other": "# documentos encontrados", "search.result.placeholder": "Teclee para comenzar b\u00fasqueda", "search.result.term.missing": "Falta", "select.version": "Seleccionar versi\u00f3n"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.c8b220af.min.js"></script>
      
        <script src="../../assets/mkdocs_pagetree_plugin.js"></script>
      
        <script src="../../js/init_mermaid.js"></script>
      
    
  </body>
</html>