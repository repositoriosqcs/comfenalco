
<!doctype html>
<html lang="es" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../../00.etl_02.C4C/02.C4C_webscraping_v4_Historico/">
      
      
        <link rel="next" href="../download/">
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.12">
    
    
      
        <title>Funciones.py - COMFENALCO</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.2afb09e1.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../assets/mkdocs_pagetree_plugin.css">
    
      <link rel="stylesheet" href="../../../css/extra.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="23abf7" data-md-color-accent="light-blue">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#configuracion-e-import-de-librerias" class="md-skip">
          Saltar a contenido
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Cabecera">
    <a href="../../.." title="COMFENALCO" class="md-header__button md-logo" aria-label="COMFENALCO" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            COMFENALCO
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Funciones.py
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Búsqueda" placeholder="Búsqueda" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Buscar">
        
        <button type="reset" class="md-search__icon md-icon" title="Limpiar" aria-label="Limpiar" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Inicializando búsqueda
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navegación" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="COMFENALCO" class="md-nav__button md-logo" aria-label="COMFENALCO" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    COMFENALCO
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" >
        
          
          <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    00. INICIO
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            00. INICIO
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    INTRODUCCIÓN
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../instalacion/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    INSTALACIÓN Y CONFIGURACIÓN
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Conexiones_BD/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    CONEXIÓN A BASE DE DATOS
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../buenaspracticas/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    BUENAS PRÁCTICAS
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    01. SCRIPTS SQL
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            01. SCRIPTS SQL
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../01.scripts/00.Inicio/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Introducción
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../01.scripts/00.Eliminar_todo/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    00. Eliminar Todo
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../01.scripts/01.Transversal/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    01. Transversal
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../01.scripts/02.Cedesarrollo/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    02. Cedesarrollo
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../01.scripts/03.Proteccion/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    03. Proteccion
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../01.scripts/04.Colegio/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    04. Colegio
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../01.scripts/05.Tablas_Stage_Area/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    05. Tablas Stage Area
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    02. ESTRUCTURA SHAREPOINT
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            02. ESTRUCTURA SHAREPOINT
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../04.sharepoint/estructura_sharepoint/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Estructura carpeta Sharepoint
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../04.sharepoint/estructura_archivos_actualizacion/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Estructura Archivos Actualizacion
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    03. BI COMFENALCO
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            03. BI COMFENALCO
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../02.Paquetes_SSIS/00.params/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Introduccion
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../02.Paquetes_SSIS/00-SCRAPING/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    00. WEB SCRAPING
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../02.Paquetes_SSIS/01.TRANSVERSAL_DIMENSIONES/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    01. TRANSVERSAL_DIMENSIONES
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../02.Paquetes_SSIS/02-TRANSVERSAL_FACT/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    02. TRANSVERSAL_FACT
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../02.Paquetes_SSIS/03-COLEGIO_DIMENSIONES/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    03. COLEGIO_DIMENSIONES
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../02.Paquetes_SSIS/04-COLEGIO_FACT/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    04. COLEGIO_FACT
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../02.Paquetes_SSIS/05-CEDESARROLLO_DIMENSIONES/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    05. CEDESARROLLO_DIMENSIONES
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../02.Paquetes_SSIS/06-CEDESARROLLO_FACT/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    06. CEDESARROLLO_FACT
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../02.Paquetes_SSIS/07-PROTECCION_DIMENSIONES/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    07. PROTECCION_DIMENSIONES
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../02.Paquetes_SSIS/08-PROTECCION_FACT/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    08. PROTECCION_FACT
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../02.Paquetes_SSIS/09-ETLS_CUBO/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    09. ETLS_CUBO
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" checked>
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    04. COMFENALCO EDUCACION
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            04. COMFENALCO EDUCACION
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1" checked>
        
          
          <label class="md-nav__link" for="__nav_5_1" id="__nav_5_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    01 SCRIPTS
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5_1">
            <span class="md-nav__icon md-icon"></span>
            01 SCRIPTS
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../00.etl_00.Introduccion/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Introducción
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1_2" >
        
          
          <label class="md-nav__link" for="__nav_5_1_2" id="__nav_5_1_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    01. Q10
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_1_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1_2">
            <span class="md-nav__icon md-icon"></span>
            01. Q10
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1_2_1" >
        
          
          <label class="md-nav__link" for="__nav_5_1_2_1" id="__nav_5_1_2_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    0.1. Educación Tecnica
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_5_1_2_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1_2_1">
            <span class="md-nav__icon md-icon"></span>
            0.1. Educación Tecnica
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../00.etl_01.q10_01.educaciontecnica/01.Docentes_Cedesarrollo/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    0.1. Docentes Cedesarrollo.py
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../00.etl_01.q10_01.educaciontecnica/02.Disenio_curricular/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    0.2. Diseño Curricular.py
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../00.etl_01.q10_01.educaciontecnica/03.Listado_matriculas/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    0.3. Listado Matrículas.py
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../00.etl_01.q10_01.educaciontecnica/04.Ingresos/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    0.4. Ingresos.py
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../00.etl_01.q10_01.educaciontecnica/05.Historico_notas_Cedesarrollo/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    0.5. Histórico notas.py
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../00.etl_01.q10_01.educaciontecnica/06.Egresados_graduados_Cedesarrollo/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    0.6. Egresados.py
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../00.etl_01.q10_01.educaciontecnica/07.Desertores/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    0.7. Desertores.py
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1_2_2" >
        
          
          <label class="md-nav__link" for="__nav_5_1_2_2" id="__nav_5_1_2_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    0.2. Educación Continua
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_5_1_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1_2_2">
            <span class="md-nav__icon md-icon"></span>
            0.2. Educación Continua
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../00.etl_01.q10_02.educacioncontinua/01.Docentes_desarrollo_empresarial/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    0.1. Docentes Desarrollo Empresarial
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../00.etl_01.q10_02.educacioncontinua/02.Preinscritos/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    0.2. Preinscritos
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../00.etl_01.q10_02.educacioncontinua/03.Listado_matriculas_emp/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    0.3. Listado Matrículas Empresarial
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../00.etl_01.q10_02.educacioncontinua/04.Consolidado_inasistencias/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    0.4. Consolidado Inasistencias
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../00.etl_01.q10_02.educacioncontinua/05.Estudiantes_inasistencias/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    0.5. Estudiantes Inasistencias
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../00.etl_01.q10_02.educacioncontinua/06.Egresados_graduados_empresarial/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    0.6. Egresados Graduados Empresarial
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1_2_3" >
        
          
          <label class="md-nav__link" for="__nav_5_1_2_3" id="__nav_5_1_2_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Sharepoint
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_5_1_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1_2_3">
            <span class="md-nav__icon md-icon"></span>
            Sharepoint
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../00.etl_01.q10_02.Sharepoint/cede_01_procesar_docentes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    cede_01 procesar_docentes
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../00.etl_01.q10_02.Sharepoint/cede_02_procesar_Dise%C3%B1o_Curricular/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    cede_02 procesar_Diseño_Curricular
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../00.etl_01.q10_02.Sharepoint/cede_03_procesar_listado_matriculas/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    cede_03 procesar_listado_matriculas
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../00.etl_01.q10_02.Sharepoint/cede_04_procesar_cede_Ingresos/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    cede_04 procesar_Ingresos
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../00.etl_01.q10_02.Sharepoint/cede_05_cede_Historico_Notas/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    cede_05 cede_Historico_Notas
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../00.etl_01.q10_02.Sharepoint/cede_06_cede_Egresados_Graduados/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    cede_06 cede_Egresados_Graduados
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../00.etl_01.q10_02.Sharepoint/cede_07_Cancelados_Desertores/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    cede_07 Cancelados Desertores
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../00.etl_01.q10_02.Sharepoint/emp_01_Docentes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    emp_01 Docentes Empresarial
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../00.etl_01.q10_02.Sharepoint/emp_02_listado_matriculas/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    emp_02 Listado Matrículas
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../00.etl_01.q10_02.Sharepoint/emp_03_preinscritos/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    emp_03 Preinscritos Empresarial
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../00.etl_01.q10_02.Sharepoint/emp_04_egresados_Graduados/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    emp_04 Egresados Graduados
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../00.etl_01.q10_02.Sharepoint/emp_05_Estudiantes_inasistencias/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    emp_05 Estudiantes Inasistencias
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../00.etl_01.q10_02.Sharepoint/emp_06_consolidado_Inasistencias/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    emp_06 Consolidado Inasistencias
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1_3" >
        
          
          <label class="md-nav__link" for="__nav_5_1_3" id="__nav_5_1_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    02. C4C
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_1_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1_3">
            <span class="md-nav__icon md-icon"></span>
            02. C4C
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../00.etl_02.C4C/01.C4C_webscraping_v4_Actualizable/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    3.1. Webscraping Actualizable
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../00.etl_02.C4C/02.C4C_webscraping_v4_Historico/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    3.2. Webscraping Histórico
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1_4" checked>
        
          
          <label class="md-nav__link" for="__nav_5_1_4" id="__nav_5_1_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Utils
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_1_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5_1_4">
            <span class="md-nav__icon md-icon"></span>
            Utils
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Funciones.py
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Funciones.py
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Tabla de contenidos">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Tabla de contenidos
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#configuracion-e-import-de-librerias" class="md-nav__link">
    <span class="md-ellipsis">
      Configuracion e import de Librerias
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Configuracion e import de Librerias">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#librerias-estandar" class="md-nav__link">
    <span class="md-ellipsis">
      Librerías estándar
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#librerias-externas" class="md-nav__link">
    <span class="md-ellipsis">
      Librerías externas
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#autenticacion-y-configuracion-sharepoint" class="md-nav__link">
    <span class="md-ellipsis">
      Autenticacion y Configuracion Sharepoint
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#funcion-credenciales" class="md-nav__link">
    <span class="md-ellipsis">
      Función credenciales
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#funcion-setup_logger" class="md-nav__link">
    <span class="md-ellipsis">
      Función setup_logger
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#funcion-log_step_decorator" class="md-nav__link">
    <span class="md-ellipsis">
      Función log_step_decorator
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#funcion-process_files_from_folder" class="md-nav__link">
    <span class="md-ellipsis">
      Función process_files_from_folder
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#funcion-upload_file_to_sharepoint" class="md-nav__link">
    <span class="md-ellipsis">
      Función upload_file_to_sharepoint
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#funcion-actualizar_sharepoint_procesado" class="md-nav__link">
    <span class="md-ellipsis">
      Función actualizar_sharepoint_procesado
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#funcion-procesar_excel_con_hojas" class="md-nav__link">
    <span class="md-ellipsis">
      Función procesar_excel_con_hojas
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#funcion-limpiar_columnas" class="md-nav__link">
    <span class="md-ellipsis">
      Función limpiar_columnas
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#funcion-replace_values_df" class="md-nav__link">
    <span class="md-ellipsis">
      Función replace_values_df
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#funcion-download_all_files_from_sharepoint" class="md-nav__link">
    <span class="md-ellipsis">
      Función download_all_files_from_sharepoint
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#funcion-procesar" class="md-nav__link">
    <span class="md-ellipsis">
      Función procesar
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#funcion-seleccionar_opcion_con_js" class="md-nav__link">
    <span class="md-ellipsis">
      Función seleccionar_opcion_con_js
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#funcion-configurar_pasos_autenticacion_des_empresarial" class="md-nav__link">
    <span class="md-ellipsis">
      Función configurar_pasos_autenticacion_des_empresarial
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#funcion-configurar_pasos_autenticacion_cedesarrollo" class="md-nav__link">
    <span class="md-ellipsis">
      Función configurar_pasos_autenticacion_cedesarrollo
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#funcion-procesar_reporte_modal" class="md-nav__link">
    <span class="md-ellipsis">
      Función procesar_reporte_modal
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#funcion-procesar_opciones_descarga" class="md-nav__link">
    <span class="md-ellipsis">
      Función procesar_opciones_descarga
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#funcion-setup_driver" class="md-nav__link">
    <span class="md-ellipsis">
      Función setup_driver
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#funcion-setup_driver_c4c" class="md-nav__link">
    <span class="md-ellipsis">
      Función setup_driver_C4C
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#funcion-enter_credentials" class="md-nav__link">
    <span class="md-ellipsis">
      Función enter_credentials
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#funcion-submit_login" class="md-nav__link">
    <span class="md-ellipsis">
      Función submit_login
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#funcion-close_driver" class="md-nav__link">
    <span class="md-ellipsis">
      Función close_driver
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#funcion-seleccionar_dropdown" class="md-nav__link">
    <span class="md-ellipsis">
      Función seleccionar_dropdown
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#funcion-hacer_clic" class="md-nav__link">
    <span class="md-ellipsis">
      Función hacer_clic
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#funcion-hacer_clic_modal" class="md-nav__link">
    <span class="md-ellipsis">
      Función hacer_clic_modal
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#funcion-hacer_clic_por_coordenadas" class="md-nav__link">
    <span class="md-ellipsis">
      Función hacer_clic_por_coordenadas
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#funciones-actualizar_nombre_archivo-y-verificar_descarga" class="md-nav__link">
    <span class="md-ellipsis">
      Funciones actualizar_nombre_archivo y verificar_descarga
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#funcion-cargar_archivo_excel" class="md-nav__link">
    <span class="md-ellipsis">
      Función cargar_archivo_excel
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#funcion-generar_fechas" class="md-nav__link">
    <span class="md-ellipsis">
      Función generar_fechas
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#funcion-generar_periodos_cortes" class="md-nav__link">
    <span class="md-ellipsis">
      Función generar_periodos_cortes
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#funcion-cola_descargar" class="md-nav__link">
    <span class="md-ellipsis">
      Función cola_descargar
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#funcion-seleccionar_opcion_custom_dropdown" class="md-nav__link">
    <span class="md-ellipsis">
      Función seleccionar_opcion_custom_dropdown
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#funcion-obtener_elementos_dropdown" class="md-nav__link">
    <span class="md-ellipsis">
      Función obtener_elementos_dropdown
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#funcion-eliminar_archivos_anteriores" class="md-nav__link">
    <span class="md-ellipsis">
      Función eliminar_archivos_anteriores
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#funcion-pre_procesamiento" class="md-nav__link">
    <span class="md-ellipsis">
      Función pre_procesamiento
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#funcion-pre_procesamiento_periodo" class="md-nav__link">
    <span class="md-ellipsis">
      Función pre_procesamiento_periodo
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#funcion-get_data_range" class="md-nav__link">
    <span class="md-ellipsis">
      Función get_data_range
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#funcion-crea_dataframes" class="md-nav__link">
    <span class="md-ellipsis">
      Función crea_dataframes
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#funcion-presave" class="md-nav__link">
    <span class="md-ellipsis">
      Función PreSave
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#funciones-sorted_answer-y-fix_table_answers" class="md-nav__link">
    <span class="md-ellipsis">
      Funciones Sorted_Answer y Fix_Table_Answers
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#funcion-fix_id_type_caract" class="md-nav__link">
    <span class="md-ellipsis">
      Función Fix_Id_Type_Caract
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#funcion-fix_questions" class="md-nav__link">
    <span class="md-ellipsis">
      Función Fix_Questions
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#funcion-charge_excel_fixed" class="md-nav__link">
    <span class="md-ellipsis">
      Función Charge_Excel_Fixed
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#funciones-combine_and_store_unparametro-y-combine_and_store" class="md-nav__link">
    <span class="md-ellipsis">
      Funciones Combine_and_store_unparametro y Combine_and_store
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#funcion-conection_to_c4c" class="md-nav__link">
    <span class="md-ellipsis">
      Función conection_to_C4C
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#funcion-download_file_between_dates" class="md-nav__link">
    <span class="md-ellipsis">
      Función download_file_between_dates
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#funcion-click_and_wait" class="md-nav__link">
    <span class="md-ellipsis">
      Función click_and_wait
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../download/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Download.py
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Funciones_DM/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Funciones_DM.py
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../c4c_from_sharepoint/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    c4c_from_sharepoint
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../dim_Estudiantes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    dim_Estudiantes
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../dim_periodo_academico/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    dim_periodo_academico
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../fact_facturacion/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    fact_facturacion
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../fact_graduados/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    fact_graduados
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../fact_cotizacion/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    fact_cotizacion
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../fact_listado_matriculas/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    fact_listado_matriculas
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    05. CUBO
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            05. CUBO
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../03.Cubo/00.Introduccion/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Introducción
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../03.Cubo/01.Origen/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    01. ORIGEN Y MEDIDAS
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../03.Cubo/02.Tablas/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    02. TABLAS
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../03.Cubo/03.ETL/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    03. ETL
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    06. POWER BI
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            06. POWER BI
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../05.Power_BI/00.Introduccion/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Introducción
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../05.Power_BI/01.Dashboard/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    01. DASHBOARD
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Tabla de contenidos">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Tabla de contenidos
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#configuracion-e-import-de-librerias" class="md-nav__link">
    <span class="md-ellipsis">
      Configuracion e import de Librerias
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Configuracion e import de Librerias">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#librerias-estandar" class="md-nav__link">
    <span class="md-ellipsis">
      Librerías estándar
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#librerias-externas" class="md-nav__link">
    <span class="md-ellipsis">
      Librerías externas
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#autenticacion-y-configuracion-sharepoint" class="md-nav__link">
    <span class="md-ellipsis">
      Autenticacion y Configuracion Sharepoint
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#funcion-credenciales" class="md-nav__link">
    <span class="md-ellipsis">
      Función credenciales
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#funcion-setup_logger" class="md-nav__link">
    <span class="md-ellipsis">
      Función setup_logger
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#funcion-log_step_decorator" class="md-nav__link">
    <span class="md-ellipsis">
      Función log_step_decorator
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#funcion-process_files_from_folder" class="md-nav__link">
    <span class="md-ellipsis">
      Función process_files_from_folder
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#funcion-upload_file_to_sharepoint" class="md-nav__link">
    <span class="md-ellipsis">
      Función upload_file_to_sharepoint
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#funcion-actualizar_sharepoint_procesado" class="md-nav__link">
    <span class="md-ellipsis">
      Función actualizar_sharepoint_procesado
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#funcion-procesar_excel_con_hojas" class="md-nav__link">
    <span class="md-ellipsis">
      Función procesar_excel_con_hojas
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#funcion-limpiar_columnas" class="md-nav__link">
    <span class="md-ellipsis">
      Función limpiar_columnas
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#funcion-replace_values_df" class="md-nav__link">
    <span class="md-ellipsis">
      Función replace_values_df
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#funcion-download_all_files_from_sharepoint" class="md-nav__link">
    <span class="md-ellipsis">
      Función download_all_files_from_sharepoint
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#funcion-procesar" class="md-nav__link">
    <span class="md-ellipsis">
      Función procesar
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#funcion-seleccionar_opcion_con_js" class="md-nav__link">
    <span class="md-ellipsis">
      Función seleccionar_opcion_con_js
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#funcion-configurar_pasos_autenticacion_des_empresarial" class="md-nav__link">
    <span class="md-ellipsis">
      Función configurar_pasos_autenticacion_des_empresarial
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#funcion-configurar_pasos_autenticacion_cedesarrollo" class="md-nav__link">
    <span class="md-ellipsis">
      Función configurar_pasos_autenticacion_cedesarrollo
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#funcion-procesar_reporte_modal" class="md-nav__link">
    <span class="md-ellipsis">
      Función procesar_reporte_modal
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#funcion-procesar_opciones_descarga" class="md-nav__link">
    <span class="md-ellipsis">
      Función procesar_opciones_descarga
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#funcion-setup_driver" class="md-nav__link">
    <span class="md-ellipsis">
      Función setup_driver
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#funcion-setup_driver_c4c" class="md-nav__link">
    <span class="md-ellipsis">
      Función setup_driver_C4C
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#funcion-enter_credentials" class="md-nav__link">
    <span class="md-ellipsis">
      Función enter_credentials
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#funcion-submit_login" class="md-nav__link">
    <span class="md-ellipsis">
      Función submit_login
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#funcion-close_driver" class="md-nav__link">
    <span class="md-ellipsis">
      Función close_driver
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#funcion-seleccionar_dropdown" class="md-nav__link">
    <span class="md-ellipsis">
      Función seleccionar_dropdown
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#funcion-hacer_clic" class="md-nav__link">
    <span class="md-ellipsis">
      Función hacer_clic
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#funcion-hacer_clic_modal" class="md-nav__link">
    <span class="md-ellipsis">
      Función hacer_clic_modal
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#funcion-hacer_clic_por_coordenadas" class="md-nav__link">
    <span class="md-ellipsis">
      Función hacer_clic_por_coordenadas
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#funciones-actualizar_nombre_archivo-y-verificar_descarga" class="md-nav__link">
    <span class="md-ellipsis">
      Funciones actualizar_nombre_archivo y verificar_descarga
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#funcion-cargar_archivo_excel" class="md-nav__link">
    <span class="md-ellipsis">
      Función cargar_archivo_excel
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#funcion-generar_fechas" class="md-nav__link">
    <span class="md-ellipsis">
      Función generar_fechas
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#funcion-generar_periodos_cortes" class="md-nav__link">
    <span class="md-ellipsis">
      Función generar_periodos_cortes
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#funcion-cola_descargar" class="md-nav__link">
    <span class="md-ellipsis">
      Función cola_descargar
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#funcion-seleccionar_opcion_custom_dropdown" class="md-nav__link">
    <span class="md-ellipsis">
      Función seleccionar_opcion_custom_dropdown
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#funcion-obtener_elementos_dropdown" class="md-nav__link">
    <span class="md-ellipsis">
      Función obtener_elementos_dropdown
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#funcion-eliminar_archivos_anteriores" class="md-nav__link">
    <span class="md-ellipsis">
      Función eliminar_archivos_anteriores
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#funcion-pre_procesamiento" class="md-nav__link">
    <span class="md-ellipsis">
      Función pre_procesamiento
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#funcion-pre_procesamiento_periodo" class="md-nav__link">
    <span class="md-ellipsis">
      Función pre_procesamiento_periodo
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#funcion-get_data_range" class="md-nav__link">
    <span class="md-ellipsis">
      Función get_data_range
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#funcion-crea_dataframes" class="md-nav__link">
    <span class="md-ellipsis">
      Función crea_dataframes
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#funcion-presave" class="md-nav__link">
    <span class="md-ellipsis">
      Función PreSave
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#funciones-sorted_answer-y-fix_table_answers" class="md-nav__link">
    <span class="md-ellipsis">
      Funciones Sorted_Answer y Fix_Table_Answers
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#funcion-fix_id_type_caract" class="md-nav__link">
    <span class="md-ellipsis">
      Función Fix_Id_Type_Caract
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#funcion-fix_questions" class="md-nav__link">
    <span class="md-ellipsis">
      Función Fix_Questions
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#funcion-charge_excel_fixed" class="md-nav__link">
    <span class="md-ellipsis">
      Función Charge_Excel_Fixed
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#funciones-combine_and_store_unparametro-y-combine_and_store" class="md-nav__link">
    <span class="md-ellipsis">
      Funciones Combine_and_store_unparametro y Combine_and_store
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#funcion-conection_to_c4c" class="md-nav__link">
    <span class="md-ellipsis">
      Función conection_to_C4C
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#funcion-download_file_between_dates" class="md-nav__link">
    <span class="md-ellipsis">
      Función download_file_between_dates
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#funcion-click_and_wait" class="md-nav__link">
    <span class="md-ellipsis">
      Función click_and_wait
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



  <h1>Funciones.py</h1>

<!-- markdownlint-disable -->

<p>Este archivo contiene una serie de funciones automatizadas desarrolladas para gestionar tareas comunes en la manipulación de datos y la interacción con sistemas externos. Las funciones descritas están diseñadas principalmente para automatizar procesos en plataformas como SharePoint y sistemas como C4C, así como para facilitar el procesamiento de datos utilizando herramientas como Selenium, pandas y xlwings.</p>
<p>Las funciones cubren una variedad de tareas, incluyendo:</p>
<ol>
<li>
<p><strong>Autenticación y acceso a plataformas externas:</strong></p>
<ul>
<li>Funciones que automatizan el proceso de inicio de sesión y la autenticación en plataformas como C4C y SharePoint.</li>
</ul>
</li>
<li>
<p><strong>Interacción con menús desplegables y formularios web:</strong></p>
<ul>
<li>Herramientas para manejar menús desplegables personalizados y formularios en páginas web, facilitando la automatización de interacciones con elementos HTML mediante Selenium.</li>
</ul>
</li>
<li>
<p><strong>Descarga y procesamiento de datos:</strong></p>
<ul>
<li>Funciones que permiten la descarga de archivos desde plataformas externas basadas en fechas, así como la transformación y organización de los datos descargados en un formato adecuado para análisis.</li>
</ul>
</li>
<li>
<p><strong>Manejo de archivos y directorios:</strong></p>
<ul>
<li>Funciones que facilitan la gestión de archivos en el sistema de archivos local y en plataformas como SharePoint, incluyendo el renombrado, carga y descarga de archivos.</li>
</ul>
</li>
<li>
<p><strong>Limpieza y normalización de datos:</strong></p>
<ul>
<li>Funciones específicas para preprocesar, normalizar y limpiar los datos antes de ser utilizados o almacenados, asegurando que la información esté en el formato adecuado para su posterior análisis.</li>
</ul>
</li>
</ol>
<p>Este conjunto de herramientas es esencial para mejorar la eficiencia en tareas repetitivas, reduciendo la necesidad de intervención manual y permitiendo una integración más fluida entre los sistemas externos y el entorno de trabajo. La automatización de estos procesos optimiza el flujo de trabajo y facilita la administración y procesamiento de grandes volúmenes de datos.</p>
<h2 id="configuracion-e-import-de-librerias">Configuracion e import de Librerias<a class="headerlink" href="#configuracion-e-import-de-librerias" title="Permanent link">&para;</a></h2>
<p>Este bloque de código configura el entorno de trabajo importando todas las librerías necesarias para manipulación de datos, automatización de Excel, autenticación y automatización de navegadores web. <code>Funciones.py</code> importa varias librerías estándar y externas necesarias para el funcionamiento del script. </p>
<h3 id="librerias-estandar">Librerías estándar<a class="headerlink" href="#librerias-estandar" title="Permanent link">&para;</a></h3>
<ul>
<li><code>calendar</code>: Funciones de calendario.</li>
<li><code>configparser</code>: Manejo de archivos de configuración.</li>
<li><code>hashlib</code>: Funciones hash seguras.</li>
<li><code>json</code>: Trabajo con datos JSON.</li>
<li><code>logging</code>: Registro de mensajes.</li>
<li><code>os</code>: Interacción con el sistema operativo.</li>
<li><code>re</code>: Expresiones regulares.</li>
<li><code>time</code>: Funciones relacionadas con el tiempo.</li>
<li><code>unicodedata</code>: Manipulación de datos Unicode.</li>
<li><code>datetime</code>: Manejo de fechas y horas.</li>
<li><code>timedelta</code>: Diferencia entre fechas o tiempos.</li>
</ul>
<h3 id="librerias-externas">Librerías externas<a class="headerlink" href="#librerias-externas" title="Permanent link">&para;</a></h3>
<ul>
<li><code>numpy (np)</code>: Computación numérica.</li>
<li><code>pandas (pd)</code>: Manipulación y análisis de datos.</li>
<li><code>requests</code>: Solicitudes HTTP.</li>
<li><code>xlwings (xw)</code>: Automatización de Excel.</li>
<li><code>msal</code>: Autenticación de Microsoft.</li>
<li><code>openpyxl</code>: Lectura y escritura de archivos de Excel.</li>
<li><code>selenium</code>: Automatización de navegadores web.</li>
</ul>
<p>Dentro de <code>selenium</code>, se importan excepciones y módulos específicos para manejar errores y realizar acciones complejas en el navegador.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># pylint: disable=all</span>
<span class="c1"># Librerías estándar</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">calendar</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">configparser</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">hashlib</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">re</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">unicodedata</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>

<span class="c1"># Librerías externas</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">xlwings</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">xw</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">msal</span><span class="w"> </span><span class="kn">import</span> <span class="n">ConfidentialClientApplication</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">openpyxl</span><span class="w"> </span><span class="kn">import</span> <span class="n">load_workbook</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">selenium</span><span class="w"> </span><span class="kn">import</span> <span class="n">webdriver</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">selenium.common.exceptions</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">ElementNotInteractableException</span><span class="p">,</span> <span class="n">NoSuchElementException</span><span class="p">,</span> <span class="n">StaleElementReferenceException</span><span class="p">,</span> 
    <span class="n">TimeoutException</span><span class="p">,</span> <span class="n">WebDriverException</span>
<span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">selenium.webdriver.common.action_chains</span><span class="w"> </span><span class="kn">import</span> <span class="n">ActionChains</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">selenium.webdriver.common.by</span><span class="w"> </span><span class="kn">import</span> <span class="n">By</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">selenium.webdriver.common.keys</span><span class="w"> </span><span class="kn">import</span> <span class="n">Keys</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">selenium.webdriver.support</span><span class="w"> </span><span class="kn">import</span> <span class="n">expected_conditions</span> <span class="k">as</span> <span class="n">EC</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">selenium.webdriver.support.ui</span><span class="w"> </span><span class="kn">import</span> <span class="n">Select</span><span class="p">,</span> <span class="n">WebDriverWait</span>
</code></pre></div>
<h2 id="autenticacion-y-configuracion-sharepoint">Autenticacion y Configuracion Sharepoint<a class="headerlink" href="#autenticacion-y-configuracion-sharepoint" title="Permanent link">&para;</a></h2>
<p>Este código realiza varias tareas relacionadas con la autenticación y configuración para procesar archivos en SharePoint. A continuación, se detalla cada parte del código:</p>
<ol>
<li>
<p><strong>Inicialización de Variables</strong>:</p>
<ul>
<li><code>csv_files</code>: Lista de archivos CSV a procesar.</li>
<li><code>original_dir</code>: Guarda el directorio de trabajo actual.</li>
</ul>
</li>
<li>
<p><strong>Cambio de Directorio</strong>:</p>
<ul>
<li>Guarda el directorio de trabajo actual y cambia al directorio del script.</li>
</ul>
</li>
<li>
<p><strong>Lectura de Credenciales</strong>:</p>
<ul>
<li>Lee las credenciales desde un archivo <code>credenciales.env</code>.</li>
<li>Procesa las claves y las almacena en un diccionario <code>keys</code>.</li>
</ul>
</li>
<li>
<p><strong>Configuración de MSAL</strong>:</p>
<ul>
<li>Configura la autenticación usando <code>msal</code> con las credenciales leídas.</li>
<li>Lee la clave privada desde un archivo <code>key.pem</code>.</li>
<li>Configura la aplicación <code>msal</code> con el <code>client_id</code>, <code>authority</code> y <code>client_credential</code>.</li>
<li>Adquiere un token de acceso para SharePoint Online.</li>
<li>Configura los encabezados de autorización para las solicitudes HTTP.</li>
</ul>
</li>
<li>
<p><strong>Lectura de Configuración Adicional</strong>:</p>
<ul>
<li>Lee más credenciales desde un archivo <code>scraping.env</code>.</li>
<li>Almacena las credenciales en variables para diferentes servicios.</li>
</ul>
</li>
<li>
<p><strong>Restauración del Directorio Original</strong>:</p>
<ul>
<li>Restaura el directorio de trabajo original.</li>
</ul>
</li>
</ol>
<h4 id="resumen">Resumen<a class="headerlink" href="#resumen" title="Permanent link">&para;</a></h4>
<p>Este código realiza las siguientes tareas:</p>
<ol>
<li>Guarda y cambia el directorio de trabajo.</li>
<li>Lee credenciales desde archivos de configuración.</li>
<li>Configura la autenticación con MSAL para acceder a SharePoint.</li>
<li>Lee configuraciones adicionales para otros servicios.</li>
<li>Restaura el directorio de trabajo original.</li>
</ol>
<p>Este proceso es esencial para asegurar que las credenciales y configuraciones necesarias estén disponibles y seguras para el procesamiento de archivos en SharePoint y otros servicios relacionados.</p>
<div class="highlight"><pre><span></span><code><span class="c1">#Determina si un archivo es un archivo de Excel o csv para los procesados en Sharepoint</span>
<span class="c1">#csv_files = [&quot;cede_Listado_Matriculas&quot;,&quot;emp_Listado_Matriculas&quot;]</span>
<span class="n">csv_files</span> <span class="o">=</span> <span class="p">[]</span>

<span class="c1"># Guardar el directorio de trabajo actual</span>
<span class="n">original_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
<span class="k">try</span><span class="p">:</span>
    <span class="c1"># Cambiar el directorio de trabajo al directorio del script</span>
    <span class="n">script_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))</span>
    <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">script_dir</span><span class="p">)</span>

    <span class="c1"># Leer la clave privada desde el archivo key.pem</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;credenciales.env&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">key_file</span><span class="p">:</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">key_file</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>

    <span class="c1"># Procesar las claves</span>
    <span class="n">keys</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
        <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; = &quot;</span><span class="p">)</span>
        <span class="n">keys</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">)</span>

    <span class="n">client_id</span> <span class="o">=</span> <span class="n">keys</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;client_id&quot;</span><span class="p">)</span>
    <span class="n">cert_thumbprint</span> <span class="o">=</span> <span class="n">keys</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;cert_thumbprint&quot;</span><span class="p">)</span>
    <span class="n">tenant_id</span> <span class="o">=</span> <span class="n">keys</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;tenant_id&quot;</span><span class="p">)</span>

    <span class="n">authority</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;https://login.microsoftonline.com/</span><span class="si">{</span><span class="n">tenant_id</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="c1"># Leer la clave privada desde el archivo key.pem</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;key.pem&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">key_file</span><span class="p">:</span>
        <span class="n">private_key</span> <span class="o">=</span> <span class="n">key_file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

    <span class="n">cert</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;private_key&quot;</span><span class="p">:</span> <span class="n">private_key</span><span class="p">,</span>
        <span class="s2">&quot;thumbprint&quot;</span><span class="p">:</span> <span class="n">cert_thumbprint</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="n">msal_app</span> <span class="o">=</span> <span class="n">ConfidentialClientApplication</span><span class="p">(</span>
        <span class="n">client_id</span><span class="o">=</span><span class="n">client_id</span><span class="p">,</span>
        <span class="n">authority</span><span class="o">=</span><span class="n">authority</span><span class="p">,</span>
        <span class="n">client_credential</span><span class="o">=</span><span class="n">cert</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">scopes_sharepoint_online</span> <span class="o">=</span> <span class="p">[</span><span class="n">keys</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;scopes_sharepoint_online&quot;</span><span class="p">)]</span>

    <span class="n">results</span> <span class="o">=</span> <span class="n">msal_app</span><span class="o">.</span><span class="n">acquire_token_for_client</span><span class="p">(</span><span class="n">scopes_sharepoint_online</span><span class="p">)</span>

    <span class="k">if</span> <span class="s2">&quot;access_token&quot;</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
        <span class="n">access_token</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;access_token&quot;</span><span class="p">)</span>

    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;Authorization&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Bearer </span><span class="si">{</span><span class="n">access_token</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Accept&quot;</span><span class="p">:</span> <span class="s2">&quot;application/json;odata=verbose&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Content-Type&quot;</span><span class="p">:</span> <span class="s2">&quot;application/json&quot;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="n">sharepoint_base_url</span> <span class="o">=</span> <span class="n">keys</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;sharepoint_base_url&quot;</span><span class="p">)</span>



    <span class="c1"># Leer las credenciales desde el archivo credenciales.env</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">configparser</span><span class="o">.</span><span class="n">ConfigParser</span><span class="p">(</span><span class="n">interpolation</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">config</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;scraping.env&#39;</span><span class="p">)</span>

    <span class="c1"># Almacenar las credenciales en variables</span>
    <span class="n">desarrollo_empresarial_url</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;desarrollo_empresarial&#39;</span><span class="p">][</span><span class="s1">&#39;url&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">)</span>
    <span class="n">desarrollo_empresarial_username</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;desarrollo_empresarial&#39;</span><span class="p">][</span><span class="s1">&#39;username&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">)</span>
    <span class="n">desarrollo_empresarial_password</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;desarrollo_empresarial&#39;</span><span class="p">][</span><span class="s1">&#39;password&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">)</span>

    <span class="n">cedesarrollo_url</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;cedesarrollo&#39;</span><span class="p">][</span><span class="s1">&#39;url&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">)</span>
    <span class="n">cedesarrollo_username</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;cedesarrollo&#39;</span><span class="p">][</span><span class="s1">&#39;username&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">)</span>
    <span class="n">cedesarrollo_password</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;cedesarrollo&#39;</span><span class="p">][</span><span class="s1">&#39;password&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">)</span>

    <span class="n">C4C_username</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;C4C&#39;</span><span class="p">][</span><span class="s1">&#39;username&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">)</span>
    <span class="n">C4C_password</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;C4C&#39;</span><span class="p">][</span><span class="s1">&#39;password&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">)</span>
<span class="k">finally</span><span class="p">:</span>
    <span class="c1"># Restaurar el directorio de trabajo original</span>
    <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">original_dir</span><span class="p">)</span>
</code></pre></div>
<h2 id="funcion-credenciales">Función <code>credenciales</code><a class="headerlink" href="#funcion-credenciales" title="Permanent link">&para;</a></h2>
<h4 id="proposito"><strong>Propósito</strong><a class="headerlink" href="#proposito" title="Permanent link">&para;</a></h4>
<p>La función <code>credenciales</code> se utiliza para recuperar las credenciales almacenadas en un archivo de configuración (<code>scraping.env</code>) según la plataforma especificada. Las credenciales se procesan eliminando cualquier comilla circundante en los valores.</p>
<hr />
<h4 id="entradas"><strong>Entradas</strong><a class="headerlink" href="#entradas" title="Permanent link">&para;</a></h4>
<ul>
<li><strong><code>plataforma</code> (str):</strong> El nombre de la plataforma para la cual se necesitan las credenciales. Las opciones válidas son:</li>
<li><code>"desarrollo_empresarial"</code></li>
<li><code>"cedesarrollo"</code></li>
<li><code>"C4C"</code></li>
</ul>
<hr />
<h4 id="salidas"><strong>Salidas</strong><a class="headerlink" href="#salidas" title="Permanent link">&para;</a></h4>
<p>Dependiendo de la plataforma solicitada:</p>
<ul>
<li><strong><code>desarrollo_empresarial</code>:</strong><ul>
<li>URL</li>
<li>Nombre de usuario</li>
<li>Contraseña</li>
</ul>
</li>
<li><strong><code>cedesarrollo</code>:</strong><ul>
<li>URL</li>
<li>Nombre de usuario</li>
<li>Contraseña</li>
</ul>
</li>
<li><strong><code>C4C</code>:</strong><ul>
<li>Nombre de usuario</li>
<li>Contraseña</li>
</ul>
</li>
</ul>
<h4 id="detalles-de-implementacion"><strong>Detalles de implementación</strong><a class="headerlink" href="#detalles-de-implementacion" title="Permanent link">&para;</a></h4>
<ol>
<li>
<p><strong>Cambio temporal del directorio:</strong></p>
<ul>
<li>Guarda el directorio actual (<code>os.getcwd</code>) y cambia al directorio donde se encuentra el archivo de script (<code>__file__</code>). Esto asegura que <code>scraping.env</code> sea accesible incluso si el script se ejecuta desde un directorio diferente.</li>
</ul>
</li>
<li>
<p><strong>Lectura del archivo de configuración:</strong></p>
<ul>
<li>Utiliza <code>configparser.ConfigParser</code> con <code>interpolation=None</code> para cargar los valores directamente sin interpolación.</li>
</ul>
</li>
<li>
<p><strong>Eliminación de comillas:</strong></p>
<ul>
<li>Se usa la función <code>remove_quotes</code> para eliminar comillas simples y dobles de los valores cargados.</li>
</ul>
</li>
<li>
<p><strong>Restauración del directorio original:</strong></p>
<ul>
<li>Una vez procesadas las credenciales, se restaura el directorio original, garantizando que no haya efectos secundarios en otros procesos que utilicen el directorio de trabajo actual.</li>
</ul>
</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="c1"># Función para eliminar las comillas del valor</span>
<span class="k">def</span><span class="w"> </span><span class="nf">remove_quotes</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">value</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">credenciales</span><span class="p">(</span><span class="n">plataforma</span><span class="p">):</span>
    <span class="c1"># Guardar el directorio de trabajo actual</span>
    <span class="n">original_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Cambiar el directorio de trabajo al directorio del script</span>
        <span class="n">script_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))</span>
        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">script_dir</span><span class="p">)</span>
        <span class="c1"># Leer las credenciales desde el archivo scraping.env</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">configparser</span><span class="o">.</span><span class="n">ConfigParser</span><span class="p">(</span><span class="n">interpolation</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
        <span class="n">config</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;scraping.env&#39;</span><span class="p">)</span>
        <span class="c1"># Almacenar las credenciales en variables</span>
        <span class="k">if</span> <span class="n">plataforma</span> <span class="o">==</span> <span class="s2">&quot;desarrollo_empresarial&quot;</span><span class="p">:</span>
            <span class="n">desarrollo_empresarial_url</span> <span class="o">=</span> <span class="n">remove_quotes</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;desarrollo_empresarial&#39;</span><span class="p">][</span><span class="s1">&#39;url&#39;</span><span class="p">])</span>
            <span class="n">desarrollo_empresarial_username</span> <span class="o">=</span> <span class="n">remove_quotes</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;desarrollo_empresarial&#39;</span><span class="p">][</span><span class="s1">&#39;username&#39;</span><span class="p">])</span>
            <span class="n">desarrollo_empresarial_password</span> <span class="o">=</span> <span class="n">remove_quotes</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;desarrollo_empresarial&#39;</span><span class="p">][</span><span class="s1">&#39;password&#39;</span><span class="p">])</span>
            <span class="k">return</span> <span class="n">desarrollo_empresarial_url</span><span class="p">,</span> <span class="n">desarrollo_empresarial_username</span><span class="p">,</span> <span class="n">desarrollo_empresarial_password</span>
        <span class="k">elif</span> <span class="n">plataforma</span> <span class="o">==</span> <span class="s2">&quot;cedesarrollo&quot;</span><span class="p">:</span>
            <span class="n">cedesarrollo_url</span> <span class="o">=</span> <span class="n">remove_quotes</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;cedesarrollo&#39;</span><span class="p">][</span><span class="s1">&#39;url&#39;</span><span class="p">])</span>
            <span class="n">cedesarrollo_username</span> <span class="o">=</span> <span class="n">remove_quotes</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;cedesarrollo&#39;</span><span class="p">][</span><span class="s1">&#39;username&#39;</span><span class="p">])</span>
            <span class="n">cedesarrollo_password</span> <span class="o">=</span> <span class="n">remove_quotes</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;cedesarrollo&#39;</span><span class="p">][</span><span class="s1">&#39;password&#39;</span><span class="p">])</span>
            <span class="k">return</span> <span class="n">cedesarrollo_url</span><span class="p">,</span> <span class="n">cedesarrollo_username</span><span class="p">,</span> <span class="n">cedesarrollo_password</span>
        <span class="k">elif</span> <span class="n">plataforma</span> <span class="o">==</span> <span class="s2">&quot;C4C&quot;</span><span class="p">:</span>
            <span class="n">C4C_username</span> <span class="o">=</span> <span class="n">remove_quotes</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;C4C&#39;</span><span class="p">][</span><span class="s1">&#39;username&#39;</span><span class="p">])</span>
            <span class="n">C4C_password</span> <span class="o">=</span> <span class="n">remove_quotes</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;C4C&#39;</span><span class="p">][</span><span class="s1">&#39;password&#39;</span><span class="p">])</span>
            <span class="k">return</span> <span class="n">C4C_username</span><span class="p">,</span> <span class="n">C4C_password</span>

    <span class="k">finally</span><span class="p">:</span>
        <span class="c1"># Restaurar el directorio de trabajo original</span>
        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">original_dir</span><span class="p">)</span>
</code></pre></div>
<p><code>generar_periodos</code> crea un conjunto de años desde el año inicial (<code>inicio</code>) hasta el año final (<code>fin</code>), incluyendo ambos extremos. Devuelve un conjunto de enteros únicos representando los años en el rango especificado.</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">generar_periodos</span><span class="p">(</span><span class="n">inicio</span><span class="p">,</span> <span class="n">fin</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">{</span><span class="n">year</span> <span class="k">for</span> <span class="n">year</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">inicio</span><span class="p">,</span> <span class="n">fin</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)}</span>
</code></pre></div>
<p><code>dias_del_mes</code> devuelve el número de días de un mes específico en un año determinado, teniendo en cuenta si el año es bisiesto.</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">dias_del_mes</span><span class="p">(</span><span class="n">mes</span><span class="p">,</span> <span class="n">anio</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Devuelve el número de días en un mes dado, considerando años bisiestos.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">calendar</span><span class="o">.</span><span class="n">monthrange</span><span class="p">(</span><span class="n">anio</span><span class="p">,</span> <span class="n">mes</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
</code></pre></div>
<h2 id="funcion-setup_logger">Función <code>setup_logger</code><a class="headerlink" href="#funcion-setup_logger" title="Permanent link">&para;</a></h2>
<h4 id="proposito_1"><strong>Propósito</strong><a class="headerlink" href="#proposito_1" title="Permanent link">&para;</a></h4>
<p>Configura un logger para manejar y formatear mensajes de registro, permitiendo guardar los logs en un archivo y mostrarlos en la consola.</p>
<hr />
<h4 id="entradas_1"><strong>Entradas</strong><a class="headerlink" href="#entradas_1" title="Permanent link">&para;</a></h4>
<ul>
<li><strong><code>log_filename</code> (str):</strong> Nombre del archivo donde se almacenarán los logs (por defecto, <code>scraper.log</code>).</li>
<li><strong><code>log_level</code> (nivel de log):</strong> Nivel de severidad de los mensajes registrados (por defecto, <code>logging.DEBUG</code>).</li>
<li><strong><code>log_format</code> (str):</strong> Formato de los mensajes de log (por defecto, <code>'%(asctime)s - %(levelname)s - %(message)s'</code>).</li>
</ul>
<hr />
<h4 id="salida"><strong>Salida</strong><a class="headerlink" href="#salida" title="Permanent link">&para;</a></h4>
<ul>
<li><strong><code>logger</code> (logging.Logger):</strong> Objeto configurado para registrar mensajes con los manejadores y formato especificados.</li>
</ul>
<hr />
<h4 id="detalles"><strong>Detalles</strong><a class="headerlink" href="#detalles" title="Permanent link">&para;</a></h4>
<ol>
<li>Configura un logger con el nivel deseado.</li>
<li>Define manejadores para archivo y consola.</li>
<li>Establece un formato uniforme para los logs.</li>
<li>Elimina manejadores existentes en caso de configuración previa, evitando duplicados.</li>
<li>Retorna el logger configurado.</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">setup_logger</span><span class="p">(</span><span class="n">log_filename</span><span class="o">=</span><span class="s1">&#39;scraper.log&#39;</span><span class="p">,</span> <span class="n">log_level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">,</span> <span class="n">log_format</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%(asctime)s</span><span class="s1"> - </span><span class="si">%(levelname)s</span><span class="s1"> - </span><span class="si">%(message)s</span><span class="s1">&#39;</span><span class="p">):</span>
    <span class="c1"># Crea un logger con el nivel especificado</span>
    <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">()</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">log_level</span><span class="p">)</span>

    <span class="c1"># Crea un manejador para el archivo de log</span>
    <span class="n">file_handler</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">FileHandler</span><span class="p">(</span><span class="n">log_filename</span><span class="p">)</span>
    <span class="n">file_handler</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">log_level</span><span class="p">)</span>

    <span class="c1"># Crea un manejador para la consola</span>
    <span class="n">console_handler</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">StreamHandler</span><span class="p">()</span>
    <span class="n">console_handler</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">log_level</span><span class="p">)</span>

    <span class="c1"># Crea un formato para los logs</span>
    <span class="n">formatter</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">Formatter</span><span class="p">(</span><span class="n">log_format</span><span class="p">)</span>
    <span class="n">file_handler</span><span class="o">.</span><span class="n">setFormatter</span><span class="p">(</span><span class="n">formatter</span><span class="p">)</span>
    <span class="n">console_handler</span><span class="o">.</span><span class="n">setFormatter</span><span class="p">(</span><span class="n">formatter</span><span class="p">)</span>

    <span class="c1"># Si el logger ya tiene manejadores, eliminar todos para evitar duplicados</span>
    <span class="k">if</span> <span class="n">logger</span><span class="o">.</span><span class="n">hasHandlers</span><span class="p">():</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">handlers</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

    <span class="c1"># Añadir los manejadores al logger</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">file_handler</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">console_handler</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">logger</span>
</code></pre></div>
<h2 id="funcion-log_step_decorator">Función <code>log_step_decorator</code><a class="headerlink" href="#funcion-log_step_decorator" title="Permanent link">&para;</a></h2>
<h4 id="proposito_2"><strong>Propósito</strong><a class="headerlink" href="#proposito_2" title="Permanent link">&para;</a></h4>
<p>Decora una función para registrar información sobre su ejecución, incluyendo inicio, finalización exitosa o errores, así como la duración del proceso.</p>
<hr />
<h4 id="entradas_2"><strong>Entradas</strong><a class="headerlink" href="#entradas_2" title="Permanent link">&para;</a></h4>
<ul>
<li><strong><code>step_name</code> (str):</strong> Nombre descriptivo del paso que se está decorando, utilizado para identificar los registros.</li>
</ul>
<hr />
<h4 id="funcionamiento"><strong>Funcionamiento</strong><a class="headerlink" href="#funcionamiento" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>Inicio:</strong> Registra un mensaje indicando el inicio del paso.</li>
<li><strong>Finalización exitosa:</strong><ul>
<li>Calcula y registra la duración del paso en segundos o minutos.</li>
</ul>
</li>
<li><strong>Error:</strong><ul>
<li>Registra un mensaje de error con la duración transcurrida y el detalle de la excepción.</li>
</ul>
</li>
<li><strong>Formato:</strong> Los mensajes se registran con colores en consola (<code>\033[92m</code> para éxito y <code>\033[91m</code> para errores).</li>
</ul>
<hr />
<h4 id="salida_1"><strong>Salida</strong><a class="headerlink" href="#salida_1" title="Permanent link">&para;</a></h4>
<ul>
<li>Devuelve un decorador que envuelve la función original, añadiendo la funcionalidad de registro.</li>
</ul>
<hr />
<h4 id="detalles-adicionales"><strong>Detalles adicionales</strong><a class="headerlink" href="#detalles-adicionales" title="Permanent link">&para;</a></h4>
<ul>
<li>Utiliza un logger configurado previamente para registrar los eventos.</li>
<li>Maneja tanto procesos exitosos como excepciones, asegurando que los logs sean informativos.</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="n">logger</span> <span class="o">=</span> <span class="n">setup_logger</span><span class="p">(</span><span class="s2">&quot;scraper.log&quot;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">log_step_decorator</span><span class="p">(</span><span class="n">step_name</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">decorator</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\033</span><span class="s2">[92mIniciando: </span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="se">\033</span><span class="s2">[0m&quot;</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="n">duration</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>
                <span class="k">if</span> <span class="n">duration</span> <span class="o">&gt;=</span> <span class="mi">60</span><span class="p">:</span>
                    <span class="n">duration_minutes</span> <span class="o">=</span> <span class="n">duration</span> <span class="o">/</span> <span class="mi">60</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\033</span><span class="s2">[92mProceso &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39; </span>
<span class="s2">                                completado exitosamente en </span><span class="si">{</span><span class="n">duration_minutes</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> minutos.</span><span class="se">\033</span><span class="s2">[0m&quot;&quot;&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\033</span><span class="s2">[92mProceso &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39; </span>
<span class="s2">                                completado exitosamente en </span><span class="si">{</span><span class="n">duration</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> segundos.</span><span class="se">\033</span><span class="s2">[0m&quot;&quot;&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">result</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">duration</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>
                <span class="k">if</span> <span class="n">duration</span> <span class="o">&gt;=</span> <span class="mi">60</span><span class="p">:</span>
                    <span class="n">duration_minutes</span> <span class="o">=</span> <span class="n">duration</span> <span class="o">/</span> <span class="mi">60</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\033</span><span class="s2">[91mError en el paso &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39; después de </span><span class="si">{</span><span class="n">duration_minutes</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> minutos: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="se">\033</span><span class="s2">[0m&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\033</span><span class="s2">[91mError en el paso &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39; después de </span><span class="si">{</span><span class="n">duration</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> segundos: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="se">\033</span><span class="s2">[0m&quot;</span><span class="p">)</span>
                <span class="k">raise</span>
        <span class="k">return</span> <span class="n">wrapper</span>
    <span class="k">return</span> <span class="n">decorator</span>
</code></pre></div>
<p><code>log_tiempo</code> registra un mensaje en el logger indicando el tiempo transcurrido, mostrando minutos si supera los 60 segundos. Toma tres parámetros: <code>logger</code> para manejar el registro, <code>message</code> como texto base y <code>tiempo_transcurrido</code> como duración en segundos.</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">log_tiempo</span><span class="p">(</span><span class="n">logger</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">tiempo_transcurrido</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Función para registrar tiempo en el logger, mostrando en minutos si es mayor a 60 segundos.</span>
<span class="sd">    Parámetros:</span>
<span class="sd">     - logger: instancia del logger</span>
<span class="sd">     - message: mensaje base a mostrar</span>
<span class="sd">     - tiempo_transcurrido: tiempo transcurrido en segundos</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">tiempo_transcurrido</span> <span class="o">&gt;=</span> <span class="mi">60</span><span class="p">:</span>
        <span class="n">tiempo_minutos</span> <span class="o">=</span> <span class="n">tiempo_transcurrido</span> <span class="o">/</span> <span class="mi">60</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">message</span><span class="si">}</span><span class="s1"> --- </span><span class="si">{</span><span class="n">tiempo_minutos</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1"> minutes ---&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">message</span><span class="si">}</span><span class="s1"> --- </span><span class="si">{</span><span class="n">tiempo_transcurrido</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1"> seconds ---&#39;</span><span class="p">)</span>
</code></pre></div>
<h2 id="funcion-process_files_from_folder">Función <code>process_files_from_folder</code><a class="headerlink" href="#funcion-process_files_from_folder" title="Permanent link">&para;</a></h2>
<h4 id="proposito_3"><strong>Propósito</strong><a class="headerlink" href="#proposito_3" title="Permanent link">&para;</a></h4>
<p>Procesa archivos de una carpeta de SharePoint que han sido modificados en los últimos seis meses, almacenando los datos en una lista de DataFrames.</p>
<hr />
<h4 id="entradas_3"><strong>Entradas</strong><a class="headerlink" href="#entradas_3" title="Permanent link">&para;</a></h4>
<ul>
<li><strong><code>folder_url</code> (str):</strong> URL de la carpeta en SharePoint desde donde se obtendrán los archivos.</li>
<li><strong><code>dfs</code> (list):</strong> Lista utilizada para almacenar los DataFrames procesados.</li>
</ul>
<hr />
<h4 id="funcionamiento_1"><strong>Funcionamiento</strong><a class="headerlink" href="#funcionamiento_1" title="Permanent link">&para;</a></h4>
<ol>
<li><strong>Listar archivos:</strong> Obtiene la lista de archivos en la carpeta de SharePoint.</li>
<li><strong>Filtrar por fecha:</strong> Identifica archivos modificados en los últimos seis meses.</li>
<li><strong>Procesar archivos:</strong><ul>
<li>Recupera el contenido de los archivos seleccionados desde SharePoint.</li>
<li>Lee el contenido de los archivos como DataFrames utilizando <code>pandas</code>.</li>
<li>Registra información sobre el contenido y lo almacena en la lista <code>dfs</code>.</li>
</ul>
</li>
</ol>
<hr />
<h4 id="salida_2"><strong>Salida</strong><a class="headerlink" href="#salida_2" title="Permanent link">&para;</a></h4>
<ul>
<li>No retorna ningún valor. Modifica la lista <code>dfs</code> proporcionada al agregar los DataFrames procesados.</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="nd">@log_step_decorator</span><span class="p">(</span><span class="s2">&quot;Procesar archivos de una carpeta de SharePoint&quot;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">process_files_from_folder</span><span class="p">(</span><span class="n">folder_url</span><span class="p">,</span> <span class="n">dfs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Procesa los archivos en una carpeta de SharePoint que han sido modificados en los últimos seis meses.</span>

<span class="sd">    Args:</span>
<span class="sd">        folder_url (str): La URL de la carpeta en SharePoint.</span>
<span class="sd">        dfs (list): Una lista para almacenar los DataFrames procesados.</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">files</span> <span class="o">=</span> <span class="n">list_files_from_sharepoint</span><span class="p">(</span><span class="n">folder_url</span><span class="p">)</span>
    <span class="n">six_months_ago</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">-</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">180</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
        <span class="n">file_name</span> <span class="o">=</span> <span class="n">file</span><span class="p">[</span><span class="s1">&#39;Name&#39;</span><span class="p">]</span>
        <span class="n">file_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">sharepoint_base_url</span><span class="si">}</span><span class="s2">/_api/web/GetFolderByServerRelativeUrl(&#39;</span><span class="si">{</span><span class="n">folder_url</span><span class="si">}</span><span class="s2">&#39;)/Files(&#39;</span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s2">&#39;)/$value&quot;</span>
        <span class="n">modified_date_str</span> <span class="o">=</span> <span class="n">file</span><span class="p">[</span><span class="s1">&#39;TimeLastModified&#39;</span><span class="p">]</span>
        <span class="n">modified_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">modified_date_str</span><span class="p">,</span> <span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">T%H:%M:%SZ&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">modified_date</span> <span class="o">&gt;=</span> <span class="n">six_months_ago</span><span class="p">:</span>
            <span class="c1"># Obtener el archivo de SharePoint</span>
            <span class="n">file_content</span> <span class="o">=</span> <span class="n">get_file_from_sharepoint</span><span class="p">(</span><span class="n">file_url</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">file_content</span><span class="p">:</span>
                <span class="c1"># Leer el archivo Excel sin descargar</span>
                <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">file_content</span><span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Contenido de </span><span class="si">{}</span><span class="s2">:</span><span class="se">\n</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()))</span>
                <span class="n">dfs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</code></pre></div>
<p><code>list_files_from_sharepoint</code> obtiene una lista de archivos presentes en una carpeta de SharePoint indicada por la URL proporcionada. Recibe como entrada <code>folder_url</code> (str), que especifica la ubicación de la carpeta, y devuelve una lista de archivos si la solicitud es exitosa o una lista vacía en caso de fallo. También registra advertencias en caso de errores durante la solicitud.</p>
<div class="highlight"><pre><span></span><code><span class="nd">@log_step_decorator</span><span class="p">(</span><span class="s2">&quot;Listar archivos de SharePoint&quot;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">list_files_from_sharepoint</span><span class="p">(</span><span class="n">folder_url</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Lista los archivos en una carpeta de SharePoint.</span>

<span class="sd">    Args:</span>
<span class="sd">        folder_url (str): La URL de la carpeta en SharePoint.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list: Una lista de archivos en la carpeta si la solicitud es exitosa.</span>
<span class="sd">        list: Una lista vacía si la solicitud falla.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">list_files_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">sharepoint_base_url</span><span class="si">}</span><span class="s2">/_api/web/GetFolderByServerRelativeUrl(&#39;</span><span class="si">{</span><span class="n">folder_url</span><span class="si">}</span><span class="s2">&#39;)/Files&quot;</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">list_files_url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
        <span class="n">files</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s1">&#39;d&#39;</span><span class="p">][</span><span class="s1">&#39;results&#39;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">files</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error al listar los archivos. Código de estado: </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[]</span>
</code></pre></div>
<p><code>get_file_from_sharepoint</code> descarga un archivo desde SharePoint utilizando su URL. Recibe como entrada <code>file_url</code> (str), que especifica la ubicación del archivo, y devuelve el contenido del archivo como bytes si la solicitud es exitosa. En caso de error, retorna <code>None</code> y registra una advertencia con el código de estado de la respuesta.</p>
<div class="highlight"><pre><span></span><code><span class="nd">@log_step_decorator</span><span class="p">(</span><span class="s2">&quot;Obtener archivo de SharePoint&quot;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">get_file_from_sharepoint</span><span class="p">(</span><span class="n">file_url</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Descarga un archivo desde SharePoint dado su URL.</span>

<span class="sd">    Args:</span>
<span class="sd">        file_url (str): La URL del archivo en SharePoint.</span>

<span class="sd">    Returns:</span>
<span class="sd">        bytes: El contenido del archivo si la solicitud es exitosa.</span>
<span class="sd">        None: Si la solicitud falla.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">file_url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Response Status Code: </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error al acceder al archivo. Código de estado: </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>
</code></pre></div>
<p><code>_extract_date</code> convierte una fecha extraída de un nombre de archivo en un objeto <code>datetime.date</code>. Recibe como entrada <code>file_name</code> (str), que contiene la fecha incrustada, y <code>date_pattern</code>, un patrón de expresión regular para buscar la fecha. Si encuentra coincidencias, devuelve un objeto <code>datetime.date</code>; de lo contrario, retorna <code>None</code>.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Función para convertir la fecha extraída en un objeto datetime</span>
<span class="k">def</span><span class="w"> </span><span class="nf">_extract_date</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span><span class="n">date_pattern</span><span class="p">):</span>
    <span class="n">match</span> <span class="o">=</span> <span class="n">date_pattern</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
        <span class="n">day</span><span class="p">,</span> <span class="n">month</span><span class="p">,</span> <span class="n">year</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">match</span><span class="o">.</span><span class="n">groups</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">month</span><span class="p">,</span> <span class="n">day</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">None</span>
</code></pre></div>
<p><code>obtener_sharepoint</code> limpia una carpeta local especificada y descarga todos los archivos desde una carpeta de SharePoint hacia esa ubicación. Recibe como entradas <code>folder_url</code> (str), que indica la URL de la carpeta de SharePoint, y <code>_folder</code> (str), la ruta de la carpeta local donde se guardarán los archivos.</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">obtener_sharepoint</span><span class="p">(</span><span class="n">folder_url</span><span class="p">,</span><span class="n">_folder</span><span class="p">):</span>
    <span class="n">limpiar_carpeta</span><span class="p">(</span><span class="n">_folder</span><span class="p">)</span>
    <span class="n">download_all_files_from_sharepoint</span><span class="p">(</span><span class="n">folder_url</span><span class="p">,</span> <span class="n">_folder</span><span class="p">)</span>
</code></pre></div>
<p>Función <code>extract_date</code> para convertir la fecha extraída en un objeto datetime</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">extract_date</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">date_pattern</span><span class="p">):</span>
    <span class="n">match</span> <span class="o">=</span> <span class="n">date_pattern</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
        <span class="n">day</span><span class="p">,</span> <span class="n">month</span><span class="p">,</span> <span class="n">year</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">match</span><span class="o">.</span><span class="n">groups</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">datetime</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">month</span><span class="p">,</span> <span class="n">day</span><span class="p">)</span>  <span class="c1"># Usar datetime en lugar de date</span>
    <span class="k">return</span> <span class="kc">None</span>
</code></pre></div>
<h2 id="funcion-upload_file_to_sharepoint">Función <code>upload_file_to_sharepoint</code><a class="headerlink" href="#funcion-upload_file_to_sharepoint" title="Permanent link">&para;</a></h2>
<p>Sube un archivo local a una carpeta de SharePoint especificada. Recibe como entradas:</p>
<ul>
<li><strong><code>file_path</code> (str):</strong> Ruta local del archivo que se desea subir.</li>
<li><strong><code>folder_url</code> (str):</strong> URL de la carpeta de destino en SharePoint.</li>
</ul>
<p><strong>Funcionamiento:</strong>
1. <strong>Validación de existencia:</strong> Verifica que el archivo local exista.
2. <strong>Lectura del archivo:</strong> Abre el archivo en modo binario y lee su contenido.
3. <strong>Preparación de la URL:</strong> Construye la URL para la subida en SharePoint.
4. <strong>Encabezados:</strong> Configura el encabezado <code>Content-Length</code> con el tamaño del archivo.
5. <strong>Subida:</strong> Realiza una solicitud POST para subir el archivo a SharePoint.
6. <strong>Logs:</strong>
    - Registra un mensaje de éxito si el archivo se sube correctamente (excepto si es un archivo codificado con nombre MD5).
    - Registra un error si la subida falla, indicando el código de estado.</p>
<p><strong>Salidas:</strong>
- No retorna ningún valor; realiza acciones y registra logs según el resultado.</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">upload_file_to_sharepoint</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">folder_url</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">file_path</span><span class="p">):</span>
        <span class="c1"># logging.error(f&quot;Archivo no encontrado: {file_path}. No se puede subir a SharePoint.&quot;)</span>
        <span class="k">return</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="n">file_content</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

    <span class="n">file_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
    <span class="n">upload_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">sharepoint_base_url</span><span class="si">}</span><span class="s2">/_api/web/GetFolderByServerRelativeUrl(&#39;</span><span class="si">{</span><span class="n">folder_url</span><span class="si">}</span><span class="s2">&#39;)/Files/add(url=&#39;</span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s2">&#39;,overwrite=true)&quot;</span>

    <span class="n">headers</span><span class="p">[</span><span class="s1">&#39;Content-Length&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">file_content</span><span class="p">))</span>  <span class="c1"># Añadir encabezado para la longitud del contenido</span>

    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">upload_url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">file_content</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^[a-f0-9]</span><span class="si">{32}</span><span class="s1">\.xlsx$&#39;</span><span class="p">,</span> <span class="n">file_name</span><span class="p">):</span>
            <span class="c1"># Archivo codificado, no hacer logging</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Archivo </span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s2"> subido exitosamente a SharePoint.&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error al subir el archivo </span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s2">. Código de estado: </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
<h2 id="funcion-actualizar_sharepoint_procesado">Función <code>actualizar_sharepoint_procesado</code><a class="headerlink" href="#funcion-actualizar_sharepoint_procesado" title="Permanent link">&para;</a></h2>
<h4 id="proposito_4"><strong>Propósito</strong><a class="headerlink" href="#proposito_4" title="Permanent link">&para;</a></h4>
<p>Sube un archivo procesado (en formato Excel o CSV) a una carpeta específica en SharePoint, determinada por un identificador ETL. El archivo se genera a partir de un DataFrame proporcionado.</p>
<hr />
<h4 id="entradas_4"><strong>Entradas</strong><a class="headerlink" href="#entradas_4" title="Permanent link">&para;</a></h4>
<ul>
<li><strong><code>df</code> (pandas.DataFrame):</strong> Datos procesados que se guardarán y subirán como archivo.</li>
<li><strong><code>etl</code> (str):</strong> Identificador del tipo de proceso ETL, utilizado para determinar la carpeta de destino en SharePoint.</li>
</ul>
<hr />
<h4 id="funcionamiento_2"><strong>Funcionamiento</strong><a class="headerlink" href="#funcionamiento_2" title="Permanent link">&para;</a></h4>
<ol>
<li><strong>Mapeo de ETL a carpeta:</strong> Determina la URL de destino en SharePoint según el identificador <code>etl</code> usando el diccionario <code>etl_to_folder_url</code>.</li>
<li><strong>Generación de archivo temporal:</strong><ul>
<li>Crea un archivo Excel (<code>.xlsx</code>) o CSV (<code>.csv</code>) a partir del DataFrame.</li>
<li>El formato depende de si <code>etl</code> está presente en <code>csv_files</code>.</li>
<li>El archivo incluye un timestamp en el nombre para garantizar unicidad.</li>
</ul>
</li>
<li><strong>Subida a SharePoint:</strong> Llama a <code>upload_file_to_sharepoint</code> para subir el archivo temporal a la URL correspondiente.</li>
<li><strong>Manejo de errores:</strong> Si ocurre un error durante la subida, registra un mensaje de error.</li>
<li><strong>Limpieza:</strong> Elimina el archivo temporal después de subirlo, asegurando que no queden residuos en el sistema local.</li>
</ol>
<hr />
<h4 id="salida_3"><strong>Salida</strong><a class="headerlink" href="#salida_3" title="Permanent link">&para;</a></h4>
<ul>
<li>No retorna valores. Realiza acciones y muestra mensajes en consola para registrar el éxito o errores durante el proceso.</li>
</ul>
<hr />
<h4 id="excepciones"><strong>Excepciones</strong><a class="headerlink" href="#excepciones" title="Permanent link">&para;</a></h4>
<ul>
<li>Maneja excepciones relacionadas con la subida a SharePoint e informa del error en consola. Limpia siempre los archivos temporales, incluso si ocurre un error.</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">actualizar_sharepoint_procesado</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">etl</span><span class="p">):</span>   

    <span class="n">etl_to_folder_url</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;cede_Docentes&quot;</span><span class="p">:</span><span class="s1">&#39;Documentos compartidos/01.Q10/01.Educacion_Tecnica/Procesados/01.Docentes&#39;</span><span class="p">,</span>
        <span class="s2">&quot;cede_Diseño_Curricular&quot;</span><span class="p">:</span><span class="s1">&#39;Documentos compartidos/01.Q10/01.Educacion_Tecnica/Procesados/02.Disenio_Curricular&#39;</span><span class="p">,</span>
        <span class="s2">&quot;cede_Listado_Matriculas&quot;</span><span class="p">:</span><span class="s1">&#39;Documentos compartidos/01.Q10/01.Educacion_Tecnica/Procesados/03.Listado_Matriculas&#39;</span><span class="p">,</span>
        <span class="s2">&quot;cede_Ingresos&quot;</span><span class="p">:</span><span class="s1">&#39;Documentos compartidos/01.Q10/01.Educacion_Tecnica/Procesados/04.Ingresos&#39;</span><span class="p">,</span>
        <span class="s2">&quot;cede_Historico_Notas&quot;</span><span class="p">:</span><span class="s1">&#39;Documentos compartidos/01.Q10/01.Educacion_Tecnica/Procesados/05.Historico_Notas&#39;</span><span class="p">,</span>
        <span class="s2">&quot;cede_Egresados_Graduados&quot;</span><span class="p">:</span><span class="s1">&#39;Documentos compartidos/01.Q10/01.Educacion_Tecnica/Procesados/06.Egresados_Graduados&#39;</span><span class="p">,</span>
        <span class="s2">&quot;cede_Cancelados_Desertores&quot;</span><span class="p">:</span><span class="s1">&#39;Documentos compartidos/01.Q10/01.Educacion_Tecnica/Procesados/07.Cancelados_Desertores&#39;</span><span class="p">,</span>
        <span class="s2">&quot;emp_Docentes&quot;</span><span class="p">:</span><span class="s1">&#39;Documentos compartidos/01.Q10/02.Educacion_Continua/Procesados/01.Docentes&#39;</span><span class="p">,</span>
        <span class="s2">&quot;emp_Preinscritos&quot;</span><span class="p">:</span><span class="s1">&#39;Documentos compartidos/01.Q10/02.Educacion_Continua/Procesados/02.Preinscritos&#39;</span><span class="p">,</span>
        <span class="s2">&quot;emp_Listado_Matriculas&quot;</span><span class="p">:</span><span class="s1">&#39;Documentos compartidos/01.Q10/02.Educacion_Continua/Procesados/03.Listado_Matriculas&#39;</span><span class="p">,</span>
        <span class="s2">&quot;emp_Consolidado_inasistencias&quot;</span><span class="p">:</span><span class="s1">&#39;Documentos compartidos/01.Q10/02.Educacion_Continua/Procesados/04.Consolidado_inasistencias&#39;</span><span class="p">,</span>
        <span class="s2">&quot;emp_Estudiantes_inasistencias&quot;</span><span class="p">:</span><span class="s1">&#39;Documentos compartidos/01.Q10/02.Educacion_Continua/Procesados/05.Estudiantes_cancelados_por_inasistencias&#39;</span><span class="p">,</span>
        <span class="s2">&quot;emp_Egresados_Graduados&quot;</span><span class="p">:</span><span class="s1">&#39;Documentos compartidos/01.Q10/02.Educacion_Continua/Procesados/06.Egresados_Graduados&#39;</span>    
        <span class="p">}</span>
    <span class="c1"># &quot;emp_Egresados_Graduados&quot;:&#39;Documentos compartidos/01.Q10/02.Educacion_Continua/06.Egresados_Graduados&#39;</span>
    <span class="n">folder_url</span> <span class="o">=</span> <span class="n">etl_to_folder_url</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">etl</span><span class="p">,</span> <span class="s2">&quot;URL por defecto si no se encuentra el valor de etl&quot;</span><span class="p">)</span>
    <span class="c1"># Guardar en un archivo Excel temporal del df recibido</span>
    <span class="n">hoy</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2">_%m_%Y_%H_%M&quot;</span><span class="p">)</span>

    <span class="c1">#si etl no esta en csv_files</span>
    <span class="k">if</span> <span class="n">etl</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">csv_files</span><span class="p">:</span>
        <span class="n">archivo_temporal</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;procesado_</span><span class="si">{</span><span class="n">etl</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">hoy</span><span class="si">}</span><span class="s2">.xlsx&quot;</span>
        <span class="n">df</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="n">archivo_temporal</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">archivo_temporal</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;procesado_</span><span class="si">{</span><span class="n">etl</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">hoy</span><span class="si">}</span><span class="s2">.csv&quot;</span>
        <span class="c1">#utf-8-sig para evitar problemas con caracteres especiales</span>
        <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">archivo_temporal</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8-sig&#39;</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">upload_file_to_sharepoint</span><span class="p">(</span><span class="n">file_path</span><span class="o">=</span><span class="n">archivo_temporal</span><span class="p">,</span> <span class="n">folder_url</span><span class="o">=</span><span class="n">folder_url</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Archivo subido a SharePoint: </span><span class="si">{</span><span class="n">archivo_temporal</span><span class="si">}</span><span class="s2">, folder_url: </span><span class="si">{</span><span class="n">folder_url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error al subir el archivo </span><span class="si">{</span><span class="n">archivo_temporal</span><span class="si">}</span><span class="s2"> a SharePoint: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="c1"># cerrar el archivo temporal</span>
        <span class="c1"># Eliminar el archivo original después de procesarlo</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>  <span class="c1"># Pausa de 500ms</span>
        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">archivo_temporal</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Archivo original eliminado: </span><span class="si">{</span><span class="n">archivo_temporal</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
<p><code>actualizar_columna_programa</code> actualiza una columna de destino en un DataFrame basándose en condiciones de otra columna. Si la columna condicional no es nula y contiene un texto específico (si se proporciona), el valor de una columna origen se copia a la columna destino. Posteriormente, los valores nulos en la columna destino se rellenan usando el método <em>forward fill</em>. Devuelve el DataFrame actualizado.</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">actualizar_columna_programa</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">columna_condicional</span><span class="p">,</span> <span class="n">columna_origen</span><span class="p">,</span> <span class="n">columna_destino</span><span class="p">,</span> <span class="n">texto_filtro</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Actualiza una columna destino en un DataFrame en base a una condición de otra columna.</span>
<span class="sd">    Si el valor en columna_condicional no es nulo y contiene un texto específico (opcional),</span>
<span class="sd">    se copia el valor de columna_origen a columna_destino.</span>
<span class="sd">    Luego, los valores nulos en columna_destino se rellenan usando el método forward fill.</span>

<span class="sd">    :param df: DataFrame a procesar.</span>
<span class="sd">    :param columna_condicional: Nombre de la columna para evaluar la condición.</span>
<span class="sd">    :param columna_origen: Nombre de la columna de donde copiar el valor.</span>
<span class="sd">    :param columna_destino: Nombre de la columna destino que será actualizada.</span>
<span class="sd">    :param texto_filtro: Texto que debe estar presente en la columna_condicional (opcional).</span>
<span class="sd">    :return: DataFrame actualizado.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">df</span><span class="p">[</span><span class="n">columna_destino</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
        <span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">row</span><span class="p">[</span><span class="n">columna_origen</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">notnull</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="n">columna_condicional</span><span class="p">])</span> <span class="ow">and</span> 
            <span class="p">(</span><span class="n">texto_filtro</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="n">columna_condicional</span><span class="p">])</span> <span class="k">if</span> <span class="n">texto_filtro</span> <span class="k">else</span> <span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span> <span class="kc">None</span><span class="p">,</span> 
        <span class="n">axis</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">)</span>
    <span class="n">df</span><span class="p">[</span><span class="n">columna_destino</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">columna_destino</span><span class="p">]</span><span class="o">.</span><span class="n">ffill</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">df</span>
</code></pre></div>
<p><code>concatenar_dataframes</code> combina múltiples DataFrames en uno solo, ignorando los índices originales. Filtra y excluye DataFrames vacíos o aquellos cuyos valores sean completamente nulos antes de la concatenación. Si no hay DataFrames válidos, retorna un DataFrame vacío.</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">concatenar_dataframes</span><span class="p">(</span><span class="n">dataframes</span><span class="p">):</span>
    <span class="c1"># Filtrar DataFrames vacíos o con todos los valores como NA</span>
    <span class="n">dataframes</span> <span class="o">=</span> <span class="p">[</span><span class="n">df</span> <span class="k">for</span> <span class="n">df</span> <span class="ow">in</span> <span class="n">dataframes</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">df</span><span class="o">.</span><span class="n">empty</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">df</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">all</span><span class="p">()]</span>
    <span class="k">if</span> <span class="n">dataframes</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">dataframes</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
</code></pre></div>
<p><code>process_row</code> procesa una fila de un DataFrame modificando columnas específicas en función del contenido de la columna <code>'Columna_15'</code>. También actualiza dos indicadores booleanos, <code>found_porcentaje</code> y <code>found_creditos</code>, que rastrean si se encontraron palabras clave específicas:</p>
<ul>
<li>
<p><strong>Condiciones:</strong></p>
<ul>
<li>Si <code>'Columna_15'</code> es una cadena que contiene "Porcentaje", activa <code>found_porcentaje</code> y desactiva <code>found_creditos</code>.</li>
<li>Si <code>'Columna_15'</code> es "Creditos", activa <code>found_creditos</code> y desactiva <code>found_porcentaje</code>.</li>
</ul>
</li>
<li>
<p><strong>Acciones:</strong></p>
<ul>
<li>Si <code>found_porcentaje</code> es <code>True</code>, copia el valor de <code>'Columna_15'</code> en <code>'Columna_16'</code>.</li>
<li>Si <code>found_creditos</code> es <code>True</code>, copia el valor de <code>'Columna_15'</code> en <code>'Columna_14'</code>.</li>
</ul>
</li>
</ul>
<p>Devuelve la fila actualizada junto con los valores actualizados de <code>found_porcentaje</code> y <code>found_creditos</code>.</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">process_row</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">found_porcentaje</span><span class="p">,</span> <span class="n">found_creditos</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;Columna_15&#39;</span><span class="p">],</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="s1">&#39;Porcentaje&#39;</span> <span class="ow">in</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Columna_15&#39;</span><span class="p">]:</span>
        <span class="n">found_porcentaje</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">found_creditos</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">elif</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Columna_15&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Creditos&#39;</span><span class="p">:</span>
        <span class="n">found_creditos</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">found_porcentaje</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="n">found_porcentaje</span><span class="p">:</span>
        <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Columna_16&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Columna_15&#39;</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">found_creditos</span><span class="p">:</span>
        <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Columna_14&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Columna_15&#39;</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">row</span><span class="p">,</span> <span class="n">found_porcentaje</span><span class="p">,</span> <span class="n">found_creditos</span>
</code></pre></div>
<h2 id="funcion-procesar_excel_con_hojas">Función <code>procesar_excel_con_hojas</code><a class="headerlink" href="#funcion-procesar_excel_con_hojas" title="Permanent link">&para;</a></h2>
<p>Procesa un archivo Excel con múltiples hojas, combinando los datos según reglas específicas:</p>
<ol>
<li>
<p><strong>Lectura inicial:</strong></p>
<ul>
<li>Carga todas las hojas del archivo Excel.</li>
<li>Procesa la primera hoja directamente.</li>
</ul>
</li>
<li>
<p><strong>Procesamiento de hojas restantes:</strong></p>
<ul>
<li>Identifica el inicio de los datos en cada hoja mediante la primera fila no nula de la columna A.</li>
<li>Si los datos de la hoja comienzan con "1" en la columna A, combina alineando por esta columna usando un <em>merge</em>.</li>
<li>Si no comienzan con "1", concatena los datos al final, continuando el listado.</li>
</ul>
</li>
<li>
<p><strong>Salida:</strong></p>
<ul>
<li>Devuelve un único DataFrame que combina los datos procesados de todas las hojas según las reglas descritas.</li>
</ul>
</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">procesar_excel_con_hojas</span><span class="p">(</span><span class="n">file_path</span><span class="p">):</span>
    <span class="c1"># Leer todas las hojas</span>
    <span class="n">excel_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">ExcelFile</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
    <span class="n">hojas</span> <span class="o">=</span> <span class="n">excel_data</span><span class="o">.</span><span class="n">sheet_names</span>

    <span class="c1"># Procesar la primera hoja directamente</span>
    <span class="n">hoja1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="n">hojas</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="c1"># Procesar las demás hojas</span>
    <span class="k">for</span> <span class="n">sheet_name</span> <span class="ow">in</span> <span class="n">hojas</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
        <span class="n">hoja_actual</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="n">sheet_name</span><span class="p">)</span>

        <span class="c1"># Identificar dónde empiezan los datos en la columna A</span>
        <span class="n">inicio_datos</span> <span class="o">=</span> <span class="n">hoja_actual</span><span class="p">[</span><span class="n">hoja_actual</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">notna</span><span class="p">()]</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">hoja_actual</span> <span class="o">=</span> <span class="n">hoja_actual</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">inicio_datos</span><span class="p">:]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Verificar si la columna A comienza con 1</span>
        <span class="k">if</span> <span class="n">hoja_actual</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c1"># Combinar alineando por la columna A</span>
            <span class="n">hoja1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
                <span class="n">hoja1</span><span class="p">,</span>
                <span class="n">hoja_actual</span><span class="p">,</span>
                <span class="n">left_on</span><span class="o">=</span><span class="n">hoja1</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                <span class="n">right_on</span><span class="o">=</span><span class="n">hoja_actual</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Agregar datos debajo continuando el listado</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">hoja_actual</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                <span class="n">hoja1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">hoja1</span><span class="p">,</span> <span class="n">hoja_actual</span><span class="p">],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">hoja1</span>
</code></pre></div>
<h2 id="funcion-limpiar_columnas">Función <code>limpiar_columnas</code><a class="headerlink" href="#funcion-limpiar_columnas" title="Permanent link">&para;</a></h2>
<p>Realiza tareas de limpieza y transformación en un DataFrame:</p>
<ol>
<li>
<p><strong>Eliminación de columnas:</strong></p>
<ul>
<li>Elimina las columnas especificadas en <code>columnas_a_eliminar</code> si existen en el DataFrame.</li>
</ul>
</li>
<li>
<p><strong>Renombrado de columnas:</strong></p>
<ul>
<li>Renombra columnas según el mapeo proporcionado en el diccionario <code>renombres</code>.</li>
</ul>
</li>
<li>
<p><strong>Conversión a mayúsculas:</strong></p>
<ul>
<li>Convierte todos los nombres de columnas a mayúsculas si se proporciona <code>columnas_a_mayusculas</code>.</li>
</ul>
</li>
</ol>
<p><strong>Parámetros:</strong>
- <code>df</code>: DataFrame a procesar.
- <code>columnas_a_eliminar</code> (list): Lista de nombres de columnas a eliminar.
- <code>renombres</code> (dict): Diccionario de renombramiento <code>{nombre_actual: nuevo_nombre}</code>.
- <code>columnas_a_mayusculas</code> (bool, opcional): Si se proporciona, convierte los nombres de todas las columnas a mayúsculas.</p>
<p><strong>Salida:</strong>
Devuelve el DataFrame transformado.</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">limpiar_columnas</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">columnas_a_eliminar</span><span class="p">,</span> <span class="n">renombres</span><span class="p">,</span> <span class="n">columnas_a_mayusculas</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">columnas_a_eliminar</span> <span class="k">if</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">],</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">renombres</span><span class="p">)</span>
    <span class="c1"># COLOCAR TODAS LAS COLUMNAS EN MAYÚSCULAS</span>
    <span class="k">if</span> <span class="n">columnas_a_mayusculas</span><span class="p">:</span>
        <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">df</span>
</code></pre></div>
<h2 id="funcion-replace_values_df">Función <code>replace_values_df</code><a class="headerlink" href="#funcion-replace_values_df" title="Permanent link">&para;</a></h2>
<p>Reemplaza valores en un DataFrame basándose en un diccionario de sustituciones. Si no se especifica un diccionario <code>replacements</code>, utiliza uno predeterminado donde la columna <code>'Tipo de documento'</code> mapea valores largos como <code>'Cédula de Ciudadanía'</code> a formas abreviadas como <code>'CC'</code>. Itera por las columnas del diccionario y aplica los cambios definidos, devolviendo el DataFrame actualizado.</p>
<p><code>_dict</code> contiene las claves y valores para reemplazar los tipos de documentos en español con sus correspondientes abreviaturas:</p>
<ul>
<li><strong>Cédula de Ciudadanía</strong>: 'CC'</li>
<li><strong>Tarjeta de Identidad</strong>: 'TI'</li>
<li><strong>Registro Civil de Nacimiento</strong>: 'RC'</li>
<li><strong>Cédula ó Identificación de Extranjería</strong>: 'CE'</li>
<li><strong>Permiso de Protección Temporal</strong>: 'PPT'</li>
<li><strong>Permiso Especial de Permanencia</strong>: 'PEP'</li>
<li><strong>Número de Identificación Tributaria</strong>: 'NIT'</li>
<li><strong>Código NES</strong>: 'NES'</li>
<li><strong>Pasaporte</strong>: 'PA'</li>
<li><strong>Otros</strong>: 'OTRO'
<div class="highlight"><pre><span></span><code>```python
# Define the dictionary with the replacements
_dict = {
            &#39;Cédula de Ciudadanía&#39;: &#39;CC&#39;,
            &#39;Tarjeta de Identidad&#39;: &#39;TI&#39;,
            &#39;Registro Civil de Nacimiento&#39;: &#39;RC&#39;,
            &#39;Cédula ó Identificación de Extranjería&#39;: &#39;CE&#39;,
            &#39;Permiso de Protección Temporal&#39;: &#39;PPT&#39;,
            &#39;Permiso Especial de Permanencia&#39;: &#39;PEP&#39;,
            &#39;Número de Identificación Tributaria&#39;: &#39;NIT&#39;,
            &#39;Código NES&#39;: &#39;NES&#39;,
            &#39;Pasaporte&#39;: &#39;PA&#39;,
            &#39;Otros&#39;: &#39;OTRO&#39;,
            }

# Define the function to replace values based on a dictionary
def replace_values_df(df, replacements=None):
    if replacements is None:
        replacements = {&#39;Tipo de documento&#39;: _dict}

    for column, changes in replacements.items():
        df[column] = df[column].replace(changes)
    return df
</code></pre></div></li>
</ul>
<h2 id="funcion-download_all_files_from_sharepoint">Función <code>download_all_files_from_sharepoint</code><a class="headerlink" href="#funcion-download_all_files_from_sharepoint" title="Permanent link">&para;</a></h2>
<h4 id="proposito_5"><strong>Propósito</strong><a class="headerlink" href="#proposito_5" title="Permanent link">&para;</a></h4>
<p>Descarga todos los archivos de una carpeta de SharePoint a un directorio local especificado, asegurando que el directorio local sea creado o limpiado antes de la descarga.</p>
<hr />
<h4 id="entradas_5"><strong>Entradas</strong><a class="headerlink" href="#entradas_5" title="Permanent link">&para;</a></h4>
<ul>
<li><strong><code>folder_url</code> (str):</strong> URL relativa de la carpeta en SharePoint.</li>
<li><strong><code>local_folder_path</code> (str):</strong> Ruta local donde se descargarán los archivos.</li>
</ul>
<hr />
<h4 id="funcionamiento_3"><strong>Funcionamiento</strong><a class="headerlink" href="#funcionamiento_3" title="Permanent link">&para;</a></h4>
<ol>
<li>
<p><strong>Preparación del directorio local:</strong></p>
<ul>
<li>Verifica si el directorio existe:</li>
<li>Si existe, elimina los archivos existentes.</li>
<li>Si no existe, lo crea.</li>
</ul>
</li>
<li>
<p><strong>Listado de archivos en SharePoint:</strong></p>
<ul>
<li>Envía una solicitud HTTP para obtener la lista de archivos en la carpeta especificada.</li>
<li>Procesa la respuesta JSON para obtener los detalles de los archivos.</li>
</ul>
</li>
<li>
<p><strong>Descarga de archivos:</strong></p>
<ul>
<li>Itera sobre la lista de archivos.</li>
<li>Descarga cada archivo desde SharePoint y lo guarda en el directorio local.</li>
<li>Registra información sobre cada archivo descargado o errores si ocurren durante la descarga.</li>
</ul>
</li>
<li>
<p><strong>Manejo de sesiones HTTP:</strong></p>
<ul>
<li>Utiliza una sesión HTTP para realizar las solicitudes.</li>
<li>Configura un timeout para prevenir bloqueos.</li>
<li>Cierra la sesión al finalizar.</li>
</ul>
</li>
</ol>
<hr />
<h4 id="salida_4"><strong>Salida</strong><a class="headerlink" href="#salida_4" title="Permanent link">&para;</a></h4>
<ul>
<li>No retorna valores. Registra los eventos relacionados con la limpieza del directorio, descarga de archivos y manejo de errores en el logger configurado.</li>
</ul>
<hr />
<h4 id="manejo-de-errores"><strong>Manejo de errores</strong><a class="headerlink" href="#manejo-de-errores" title="Permanent link">&para;</a></h4>
<ul>
<li>Registra errores en:</li>
<li>Listado de archivos (problemas de red, tiempo de espera, etc.).</li>
<li>Descarga de archivos individuales (problemas con la conexión o permisos).</li>
<li>Asegura la limpieza del directorio local y el cierre de la sesión HTTP incluso en caso de errores.</li>
</ul>
<h4 id="consideraciones"><strong>Consideraciones</strong><a class="headerlink" href="#consideraciones" title="Permanent link">&para;</a></h4>
<ul>
<li>La función utiliza un decorador <code>log_step_decorator</code> para registrar el inicio, éxito o error del proceso completo.</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="c1"># Función para descargar todos los archivos de una carpeta en SharePoint</span>
<span class="nd">@log_step_decorator</span><span class="p">(</span><span class="s2">&quot;Descargar archivos de SharePoint&quot;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">download_all_files_from_sharepoint</span><span class="p">(</span><span class="n">folder_url</span><span class="p">,</span> <span class="n">local_folder_path</span><span class="p">):</span>
    <span class="c1"># Asegurarnos de que el directorio local existe y limpiarlo</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">local_folder_path</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">local_folder_path</span><span class="p">):</span>
            <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">local_folder_path</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Archivo eliminado: </span><span class="si">{</span><span class="n">file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No se pudo eliminar el archivo </span><span class="si">{</span><span class="n">file</span><span class="si">}</span><span class="s2">. Error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">local_folder_path</span><span class="p">)</span>

    <span class="c1"># Crear una sesión para manejar las solicitudes HTTP</span>
    <span class="n">session</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span>
    <span class="n">session</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">headers</span><span class="p">)</span>  <span class="c1"># Asegurar que los encabezados están configurados</span>

    <span class="c1"># URL para listar los archivos de la carpeta en SharePoint</span>
    <span class="n">list_files_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">sharepoint_base_url</span><span class="si">}</span><span class="s2">/_api/web/GetFolderByServerRelativeUrl(&#39;</span><span class="si">{</span><span class="n">folder_url</span><span class="si">}</span><span class="s2">&#39;)/Files&quot;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Solicitud para obtener la lista de archivos</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">list_files_url</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>  <span class="c1"># Configurar un timeout para evitar bloqueos</span>
        <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>  <span class="c1"># Levantar un error si el código de estado no es 200</span>
    <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">RequestException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error al listar los archivos de la carpeta. Detalles: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">session</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">return</span>

    <span class="c1"># Procesar la respuesta JSON</span>
    <span class="n">files</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;results&#39;</span><span class="p">,</span> <span class="p">[])</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">files</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;No hay archivos en la carpeta especificada.&quot;</span><span class="p">)</span>
        <span class="n">session</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">return</span>

    <span class="c1"># Descargar cada archivo</span>
    <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
        <span class="n">file_name</span> <span class="o">=</span> <span class="n">file</span><span class="p">[</span><span class="s1">&#39;Name&#39;</span><span class="p">]</span>
        <span class="n">file_url</span> <span class="o">=</span> <span class="n">file</span><span class="p">[</span><span class="s1">&#39;ServerRelativeUrl&#39;</span><span class="p">]</span>
        <span class="n">download_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">sharepoint_base_url</span><span class="si">}</span><span class="s2">/_api/web/GetFileByServerRelativeUrl(&#39;</span><span class="si">{</span><span class="n">file_url</span><span class="si">}</span><span class="s2">&#39;)/$value&quot;</span>
        <span class="n">local_file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">local_folder_path</span><span class="p">,</span> <span class="n">file_name</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">file_response</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">download_url</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>  <span class="c1"># Configurar timeout para cada descarga</span>
            <span class="n">file_response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">local_file_path</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">local_file</span><span class="p">:</span>
                <span class="n">local_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">file_response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Archivo descargado: </span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">RequestException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error al descargar el archivo </span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s2">. Detalles: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># Añadir un pequeño retraso entre descargas para evitar saturar el servidor</span>

    <span class="c1"># Cerrar la sesión HTTP</span>
    <span class="n">session</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div>
<p><code>corregir_nombre_archivo</code> ajusta un nombre de archivo para cumplir con las restricciones del sistema de archivos. Reemplaza caracteres prohibidos (<code>\ / : * ? " &lt; &gt; |</code>) con guiones bajos, elimina guiones bajos consecutivos, y asegura que la longitud total no exceda los 255 caracteres. Retorna el nombre corregido.</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">corregir_nombre_archivo</span><span class="p">(</span><span class="n">nuevo_nombre</span><span class="p">):</span>
    <span class="c1"># Reemplazar caracteres prohibidos por un guion bajo</span>
    <span class="n">nuevo_nombre</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;[</span><span class="se">\\</span><span class="s1">/:*?&quot;&lt;&gt;|]&#39;</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span><span class="p">,</span> <span class="n">nuevo_nombre</span><span class="p">)</span>

    <span class="c1"># Reemplazar múltiples guiones bajos consecutivos por uno solo</span>
    <span class="n">nuevo_nombre</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;_+&#39;</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span><span class="p">,</span> <span class="n">nuevo_nombre</span><span class="p">)</span>

    <span class="c1"># Limitar la longitud total a 255 caracteres</span>
    <span class="n">base_name</span><span class="p">,</span> <span class="n">extension</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">nuevo_nombre</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">base_name</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">extension</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">255</span><span class="p">:</span>
        <span class="n">base_name</span> <span class="o">=</span> <span class="n">base_name</span><span class="p">[:</span><span class="mi">127</span><span class="p">]</span> <span class="o">+</span> <span class="n">base_name</span><span class="p">[</span><span class="o">-</span><span class="p">(</span><span class="mi">127</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">extension</span><span class="p">)):]</span>

    <span class="c1"># Retornar nombre corregido</span>
    <span class="k">return</span> <span class="n">base_name</span> <span class="o">+</span> <span class="n">extension</span>
</code></pre></div>
<h2 id="funcion-procesar">Función <code>procesar</code><a class="headerlink" href="#funcion-procesar" title="Permanent link">&para;</a></h2>
<h4 id="proposito_6"><strong>Propósito</strong><a class="headerlink" href="#proposito_6" title="Permanent link">&para;</a></h4>
<p>Gestiona el procesamiento y renombrado de archivos en un directorio de descargas basado en un tipo de proceso ETL especificado. Los archivos se renombran según reglas específicas y se cargan en una ubicación correspondiente en SharePoint.</p>
<hr />
<h4 id="entradas_6"><strong>Entradas</strong><a class="headerlink" href="#entradas_6" title="Permanent link">&para;</a></h4>
<ul>
<li><strong><code>etl</code> (str):</strong> Identificador del tipo de proceso ETL que determina las reglas de procesamiento y el destino en SharePoint.</li>
<li><strong><code>download_dir</code> (str):</strong> Ruta del directorio donde se encuentran los archivos a procesar.</li>
</ul>
<hr />
<h4 id="funcionamiento_4"><strong>Funcionamiento</strong><a class="headerlink" href="#funcionamiento_4" title="Permanent link">&para;</a></h4>
<ol>
<li>
<p><strong>Iteración sobre archivos:</strong></p>
<ul>
<li>Procesa únicamente archivos con la extensión <code>.xlsx</code>.</li>
<li>Intenta cargar y analizar cada archivo usando <code>openpyxl</code>.</li>
</ul>
</li>
<li>
<p><strong>Reglas de procesamiento específicas por ETL:</strong></p>
<ul>
<li>Renombra los archivos basándose en contenido de celdas específicas o estructuras predefinidas.</li>
<li>Aplica reglas personalizadas según el tipo de ETL, como extracción de fechas, nombres descriptivos o combinación de valores en celdas.</li>
</ul>
</li>
<li>
<p><strong>Renombrado de archivos:</strong></p>
<ul>
<li>Genera nombres corregidos que cumplen con las restricciones del sistema de archivos.</li>
<li>Verifica la existencia del archivo renombrado antes de continuar.</li>
</ul>
</li>
<li>
<p><strong>Subida a SharePoint:</strong></p>
<ul>
<li>Determina la carpeta de destino en SharePoint según el identificador ETL.</li>
<li>Sube los archivos procesados a la carpeta correspondiente.</li>
</ul>
</li>
<li>
<p><strong>Limpieza:</strong></p>
<ul>
<li>Elimina archivos originales y temporales después del procesamiento o subida.</li>
</ul>
</li>
</ol>
<hr />
<h4 id="salida_5"><strong>Salida</strong><a class="headerlink" href="#salida_5" title="Permanent link">&para;</a></h4>
<ul>
<li>No retorna valores. Registra mensajes en consola sobre el estado del procesamiento, subida o errores encontrados.</li>
</ul>
<hr />
<h4 id="manejo-de-errores_1"><strong>Manejo de errores</strong><a class="headerlink" href="#manejo-de-errores_1" title="Permanent link">&para;</a></h4>
<ul>
<li>Captura y maneja excepciones en:</li>
<li>Lectura y procesamiento de archivos.</li>
<li>Renombrado de archivos.</li>
<li>Subida a SharePoint.</li>
<li>Registra detalles del error o marca archivos omitidos para su posterior revisión.</li>
</ul>
<hr />
<h4 id="consideraciones_1"><strong>Consideraciones</strong><a class="headerlink" href="#consideraciones_1" title="Permanent link">&para;</a></h4>
<ul>
<li>Las reglas específicas por ETL permiten flexibilidad para distintos tipos de procesamiento.</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">procesar</span><span class="p">(</span><span class="n">etl</span><span class="p">,</span> <span class="n">download_dir</span><span class="p">):</span>
    <span class="c1"># Lista para almacenar las rutas completas de los archivos procesados y originales</span>
    <span class="n">archivos_a_subir</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Iterar sobre todos los archivos en el directorio de descargas</span>
    <span class="k">for</span> <span class="n">archivo</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">download_dir</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">archivo</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.xlsx&#39;</span><span class="p">):</span>  <span class="c1"># Procesar solo archivos Excel</span>
            <span class="n">archivo_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">download_dir</span><span class="p">,</span> <span class="n">archivo</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Procesando archivo: </span><span class="si">{</span><span class="n">archivo</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="c1"># Intentar cargar el archivo Excel</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">wb</span> <span class="o">=</span> <span class="n">load_workbook</span><span class="p">(</span><span class="n">archivo_path</span><span class="p">,</span><span class="n">data_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">ws</span> <span class="o">=</span> <span class="n">wb</span><span class="o">.</span><span class="n">active</span>
                    <span class="n">fecha</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2">_%m_%Y&quot;</span><span class="p">)</span>
                    <span class="k">match</span> <span class="n">etl</span><span class="p">:</span>
                        <span class="k">case</span> <span class="s2">&quot;C4C&quot;</span><span class="p">:</span>
                            <span class="n">nuevo_nombre</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;archivo_</span><span class="si">{</span><span class="n">fecha</span><span class="si">}</span><span class="s2">.xlsx&quot;</span>
                            <span class="n">nuevo_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">download_dir</span><span class="p">,</span> <span class="n">nuevo_nombre</span><span class="p">)</span>
                            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">nuevo_path</span><span class="p">),</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># Ensure directory exists</span>

                        <span class="k">case</span> <span class="s2">&quot;emp_Consolidado_inasistencias&quot;</span><span class="p">:</span>
                            <span class="n">sede_jornada</span> <span class="o">=</span> <span class="n">ws</span><span class="p">[</span><span class="s1">&#39;D6&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">if</span> <span class="n">ws</span><span class="p">[</span><span class="s1">&#39;D6&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="k">else</span> <span class="s2">&quot;SIN_SEDE&quot;</span>
                            <span class="n">curso</span> <span class="o">=</span> <span class="n">ws</span><span class="p">[</span><span class="s1">&#39;F6&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">if</span> <span class="n">ws</span><span class="p">[</span><span class="s1">&#39;F6&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="k">else</span> <span class="s2">&quot;SIN_CURSO&quot;</span>
                            <span class="n">periodo</span> <span class="o">=</span> <span class="n">ws</span><span class="p">[</span><span class="s1">&#39;M6&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">if</span> <span class="n">ws</span><span class="p">[</span><span class="s1">&#39;M6&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="k">else</span> <span class="s2">&quot;SIN_PERIODO&quot;</span>

                            <span class="n">nuevo_nombre</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Inasistencias_</span><span class="si">{</span><span class="n">sede_jornada</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">curso</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">periodo</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">fecha</span><span class="si">}</span><span class="s2">.xlsx&quot;</span>
                            <span class="n">nuevo_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">download_dir</span><span class="p">,</span> <span class="n">nuevo_nombre</span><span class="p">)</span>
                            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">nuevo_path</span><span class="p">),</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># Ensure directory exists</span>

                            <span class="k">if</span> <span class="s2">&quot;SIN&quot;</span> <span class="ow">in</span> <span class="p">[</span><span class="n">sede_jornada</span><span class="p">,</span> <span class="n">curso</span><span class="p">,</span> <span class="n">periodo</span><span class="p">]:</span>
                                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Archivo </span><span class="si">{</span><span class="n">archivo</span><span class="si">}</span><span class="s2"> omitido para procesamiento debido a datos incompletos.&quot;</span><span class="p">)</span>
                                <span class="n">archivos_a_subir</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">archivo_path</span><span class="p">)</span>
                                <span class="k">continue</span>

                        <span class="k">case</span> <span class="s2">&quot;cede_Cancelados_Desertores&quot;</span><span class="p">:</span>
                            <span class="c1"># Filtrar y limpiar las fechas</span>
                            <span class="n">filtro_fechas</span> <span class="o">=</span> <span class="p">[</span><span class="n">cell</span><span class="o">.</span><span class="n">value</span> <span class="k">for</span> <span class="n">cell</span> <span class="ow">in</span> <span class="n">ws</span><span class="p">[</span><span class="s1">&#39;I&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="n">cell</span><span class="o">.</span><span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">cell</span><span class="o">.</span><span class="n">value</span> <span class="o">!=</span> <span class="s1">&#39;Fecha&#39;</span><span class="p">]</span>
                            <span class="c1"># Eliminar el primer valor si existe</span>
                            <span class="k">if</span> <span class="n">filtro_fechas</span><span class="p">:</span>
                                <span class="n">filtro_fechas</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                            <span class="k">if</span> <span class="ow">not</span> <span class="n">filtro_fechas</span><span class="p">:</span>
                                <span class="n">filtro_fechas</span> <span class="o">=</span> <span class="p">[</span><span class="n">cell</span><span class="o">.</span><span class="n">value</span> <span class="k">for</span> <span class="n">cell</span> <span class="ow">in</span> <span class="n">ws</span><span class="p">[</span><span class="s1">&#39;H&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="n">cell</span><span class="o">.</span><span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">cell</span><span class="o">.</span><span class="n">value</span> <span class="o">!=</span> <span class="s1">&#39;Fecha&#39;</span><span class="p">]</span>
                            <span class="c1"># Convertir todas las fechas a objetos datetime</span>
                            <span class="n">fechas</span> <span class="o">=</span> <span class="p">[]</span>
                            <span class="k">for</span> <span class="n">fecha</span> <span class="ow">in</span> <span class="n">filtro_fechas</span><span class="p">:</span>
                                <span class="k">try</span><span class="p">:</span>
                                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fecha</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                                        <span class="n">fechas</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">fecha</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">%d</span><span class="s2">/%m/%Y&quot;</span><span class="p">))</span>
                                    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fecha</span><span class="p">,</span> <span class="n">datetime</span><span class="p">):</span>
                                        <span class="n">fechas</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fecha</span><span class="p">)</span>
                                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                                    <span class="k">continue</span>

                            <span class="k">if</span> <span class="n">fechas</span><span class="p">:</span>
                                <span class="n">fecha_inicio</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">fechas</span><span class="p">)</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2">_%m_%Y&quot;</span><span class="p">)</span>
                                <span class="n">fecha_fin</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">fechas</span><span class="p">)</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2">_%m_%Y&quot;</span><span class="p">)</span>
                                <span class="n">nuevo_nombre</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Cancelados_desertores_</span><span class="si">{</span><span class="n">fecha_inicio</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">fecha_fin</span><span class="si">}</span><span class="s2">.xlsx&quot;</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">fecha</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2">_%m_%Y&quot;</span><span class="p">)</span>
                                <span class="n">nuevo_nombre</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Cancelados_desertores_</span><span class="si">{</span><span class="n">fecha</span><span class="si">}</span><span class="s2">.xlsx&quot;</span>



                        <span class="k">case</span> <span class="s2">&quot;cede_Diseño_Curricular&quot;</span><span class="p">:</span>
                            <span class="n">nuevo_nombre</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Diseño_Curricular_</span><span class="si">{</span><span class="n">fecha</span><span class="si">}</span><span class="s2">.xlsx&quot;</span>


                        <span class="k">case</span> <span class="s2">&quot;cede_Docentes&quot;</span> <span class="o">|</span> <span class="s2">&quot;emp_Docentes&quot;</span><span class="p">:</span>
                            <span class="n">nuevo_nombre</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Docentes_</span><span class="si">{</span><span class="n">fecha</span><span class="si">}</span><span class="s2">.xlsx&quot;</span>


                        <span class="k">case</span> <span class="s2">&quot;cede_Egresados_Graduados&quot;</span> <span class="o">|</span> <span class="s2">&quot;emp_Egresados_Graduados&quot;</span><span class="p">:</span>
                            <span class="n">archivo_sin_ext</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">archivo</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                            <span class="n">nuevo_nombre</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">archivo_sin_ext</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">fecha</span><span class="si">}</span><span class="s2">.xlsx&quot;</span>

                        <span class="k">case</span> <span class="s2">&quot;emp_Estudiantes_inasistencias&quot;</span><span class="p">:</span>
                            <span class="n">periodo</span> <span class="o">=</span> <span class="n">ws</span><span class="p">[</span><span class="s1">&#39;A7&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">if</span> <span class="n">ws</span><span class="p">[</span><span class="s1">&#39;A7&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="k">else</span> <span class="s2">&quot;SIN_DPTO&quot;</span>
                            <span class="n">periodo</span> <span class="o">=</span> <span class="n">periodo</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                            <span class="n">nuevo_nombre</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;emp_Estudiantes_inasistencias_</span><span class="si">{</span><span class="n">periodo</span><span class="si">}</span><span class="s2">.xlsx&quot;</span>


                            <span class="k">if</span> <span class="s2">&quot;SIN_DPTO&quot;</span> <span class="ow">in</span> <span class="p">[</span><span class="n">periodo</span><span class="p">]:</span>
                                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Archivo </span><span class="si">{</span><span class="n">archivo</span><span class="si">}</span><span class="s2"> omitido para procesamiento debido a datos incompletos.&quot;</span><span class="p">)</span>
                                <span class="n">archivos_a_subir</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">archivo_path</span><span class="p">)</span>
                                <span class="k">continue</span>
                        <span class="k">case</span> <span class="s2">&quot;cede_Historico_Notas&quot;</span><span class="p">:</span>
                            <span class="n">periodo</span> <span class="o">=</span> <span class="n">ws</span><span class="p">[</span><span class="s1">&#39;J5&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">if</span> <span class="n">ws</span><span class="p">[</span><span class="s1">&#39;J5&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="k">else</span> <span class="s2">&quot;SIN_CURSO&quot;</span>
                            <span class="n">nuevo_nombre</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Historico_Notas_</span><span class="si">{</span><span class="n">periodo</span><span class="si">}</span><span class="s2">&quot;</span>
                            <span class="c1">#elimina cualquier espacio en nuevo_nombre</span>
                            <span class="n">nuevo_nombre</span> <span class="o">=</span> <span class="n">nuevo_nombre</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span>
                            <span class="c1">#agrega un hash al final del nombre del archivo para que no se repitan</span>
                            <span class="n">nuevo_nombre</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">nuevo_nombre</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">urandom</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="o">.</span><span class="n">hex</span><span class="p">()</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">fecha</span><span class="si">}</span><span class="s2">.xlsx&quot;</span>
                            <span class="k">if</span> <span class="s2">&quot;SIN_CURSO&quot;</span> <span class="ow">in</span> <span class="p">[</span><span class="n">periodo</span><span class="p">]:</span>
                                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Archivo </span><span class="si">{</span><span class="n">archivo</span><span class="si">}</span><span class="s2"> omitido para procesamiento debido a datos incompletos.&quot;</span><span class="p">)</span>
                                <span class="n">archivos_a_subir</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">archivo_path</span><span class="p">)</span>
                                <span class="k">continue</span>
                        <span class="k">case</span> <span class="s2">&quot;cede_Ingresos&quot;</span><span class="p">:</span>
                            <span class="c1"># nombre = &quot;Cajero: Todos  |  Desde: 01/01/2020  |  Hasta: 31/01/2020&quot;</span>
                            <span class="c1">#estraer de nombre Todos_01_01_2020_31_01_2020</span>
                            <span class="n">nombre</span> <span class="o">=</span> <span class="n">ws</span><span class="p">[</span><span class="s1">&#39;A7&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">if</span> <span class="n">ws</span><span class="p">[</span><span class="s1">&#39;A7&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="k">else</span> <span class="s2">&quot;SIN_CURSO&quot;</span>
                            <span class="n">nombre</span> <span class="o">=</span> <span class="n">nombre</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;Cajero: &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
                            <span class="n">nombre</span> <span class="o">=</span> <span class="n">nombre</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;Todos&quot;</span><span class="p">,</span> <span class="s2">&quot;Ingresos&quot;</span><span class="p">)</span>
                            <span class="n">nombre</span> <span class="o">=</span> <span class="n">nombre</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;  |  Desde: &quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span>
                            <span class="n">nombre</span> <span class="o">=</span> <span class="n">nombre</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;  |  Hasta: &quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span>
                            <span class="n">nombre</span> <span class="o">=</span> <span class="n">nombre</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span>
                            <span class="n">nombre</span> <span class="o">=</span> <span class="n">nombre</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

                            <span class="n">nuevo_nombre</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">nombre</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">fecha</span><span class="si">}</span><span class="s2">.xlsx&quot;</span>


                            <span class="k">if</span> <span class="s2">&quot;SIN_CURSO&quot;</span> <span class="ow">in</span> <span class="p">[</span><span class="n">nombre</span><span class="p">]:</span>
                                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Archivo </span><span class="si">{</span><span class="n">archivo</span><span class="si">}</span><span class="s2"> omitido para procesamiento debido a datos incompletos.&quot;</span><span class="p">)</span>
                                <span class="n">archivos_a_subir</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">archivo_path</span><span class="p">)</span>
                                <span class="k">continue</span>                            
                            <span class="n">nuevo_nombre</span>
                        <span class="k">case</span> <span class="s2">&quot;cede_Listado_Matriculas&quot;</span> <span class="o">|</span> <span class="s2">&quot;emp_Listado_Matriculas&quot;</span><span class="p">:</span>
                            <span class="n">nombre</span> <span class="o">=</span> <span class="n">ws</span><span class="p">[</span><span class="s1">&#39;A7&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">if</span> <span class="n">ws</span><span class="p">[</span><span class="s1">&#39;A7&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="k">else</span> <span class="s2">&quot;SIN_CURSO&quot;</span>
                            <span class="c1"># texto de la celda Estado: Todos  |  Desde: 01/01/2016  |  Hasta: 31/12/2016</span>
                            <span class="c1">#nombre final del archivo Listado_Matriculas_01_01_2016_31_12_2016</span>
                            <span class="n">nombre</span> <span class="o">=</span> <span class="n">nombre</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;Estado: &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
                            <span class="n">nombre</span> <span class="o">=</span> <span class="n">nombre</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;Todos&quot;</span><span class="p">,</span> <span class="s2">&quot;Listado_Matriculas&quot;</span><span class="p">)</span>                            
                            <span class="n">nombre</span> <span class="o">=</span> <span class="n">nombre</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;  |  Desde: &quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span>
                            <span class="n">nombre</span> <span class="o">=</span> <span class="n">nombre</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;  |  Hasta: &quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span>
                            <span class="n">nombre</span> <span class="o">=</span> <span class="n">nombre</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span>
                            <span class="n">nombre</span> <span class="o">=</span> <span class="n">nombre</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

                            <span class="n">nuevo_nombre</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">nombre</span><span class="si">}</span><span class="s2">_Act_</span><span class="si">{</span><span class="n">fecha</span><span class="si">}</span><span class="s2">.xlsx&quot;</span>


                            <span class="k">if</span> <span class="s2">&quot;SIN_CURSO&quot;</span> <span class="ow">in</span> <span class="p">[</span><span class="n">nombre</span><span class="p">]:</span>
                                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Archivo </span><span class="si">{</span><span class="n">archivo</span><span class="si">}</span><span class="s2"> omitido para procesamiento debido a datos incompletos.&quot;</span><span class="p">)</span>
                                <span class="n">archivos_a_subir</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">archivo_path</span><span class="p">)</span>
                                <span class="k">continue</span>                            

                        <span class="k">case</span> <span class="s2">&quot;emp_Preinscritos&quot;</span><span class="p">:</span>
                            <span class="n">archivo_sin_ext</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">archivo</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                            <span class="n">nuevo_nombre</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">archivo_sin_ext</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">fecha</span><span class="si">}</span><span class="s2">.xlsx&quot;</span>                           
                        <span class="k">case</span><span class="w"> </span><span class="k">_</span><span class="p">:</span>
                            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ETL no reconocido, se omite procesamiento.&quot;</span><span class="p">)</span>
                            <span class="k">continue</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error al procesar el archivo </span><span class="si">{</span><span class="n">archivo</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">wb</span><span class="o">.</span><span class="n">close</span><span class="p">()</span> 
                    <span class="k">continue</span>
                <span class="k">finally</span><span class="p">:</span>
                    <span class="n">wb</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                <span class="n">nuevo_nombre</span> <span class="o">=</span> <span class="n">corregir_nombre_archivo</span><span class="p">(</span><span class="n">nuevo_nombre</span><span class="p">)</span>
                <span class="n">nuevo_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">download_dir</span><span class="p">,</span> <span class="n">nuevo_nombre</span><span class="p">)</span>
                <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">nuevo_path</span><span class="p">),</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>                
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">nuevo_path</span><span class="p">):</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">nuevo_path</span><span class="p">)</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">1.5</span><span class="p">)</span>  

                <span class="c1"># Intentar renombrar el archivo</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">archivo_path</span><span class="p">,</span> <span class="n">nuevo_path</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error al renombrar el archivo: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="c1"># input(&quot;Presione Enter para continuar...&quot;)</span>

                <span class="c1">#Verificar que existe el nuevo archivo nuevo_nombre</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">nuevo_path</span><span class="p">):</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error al procesar el archivo </span><span class="si">{</span><span class="n">nuevo_nombre</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="c1">#pausa de teclado</span>
                    <span class="c1"># input(&quot;Presione Enter para continuar...&quot;)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Archivo procesado y guardado como: </span><span class="si">{</span><span class="n">nuevo_nombre</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">archivos_a_subir</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nuevo_path</span><span class="p">)</span>
                    <span class="c1"># Eliminar el archivo original después de procesarlo</span>
                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># Pausa de 500ms</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">archivo_path</span><span class="p">)</span>

                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Archivo original eliminado: </span><span class="si">{</span><span class="n">archivo</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="s2">&quot;WinError 2&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">):</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error al procesar el archivo </span><span class="si">{</span><span class="n">archivo</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="c1"># Agregar el archivo original a la lista de subida incluso si no se procesó</span>
                <span class="n">archivos_a_subir</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">archivo_path</span><span class="p">)</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># Pausa de 1 segundo entre archivos</span>

    <span class="n">etl_to_folder_url</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;cede_Docentes&quot;</span><span class="p">:</span><span class="s1">&#39;Documentos compartidos/01.Q10/01.Educacion_Tecnica/01.Docentes&#39;</span><span class="p">,</span>
        <span class="s2">&quot;cede_Diseño_Curricular&quot;</span><span class="p">:</span><span class="s1">&#39;Documentos compartidos/01.Q10/01.Educacion_Tecnica/02.Disenio_Curricular&#39;</span><span class="p">,</span>
        <span class="s2">&quot;cede_Listado_Matriculas&quot;</span><span class="p">:</span><span class="s1">&#39;Documentos compartidos/01.Q10/01.Educacion_Tecnica/03.Listado_Matriculas&#39;</span><span class="p">,</span>
        <span class="s2">&quot;cede_Ingresos&quot;</span><span class="p">:</span><span class="s1">&#39;Documentos compartidos/01.Q10/01.Educacion_Tecnica/04.Ingresos&#39;</span><span class="p">,</span>
        <span class="s2">&quot;cede_Historico_Notas&quot;</span><span class="p">:</span><span class="s1">&#39;Documentos compartidos/01.Q10/01.Educacion_Tecnica/05.Historico_Notas&#39;</span><span class="p">,</span>
        <span class="s2">&quot;cede_Egresados_Graduados&quot;</span><span class="p">:</span><span class="s1">&#39;Documentos compartidos/01.Q10/01.Educacion_Tecnica/06.Egresados_Graduados&#39;</span><span class="p">,</span>
        <span class="s2">&quot;cede_Cancelados_Desertores&quot;</span><span class="p">:</span><span class="s1">&#39;Documentos compartidos/01.Q10/01.Educacion_Tecnica/07.Cancelados_Desertores&#39;</span><span class="p">,</span>
        <span class="s2">&quot;emp_Docentes&quot;</span><span class="p">:</span><span class="s1">&#39;Documentos compartidos/01.Q10/02.Educacion_Continua/01.Docentes&#39;</span><span class="p">,</span>
        <span class="s2">&quot;emp_Preinscritos&quot;</span><span class="p">:</span><span class="s1">&#39;Documentos compartidos/01.Q10/02.Educacion_Continua/02.Preinscritos&#39;</span><span class="p">,</span>
        <span class="s2">&quot;emp_Listado_Matriculas&quot;</span><span class="p">:</span><span class="s1">&#39;Documentos compartidos/01.Q10/02.Educacion_Continua/03.Listado_Matriculas&#39;</span><span class="p">,</span>
        <span class="s2">&quot;emp_Consolidado_inasistencias&quot;</span><span class="p">:</span><span class="s1">&#39;Documentos compartidos/01.Q10/02.Educacion_Continua/04.Consolidado_inasistencias&#39;</span><span class="p">,</span>
        <span class="s2">&quot;emp_Estudiantes_inasistencias&quot;</span><span class="p">:</span><span class="s1">&#39;Documentos compartidos/01.Q10/02.Educacion_Continua/05.Estudiantes_cancelados_por_inasistencias&#39;</span><span class="p">,</span>
        <span class="s2">&quot;emp_Egresados_Graduados&quot;</span><span class="p">:</span><span class="s1">&#39;Documentos compartidos/01.Q10/02.Educacion_Continua/06.Egresados_Graduados&#39;</span><span class="p">,</span>
        <span class="s2">&quot;C4C&quot;</span><span class="p">:</span><span class="s1">&#39;Documentos compartidos/02.C4C&#39;</span>   
        <span class="p">}</span>

    <span class="n">folder_url</span> <span class="o">=</span> <span class="n">etl_to_folder_url</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">etl</span><span class="p">,</span> <span class="s2">&quot;URL por defecto si no se encuentra el valor de etl&quot;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">archivo</span> <span class="ow">in</span> <span class="n">archivos_a_subir</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">upload_file_to_sharepoint</span><span class="p">(</span><span class="n">file_path</span><span class="o">=</span><span class="n">archivo</span><span class="p">,</span> <span class="n">folder_url</span><span class="o">=</span><span class="n">folder_url</span><span class="p">)</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># Esperar 1 segundo </span>
            <span class="c1">#pausa de teclado</span>
            <span class="c1"># input(&quot;Presione Enter para continuar...&quot;)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Archivo subido a SharePoint: </span><span class="si">{</span><span class="n">archivo</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">archivo</span><span class="p">)</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># Esperar 1 segundo </span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^[a-f0-9]</span><span class="si">{32}</span><span class="s1">\.xlsx$&#39;</span><span class="p">,</span> <span class="n">archivo</span><span class="p">):</span>
                <span class="c1"># Archivo codificado, no hacer logging</span>
                <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>        
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;--Archivo </span><span class="si">{</span><span class="n">archivo</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
<h2 id="funcion-seleccionar_opcion_con_js">Función <code>seleccionar_opcion_con_js</code><a class="headerlink" href="#funcion-seleccionar_opcion_con_js" title="Permanent link">&para;</a></h2>
<h4 id="proposito_7"><strong>Propósito</strong><a class="headerlink" href="#proposito_7" title="Permanent link">&para;</a></h4>
<p>Selecciona una opción en un menú desplegable (dropdown) utilizando JavaScript, lo que permite forzar la interacción en casos donde los métodos estándar de Selenium pueden fallar.</p>
<hr />
<h4 id="entradas_7"><strong>Entradas</strong><a class="headerlink" href="#entradas_7" title="Permanent link">&para;</a></h4>
<ul>
<li><strong><code>driver</code> (WebDriver):</strong> Instancia del controlador de Selenium para manejar el navegador.</li>
<li><strong><code>xpath_dropdown</code> (str):</strong> XPath del botón del dropdown que se desea abrir.</li>
<li><strong><code>opcion</code> (str):</strong> Texto exacto de la opción que se desea seleccionar en el menú desplegable.</li>
</ul>
<hr />
<h4 id="funcionamiento_5"><strong>Funcionamiento</strong><a class="headerlink" href="#funcionamiento_5" title="Permanent link">&para;</a></h4>
<ol>
<li>
<p><strong>Abrir el dropdown:</strong></p>
<ul>
<li>Localiza el elemento del dropdown mediante su XPath.</li>
<li>Usa JavaScript para forzar la apertura del menú desplegable.</li>
</ul>
</li>
<li>
<p><strong>Seleccionar la opción:</strong></p>
<ul>
<li>Busca la opción deseada dentro del menú desplegable usando su texto.</li>
<li>Utiliza JavaScript para hacer clic en la opción seleccionada.</li>
</ul>
</li>
<li>
<p><strong>Manejo de tiempos:</strong></p>
<ul>
<li>Incluye pausas breves entre las acciones para asegurar que los elementos se carguen correctamente.</li>
</ul>
</li>
<li>
<p><strong>Manejo de errores:</strong></p>
<ul>
<li><strong><code>TimeoutException</code></strong>: Si el elemento tarda demasiado en cargarse.</li>
<li><strong><code>NoSuchElementException</code></strong>: Si no se encuentra la opción especificada.</li>
<li><strong><code>Exception</code></strong>: Captura cualquier otro error inesperado.</li>
</ul>
</li>
</ol>
<hr />
<h4 id="salida_6"><strong>Salida</strong><a class="headerlink" href="#salida_6" title="Permanent link">&para;</a></h4>
<ul>
<li>No retorna valores. Registra en el log el estado del proceso, incluyendo éxito o errores. </li>
</ul>
<hr />
<h4 id="consideraciones_2"><strong>Consideraciones</strong><a class="headerlink" href="#consideraciones_2" title="Permanent link">&para;</a></h4>
<ul>
<li>Es útil para casos donde los menús desplegables tienen comportamientos dinámicos que dificultan su manejo con clics estándar de Selenium.</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">seleccionar_opcion_con_js</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="n">xpath_dropdown</span><span class="p">,</span> <span class="n">opcion</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Selecciona una opción en un dropdown utilizando JavaScript para forzar el cambio.</span>

<span class="sd">    Args:</span>
<span class="sd">        driver: Instancia del controlador de Selenium.</span>
<span class="sd">        xpath_dropdown: XPath del botón del dropdown.</span>
<span class="sd">        opcion: Texto de la opción a seleccionar.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Encontrar el elemento dropdown</span>
        <span class="n">dropdown</span> <span class="o">=</span> <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span><span class="n">EC</span><span class="o">.</span><span class="n">presence_of_element_located</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">xpath_dropdown</span><span class="p">)))</span>

        <span class="c1"># Ejecutar JavaScript para abrir el dropdown</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Abriendo dropdown ubicado en: </span><span class="si">{</span><span class="n">xpath_dropdown</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">driver</span><span class="o">.</span><span class="n">execute_script</span><span class="p">(</span><span class="s2">&quot;arguments[0].click();&quot;</span><span class="p">,</span> <span class="n">dropdown</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># Breve pausa para permitir que el dropdown se abra</span>

        <span class="c1"># Localizar la opción deseada en el menú desplegable</span>
        <span class="n">opcion_xpath</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;//ul[contains(@class, &#39;dropdown-menu&#39;)]//span[text()=&#39;</span><span class="si">{</span><span class="n">opcion</span><span class="si">}</span><span class="s2">&#39;]&quot;</span>
        <span class="n">opcion_elemento</span> <span class="o">=</span> <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span>
            <span class="n">EC</span><span class="o">.</span><span class="n">presence_of_element_located</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">opcion_xpath</span><span class="p">))</span>
        <span class="p">)</span>

        <span class="c1"># Ejecutar JavaScript para hacer clic en la opción</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Seleccionando opción: </span><span class="si">{</span><span class="n">opcion</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">driver</span><span class="o">.</span><span class="n">execute_script</span><span class="p">(</span><span class="s2">&quot;arguments[0].click();&quot;</span><span class="p">,</span> <span class="n">opcion_elemento</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>  <span class="c1"># Breve pausa para permitir que la opción se seleccione</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Opción &#39;</span><span class="si">{</span><span class="n">opcion</span><span class="si">}</span><span class="s2">&#39; seleccionada correctamente.&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">TimeoutException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Timeout al intentar seleccionar la opción &#39;</span><span class="si">{</span><span class="n">opcion</span><span class="si">}</span><span class="s2">&#39; en el dropdown: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">NoSuchElementException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No se encontró la opción &#39;</span><span class="si">{</span><span class="n">opcion</span><span class="si">}</span><span class="s2">&#39; en el dropdown: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error al seleccionar la opción &#39;</span><span class="si">{</span><span class="n">opcion</span><span class="si">}</span><span class="s2">&#39;: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
<h2 id="funcion-configurar_pasos_autenticacion_des_empresarial">Función <code>configurar_pasos_autenticacion_des_empresarial</code><a class="headerlink" href="#funcion-configurar_pasos_autenticacion_des_empresarial" title="Permanent link">&para;</a></h2>
<p>Configura y devuelve una lista de pasos necesarios para autenticar al usuario en el sistema de Desarrollo Empresarial. </p>
<p><strong>Funcionamiento:</strong></p>
<ol>
<li><strong>Obtención de credenciales:</strong> Recupera la URL, el nombre de usuario y la contraseña mediante la función <code>credenciales</code>.</li>
<li><strong>Definición de pasos:</strong><ul>
<li>Cada paso está representado como una tupla con:<ul>
<li><strong>Nombre del paso</strong>: Identificador descriptivo del paso.</li>
<li><strong>Función decorada</strong>: Acción específica asociada al paso, como abrir la página de inicio de sesión o ingresar credenciales.</li>
<li><strong>Parámetros</strong>: Diccionario con los argumentos requeridos por cada función.</li>
</ul>
</li>
</ul>
</li>
<li><strong>Devolución:</strong> Retorna una lista con los pasos configurados, lista para ejecutarse en un flujo de autenticación.</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">configurar_pasos_autenticacion_des_empresarial</span><span class="p">(</span><span class="n">driver</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Configura y devuelve los pasos de autenticación para acceder al sistema.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Configuración de credenciales y URL de autenticación</span>
    <span class="n">url</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">password</span> <span class="o">=</span> <span class="n">credenciales</span><span class="p">(</span><span class="s2">&quot;desarrollo_empresarial&quot;</span><span class="p">)</span>
    <span class="n">pasos_autenticacion</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="s2">&quot;abrir_pagina&quot;</span><span class="p">,</span> 
            <span class="n">log_step_decorator</span><span class="p">(</span><span class="s2">&quot;abrir_pagina&quot;</span><span class="p">)(</span><span class="n">open_login_page</span><span class="p">),</span> 
            <span class="p">{</span>
                <span class="s1">&#39;driver&#39;</span><span class="p">:</span> <span class="n">driver</span><span class="p">,</span>
                <span class="s1">&#39;url&#39;</span><span class="p">:</span> <span class="n">url</span><span class="p">,</span>
                <span class="s1">&#39;wait_time&#39;</span><span class="p">:</span> <span class="mi">10</span>
            <span class="p">}</span>
        <span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;ingresar_credenciales&quot;</span><span class="p">,</span> 
            <span class="n">log_step_decorator</span><span class="p">(</span><span class="s2">&quot;ingresar_credenciales&quot;</span><span class="p">)(</span><span class="n">enter_credentials</span><span class="p">),</span> 
            <span class="p">{</span>
                <span class="s1">&#39;driver&#39;</span><span class="p">:</span> <span class="n">driver</span><span class="p">,</span>
                <span class="s1">&#39;username&#39;</span><span class="p">:</span> <span class="n">username</span><span class="p">,</span>
                <span class="s1">&#39;password&#39;</span><span class="p">:</span> <span class="n">password</span><span class="p">,</span>
                <span class="s1">&#39;wait_time&#39;</span><span class="p">:</span> <span class="mi">10</span>
            <span class="p">}</span>
        <span class="p">)</span>
    <span class="p">]</span>
    <span class="k">return</span> <span class="n">pasos_autenticacion</span>
</code></pre></div>
<h2 id="funcion-configurar_pasos_autenticacion_cedesarrollo">Función <code>configurar_pasos_autenticacion_cedesarrollo</code><a class="headerlink" href="#funcion-configurar_pasos_autenticacion_cedesarrollo" title="Permanent link">&para;</a></h2>
<p>Configura y devuelve los pasos necesarios para autenticar al usuario en el sistema de Cedesarrollo.</p>
<p><strong>Funcionamiento:</strong></p>
<ol>
<li><strong>Obtención de credenciales:</strong> Recupera la URL, el nombre de usuario y la contraseña utilizando la función <code>credenciales</code> con el identificador <code>"cedesarrollo"</code>.</li>
<li><strong>Definición de pasos:</strong> <ul>
<li><strong>Abrir página:</strong> Usa <code>open_login_page</code> para cargar la URL del sistema.</li>
<li><strong>Ingresar credenciales:</strong> Utiliza <code>enter_credentials</code> para completar los campos de inicio de sesión con el nombre de usuario y la contraseña.</li>
<li>Cada paso incluye su nombre, la función asociada decorada con <code>log_step_decorator</code>, y los parámetros requeridos.</li>
</ul>
</li>
<li><strong>Registro de información:</strong> Registra la URL utilizada en el log.</li>
<li><strong>Salida:</strong> Devuelve una lista de pasos configurados para ejecutar el flujo de autenticación.</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">configurar_pasos_autenticacion_cedesarrollo</span><span class="p">(</span><span class="n">driver</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Configura y devuelve los pasos de autenticación para acceder al sistema.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Configuración de credenciales y URL de autenticación</span>
    <span class="n">url</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">password</span> <span class="o">=</span> <span class="n">credenciales</span><span class="p">(</span><span class="s2">&quot;cedesarrollo&quot;</span><span class="p">)</span>
    <span class="c1"># url = f&quot;https://site.q10.com/login?ReturnUrl=%2F&amp;aplentId=8fa60f3a-1a89-4048-a798-afd5cda72549&quot;</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;URL: </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">pasos_autenticacion</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="s2">&quot;abrir_pagina&quot;</span><span class="p">,</span> 
            <span class="n">log_step_decorator</span><span class="p">(</span><span class="s2">&quot;abrir_pagina&quot;</span><span class="p">)(</span><span class="n">open_login_page</span><span class="p">),</span> 
            <span class="p">{</span>
                <span class="s1">&#39;driver&#39;</span><span class="p">:</span> <span class="n">driver</span><span class="p">,</span>
                <span class="s1">&#39;url&#39;</span><span class="p">:</span> <span class="n">url</span><span class="p">,</span>
                <span class="s1">&#39;wait_time&#39;</span><span class="p">:</span> <span class="mi">10</span>
            <span class="p">}</span>
        <span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;ingresar_credenciales&quot;</span><span class="p">,</span> 
            <span class="n">log_step_decorator</span><span class="p">(</span><span class="s2">&quot;ingresar_credenciales&quot;</span><span class="p">)(</span><span class="n">enter_credentials</span><span class="p">),</span> 
            <span class="p">{</span>
                <span class="s1">&#39;driver&#39;</span><span class="p">:</span> <span class="n">driver</span><span class="p">,</span>
                <span class="s1">&#39;username&#39;</span><span class="p">:</span> <span class="n">username</span><span class="p">,</span>
                <span class="s1">&#39;password&#39;</span><span class="p">:</span> <span class="n">password</span><span class="p">,</span>
                <span class="s1">&#39;wait_time&#39;</span><span class="p">:</span> <span class="mi">10</span>
            <span class="p">}</span>
        <span class="p">)</span>
    <span class="p">]</span>
    <span class="k">return</span> <span class="n">pasos_autenticacion</span>
</code></pre></div>
<p><code>esperar_y_renombrar_archivo</code> monitorea un directorio de descargas para detectar la aparición de un nuevo archivo, esperando hasta 10 segundos, y lo renombra con un nombre base especificado.</p>
<p><strong>Funcionamiento:</strong></p>
<ol>
<li><strong>Detección de nuevos archivos:</strong>
    -Obtiene la lista de archivos antes y después de la espera.
    -Identifica los archivos nuevos comparando ambas listas.</li>
<li><strong>Renombrar archivo:</strong>
    -Si se encuentra un archivo nuevo, selecciona el más reciente según la fecha de creación.
    -Renombra el archivo con el nombre base y extensión proporcionados.</li>
<li><strong>Manejo de tiempos:</strong>
    -Espera hasta 10 segundos, verificando cada segundo si hay un archivo nuevo.</li>
<li><strong>Resultados:</strong>
    -Devuelve <code>True</code> si el archivo fue renombrado exitosamente.
    -Devuelve <code>False</code> si no se encuentra un nuevo archivo dentro del tiempo límite.</li>
</ol>
<p><strong>Entradas:</strong>
- <code>download_dir</code> (str): Ruta al directorio donde se espera el archivo.
- <code>archivo</code> (str): Nombre base del archivo para renombrar.</p>
<p><strong>Salida:</strong>
- <strong><code>bool</code>:</strong> Indica si el renombrado fue exitoso (<code>True</code>) o no (<code>False</code>).</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">esperar_y_renombrar_archivo</span><span class="p">(</span><span class="n">download_dir</span><span class="p">,</span> <span class="n">archivo</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Espera a que un archivo nuevo aparezca en el directorio de descargas y lo renombra.</span>

<span class="sd">    Args:</span>
<span class="sd">        download_dir (str): Directorio de descargas.</span>
<span class="sd">        archivo (str): Nombre base del archivo.</span>
<span class="sd">        opcion (str): Opción para renombrar el archivo.</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: True si el archivo fue renombrado exitosamente, False en caso contrario.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">archivos_antes</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">download_dir</span><span class="p">))</span>

    <span class="c1"># Esperar a que un archivo nuevo aparezca en el directorio</span>
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
        <span class="n">archivos_despues</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">download_dir</span><span class="p">))</span>
        <span class="n">archivos_nuevos</span> <span class="o">=</span> <span class="n">archivos_despues</span> <span class="o">-</span> <span class="n">archivos_antes</span>  <span class="c1"># Detectar nuevos archivos</span>
        <span class="k">if</span> <span class="n">archivos_nuevos</span><span class="p">:</span>
            <span class="c1"># Obtener el archivo nuevo más reciente</span>
            <span class="n">latest_file</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">archivos_nuevos</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">f</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getctime</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">download_dir</span><span class="p">,</span> <span class="n">f</span><span class="p">)))</span>
            <span class="n">latest_file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">download_dir</span><span class="p">,</span> <span class="n">latest_file</span><span class="p">)</span>

            <span class="c1"># Renombrar el archivo descargado</span>
            <span class="n">base_name</span><span class="p">,</span> <span class="n">extension</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">archivo</span><span class="p">)</span>
            <span class="n">new_file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">download_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">base_name</span><span class="si">}{</span><span class="n">extension</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">os</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">latest_file_path</span><span class="p">,</span> <span class="n">new_file_path</span><span class="p">)</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Archivo renombrado a: </span><span class="si">{</span><span class="n">new_file_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Esperando que la descarga se complete...&quot;</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;No se encontró un archivo nuevo en el tiempo esperado.&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">False</span>
</code></pre></div>
<p><code>elemento_disponible</code> verifica si un elemento en el DOM es clickeable dentro de un tiempo de espera especificado. Recibe como argumentos el controlador de Selenium (<code>driver</code>), el tipo de localizador (<code>by</code>), el valor del localizador (<code>value</code>), y un tiempo máximo de espera (<code>timeout</code>). Retorna el elemento web si está disponible, o <code>None</code> en caso de que no sea clickeable en el tiempo especificado, registrando una advertencia en el log.</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">elemento_disponible</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="n">by</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Verifica si un elemento está presente y es clickeable en el DOM dentro del tiempo especificado.</span>

<span class="sd">    Args:</span>
<span class="sd">        driver: Instancia del controlador de Selenium.</span>
<span class="sd">        by: Tipo de localización (By.ID, By.XPATH, etc.).</span>
<span class="sd">        value: Valor del localizador.</span>
<span class="sd">        timeout: Tiempo máximo de espera (en segundos).</span>

<span class="sd">    Returns:</span>
<span class="sd">        WebElement si el elemento está disponible, None en caso contrario.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="n">timeout</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span><span class="n">EC</span><span class="o">.</span><span class="n">element_to_be_clickable</span><span class="p">((</span><span class="n">by</span><span class="p">,</span> <span class="n">value</span><span class="p">)))</span>
    <span class="k">except</span> <span class="n">TimeoutException</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Elemento no disponible: </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>
</code></pre></div>
<h2 id="funcion-procesar_reporte_modal">Función <code>procesar_reporte_modal</code><a class="headerlink" href="#funcion-procesar_reporte_modal" title="Permanent link">&para;</a></h2>
<h4 id="proposito_8"><strong>Propósito</strong><a class="headerlink" href="#proposito_8" title="Permanent link">&para;</a></h4>
<p>Gestiona la exportación de un reporte desde un modal con un <code>iframe</code>, descargando el archivo en formato <code>XLSX</code>, verificando su aparición en el directorio de descargas y renombrándolo con un nombre específico.</p>
<hr />
<h4 id="entradas_8"><strong>Entradas</strong><a class="headerlink" href="#entradas_8" title="Permanent link">&para;</a></h4>
<ul>
<li><strong><code>driver</code> (WebDriver):</strong> Instancia del controlador Selenium.</li>
<li><strong><code>download_dir</code> (str):</strong> Ruta del directorio de descargas donde se guardará el archivo.</li>
<li><strong><code>archivo</code> (str):</strong> Nombre con el que se renombrará el archivo descargado.</li>
</ul>
<hr />
<h4 id="funcionamiento_6"><strong>Funcionamiento</strong><a class="headerlink" href="#funcionamiento_6" title="Permanent link">&para;</a></h4>
<ol>
<li>
<p><strong>Acceso al modal:</strong></p>
<ul>
<li>Espera a que el modal sea visible y cambia al contexto del <code>iframe</code>.</li>
</ul>
</li>
<li>
<p><strong>Interacción con el menú de exportación:</strong></p>
<ul>
<li>Hace clic en el elemento <code>exportSelect</code>.</li>
<li>Intenta seleccionar la opción <code>XLSX</code>:</li>
<li>Navega mediante teclas (flechas y Enter).</li>
<li>Alternativamente, utiliza JavaScript para forzar la selección.</li>
</ul>
</li>
<li>
<p><strong>Gestión del archivo descargado:</strong></p>
<ul>
<li>Verifica la aparición de nuevos archivos en el directorio de descargas.</li>
<li>Renombra el archivo más reciente al nombre especificado (<code>archivo</code>).</li>
</ul>
</li>
<li>
<p><strong>Manejo de errores:</strong></p>
<ul>
<li>Captura excepciones relacionadas con tiempo de espera o problemas al interactuar con elementos.</li>
<li>Intenta cerrar el modal si ocurre un error.</li>
</ul>
</li>
<li>
<p><strong>Finalización:</strong></p>
<ul>
<li>Cierra el modal y regresa al contexto principal del navegador.</li>
</ul>
</li>
</ol>
<hr />
<h4 id="salida_7"><strong>Salida</strong><a class="headerlink" href="#salida_7" title="Permanent link">&para;</a></h4>
<ul>
<li>No retorna valores. Registra eventos y errores en el log.</li>
</ul>
<hr />
<h4 id="manejo-de-errores_2"><strong>Manejo de errores</strong><a class="headerlink" href="#manejo-de-errores_2" title="Permanent link">&para;</a></h4>
<ul>
<li><strong><code>TimeoutException</code>:</strong> Si un elemento no está disponible dentro del tiempo límite.</li>
<li><strong><code>Exception</code>:</strong> Captura otros errores inesperados e intenta cerrar el modal.</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">procesar_reporte_modal</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="n">download_dir</span><span class="p">,</span> <span class="n">archivo</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Esperar hasta que el modal esté visible</span>
        <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span><span class="n">EC</span><span class="o">.</span><span class="n">visibility_of_element_located</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">ID</span><span class="p">,</span> <span class="s2">&quot;master-modal&quot;</span><span class="p">)))</span>

        <span class="c1"># Cambiar al contexto del `iframe` dentro del modal</span>
        <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span><span class="n">EC</span><span class="o">.</span><span class="n">frame_to_be_available_and_switch_to_it</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">ID</span><span class="p">,</span> <span class="s2">&quot;report&quot;</span><span class="p">)))</span>

        <span class="c1"># Esperar hasta que el elemento &#39;exportSelect&#39; esté visible y hacer clic en él</span>
        <span class="n">export_select</span> <span class="o">=</span> <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span><span class="n">EC</span><span class="o">.</span><span class="n">element_to_be_clickable</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">ID</span><span class="p">,</span> <span class="s2">&quot;exportSelect&quot;</span><span class="p">)))</span>
        <span class="n">export_select</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Elemento exportSelect clickeado exitosamente.&quot;</span><span class="p">)</span>

        <span class="c1"># Espera adicional para que el menú de exportación se despliegue</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

        <span class="c1"># Intento 1: Navegar con teclas para seleccionar XLSX</span>
        <span class="n">export_select</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">Keys</span><span class="o">.</span><span class="n">ARROW_DOWN</span><span class="p">)</span>  <span class="c1"># Baja una vez en el menú</span>
        <span class="n">export_select</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">Keys</span><span class="o">.</span><span class="n">ARROW_DOWN</span><span class="p">)</span>  <span class="c1"># Baja dos veces (ajustar según sea necesario)</span>
        <span class="n">export_select</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">Keys</span><span class="o">.</span><span class="n">ENTER</span><span class="p">)</span>  <span class="c1"># Seleccionar</span>

        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Intento de seleccionar XLSX usando teclas.&quot;</span><span class="p">)</span>

        <span class="c1"># Esperar unos segundos para que el efecto del clic se procese</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

        <span class="c1"># Intento 2: Forzar clic en la opción &#39;XLSX&#39; mediante JavaScript</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">xlsx_option_js</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="s2">&quot;//li[text()=&#39;XLSX&#39;]&quot;</span><span class="p">)</span>
            <span class="n">driver</span><span class="o">.</span><span class="n">execute_script</span><span class="p">(</span><span class="s2">&quot;arguments[0].click();&quot;</span><span class="p">,</span> <span class="n">xlsx_option_js</span><span class="p">)</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Opción XLSX seleccionada exitosamente mediante JavaScript.&quot;</span><span class="p">)</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>


            <span class="c1"># Espera adicional para asegurar el procesamiento del cierre</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

            <span class="n">export_select</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">Keys</span><span class="o">.</span><span class="n">ESCAPE</span><span class="p">)</span>  <span class="c1"># Baja una vez en el menú</span>


        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No se pudo seleccionar la opción XLSX con JavaScript:&quot;</span><span class="p">)</span>

        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

        <span class="c1"># Verificar y renombrar el archivo</span>
        <span class="n">archivos_antes</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">download_dir</span><span class="p">))</span>

        <span class="c1">#eliminar archivo anterior</span>
        <span class="c1"># Eliminar solo el archivo específico si existe</span>
        <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">download_dir</span><span class="p">,</span> <span class="n">archivo</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">file_path</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Archivo </span><span class="si">{</span><span class="n">archivo</span><span class="si">}</span><span class="s2"> eliminado correctamente&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>  <span class="c1"># Reducir el tiempo de espera a máximo 5 segundos</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># Intervalos más cortos</span>
            <span class="n">archivos_despues</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">download_dir</span><span class="p">))</span>
            <span class="n">archivos_nuevos</span> <span class="o">=</span> <span class="n">archivos_despues</span> <span class="o">-</span> <span class="n">archivos_antes</span>

            <span class="k">if</span> <span class="n">archivos_nuevos</span><span class="p">:</span>
                <span class="c1"># Detectar el archivo más reciente</span>
                <span class="n">latest_file</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span>
                    <span class="n">archivos_nuevos</span><span class="p">,</span>
                    <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">f</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getctime</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">download_dir</span><span class="p">,</span> <span class="n">f</span><span class="p">))</span>
                <span class="p">)</span>
                <span class="n">latest_file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">download_dir</span><span class="p">,</span> <span class="n">latest_file</span><span class="p">)</span>

                <span class="c1"># Renombrar el archivo descargado</span>
                <span class="n">base_name</span><span class="p">,</span> <span class="n">extension</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">archivo</span><span class="p">)</span>
                <span class="n">new_file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">download_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">base_name</span><span class="si">}{</span><span class="n">extension</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="s2">&quot;.xlsx&quot;</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

                <span class="n">os</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">latest_file_path</span><span class="p">,</span> <span class="n">new_file_path</span><span class="p">)</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Archivo renombrado a: </span><span class="si">{</span><span class="n">new_file_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">break</span> <span class="c1"># Salir del bucle si se renombró correctamente</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;No se detectó un nuevo archivo en el tiempo límite.&quot;</span><span class="p">)</span>        
        <span class="c1"># Espera adicional para asegurar el procesamiento de la selección</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">TimeoutException</span> <span class="k">as</span> <span class="n">te</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Tiempo de espera excedido al procesar el reporte: </span><span class="si">{</span><span class="n">te</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error al procesar el reporte en el iframe: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="c1"># Esperar hasta que el elemento &#39;exportSelect&#39; esté visible y hacer clic en él</span>
        <span class="n">export_select</span> <span class="o">=</span> <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span><span class="n">EC</span><span class="o">.</span><span class="n">element_to_be_clickable</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">ID</span><span class="p">,</span> <span class="s2">&quot;close&quot;</span><span class="p">)))</span>
        <span class="n">export_select</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="c1"># Esperar hasta que el elemento &#39;exportSelect&#39; esté visible y hacer clic en él</span>
        <span class="n">export_select</span> <span class="o">=</span> <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span><span class="n">EC</span><span class="o">.</span><span class="n">element_to_be_clickable</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">ID</span><span class="p">,</span> <span class="s2">&quot;close&quot;</span><span class="p">)))</span>
        <span class="n">export_select</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
        <span class="c1"># Regresar al contexto principal si necesitas realizar más acciones fuera del iframe</span>
        <span class="n">driver</span><span class="o">.</span><span class="n">switch_to</span><span class="o">.</span><span class="n">default_content</span><span class="p">()</span>
</code></pre></div>
<p><code>normalizar_texto</code> elimina tildes y caracteres especiales de un texto dado. Utiliza <code>unicodedata.normalize</code> para convertir caracteres Unicode a una representación compatible con ASCII, eliminando acentos y caracteres no estándar. Retorna el texto normalizado.</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">normalizar_texto</span><span class="p">(</span><span class="n">texto</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Normaliza un texto eliminando tildes y caracteres especiales.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">unicodedata</span><span class="o">.</span><span class="n">normalize</span><span class="p">(</span><span class="s1">&#39;NFKD&#39;</span><span class="p">,</span> <span class="n">texto</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;ASCII&#39;</span><span class="p">,</span> <span class="s1">&#39;ignore&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;ASCII&#39;</span><span class="p">)</span>
</code></pre></div>
<p><code>ejecutar_pasos</code> ejecuta de forma secuencial una lista de pasos definidos. Cada paso es una tupla que contiene el nombre del paso (<code>step_name</code>), la función a ejecutar (<code>step_function</code>), y un diccionario de parámetros (<code>params</code>). Registra el nombre de cada paso antes de ejecutarlo y llama a la función correspondiente con los parámetros proporcionados.</p>
<div class="highlight"><pre><span></span><code><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        # Ejecutar cada uno de los pasos definidos en el diccionario</span>
<span class="sd">        for step_name, step_function, params in step_1:</span>
<span class="sd">            logging.info(f&quot;Ejecutando el paso: {step_name}&quot;)</span>
<span class="sd">            step_function(**params)</span>

<span class="sd">&quot;&quot;&quot;</span>
        <span class="c1"># Ejecutar cada uno de los pasos definidos en el diccionario</span>
<span class="k">def</span><span class="w"> </span><span class="nf">ejecutar_pasos</span><span class="p">(</span><span class="n">pasos</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">step_name</span><span class="p">,</span> <span class="n">step_function</span><span class="p">,</span> <span class="n">params</span> <span class="ow">in</span> <span class="n">pasos</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Ejecutando el paso: </span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">step_function</span><span class="p">(</span><span class="o">**</span><span class="n">params</span><span class="p">)</span>
</code></pre></div>
<h2 id="funcion-procesar_opciones_descarga">Función <code>procesar_opciones_descarga</code><a class="headerlink" href="#funcion-procesar_opciones_descarga" title="Permanent link">&para;</a></h2>
<h4 id="proposito_9"><strong>Propósito</strong><a class="headerlink" href="#proposito_9" title="Permanent link">&para;</a></h4>
<p>Automatiza la selección de opciones en un menú desplegable (dropdown), descarga los archivos correspondientes y los renombra con base en las opciones seleccionadas.</p>
<hr />
<h4 id="entradas_9"><strong>Entradas</strong><a class="headerlink" href="#entradas_9" title="Permanent link">&para;</a></h4>
<ul>
<li><strong><code>driver</code> (WebDriver):</strong> Controlador de Selenium para manejar el navegador.</li>
<li><strong><code>opciones</code> (list):</strong> Lista de opciones del dropdown.</li>
<li><strong><code>xpath_boton</code> (str):</strong> XPath del botón para abrir el dropdown.</li>
<li><strong><code>id_descargar</code> (str):</strong> ID del botón de descarga.</li>
<li><strong><code>nombre_archivo</code> (str):</strong> Nombre base del archivo para el renombrado.</li>
<li><strong><code>nombre_archivo_completo</code> (str):</strong> Nombre completo del archivo descargado.</li>
<li><strong><code>download_dir</code> (str):</strong> Directorio donde se guardan las descargas.</li>
<li><strong><code>wait_time</code> (int):</strong> Tiempo de espera después de cada acción (por defecto 2 segundos).</li>
<li><strong><code>xpath_omitir</code> (str, opcional):</strong> XPath para omitir popups opcionales.</li>
</ul>
<hr />
<h4 id="funcionamiento_7"><strong>Funcionamiento</strong><a class="headerlink" href="#funcionamiento_7" title="Permanent link">&para;</a></h4>
<ol>
<li>
<p><strong>Preparación inicial:</strong></p>
<ul>
<li>Llama a <code>eliminar_archivos_anteriores</code> para limpiar descargas previas en el directorio.</li>
</ul>
</li>
<li>
<p><strong>Interacción con el dropdown:</strong></p>
<ul>
<li>Hace clic en el botón del dropdown para abrirlo.</li>
<li>Itera sobre las opciones de la lista:</li>
<li>Selecciona una opción usando <code>seleccionar_opcion_custom_dropdown</code>.</li>
</ul>
</li>
<li>
<p><strong>Descarga de archivos:</strong></p>
<ul>
<li>Para cada opción seleccionada:</li>
<li>Si el tipo es <code>"modal"</code>, procesa la descarga mediante <code>procesar_reporte_modal</code>.</li>
<li>En otros casos, utiliza <code>cola_descargar</code> para manejar la descarga y verificarla.</li>
</ul>
</li>
</ol>
<hr />
<h4 id="salida_8"><strong>Salida</strong><a class="headerlink" href="#salida_8" title="Permanent link">&para;</a></h4>
<ul>
<li>No retorna valores. Realiza acciones relacionadas con selección, descarga y renombrado de archivos.</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">procesar_opciones_descarga</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="n">opciones</span><span class="p">,</span> <span class="n">xpath_boton</span><span class="p">,</span> <span class="n">id_descargar</span><span class="p">,</span> <span class="n">nombre_archivo</span><span class="p">,</span> <span class="n">tipo</span><span class="p">,</span> <span class="n">nombre_archivo_completo</span><span class="p">,</span> <span class="n">download_dir</span><span class="p">,</span> <span class="n">wait_time</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">xpath_omitir</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Itera sobre las opciones de un dropdown, selecciona cada opción, descarga el archivo</span>
<span class="sd">    y renombra el archivo descargado con la opción seleccionada.</span>

<span class="sd">    Args:</span>
<span class="sd">        driver (WebDriver): El controlador de Selenium.</span>
<span class="sd">        opciones (list): Lista de opciones del dropdown.</span>
<span class="sd">        xpath_boton (str): XPath del botón para abrir el dropdown.</span>
<span class="sd">        id_descargar (str): ID del botón de descarga.</span>
<span class="sd">        nombre_archivo (str): Nombre base del archivo para renombrar.</span>
<span class="sd">        nombre_archivo_completo (str): Nombre completo del archivo descargado.</span>
<span class="sd">        download_dir (str): Directorio donde se guardan las descargas.</span>
<span class="sd">        wait_time (int): Tiempo de espera después de cada acción.</span>
<span class="sd">        xpath_omitir (str): XPath opcional para omitir un popup.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Llamada a eliminar archivos anteriores usando el directorio especificado</span>
    <span class="n">eliminar_archivos_anteriores</span><span class="p">(</span><span class="n">nombre_archivo_completo</span><span class="p">,</span> <span class="n">download_dir</span><span class="o">=</span><span class="n">download_dir</span><span class="p">)</span>

    <span class="c1"># Clic en el botón de apertura del dropdown</span>
    <span class="n">hacer_clic</span><span class="p">(</span><span class="n">driver</span><span class="o">=</span><span class="n">driver</span><span class="p">,</span> <span class="n">xpath</span><span class="o">=</span><span class="n">xpath_boton</span><span class="p">,</span> <span class="n">wait_time</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

    <span class="c1"># Itera sobre las opciones para seleccionar y descargar</span>
    <span class="k">for</span> <span class="n">opcion</span> <span class="ow">in</span> <span class="n">opciones</span><span class="p">:</span>
        <span class="n">seleccionar_opcion_custom_dropdown</span><span class="p">(</span><span class="n">driver</span><span class="o">=</span><span class="n">driver</span><span class="p">,</span> <span class="n">xpath</span><span class="o">=</span><span class="n">xpath_boton</span><span class="p">,</span> <span class="n">option</span><span class="o">=</span><span class="n">opcion</span><span class="p">,</span> <span class="n">wait_time</span><span class="o">=</span><span class="n">wait_time</span><span class="p">)</span>

        <span class="c1"># Descargar el archivo</span>
        <span class="k">if</span> <span class="n">tipo</span> <span class="o">==</span> <span class="s2">&quot;modal&quot;</span><span class="p">:</span>
            <span class="n">procesar_reporte_modal</span><span class="p">(</span><span class="n">driver</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">se_descargo</span> <span class="o">=</span> <span class="n">cola_descargar</span><span class="p">(</span><span class="n">opcion</span><span class="o">=</span><span class="n">opcion</span><span class="p">,</span><span class="n">download_dir</span><span class="o">=</span> <span class="n">download_dir</span><span class="p">,</span><span class="n">driver</span><span class="o">=</span><span class="n">driver</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">id_descargar</span><span class="p">,</span> <span class="n">archivo</span><span class="o">=</span><span class="n">nombre_archivo_completo</span><span class="p">,</span> <span class="n">wait_time</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">xpath_omitir</span><span class="o">=</span><span class="n">xpath_omitir</span><span class="p">)</span>
</code></pre></div>
<h2 id="funcion-setup_driver">Función <code>setup_driver</code><a class="headerlink" href="#funcion-setup_driver" title="Permanent link">&para;</a></h2>
<h4 id="proposito_10"><strong>Propósito</strong><a class="headerlink" href="#proposito_10" title="Permanent link">&para;</a></h4>
<p>Configura un controlador de Selenium con opciones personalizadas, estableciendo un directorio específico para las descargas de archivos.</p>
<hr />
<h4 id="entradas_10"><strong>Entradas</strong><a class="headerlink" href="#entradas_10" title="Permanent link">&para;</a></h4>
<ul>
<li><strong><code>subcarpeta</code> (str):</strong> Nombre de la subcarpeta dentro del directorio de descargas base donde se guardarán los archivos (por defecto: <code>"default"</code>).</li>
</ul>
<hr />
<h4 id="funcionamiento_8"><strong>Funcionamiento</strong><a class="headerlink" href="#funcionamiento_8" title="Permanent link">&para;</a></h4>
<ol>
<li>
<p><strong>Definición del directorio de descargas:</strong></p>
<ul>
<li>Construye la ruta completa para las descargas en la subcarpeta especificada, ubicada dentro de <code>01.Q10/Procesados</code>.</li>
<li>Crea el directorio si no existe y registra su creación o existencia en el log.</li>
</ul>
</li>
<li>
<p><strong>Configuración de Chrome:</strong></p>
<ul>
<li>Define preferencias específicas para descargas:</li>
<li>Descargas automáticas sin confirmación.</li>
<li>Actualización del directorio de descargas.</li>
<li>Habilitación de la navegación segura.</li>
<li>Añade configuraciones para optimizar el navegador:</li>
<li>Maximización de ventana.</li>
<li>Deshabilitación de características innecesarias y controles automáticos.</li>
</ul>
</li>
<li>
<p><strong>Inicia el controlador de Selenium:</strong></p>
<ul>
<li>Configura un tiempo de espera para la carga de páginas (30 segundos).</li>
<li>Registra la configuración del controlador y la ruta de descargas en el log.</li>
</ul>
</li>
<li>
<p><strong>Salida:</strong></p>
<ul>
<li>Retorna la instancia del controlador <code>driver</code> y la ruta completa del directorio de descargas.</li>
</ul>
</li>
</ol>
<hr />
<h4 id="salida_9"><strong>Salida</strong><a class="headerlink" href="#salida_9" title="Permanent link">&para;</a></h4>
<ul>
<li><strong><code>driver</code> (WebDriver):</strong> Instancia configurada del controlador de Selenium.</li>
<li><strong><code>download_dir</code> (str):</strong> Ruta absoluta del directorio de descargas configurado.</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="n">DOWNLOAD_DIR</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()),</span> <span class="s2">&quot;Procesados&quot;</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">setup_driver</span><span class="p">(</span><span class="n">subcarpeta</span><span class="o">=</span><span class="s2">&quot;default&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Configura el controlador de Selenium y crea la ruta de descargas en la subcarpeta especificada.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Define la ruta completa de descarga en la subcarpeta especificada</span>
    <span class="n">base_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)))</span>  <span class="c1"># Subir un nivel desde `Codigos`</span>
    <span class="n">download_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">base_dir</span><span class="p">,</span> <span class="s2">&quot;01.Q10&quot;</span><span class="p">,</span> <span class="s2">&quot;Procesados&quot;</span><span class="p">,</span> <span class="n">subcarpeta</span><span class="p">)</span>  <span class="c1"># Ruta hacia `01.Q10\Procesados`</span>

    <span class="c1"># Crear el directorio si no existe</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">download_dir</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">download_dir</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Directorio de descargas creado en: </span><span class="si">{</span><span class="n">download_dir</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Directorio de descargas ya existe: </span><span class="si">{</span><span class="n">download_dir</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Configura las preferencias de Chrome para las descargas</span>
    <span class="n">chrome_options</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">ChromeOptions</span><span class="p">()</span>
    <span class="n">prefs</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;download.default_directory&quot;</span><span class="p">:</span> <span class="n">download_dir</span><span class="p">,</span>
        <span class="s2">&quot;download.prompt_for_download&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="s2">&quot;download.directory_upgrade&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="s2">&quot;safebrowsing.enabled&quot;</span><span class="p">:</span> <span class="kc">True</span>
    <span class="p">}</span>
    <span class="n">chrome_options</span><span class="o">.</span><span class="n">add_experimental_option</span><span class="p">(</span><span class="s2">&quot;prefs&quot;</span><span class="p">,</span> <span class="n">prefs</span><span class="p">)</span>
    <span class="n">chrome_options</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--disable-gpu&#39;</span><span class="p">)</span>
    <span class="n">chrome_options</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--no-sandbox&#39;</span><span class="p">)</span>
    <span class="n">chrome_options</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--disable-dev-shm-usage&#39;</span><span class="p">)</span>
    <span class="n">chrome_options</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--window-size=1920x1080&#39;</span><span class="p">)</span>
    <span class="n">chrome_options</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--ignore-certificate-errors&#39;</span><span class="p">)</span>
    <span class="n">chrome_options</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--disable-extensions&#39;</span><span class="p">)</span>
    <span class="n">chrome_options</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--disable-infobars&#39;</span><span class="p">)</span>
    <span class="n">chrome_options</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--start-maximized&#39;</span><span class="p">)</span>
    <span class="n">chrome_options</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--disable-blink-features=AutomationControlled&#39;</span><span class="p">)</span>

    <span class="c1"># Inicia el controlador</span>
    <span class="n">driver</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">Chrome</span><span class="p">(</span><span class="n">options</span><span class="o">=</span><span class="n">chrome_options</span><span class="p">)</span>
    <span class="n">driver</span><span class="o">.</span><span class="n">set_page_load_timeout</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Controlador de Selenium configurado con el directorio de descargas en: </span><span class="si">{</span><span class="n">download_dir</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Retorna el controlador y la ruta de descarga</span>
    <span class="k">return</span> <span class="n">driver</span><span class="p">,</span> <span class="n">download_dir</span>
</code></pre></div>
<h2 id="funcion-setup_driver_c4c">Función <code>setup_driver_C4C</code><a class="headerlink" href="#funcion-setup_driver_c4c" title="Permanent link">&para;</a></h2>
<h4 id="proposito_11"><strong>Propósito</strong><a class="headerlink" href="#proposito_11" title="Permanent link">&para;</a></h4>
<p>Configura un controlador de Selenium para automatizaciones en el entorno <strong>C4C</strong>, estableciendo un directorio específico para descargas en una subcarpeta determinada.</p>
<hr />
<h4 id="entradas_11"><strong>Entradas</strong><a class="headerlink" href="#entradas_11" title="Permanent link">&para;</a></h4>
<ul>
<li><strong><code>subcarpeta</code> (str):</strong> Nombre de la subcarpeta dentro del directorio base de descargas, donde se almacenarán los archivos (por defecto: <code>"default"</code>).</li>
</ul>
<hr />
<h4 id="funcionamiento_9"><strong>Funcionamiento</strong><a class="headerlink" href="#funcionamiento_9" title="Permanent link">&para;</a></h4>
<ol>
<li>
<p><strong>Definición del directorio de descargas:</strong></p>
<ul>
<li>Construye la ruta completa del directorio de descargas en <code>02.C4C/Procesados</code>.</li>
<li>Crea el directorio si no existe y registra el resultado en el log.</li>
</ul>
</li>
<li>
<p><strong>Configuración del navegador Chrome:</strong></p>
<ul>
<li>Define preferencias para la gestión automática de descargas:</li>
<li>Descargas sin solicitud de confirmación.</li>
<li>Navegación segura habilitada.</li>
<li>Actualización automática del directorio de descargas.</li>
<li>Configura argumentos adicionales para optimizar el rendimiento y la experiencia del navegador:</li>
<li>Maximiza la ventana y deshabilita extensiones y notificaciones innecesarias.</li>
</ul>
</li>
<li>
<p><strong>Inicia el controlador de Selenium:</strong></p>
<ul>
<li>Configura un tiempo de espera máximo para la carga de páginas (30 segundos).</li>
<li>Registra en el log la ruta de descargas y la configuración del controlador.</li>
</ul>
</li>
<li>
<p><strong>Salida:</strong></p>
<ul>
<li>Retorna el controlador <code>driver</code> y la ruta absoluta del directorio de descargas.</li>
</ul>
</li>
</ol>
<hr />
<h4 id="salida_10"><strong>Salida</strong><a class="headerlink" href="#salida_10" title="Permanent link">&para;</a></h4>
<ul>
<li><strong><code>driver</code> (WebDriver):</strong> Instancia configurada del controlador de Selenium.</li>
<li><strong><code>download_dir</code> (str):</strong> Ruta completa del directorio de descargas configurado.</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="c1"># En Funciones.py</span>
<span class="k">def</span><span class="w"> </span><span class="nf">setup_driver_C4C</span><span class="p">(</span><span class="n">subcarpeta</span><span class="o">=</span><span class="s2">&quot;default&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Configura el controlador de Selenium y crea la ruta de descargas en la subcarpeta especificada.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Define la ruta completa de descarga en la subcarpeta especificada</span>
    <span class="n">base_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)))</span>  <span class="c1"># Subir un nivel desde `Codigos`</span>
    <span class="n">download_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">base_dir</span><span class="p">,</span> <span class="s2">&quot;02.C4C&quot;</span><span class="p">,</span> <span class="s2">&quot;Procesados&quot;</span><span class="p">,</span> <span class="n">subcarpeta</span><span class="p">)</span>  <span class="c1"># Ruta hacia `01.Q10\Procesados`</span>

    <span class="c1"># Crear el directorio si no existe</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">download_dir</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">download_dir</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Directorio de descargas creado en: </span><span class="si">{</span><span class="n">download_dir</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Directorio de descargas ya existe: </span><span class="si">{</span><span class="n">download_dir</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Configura las preferencias de Chrome para las descargas</span>
    <span class="n">chrome_options</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">ChromeOptions</span><span class="p">()</span>
    <span class="n">prefs</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;download.default_directory&quot;</span><span class="p">:</span> <span class="n">download_dir</span><span class="p">,</span>
        <span class="s2">&quot;download.prompt_for_download&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="s2">&quot;download.directory_upgrade&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="s2">&quot;safebrowsing.enabled&quot;</span><span class="p">:</span> <span class="kc">True</span>
    <span class="p">}</span>
    <span class="n">chrome_options</span><span class="o">.</span><span class="n">add_experimental_option</span><span class="p">(</span><span class="s2">&quot;prefs&quot;</span><span class="p">,</span> <span class="n">prefs</span><span class="p">)</span>
    <span class="n">chrome_options</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--disable-gpu&#39;</span><span class="p">)</span>
    <span class="n">chrome_options</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--no-sandbox&#39;</span><span class="p">)</span>
    <span class="n">chrome_options</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--disable-dev-shm-usage&#39;</span><span class="p">)</span>
    <span class="n">chrome_options</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--window-size=1920x1080&#39;</span><span class="p">)</span>
    <span class="n">chrome_options</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--ignore-certificate-errors&#39;</span><span class="p">)</span>
    <span class="n">chrome_options</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--disable-extensions&#39;</span><span class="p">)</span>
    <span class="n">chrome_options</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--disable-infobars&#39;</span><span class="p">)</span>
    <span class="n">chrome_options</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--start-maximized&#39;</span><span class="p">)</span>
    <span class="n">chrome_options</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--disable-blink-features=AutomationControlled&#39;</span><span class="p">)</span>

    <span class="c1"># Inicia el controlador</span>
    <span class="n">driver</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">Chrome</span><span class="p">(</span><span class="n">options</span><span class="o">=</span><span class="n">chrome_options</span><span class="p">)</span>
    <span class="n">driver</span><span class="o">.</span><span class="n">set_page_load_timeout</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Controlador de Selenium configurado con el directorio de descargas en: </span><span class="si">{</span><span class="n">download_dir</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Retorna el controlador y la ruta de descarga</span>
    <span class="k">return</span> <span class="n">driver</span><span class="p">,</span> <span class="n">download_dir</span>
</code></pre></div>
<p><code>open_login_page</code> abre una página de inicio de sesión en un navegador controlado por Selenium y espera a que el cuerpo de la página se cargue completamente. Recibe el controlador (<code>driver</code>), la URL de la página a abrir (<code>url</code>) y un tiempo de espera opcional (<code>wait_time</code>). Registra en el log tanto el inicio como la confirmación de que la página se ha abierto correctamente.</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">open_login_page</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">wait_time</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Abriendo la página de inicio de sesión: </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span><span class="n">EC</span><span class="o">.</span><span class="n">presence_of_element_located</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">TAG_NAME</span><span class="p">,</span> <span class="s1">&#39;body&#39;</span><span class="p">)))</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Página de inicio de sesión abierta: </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
<h2 id="funcion-enter_credentials">Función <code>enter_credentials</code><a class="headerlink" href="#funcion-enter_credentials" title="Permanent link">&para;</a></h2>
<p>Automatiza el ingreso de credenciales en una página de inicio de sesión controlada por Selenium. </p>
<p><strong>Funcionamiento:</strong></p>
<ol>
<li>
<p><strong>Ingreso del nombre de usuario:</strong></p>
<ul>
<li>Espera hasta que el campo de entrada de usuario esté presente (<code>NombreUsuario</code>).</li>
<li>Ingresa el valor proporcionado en <code>username</code>.</li>
</ul>
</li>
<li>
<p><strong>Ingreso de la contraseña:</strong></p>
<ul>
<li>Espera hasta que el campo de entrada de contraseña esté presente (<code>Contrasena</code>).</li>
<li>Ingresa el valor proporcionado en <code>password</code>.</li>
</ul>
</li>
<li>
<p><strong>Manejo de errores:</strong></p>
<ul>
<li>Captura excepciones relacionadas con tiempo de espera, elementos no interactuables o referencias obsoletas, y registra el error en el log antes de lanzarlo nuevamente.</li>
</ul>
</li>
</ol>
<p><strong>Entradas:</strong></p>
<ul>
<li><strong><code>driver</code> (WebDriver):</strong> Instancia del controlador Selenium.</li>
<li><strong><code>username</code> (str):</strong> Nombre de usuario a ingresar.</li>
<li><strong><code>password</code> (str):</strong> Contraseña asociada al usuario.</li>
<li><strong><code>wait_time</code> (int, opcional):</strong> Tiempo de espera entre interacciones (por defecto, 1 segundo).</li>
</ul>
<p><strong>Salida:</strong></p>
<ul>
<li>No retorna valores. Realiza acciones y registra eventos o errores en el log.</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">enter_credentials</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">,</span> <span class="n">wait_time</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="c1"># Ingresa las credenciales de usuario en los campos correspondientes</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Ingresando usuario&quot;</span><span class="p">)</span>
        <span class="c1"># Esperar hasta que el campo de nombre de usuario esté presente y luego ingresar el nombre de usuario</span>
        <span class="n">username_field</span> <span class="o">=</span> <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span>
            <span class="n">EC</span><span class="o">.</span><span class="n">presence_of_element_located</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">NAME</span><span class="p">,</span> <span class="s1">&#39;NombreUsuario&#39;</span><span class="p">))</span>
        <span class="p">)</span>
        <span class="n">username_field</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">username</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Nombre de usuario ingresado correctamente&quot;</span><span class="p">)</span>

        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Ingresando contraseña&quot;</span><span class="p">)</span>
        <span class="c1"># Esperar hasta que el campo de contraseña esté presente y luego ingresar la contraseña</span>
        <span class="n">password_field</span> <span class="o">=</span> <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span>
            <span class="n">EC</span><span class="o">.</span><span class="n">presence_of_element_located</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">NAME</span><span class="p">,</span> <span class="s1">&#39;Contrasena&#39;</span><span class="p">))</span>
        <span class="p">)</span>
        <span class="n">password_field</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">password</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Credenciales ingresadas correctamente&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="p">(</span><span class="n">TimeoutException</span><span class="p">,</span> <span class="n">NoSuchElementException</span><span class="p">,</span> <span class="n">ElementNotInteractableException</span><span class="p">,</span> <span class="n">StaleElementReferenceException</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error durante el ingreso de credenciales: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">raise</span>
</code></pre></div>
<h2 id="funcion-submit_login">Función <code>submit_login</code><a class="headerlink" href="#funcion-submit_login" title="Permanent link">&para;</a></h2>
<p>Envía el formulario de inicio de sesión en una página web controlada por Selenium y verifica que el inicio de sesión haya sido exitoso.</p>
<p><strong>Funcionamiento:</strong></p>
<ol>
<li>
<p><strong>Interacción con el botón de inicio de sesión:</strong></p>
<ul>
<li>Espera hasta que el botón del formulario esté presente y sea clickeable (<code>//button[@type="submit"]</code>).</li>
<li>Hace clic en el botón para enviar el formulario.</li>
</ul>
</li>
<li>
<p><strong>Verificación del inicio de sesión:</strong></p>
<ul>
<li>Espera a que un elemento indicativo del post-login (<code>elemento_post_login</code>) esté presente para confirmar el éxito.</li>
</ul>
</li>
<li>
<p><strong>Manejo de errores:</strong></p>
<ul>
<li>Captura excepciones relacionadas con tiempo de espera, elementos no encontrados o no interactuables, registra el error en el log y lanza nuevamente la excepción.</li>
</ul>
</li>
</ol>
<p><strong>Entradas:</strong></p>
<ul>
<li><strong><code>driver</code> (WebDriver):</strong> Instancia del controlador Selenium.</li>
<li><strong><code>wait_time</code> (int, opcional):</strong> Tiempo de espera entre interacciones (por defecto, 3 segundos).</li>
</ul>
<p><strong>Salida:</strong></p>
<ul>
<li>No retorna valores. Realiza acciones en la página y registra en el log el estado del proceso o errores.</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">submit_login</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="n">wait_time</span><span class="o">=</span><span class="mi">3</span><span class="p">):</span>
    <span class="c1"># Envía el formulario de inicio de sesión</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Enviando formulario de inicio de sesión&quot;</span><span class="p">)</span>
        <span class="c1"># Esperar hasta que el botón de inicio de sesión esté presente y luego hacer clic</span>
        <span class="n">login_button</span> <span class="o">=</span> <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span>
            <span class="n">EC</span><span class="o">.</span><span class="n">element_to_be_clickable</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="s1">&#39;//button[@type=&quot;submit&quot;]&#39;</span><span class="p">))</span>
        <span class="p">)</span>
        <span class="n">login_button</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
        <span class="c1"># Esperar hasta que un elemento post-login esté presente para confirmar el éxito del inicio de sesión</span>
        <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span><span class="n">EC</span><span class="o">.</span><span class="n">presence_of_element_located</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">ID</span><span class="p">,</span> <span class="s1">&#39;elemento_post_login&#39;</span><span class="p">)))</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Formulario de inicio de sesión enviado&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="p">(</span><span class="n">TimeoutException</span><span class="p">,</span> <span class="n">NoSuchElementException</span><span class="p">,</span> <span class="n">ElementNotInteractableException</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error al enviar el formulario de inicio de sesión: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">raise</span>
</code></pre></div>
<h2 id="funcion-close_driver">Función <code>close_driver</code><a class="headerlink" href="#funcion-close_driver" title="Permanent link">&para;</a></h2>
<p>Cierra de manera segura el navegador controlado por Selenium.</p>
<p><strong>Funcionamiento:</strong></p>
<ol>
<li>
<p><strong>Cierre del navegador:</strong></p>
<ul>
<li>Intenta cerrar la instancia del controlador mediante <code>driver.quit()</code>.</li>
<li>Registra en el log que el navegador se cerró correctamente.</li>
</ul>
</li>
<li>
<p><strong>Manejo de errores:</strong></p>
<ul>
<li>Captura posibles excepciones (<code>WebDriverException</code>) durante el cierre y registra el error en el log.</li>
</ul>
</li>
</ol>
<p><strong>Entradas:</strong></p>
<ul>
<li><strong><code>driver</code> (WebDriver):</strong> Instancia del controlador Selenium que se desea cerrar.</li>
</ul>
<p><strong>Salida:</strong></p>
<ul>
<li>No retorna valores. Realiza la acción de cierre y registra el estado del proceso en el log.</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">close_driver</span><span class="p">(</span><span class="n">driver</span><span class="p">):</span>
    <span class="c1"># Cierra el navegador de manera segura</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Cerrando el navegador&quot;</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">driver</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Navegador cerrado correctamente&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">WebDriverException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error al cerrar el navegador: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
<h2 id="funcion-seleccionar_dropdown">Función <code>seleccionar_dropdown</code><a class="headerlink" href="#funcion-seleccionar_dropdown" title="Permanent link">&para;</a></h2>
<h4 id="proposito_12"><strong>Propósito</strong><a class="headerlink" href="#proposito_12" title="Permanent link">&para;</a></h4>
<p>Selecciona una opción de un menú desplegable (<code>dropdown</code>) en una página web controlada por Selenium, utilizando diversos identificadores de localización.</p>
<hr />
<h4 id="entradas_12"><strong>Entradas</strong><a class="headerlink" href="#entradas_12" title="Permanent link">&para;</a></h4>
<ul>
<li><strong><code>driver</code> (WebDriver):</strong> Instancia del controlador Selenium.</li>
<li><strong><code>kwargs</code> (dict):</strong> Argumentos clave para configurar la selección:</li>
<li><strong><code>option</code> (str):</strong> Texto visible de la opción a seleccionar.</li>
<li><strong><code>n_option</code> (int):</strong> Índice de la opción a seleccionar.</li>
<li><strong><code>wait_time</code> (int, opcional):</strong> Tiempo en segundos para esperar después de realizar la selección (por defecto: <code>0</code>).</li>
<li><strong>Localizadores:</strong> Uno de los siguientes:<ul>
<li><strong><code>xpath</code> (str):</strong> Localización del dropdown usando XPath.</li>
<li><strong><code>id</code> (str):</strong> Identificación del elemento.</li>
<li><strong><code>name</code> (str):</strong> Nombre del elemento.</li>
<li><strong><code>class_name</code> (str):</strong> Clase del elemento.</li>
<li><strong><code>css_selector</code> (str):</strong> Selector CSS.</li>
</ul>
</li>
</ul>
<hr />
<h4 id="funcionamiento_10"><strong>Funcionamiento</strong><a class="headerlink" href="#funcionamiento_10" title="Permanent link">&para;</a></h4>
<ol>
<li>
<p><strong>Localización del dropdown:</strong></p>
<ul>
<li>Determina el tipo de localizador (<code>id</code>, <code>xpath</code>, etc.) y su valor.</li>
<li>Encuentra el elemento correspondiente en el DOM usando <code>WebDriverWait</code>.</li>
</ul>
</li>
<li>
<p><strong>Selección de la opción:</strong></p>
<ul>
<li>Si se proporciona <code>option</code>, selecciona la opción por texto visible.</li>
<li>Si se proporciona <code>n_option</code>, selecciona la opción por índice.</li>
<li>Lanza un error si no se proporciona ninguna opción válida.</li>
</ul>
</li>
<li>
<p><strong>Espera opcional:</strong></p>
<ul>
<li>Realiza una pausa tras la selección si se especifica <code>wait_time</code>.</li>
</ul>
</li>
<li>
<p><strong>Manejo de errores:</strong></p>
<ul>
<li>Captura excepciones relacionadas con tiempo de espera, elementos no interactuables o referencias obsoletas.</li>
<li>Registra el error en el log y lanza la excepción.</li>
</ul>
</li>
</ol>
<hr />
<h4 id="salida_11"><strong>Salida</strong><a class="headerlink" href="#salida_11" title="Permanent link">&para;</a></h4>
<ul>
<li>No retorna valores. Realiza la selección en el dropdown y registra el estado del proceso en el log.</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">seleccionar_dropdown</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Seleccionando opción del dropdown especificado&quot;</span><span class="p">)</span>

        <span class="c1"># Recoger &#39;wait_time&#39; de kwargs o establecer un valor por defecto</span>
        <span class="n">wait_time</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;wait_time&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

        <span class="c1"># Recorrer las posibles opciones de identificador y localizar el elemento</span>
        <span class="n">locator_type</span><span class="p">,</span> <span class="n">locator_value</span><span class="p">,</span> <span class="n">option_value</span><span class="p">,</span> <span class="n">n_option</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;option&#39;</span><span class="p">:</span>
                <span class="n">option_value</span> <span class="o">=</span> <span class="n">value</span>
            <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;n_option&#39;</span><span class="p">:</span>
                <span class="n">n_option</span> <span class="o">=</span> <span class="n">value</span>
            <span class="k">elif</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">key</span> <span class="o">!=</span> <span class="s1">&#39;wait_time&#39;</span><span class="p">:</span>
                <span class="n">locator_type</span> <span class="o">=</span> <span class="n">key</span>
                <span class="n">locator_value</span> <span class="o">=</span> <span class="n">value</span>

        <span class="c1"># Verificar si se proporcionó un localizador válido</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">locator_type</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">locator_value</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Debe proporcionar una ubicación válida para seleccionar un dropdown&quot;</span><span class="p">)</span>

        <span class="c1"># Convertir el identificador a By adecuado</span>
        <span class="n">by_mapping</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;xpath&#39;</span><span class="p">:</span> <span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span>
            <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="n">By</span><span class="o">.</span><span class="n">ID</span><span class="p">,</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">By</span><span class="o">.</span><span class="n">NAME</span><span class="p">,</span>
            <span class="s1">&#39;class_name&#39;</span><span class="p">:</span> <span class="n">By</span><span class="o">.</span><span class="n">CLASS_NAME</span><span class="p">,</span>
            <span class="s1">&#39;css_selector&#39;</span><span class="p">:</span> <span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span>
        <span class="p">}</span>
        <span class="n">dropdown_element</span> <span class="o">=</span> <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span><span class="n">EC</span><span class="o">.</span><span class="n">presence_of_element_located</span><span class="p">((</span><span class="n">by_mapping</span><span class="p">[</span><span class="n">locator_type</span><span class="p">],</span> <span class="n">locator_value</span><span class="p">)))</span>
        <span class="n">select</span> <span class="o">=</span> <span class="n">Select</span><span class="p">(</span><span class="n">dropdown_element</span><span class="p">)</span>

        <span class="c1"># Seleccionar la opción por texto visible o por índice</span>
        <span class="k">if</span> <span class="n">option_value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">select</span><span class="o">.</span><span class="n">select_by_visible_text</span><span class="p">(</span><span class="n">option_value</span><span class="p">)</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Opción &#39;</span><span class="si">{</span><span class="n">option_value</span><span class="si">}</span><span class="s2">&#39; seleccionada correctamente en el dropdown&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">n_option</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">select</span><span class="o">.</span><span class="n">select_by_index</span><span class="p">(</span><span class="n">n_option</span><span class="p">)</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Opción en el índice &#39;</span><span class="si">{</span><span class="n">n_option</span><span class="si">}</span><span class="s2">&#39; seleccionada correctamente en el dropdown&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Debe proporcionar un valor válido para seleccionar una opción en el dropdown&quot;</span><span class="p">)</span>

        <span class="c1"># Esperar el tiempo especificado si se proporcionó</span>
        <span class="k">if</span> <span class="n">wait_time</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">wait_time</span><span class="p">)</span>

    <span class="k">except</span> <span class="p">(</span><span class="n">TimeoutException</span><span class="p">,</span> <span class="n">NoSuchElementException</span><span class="p">,</span> <span class="n">ElementNotInteractableException</span><span class="p">,</span> <span class="n">StaleElementReferenceException</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error al seleccionar la opción del dropdown: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">raise</span>
</code></pre></div>
<h2 id="funcion-hacer_clic">Función <code>hacer_clic</code><a class="headerlink" href="#funcion-hacer_clic" title="Permanent link">&para;</a></h2>
<h4 id="proposito_13"><strong>Propósito</strong><a class="headerlink" href="#proposito_13" title="Permanent link">&para;</a></h4>
<p>Localiza un elemento en una página web mediante un tipo de localizador, realiza clic en él y, opcionalmente, interactúa con un campo de entrada configurando un valor.</p>
<hr />
<h4 id="entradas_13"><strong>Entradas</strong><a class="headerlink" href="#entradas_13" title="Permanent link">&para;</a></h4>
<ul>
<li><strong><code>driver</code> (WebDriver):</strong> Instancia del controlador Selenium.</li>
<li><strong><code>kwargs</code> (dict):</strong> Argumentos clave para la operación:</li>
<li><strong>Localizadores (uno obligatorio):</strong><ul>
<li><strong><code>xpath</code> (str):</strong> Localización del elemento mediante XPath.</li>
<li><strong><code>id</code> (str):</strong> Identificación del elemento.</li>
<li><strong><code>name</code> (str):</strong> Nombre del elemento.</li>
<li><strong><code>class_name</code> (str):</strong> Clase CSS del elemento.</li>
<li><strong><code>css_selector</code> (str):</strong> Selector CSS del elemento.</li>
<li><strong><code>link_text</code> (str):</strong> Texto completo del enlace.</li>
<li><strong><code>partial_link_text</code> (str):</strong> Texto parcial del enlace.</li>
<li><strong><code>tag_name</code> (str):</strong> Nombre de la etiqueta del elemento.</li>
</ul>
</li>
<li><strong><code>value</code> (opcional):</strong> Valor para ingresar en un campo de entrada.</li>
<li><strong><code>wait_time</code> (int, opcional):</strong> Tiempo de espera después de realizar la acción (por defecto: 2 segundos).</li>
</ul>
<hr />
<h4 id="funcionamiento_11"><strong>Funcionamiento</strong><a class="headerlink" href="#funcionamiento_11" title="Permanent link">&para;</a></h4>
<ol>
<li>
<p><strong>Identificación del elemento:</strong></p>
<ul>
<li>Determina el tipo y valor del localizador (<code>locator_type</code> y <code>locator_value</code>) a partir de los argumentos proporcionados.</li>
<li>Utiliza <code>WebDriverWait</code> para esperar hasta que el elemento sea clickeable.</li>
<li>Si no se encuentra el elemento, registra una advertencia en el log y retorna <code>None</code>.</li>
</ul>
</li>
<li>
<p><strong>Clic en el elemento:</strong></p>
<ul>
<li>Realiza clic en el elemento localizado y espera el tiempo especificado (<code>wait_time</code>).</li>
</ul>
</li>
<li>
<p><strong>Interacción con campos de entrada:</strong></p>
<ul>
<li>Si el elemento es un campo de entrada (<code>&lt;input&gt;</code>) y se proporciona un valor (<code>value</code>):</li>
<li>Si el valor es un objeto <code>datetime</code>, lo formatea como cadena (<code>'%d/%m/%Y'</code>).</li>
<li>Limpia el campo, establece el valor, y registra la acción en el log.</li>
</ul>
</li>
<li>
<p><strong>Manejo de errores:</strong></p>
<ul>
<li>Captura excepciones relacionadas con tiempo de espera, elementos no interactuables o referencias obsoletas.</li>
<li>Registra los errores en el log y retorna sin lanzar la excepción.</li>
</ul>
</li>
</ol>
<hr />
<h4 id="salida_12"><strong>Salida</strong><a class="headerlink" href="#salida_12" title="Permanent link">&para;</a></h4>
<ul>
<li><strong><code>None</code>:</strong> Si el elemento no se encuentra o hay un error durante la operación.</li>
<li>Registra en el log el estado del proceso (clic o interacción con el campo de entrada).</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">hacer_clic</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">locator_type</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">locator_value</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">input_value</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">)</span>
        <span class="n">wait_time</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;wait_time&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>  <span class="c1"># Manejar &#39;wait_time&#39; con valor por defecto</span>

        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span>
                <span class="k">continue</span>  <span class="c1"># Ya se maneja &#39;value&#39; arriba</span>
            <span class="k">elif</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;xpath&#39;</span><span class="p">,</span> <span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;class_name&#39;</span><span class="p">,</span> <span class="s1">&#39;css_selector&#39;</span><span class="p">,</span> <span class="s1">&#39;link_text&#39;</span><span class="p">,</span> <span class="s1">&#39;partial_link_text&#39;</span><span class="p">,</span> <span class="s1">&#39;tag_name&#39;</span><span class="p">]:</span>
                <span class="n">locator_type</span> <span class="o">=</span> <span class="n">key</span>
                <span class="n">locator_value</span> <span class="o">=</span> <span class="n">value</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">locator_type</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">locator_value</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Debe proporcionar un &#39;locator_type&#39; y un &#39;locator_value&#39; válidos&quot;</span><span class="p">)</span>

        <span class="c1"># Convertir el identificador a By adecuado</span>
        <span class="n">by_mapping</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;xpath&#39;</span><span class="p">:</span> <span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span>
            <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="n">By</span><span class="o">.</span><span class="n">ID</span><span class="p">,</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">By</span><span class="o">.</span><span class="n">NAME</span><span class="p">,</span>
            <span class="s1">&#39;class_name&#39;</span><span class="p">:</span> <span class="n">By</span><span class="o">.</span><span class="n">CLASS_NAME</span><span class="p">,</span>
            <span class="s1">&#39;css_selector&#39;</span><span class="p">:</span> <span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span>
            <span class="s1">&#39;link_text&#39;</span><span class="p">:</span> <span class="n">By</span><span class="o">.</span><span class="n">LINK_TEXT</span><span class="p">,</span>
            <span class="s1">&#39;partial_link_text&#39;</span><span class="p">:</span> <span class="n">By</span><span class="o">.</span><span class="n">PARTIAL_LINK_TEXT</span><span class="p">,</span>
            <span class="s1">&#39;tag_name&#39;</span><span class="p">:</span> <span class="n">By</span><span class="o">.</span><span class="n">TAG_NAME</span>
        <span class="p">}</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">elemento</span> <span class="o">=</span> <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span><span class="n">EC</span><span class="o">.</span><span class="n">element_to_be_clickable</span><span class="p">((</span><span class="n">by_mapping</span><span class="p">[</span><span class="n">locator_type</span><span class="p">],</span> <span class="n">locator_value</span><span class="p">)))</span>
        <span class="k">except</span> <span class="n">TimeoutException</span><span class="p">:</span>
            <span class="n">elemento</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Elemento no encontrado: </span><span class="si">{</span><span class="n">locator_type</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="n">locator_value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="c1">#FINALIZAR retornando error</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Elemento localizado, realizando clic en </span><span class="si">{</span><span class="n">locator_type</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">locator_value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">elemento</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">wait_time</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Clic realizado correctamente en </span><span class="si">{</span><span class="n">locator_type</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">locator_value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Si el elemento es un input y se proporcionó un valor de fecha, formatear correctamente</span>
        <span class="k">if</span> <span class="n">elemento</span><span class="o">.</span><span class="n">tag_name</span> <span class="o">==</span> <span class="s1">&#39;input&#39;</span> <span class="ow">and</span> <span class="n">input_value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">input_value</span><span class="p">,</span> <span class="n">datetime</span><span class="p">):</span>
                <span class="n">input_value</span> <span class="o">=</span> <span class="n">input_value</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1">/%m/%Y&#39;</span><span class="p">)</span>  <span class="c1"># Convertir datetime a cadena de texto</span>

            <span class="n">elemento</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
            <span class="n">elemento</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">input_value</span><span class="p">)</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Valor &#39;</span><span class="si">{</span><span class="n">input_value</span><span class="si">}</span><span class="s2">&#39; establecido en el elemento input correctamente&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="p">(</span><span class="n">TimeoutException</span><span class="p">,</span> <span class="n">NoSuchElementException</span><span class="p">,</span> <span class="n">ElementNotInteractableException</span><span class="p">,</span> <span class="n">StaleElementReferenceException</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="c1"># logging.error(f&quot;Error al intentar hacer clic en el elemento con {locator_type}: {locator_value} - Detalles: {e}&quot;)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error al intentar hacer clic en el elemento con </span><span class="si">{</span><span class="n">locator_type</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">locator_value</span><span class="si">}</span><span class="s2"> &quot;</span><span class="p">)</span>
        <span class="c1">#raise</span>
</code></pre></div>
<h2 id="funcion-hacer_clic_modal">Función <code>hacer_clic_modal</code><a class="headerlink" href="#funcion-hacer_clic_modal" title="Permanent link">&para;</a></h2>
<h4 id="proposito_14"><strong>Propósito</strong><a class="headerlink" href="#proposito_14" title="Permanent link">&para;</a></h4>
<p>Interactúa con un modal en una página web controlada por Selenium, localizando y haciendo clic en un elemento dentro del modal. Opcionalmente, permite realizar acciones adicionales dentro del modal y gestionar cambios de contexto hacia y desde un <code>iframe</code>.</p>
<hr />
<h4 id="entradas_14"><strong>Entradas</strong><a class="headerlink" href="#entradas_14" title="Permanent link">&para;</a></h4>
<ul>
<li><strong><code>driver</code> (WebDriver):</strong> Instancia del controlador Selenium.</li>
<li><strong><code>kwargs</code> (dict):</strong> Parámetros clave para la operación:</li>
<li><strong><code>xpath_modal</code> (str, requerido):</strong> Localizador del modal usando XPath.</li>
<li><strong><code>iframe</code> (str, opcional):</strong> Nombre del iframe al que cambiar el contexto.</li>
<li><strong><code>elementos</code> (list, opcional):</strong> Lista de pasos adicionales a ejecutar dentro del modal. Cada paso debe estar definido como una tupla <code>(nombre_paso, función, parámetros)</code>.</li>
<li><strong>Localizadores:</strong> <ul>
<li><strong><code>xpath</code> (str):</strong> XPath del elemento a interactuar.</li>
<li><strong><code>id</code>, <code>name</code>, <code>class_name</code>, <code>css_selector</code>, <code>link_text</code>, <code>partial_link_text</code>, <code>tag_name</code> (str):</strong> Alternativas de localización del elemento.</li>
</ul>
</li>
<li><strong><code>wait_time</code> (int, opcional):</strong> Tiempo de espera en segundos tras realizar la acción (por defecto: <code>2</code>).</li>
</ul>
<hr />
<h4 id="funcionamiento_12"><strong>Funcionamiento</strong><a class="headerlink" href="#funcionamiento_12" title="Permanent link">&para;</a></h4>
<ol>
<li>
<p><strong>Cambio al <code>iframe</code> (opcional):</strong></p>
<ul>
<li>Si se proporciona un <code>iframe</code>, cambia al contexto del iframe indicado antes de realizar otras operaciones.</li>
</ul>
</li>
<li>
<p><strong>Localización del modal:</strong></p>
<ul>
<li>Espera hasta que el modal especificado por <code>xpath_modal</code> sea visible en el DOM.</li>
</ul>
</li>
<li>
<p><strong>Interacción con el elemento:</strong></p>
<ul>
<li>Localiza y verifica la clicabilidad del elemento especificado.</li>
<li>Intenta realizar clic estándar. Si no es posible, utiliza JavaScript como alternativa.</li>
</ul>
</li>
<li>
<p><strong>Ejecución de pasos adicionales (opcional):</strong></p>
<ul>
<li>Si se proporcionan pasos adicionales, los ejecuta dentro del contexto del modal.</li>
</ul>
</li>
<li>
<p><strong>Cambio de regreso al contexto principal (si aplica):</strong></p>
<ul>
<li>Regresa al contenido principal si se cambió previamente al <code>iframe</code>.</li>
</ul>
</li>
<li>
<p><strong>Manejo de errores:</strong></p>
<ul>
<li>Captura y registra excepciones relacionadas con tiempo de espera, elementos no interactuables o referencias obsoletas.</li>
</ul>
</li>
</ol>
<hr />
<h4 id="salida_13"><strong>Salida</strong><a class="headerlink" href="#salida_13" title="Permanent link">&para;</a></h4>
<ul>
<li>No retorna valores. Realiza las acciones en el modal y registra el estado del proceso en el log.</li>
</ul>
<hr />
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">hacer_clic_modal</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">modal_locator_type</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">modal_locator_value</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;xpath_modal&#39;</span><span class="p">)</span>
        <span class="n">iframe_name</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;iframe&#39;</span><span class="p">)</span>
        <span class="n">locator_type</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">locator_value</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">wait_time</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;wait_time&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">elementos</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;elementos&#39;</span><span class="p">,</span> <span class="p">[])</span>

        <span class="k">if</span> <span class="n">iframe_name</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Cambiando al iframe con nombre: </span><span class="si">{</span><span class="n">iframe_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span><span class="n">EC</span><span class="o">.</span><span class="n">frame_to_be_available_and_switch_to_it</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">NAME</span><span class="p">,</span> <span class="n">iframe_name</span><span class="p">)))</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Cambio al iframe exitoso&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">TimeoutException</span><span class="p">:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No se pudo cambiar al iframe &#39;</span><span class="si">{</span><span class="n">iframe_name</span><span class="si">}</span><span class="s2">&#39; dentro del tiempo límite.&quot;</span><span class="p">)</span>
                <span class="k">raise</span>

        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;xpath_modal&#39;</span><span class="p">,</span> <span class="s1">&#39;iframe&#39;</span><span class="p">,</span> <span class="s1">&#39;elementos&#39;</span><span class="p">]:</span>
                <span class="k">continue</span>
            <span class="k">elif</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;xpath&#39;</span><span class="p">,</span> <span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;class_name&#39;</span><span class="p">,</span> <span class="s1">&#39;css_selector&#39;</span><span class="p">,</span> <span class="s1">&#39;link_text&#39;</span><span class="p">,</span> <span class="s1">&#39;partial_link_text&#39;</span><span class="p">,</span> <span class="s1">&#39;tag_name&#39;</span><span class="p">]:</span>
                <span class="n">locator_type</span> <span class="o">=</span> <span class="n">key</span>
                <span class="n">locator_value</span> <span class="o">=</span> <span class="n">value</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">modal_locator_value</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Debe proporcionar un localizador válido para el modal (por ejemplo, &#39;xpath_modal&#39;)&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">locator_type</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">locator_value</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Debe proporcionar un &#39;locator_type&#39; y un &#39;locator_value&#39; válidos para el elemento de clic&quot;</span><span class="p">)</span>

        <span class="n">by_mapping</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;xpath&#39;</span><span class="p">:</span> <span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span>
            <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="n">By</span><span class="o">.</span><span class="n">ID</span><span class="p">,</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">By</span><span class="o">.</span><span class="n">NAME</span><span class="p">,</span>
            <span class="s1">&#39;class_name&#39;</span><span class="p">:</span> <span class="n">By</span><span class="o">.</span><span class="n">CLASS_NAME</span><span class="p">,</span>
            <span class="s1">&#39;css_selector&#39;</span><span class="p">:</span> <span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span>
            <span class="s1">&#39;link_text&#39;</span><span class="p">:</span> <span class="n">By</span><span class="o">.</span><span class="n">LINK_TEXT</span><span class="p">,</span>
            <span class="s1">&#39;partial_link_text&#39;</span><span class="p">:</span> <span class="n">By</span><span class="o">.</span><span class="n">PARTIAL_LINK_TEXT</span><span class="p">,</span>
            <span class="s1">&#39;tag_name&#39;</span><span class="p">:</span> <span class="n">By</span><span class="o">.</span><span class="n">TAG_NAME</span>
        <span class="p">}</span>

        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Esperando la visibilidad del modal con xpath: </span><span class="si">{</span><span class="n">modal_locator_value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span><span class="n">EC</span><span class="o">.</span><span class="n">visibility_of_element_located</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">modal_locator_value</span><span class="p">)))</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Modal localizado y visible: </span><span class="si">{</span><span class="n">modal_locator_value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">elemento</span> <span class="o">=</span> <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span><span class="n">EC</span><span class="o">.</span><span class="n">visibility_of_element_located</span><span class="p">((</span><span class="n">by_mapping</span><span class="p">[</span><span class="n">locator_type</span><span class="p">],</span> <span class="n">locator_value</span><span class="p">)))</span>
        <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span><span class="n">EC</span><span class="o">.</span><span class="n">element_to_be_clickable</span><span class="p">((</span><span class="n">by_mapping</span><span class="p">[</span><span class="n">locator_type</span><span class="p">],</span> <span class="n">locator_value</span><span class="p">)))</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Elemento localizado dentro del modal, realizando clic en </span><span class="si">{</span><span class="n">locator_type</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">locator_value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">elemento</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
        <span class="k">except</span> <span class="n">ElementNotInteractableException</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No se pudo hacer clic en </span><span class="si">{</span><span class="n">locator_type</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">locator_value</span><span class="si">}</span><span class="s2"> con el método estándar, intentando con JavaScript&quot;</span><span class="p">)</span>
            <span class="n">driver</span><span class="o">.</span><span class="n">execute_script</span><span class="p">(</span><span class="s2">&quot;arguments[0].click();&quot;</span><span class="p">,</span> <span class="n">elemento</span><span class="p">)</span>

        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">wait_time</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Clic realizado correctamente en </span><span class="si">{</span><span class="n">locator_type</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">locator_value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">elementos</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">step_name</span><span class="p">,</span> <span class="n">step_function</span><span class="p">,</span> <span class="n">params</span> <span class="ow">in</span> <span class="n">elementos</span><span class="p">:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Ejecutando el paso adicional dentro del modal: </span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">step_function</span><span class="p">(</span><span class="n">driver</span><span class="o">=</span><span class="n">driver</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">iframe_name</span><span class="p">:</span>
            <span class="n">driver</span><span class="o">.</span><span class="n">switch_to</span><span class="o">.</span><span class="n">default_content</span><span class="p">()</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Cambio de regreso al contenido principal realizado&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="p">(</span><span class="n">TimeoutException</span><span class="p">,</span> <span class="n">NoSuchElementException</span><span class="p">,</span> <span class="n">ElementNotInteractableException</span><span class="p">,</span> <span class="n">StaleElementReferenceException</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error al intentar hacer clic en el elemento dentro del modal con </span><span class="si">{</span><span class="n">locator_type</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">locator_value</span><span class="si">}</span><span class="s2"> - Detalles: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">raise</span>
</code></pre></div>
<h2 id="funcion-hacer_clic_por_coordenadas">Función <code>hacer_clic_por_coordenadas</code><a class="headerlink" href="#funcion-hacer_clic_por_coordenadas" title="Permanent link">&para;</a></h2>
<h4 id="proposito_15"><strong>Propósito</strong><a class="headerlink" href="#proposito_15" title="Permanent link">&para;</a></h4>
<p>Realiza un clic en un elemento ubicado en una página web controlada por Selenium utilizando sus coordenadas. Es útil cuando los clics tradicionales no son efectivos.</p>
<hr />
<h4 id="entradas_15"><strong>Entradas</strong><a class="headerlink" href="#entradas_15" title="Permanent link">&para;</a></h4>
<ul>
<li><strong><code>driver</code> (WebDriver):</strong> Instancia del controlador Selenium.</li>
<li><strong><code>kwargs</code> (dict):</strong> Argumentos clave para configurar la operación:</li>
<li><strong>Localizadores (uno obligatorio):</strong><ul>
<li><strong><code>xpath</code> (str):</strong> Localizador del elemento mediante XPath.</li>
<li><strong><code>id</code>, <code>name</code>, <code>class_name</code>, <code>css_selector</code>, <code>link_text</code>, <code>partial_link_text</code>, <code>tag_name</code> (str):</strong> Alternativas de localización del elemento.</li>
</ul>
</li>
<li><strong><code>iframe</code> (str, opcional):</strong> Nombre del iframe para cambiar el contexto antes de la operación.</li>
<li><strong><code>wait_time</code> (int, opcional):</strong> Tiempo en segundos para esperar después del clic (por defecto: <code>2</code>).</li>
</ul>
<hr />
<h4 id="funcionamiento_13"><strong>Funcionamiento</strong><a class="headerlink" href="#funcionamiento_13" title="Permanent link">&para;</a></h4>
<ol>
<li>
<p><strong>Cambio de contexto al iframe (opcional):</strong></p>
<ul>
<li>Cambia al contexto del iframe especificado, si se proporciona.</li>
</ul>
</li>
<li>
<p><strong>Localización del elemento:</strong></p>
<ul>
<li>Encuentra el elemento utilizando el tipo y valor del localizador proporcionado.</li>
<li>Asegura que el elemento esté visible en la ventana mediante <code>scrollIntoView</code>.</li>
</ul>
</li>
<li>
<p><strong>Obtención de coordenadas:</strong></p>
<ul>
<li>Calcula las coordenadas centrales del elemento (<code>x</code> y <code>y</code>) usando su posición y tamaño.</li>
</ul>
</li>
<li>
<p><strong>Clic en las coordenadas:</strong></p>
<ul>
<li>Usa <code>ActionChains</code> para mover el puntero a las coordenadas calculadas y realizar el clic.</li>
</ul>
</li>
<li>
<p><strong>Manejo de errores:</strong></p>
<ul>
<li>Captura excepciones relacionadas con tiempo de espera, elementos no encontrados o referencias obsoletas, registrando el error en el log.</li>
</ul>
</li>
<li>
<p><strong>Restauración del contexto principal:</strong></p>
<ul>
<li>Si se cambió al iframe, regresa al contexto principal al finalizar.</li>
</ul>
</li>
</ol>
<hr />
<h4 id="salida_14"><strong>Salida</strong><a class="headerlink" href="#salida_14" title="Permanent link">&para;</a></h4>
<ul>
<li>No retorna valores. Realiza el clic en las coordenadas especificadas y registra en el log el estado del proceso.</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">hacer_clic_por_coordenadas</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Iniciando el proceso de clic por coordenadas&quot;</span><span class="p">)</span>

        <span class="n">locator_type</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">locator_value</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">iframe</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;iframe&#39;</span><span class="p">)</span>  <span class="c1"># Nombre del iframe si es necesario cambiar de contexto</span>
        <span class="n">wait_time</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;wait_time&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>  <span class="c1"># Manejar &#39;wait_time&#39; con valor por defecto</span>

        <span class="c1"># Obtener el localizador del elemento de clic</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;iframe&#39;</span><span class="p">,</span> <span class="s1">&#39;wait_time&#39;</span><span class="p">]:</span>
                <span class="k">continue</span>  <span class="c1"># Omitir estos parámetros</span>
            <span class="k">elif</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;xpath&#39;</span><span class="p">,</span> <span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;class_name&#39;</span><span class="p">,</span> <span class="s1">&#39;css_selector&#39;</span><span class="p">,</span> <span class="s1">&#39;link_text&#39;</span><span class="p">,</span> <span class="s1">&#39;partial_link_text&#39;</span><span class="p">,</span> <span class="s1">&#39;tag_name&#39;</span><span class="p">]:</span>
                <span class="n">locator_type</span> <span class="o">=</span> <span class="n">key</span>
                <span class="n">locator_value</span> <span class="o">=</span> <span class="n">value</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">locator_type</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">locator_value</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Debe proporcionar un &#39;locator_type&#39; y un &#39;locator_value&#39; válidos&quot;</span><span class="p">)</span>

        <span class="c1"># Cambiar al contexto del iframe si se proporciona</span>
        <span class="k">if</span> <span class="n">iframe</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Cambiando al contexto del iframe: </span><span class="si">{</span><span class="n">iframe</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span><span class="n">EC</span><span class="o">.</span><span class="n">frame_to_be_available_and_switch_to_it</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">NAME</span><span class="p">,</span> <span class="n">iframe</span><span class="p">)))</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Cambio al contexto del iframe completado&quot;</span><span class="p">)</span>

        <span class="c1"># Convertir el identificador a By adecuado</span>
        <span class="n">by_mapping</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;xpath&#39;</span><span class="p">:</span> <span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span>
            <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="n">By</span><span class="o">.</span><span class="n">ID</span><span class="p">,</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">By</span><span class="o">.</span><span class="n">NAME</span><span class="p">,</span>
            <span class="s1">&#39;class_name&#39;</span><span class="p">:</span> <span class="n">By</span><span class="o">.</span><span class="n">CLASS_NAME</span><span class="p">,</span>
            <span class="s1">&#39;css_selector&#39;</span><span class="p">:</span> <span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span>
            <span class="s1">&#39;link_text&#39;</span><span class="p">:</span> <span class="n">By</span><span class="o">.</span><span class="n">LINK_TEXT</span><span class="p">,</span>
            <span class="s1">&#39;partial_link_text&#39;</span><span class="p">:</span> <span class="n">By</span><span class="o">.</span><span class="n">PARTIAL_LINK_TEXT</span><span class="p">,</span>
            <span class="s1">&#39;tag_name&#39;</span><span class="p">:</span> <span class="n">By</span><span class="o">.</span><span class="n">TAG_NAME</span>
        <span class="p">}</span>

        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Esperando la presencia del elemento </span><span class="si">{</span><span class="n">locator_type</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">locator_value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">elemento</span> <span class="o">=</span> <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span><span class="n">EC</span><span class="o">.</span><span class="n">presence_of_element_located</span><span class="p">((</span><span class="n">by_mapping</span><span class="p">[</span><span class="n">locator_type</span><span class="p">],</span> <span class="n">locator_value</span><span class="p">)))</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Elemento encontrado: </span><span class="si">{</span><span class="n">locator_type</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="n">locator_value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">driver</span><span class="o">.</span><span class="n">execute_script</span><span class="p">(</span><span class="s2">&quot;arguments[0].scrollIntoView(true);&quot;</span><span class="p">,</span> <span class="n">elemento</span><span class="p">)</span>  <span class="c1"># Asegurarse de que el elemento esté visible en la ventana</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Elemento desplazado a la vista&quot;</span><span class="p">)</span>

        <span class="c1"># Obtener las coordenadas del elemento</span>
        <span class="n">location</span> <span class="o">=</span> <span class="n">elemento</span><span class="o">.</span><span class="n">location</span>
        <span class="n">size</span> <span class="o">=</span> <span class="n">elemento</span><span class="o">.</span><span class="n">size</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">location</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">size</span><span class="p">[</span><span class="s1">&#39;width&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="n">location</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">size</span><span class="p">[</span><span class="s1">&#39;height&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>

        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Coordenadas obtenidas - X: </span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">, Y: </span><span class="si">{</span><span class="n">y</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Hacer clic en las coordenadas usando ActionChains</span>
        <span class="n">action</span> <span class="o">=</span> <span class="n">ActionChains</span><span class="p">(</span><span class="n">driver</span><span class="p">)</span>
        <span class="n">action</span><span class="o">.</span><span class="n">move_by_offset</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">()</span><span class="o">.</span><span class="n">perform</span><span class="p">()</span>

        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Clic realizado en las coordenadas especificadas&quot;</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">wait_time</span><span class="p">)</span>

    <span class="k">except</span> <span class="p">(</span><span class="n">TimeoutException</span><span class="p">,</span> <span class="n">NoSuchElementException</span><span class="p">,</span> <span class="n">ElementNotInteractableException</span><span class="p">,</span> <span class="n">StaleElementReferenceException</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error al intentar hacer clic en el elemento por coordenadas: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">raise</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="c1"># Volver al contexto principal si se cambió al iframe</span>
        <span class="k">if</span> <span class="n">iframe</span><span class="p">:</span>
            <span class="n">driver</span><span class="o">.</span><span class="n">switch_to</span><span class="o">.</span><span class="n">default_content</span><span class="p">()</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Cambio al contexto principal después de la operación en el iframe&quot;</span><span class="p">)</span>
</code></pre></div>
<h2 id="funciones-actualizar_nombre_archivo-y-verificar_descarga">Funciones <code>actualizar_nombre_archivo</code> y <code>verificar_descarga</code><a class="headerlink" href="#funciones-actualizar_nombre_archivo-y-verificar_descarga" title="Permanent link">&para;</a></h2>
<h4 id="funcion-actualizar_nombre_archivo"><strong>Función <code>actualizar_nombre_archivo</code></strong><a class="headerlink" href="#funcion-actualizar_nombre_archivo" title="Permanent link">&para;</a></h4>
<p><strong>Propósito:</strong></p>
<p>Actualiza el objeto global <code>proceso_info</code> con el nombre del archivo procesado.</p>
<p><strong>Entradas:</strong></p>
<ul>
<li><strong><code>nombre_archivo</code> (str):</strong> Nombre del archivo descargado.</li>
</ul>
<p><strong>Funcionamiento:</strong></p>
<ul>
<li>Establece el valor de <code>'nombre_archivo'</code> en el objeto global <code>proceso_info</code>.</li>
<li>Registra en el log el nombre actualizado.</li>
</ul>
<p><strong>Salida:</strong></p>
<ul>
<li>No retorna valores. Actualiza el objeto global y registra el cambio.</li>
</ul>
<hr />
<h4 id="funcion-verificar_descarga"><strong>Función <code>verificar_descarga</code></strong><a class="headerlink" href="#funcion-verificar_descarga" title="Permanent link">&para;</a></h4>
<p><strong>Propósito:</strong></p>
<p>Verifica si un archivo específico se ha descargado correctamente dentro de un tiempo de espera máximo.</p>
<p><strong>Entradas:</strong></p>
<ul>
<li><strong><code>nombre_archivo</code> (str):</strong> Nombre del archivo a verificar.</li>
<li><strong><code>download_dir</code> (str, opcional):</strong> Directorio de descargas donde se busca el archivo (por defecto: <code>DOWNLOAD_DIR</code>).</li>
<li><strong><code>timeout</code> (int, opcional):</strong> Tiempo máximo de espera en segundos (por defecto: <code>10</code>).</li>
</ul>
<p><strong>Funcionamiento:</strong></p>
<ol>
<li>Construye la ruta completa del archivo a partir del nombre y el directorio de descargas.</li>
<li>Monitorea la existencia del archivo en el sistema de archivos:<ul>
<li>Si el archivo no se encuentra dentro del tiempo especificado, devuelve <code>False</code>.</li>
<li>Si el archivo aparece, registra el éxito y devuelve <code>True</code>.</li>
</ul>
</li>
</ol>
<p><strong>Salida:</strong></p>
<ul>
<li><strong><code>True</code>:</strong> Si el archivo se descargó correctamente.</li>
<li><strong><code>False</code>:</strong> Si el archivo no se descargó dentro del tiempo especificado.</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="c1"># Objeto global para almacenar detalles del proceso</span>
<span class="n">proceso_info</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;nombre_archivo&#39;</span><span class="p">:</span> <span class="kc">None</span>
<span class="p">}</span>

<span class="c1"># Función que actualiza el objeto con el nombre del archivo descargado</span>
<span class="k">def</span><span class="w"> </span><span class="nf">actualizar_nombre_archivo</span><span class="p">(</span><span class="n">nombre_archivo</span><span class="p">):</span>
    <span class="n">proceso_info</span><span class="p">[</span><span class="s1">&#39;nombre_archivo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nombre_archivo</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Nombre del archivo actualizado en el objeto: </span><span class="si">{</span><span class="n">nombre_archivo</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">verificar_descarga</span><span class="p">(</span><span class="n">nombre_archivo</span><span class="p">,</span> <span class="n">download_dir</span><span class="o">=</span><span class="n">DOWNLOAD_DIR</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Verifica que un archivo con el nombre especificado se descargue correctamente en el </span>
<span class="sd">    directorio de descargas, con un tiempo de espera máximo.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">download_dir</span><span class="p">,</span> <span class="n">nombre_archivo</span><span class="p">)</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Verificando la presencia del archivo: </span><span class="si">{</span><span class="n">nombre_archivo</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="k">while</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">file_path</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span> <span class="o">&gt;</span> <span class="n">timeout</span><span class="p">:</span>
            <span class="c1"># logging.warning(f&quot;Tiempo de espera agotado para la descarga del archivo: {nombre_archivo}&quot;)</span>
            <span class="k">return</span> <span class="kc">False</span>  <span class="c1"># Indica que el archivo no se descargó en el tiempo dado</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Esperando la descarga...&quot;</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Archivo </span><span class="si">{</span><span class="n">nombre_archivo</span><span class="si">}</span><span class="s2"> descargado correctamente.&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">True</span>  <span class="c1"># Indica que el archivo se descargó con éxito</span>
</code></pre></div>
<h2 id="funcion-cargar_archivo_excel">Función <code>cargar_archivo_excel</code><a class="headerlink" href="#funcion-cargar_archivo_excel" title="Permanent link">&para;</a></h2>
<h4 id="proposito_16"><strong>Propósito</strong><a class="headerlink" href="#proposito_16" title="Permanent link">&para;</a></h4>
<p>Carga un archivo Excel desde el directorio de descargas y lo convierte en un DataFrame de pandas. Utiliza el nombre del archivo almacenado en el objeto global <code>proceso_info</code>.</p>
<hr />
<h4 id="entradas_16"><strong>Entradas</strong><a class="headerlink" href="#entradas_16" title="Permanent link">&para;</a></h4>
<ul>
<li>No recibe argumentos. Utiliza el nombre del archivo desde el objeto global <code>proceso_info</code>.</li>
</ul>
<hr />
<h4 id="funcionamiento_14"><strong>Funcionamiento</strong><a class="headerlink" href="#funcionamiento_14" title="Permanent link">&para;</a></h4>
<ol>
<li>
<p><strong>Obtención del nombre del archivo:</strong></p>
<ul>
<li>Recupera el nombre del archivo desde <code>proceso_info['nombre_archivo']</code>.</li>
<li>Si el nombre no está definido, registra una advertencia y retorna <code>None</code>.</li>
</ul>
</li>
<li>
<p><strong>Cargado del archivo:</strong></p>
<ul>
<li>Construye la ruta completa del archivo a partir del nombre y el directorio <code>DOWNLOAD_DIR</code>.</li>
<li>Verifica si el archivo existe en la ruta:</li>
<li>Si existe, lo carga en un DataFrame de pandas.</li>
<li>Si no existe, registra una advertencia y retorna <code>None</code>.</li>
</ul>
</li>
<li>
<p><strong>Manejo de errores:</strong></p>
<ul>
<li>Captura excepciones durante la carga y registra el error en el log.</li>
</ul>
</li>
</ol>
<hr />
<h4 id="salida_15"><strong>Salida</strong><a class="headerlink" href="#salida_15" title="Permanent link">&para;</a></h4>
<ul>
<li><strong><code>pandas.DataFrame</code>:</strong> DataFrame cargado desde el archivo Excel si la operación es exitosa.</li>
<li><strong><code>None</code>:</strong> Si el archivo no se encuentra o ocurre un error.</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">cargar_archivo_excel</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Carga un archivo de Excel desde el directorio de descargas en un DataFrame de pandas.</span>
<span class="sd">    Utiliza el nombre del archivo almacenado en el objeto global.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">nombre_archivo</span> <span class="o">=</span> <span class="n">proceso_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;nombre_archivo&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">nombre_archivo</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;El nombre del archivo no se ha registrado en el objeto global.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">DOWNLOAD_DIR</span><span class="p">,</span> <span class="n">nombre_archivo</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">file_path</span><span class="p">):</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Cargando archivo </span><span class="si">{</span><span class="n">nombre_archivo</span><span class="si">}</span><span class="s2"> en DataFrame.&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Archivo </span><span class="si">{</span><span class="n">nombre_archivo</span><span class="si">}</span><span class="s2"> no encontrado.&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error al cargar el archivo </span><span class="si">{</span><span class="n">nombre_archivo</span><span class="si">}</span><span class="s2"> en DataFrame: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>
</code></pre></div>
<h2 id="funcion-generar_fechas">Función <code>generar_fechas</code><a class="headerlink" href="#funcion-generar_fechas" title="Permanent link">&para;</a></h2>
<h4 id="proposito_17"><strong>Propósito</strong><a class="headerlink" href="#proposito_17" title="Permanent link">&para;</a></h4>
<p>Genera un diccionario con rangos de fechas por año o semestre, según los parámetros proporcionados.</p>
<hr />
<h4 id="entradas_17"><strong>Entradas</strong><a class="headerlink" href="#entradas_17" title="Permanent link">&para;</a></h4>
<ul>
<li><strong><code>inicio</code> (int, opcional):</strong> Año inicial del rango (requerido si <code>semestre</code> es <code>False</code>).</li>
<li><strong><code>fin</code> (int, opcional):</strong> Año final del rango (requerido si <code>semestre</code> es <code>False</code>).</li>
<li><strong><code>semestre</code> (bool, opcional):</strong> Si es <code>True</code>, genera fechas del semestre anterior basado en la fecha actual (por defecto: <code>False</code>).</li>
</ul>
<hr />
<h4 id="funcionamiento_15"><strong>Funcionamiento</strong><a class="headerlink" href="#funcionamiento_15" title="Permanent link">&para;</a></h4>
<ol>
<li>
<p><strong>Generación basada en semestres:</strong></p>
<ul>
<li>Si <code>semestre</code> es <code>True</code>:</li>
<li>Determina el semestre anterior con base en el mes actual:<ul>
<li>Enero a junio: Devuelve el rango del <strong>segundo semestre del año anterior</strong>.</li>
<li>Julio a diciembre: Devuelve el rango del <strong>primer semestre del año actual</strong>.</li>
</ul>
</li>
<li>Retorna un diccionario con un único rango de fechas.</li>
</ul>
</li>
<li>
<p><strong>Generación por años:</strong></p>
<ul>
<li>Si <code>semestre</code> es <code>False</code>:</li>
<li>Itera desde el año <code>inicio</code> hasta el año <code>fin</code> (inclusive).</li>
<li>Genera un diccionario donde cada clave es el índice del año en el rango, y los valores son los rangos de fechas para todo el año.</li>
</ul>
</li>
<li>
<p><strong>Registro de información:</strong></p>
<ul>
<li>Registra en el log los rangos generados.</li>
</ul>
</li>
</ol>
<hr />
<h4 id="salida_16"><strong>Salida</strong><a class="headerlink" href="#salida_16" title="Permanent link">&para;</a></h4>
<ul>
<li><strong><code>dict</code>:</strong> Diccionario con rangos de fechas. Formato:<ul>
<li><strong>Por semestre:</strong> <code>{1: {'desde': 'fecha_inicio', 'hasta': 'fecha_fin'}}</code></li>
<li><strong>Por años:</strong> <code>{índice: {'desde': '01-01-año', 'hasta': '12-31-año'}}</code></li>
</ul>
</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="c1"># Función para generar el diccionario de fechas entre dos años dados</span>
<span class="k">def</span><span class="w"> </span><span class="nf">generar_fechas</span><span class="p">(</span><span class="n">inicio</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">semestre</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>

    <span class="k">if</span> <span class="n">semestre</span><span class="p">:</span>
        <span class="c1"># Verificar si se solicita el semestre</span>
        <span class="c1">#mes fecha actual</span>
        <span class="n">mes</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">month</span>
        <span class="c1">#año fecha actual</span>
        <span class="n">año</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">year</span>

        <span class="k">if</span> <span class="n">mes</span> <span class="o">&lt;=</span> <span class="mi">6</span><span class="p">:</span>
            <span class="c1"># Primer semestre: el semestre anterior es el segundo semestre del año anterior</span>
            <span class="k">return</span> <span class="p">{</span>
                <span class="mi">1</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;desde&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;07-01-</span><span class="si">{</span><span class="n">año</span><span class="o">-</span><span class="mi">1</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;hasta&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;12-31-</span><span class="si">{</span><span class="n">año</span><span class="o">-</span><span class="mi">1</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">}</span>
            <span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Segundo semestre: el semestre anterior es el primer semestre del mismo año</span>
            <span class="k">return</span> <span class="p">{</span>
                <span class="mi">1</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;desde&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;01-01-</span><span class="si">{</span><span class="n">año</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;hasta&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;06-30-</span><span class="si">{</span><span class="n">año</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">}</span>
            <span class="p">}</span>


    <span class="n">fechas</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">año</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">inicio</span><span class="p">,</span> <span class="n">fin</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">fechas</span><span class="p">[</span><span class="n">año</span> <span class="o">-</span> <span class="n">inicio</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;desde&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;01-01-</span><span class="si">{</span><span class="n">año</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;hasta&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;12-31-</span><span class="si">{</span><span class="n">año</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">}</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;fechas: </span><span class="si">{</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">fechas</span><span class="p">,</span><span class="w"> </span><span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="c1"># input(&quot;Presione Enter para continuar...&quot;)</span>
    <span class="k">return</span> <span class="n">fechas</span>
</code></pre></div>
<h2 id="funcion-generar_periodos_cortes">Función <code>generar_periodos_cortes</code><a class="headerlink" href="#funcion-generar_periodos_cortes" title="Permanent link">&para;</a></h2>
<h4 id="proposito_18"><strong>Propósito</strong><a class="headerlink" href="#proposito_18" title="Permanent link">&para;</a></h4>
<p>Genera un diccionario que contiene periodos de tiempo divididos en cortes mensuales dentro de un rango de años.</p>
<hr />
<h4 id="entradas_18"><strong>Entradas</strong><a class="headerlink" href="#entradas_18" title="Permanent link">&para;</a></h4>
<ul>
<li><strong><code>anio_inicio</code> (int):</strong> Año inicial del rango.</li>
<li><strong><code>anio_fin</code> (int):</strong> Año final del rango.</li>
<li><strong><code>tipo</code> (int, opcional):</strong> Número de cortes por año (por defecto: <code>2</code>). Debe estar entre <code>1</code> y <code>12</code>.</li>
</ul>
<hr />
<h4 id="funcionamiento_16"><strong>Funcionamiento</strong><a class="headerlink" href="#funcionamiento_16" title="Permanent link">&para;</a></h4>
<ol>
<li>
<p><strong>Validación del parámetro <code>tipo</code>:</strong></p>
<ul>
<li>Asegura que el valor de <code>tipo</code> sea un número entre 1 y 12.</li>
<li>Lanza un <code>ValueError</code> si el valor está fuera del rango.</li>
</ul>
</li>
<li>
<p><strong>Cálculo de periodos:</strong></p>
<ul>
<li>Divide los meses del año en cortes iguales según el valor de <code>tipo</code>:</li>
<li>Calcula la cantidad de meses por periodo: <code>meses_por_periodo = 12 // tipo</code>.</li>
<li>Itera sobre los años entre <code>anio_inicio</code> y <code>anio_fin</code> (inclusive).</li>
<li>Dentro de cada año:</li>
<li>Calcula el mes de inicio y el mes final de cada periodo.</li>
<li>Genera los rangos de fechas, considerando el último día del mes (<code>dias_del_mes</code>).</li>
</ul>
</li>
<li>
<p><strong>Estructura del diccionario:</strong></p>
<ul>
<li>Cada clave es un número de periodo incremental.</li>
<li>Cada valor es un rango de fechas con formato:</li>
<li><strong><code>desde</code> (str):</strong> Fecha de inicio del periodo (formato <code>MM-DD-AAAA</code>).</li>
<li><strong><code>hasta</code> (str):</strong> Fecha de fin del periodo (formato <code>MM-DD-AAAA</code>).</li>
</ul>
</li>
<li>
<p><strong>Registro:</strong></p>
<ul>
<li>Registra en el log los periodos generados.</li>
</ul>
</li>
</ol>
<hr />
<h4 id="salida_17"><strong>Salida</strong><a class="headerlink" href="#salida_17" title="Permanent link">&para;</a></h4>
<ul>
<li><strong><code>dict</code>:</strong> Diccionario con los periodos generados. Ejemplo:
  <div class="highlight"><pre><span></span><code><span class="p">{</span>
    <span class="mi">1</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;desde&#39;</span><span class="p">:</span> <span class="s1">&#39;01-01-2023&#39;</span><span class="p">,</span> <span class="s1">&#39;hasta&#39;</span><span class="p">:</span> <span class="s1">&#39;06-30-2023&#39;</span><span class="p">},</span>
    <span class="mi">2</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;desde&#39;</span><span class="p">:</span> <span class="s1">&#39;07-01-2023&#39;</span><span class="p">,</span> <span class="s1">&#39;hasta&#39;</span><span class="p">:</span> <span class="s1">&#39;12-31-2023&#39;</span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div></li>
</ul>
<hr />
<h4 id="consideraciones_3"><strong>Consideraciones</strong><a class="headerlink" href="#consideraciones_3" title="Permanent link">&para;</a></h4>
<ul>
<li>La función usa <code>dias_del_mes</code> para calcular correctamente el último día de cada mes.</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">generar_periodos_cortes</span><span class="p">(</span><span class="n">anio_inicio</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">anio_fin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tipo</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">tipo</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">tipo</span> <span class="o">&gt;</span> <span class="mi">12</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;El parámetro &#39;tipo&#39; debe ser un número entre 1 y 12.&quot;</span><span class="p">)</span>

    <span class="n">fechas</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">periodo</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">meses_por_periodo</span> <span class="o">=</span> <span class="mi">12</span> <span class="o">//</span> <span class="n">tipo</span>

    <span class="k">for</span> <span class="n">anio</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">anio_inicio</span><span class="p">,</span> <span class="n">anio_fin</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">tipo</span><span class="p">):</span>
            <span class="n">mes_inicio</span> <span class="o">=</span> <span class="n">i</span> <span class="o">*</span> <span class="n">meses_por_periodo</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="n">mes_fin</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">meses_por_periodo</span>
            <span class="n">fechas</span><span class="p">[</span><span class="n">periodo</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;desde&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">mes_inicio</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">-01-</span><span class="si">{</span><span class="n">anio</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="s1">&#39;hasta&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">mes_fin</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">dias_del_mes</span><span class="p">(</span><span class="n">mes_fin</span><span class="p">,</span><span class="w"> </span><span class="n">anio</span><span class="p">)</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">anio</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">}</span>
            <span class="n">periodo</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;fechas: </span><span class="si">{</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">fechas</span><span class="p">,</span><span class="w"> </span><span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">fechas</span>
</code></pre></div>
<h2 id="funcion-cola_descargar">Función <code>cola_descargar</code><a class="headerlink" href="#funcion-cola_descargar" title="Permanent link">&para;</a></h2>
<h4 id="proposito_19"><strong>Propósito</strong><a class="headerlink" href="#proposito_19" title="Permanent link">&para;</a></h4>
<p>Inicia la descarga de un archivo desde un botón en una página web, espera la finalización de la descarga, y renombra el archivo más reciente en el directorio de descargas con un nombre basado en una opción especificada.</p>
<hr />
<h4 id="entradas_19"><strong>Entradas</strong><a class="headerlink" href="#entradas_19" title="Permanent link">&para;</a></h4>
<ul>
<li><strong><code>driver</code> (WebDriver):</strong> Instancia del controlador Selenium.</li>
<li><strong><code>archivo</code> (str):</strong> Nombre base para renombrar el archivo descargado.</li>
<li><strong><code>download_dir</code> (str):</strong> Ruta del directorio donde se descargan los archivos.</li>
<li><strong><code>opcion</code> (str):</strong> Valor adicional que se añadirá al nombre del archivo al renombrarlo.</li>
<li><strong><code>kwargs</code> (dict, opcional):</strong> Argumentos adicionales:</li>
<li><strong><code>wait_time</code> (int):</strong> Tiempo de espera en segundos para la descarga (por defecto: <code>10</code>).</li>
<li><strong><code>xpath_omitir</code> (str):</strong> XPath de un botón opcional para omitir antes de iniciar la descarga.</li>
<li>Localizadores del botón de descarga (<code>xpath</code>, <code>id</code>, <code>name</code>, etc.).</li>
</ul>
<hr />
<h4 id="funcionamiento_17"><strong>Funcionamiento</strong><a class="headerlink" href="#funcionamiento_17" title="Permanent link">&para;</a></h4>
<ol>
<li>
<p><strong>Omisión de popups:</strong></p>
<ul>
<li>Si se proporciona <code>xpath_omitir</code>, busca el elemento correspondiente y hace clic en él si está presente.</li>
</ul>
</li>
<li>
<p><strong>Configuración del botón de descarga:</strong></p>
<ul>
<li>Determina el tipo y valor del localizador para identificar el botón de descarga.</li>
<li>Espera hasta que el botón sea clickeable y realiza clic.</li>
</ul>
</li>
<li>
<p><strong>Monitoreo del directorio de descargas:</strong></p>
<ul>
<li>Compara el estado del directorio antes y después de la descarga.</li>
<li>Espera hasta 10 segundos para detectar un nuevo archivo.</li>
</ul>
</li>
<li>
<p><strong>Renombrar archivo descargado:</strong></p>
<ul>
<li>Identifica el archivo nuevo más reciente en el directorio.</li>
<li>Renombra el archivo con el formato: <code>nombre_base_opcion.extension</code>.</li>
</ul>
</li>
<li>
<p><strong>Manejo de errores:</strong></p>
<ul>
<li>Captura excepciones relacionadas con tiempo de espera, elementos no encontrados o no interactuables, y registra el error en el log.</li>
</ul>
</li>
</ol>
<hr />
<h4 id="salida_18"><strong>Salida</strong><a class="headerlink" href="#salida_18" title="Permanent link">&para;</a></h4>
<ul>
<li><strong><code>True</code>:</strong> Si el archivo se descargó y renombró correctamente.</li>
<li><strong><code>False</code>:</strong> Si no se detectó el archivo dentro del tiempo especificado o hubo un error durante el proceso.</li>
</ul>
<hr />
<h4 id="consideraciones_4"><strong>Consideraciones</strong><a class="headerlink" href="#consideraciones_4" title="Permanent link">&para;</a></h4>
<ul>
<li>Asegúrese de proporcionar un localizador válido (<code>locator_type</code> y <code>locator_value</code>) para identificar el botón de descarga.</li>
<li>La función maneja escenarios donde puede ser necesario omitir popups antes de descargar.</li>
<li>Diseñada para flujos de automatización que requieren monitorear y renombrar archivos descargados dinámicamente.</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">cola_descargar</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="n">archivo</span><span class="p">,</span> <span class="n">download_dir</span><span class="p">,</span> <span class="n">opcion</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Inicia la descarga de un archivo, espera el tiempo especificado y renombra</span>
<span class="sd">    el archivo más reciente en la carpeta de descargas con el nombre y la opción especificados.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Verificar si se pasa un &#39;xpath_omitir&#39; y, en caso afirmativo, si el elemento existe</span>
        <span class="n">xpath_omitir</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;xpath_omitir&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">xpath_omitir</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">omitir_button</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">xpath_omitir</span><span class="p">)</span>
                <span class="n">omitir_button</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Omitido el clic en el botón de descarga: </span><span class="si">{</span><span class="n">xpath_omitir</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">True</span>
            <span class="k">except</span> <span class="n">NoSuchElementException</span><span class="p">:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Elemento con xpath_omitir &#39;</span><span class="si">{</span><span class="n">xpath_omitir</span><span class="si">}</span><span class="s2">&#39; no encontrado, continuando con la descarga&quot;</span><span class="p">)</span>

        <span class="c1"># Configuración de los parámetros de localización del botón de descarga</span>
        <span class="n">locator_type</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">locator_value</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">wait_time</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;wait_time&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">{</span><span class="s1">&#39;wait_time&#39;</span><span class="p">,</span> <span class="s1">&#39;archivo&#39;</span><span class="p">,</span> <span class="s1">&#39;xpath_omitir&#39;</span><span class="p">}</span> <span class="ow">and</span> <span class="n">value</span><span class="p">:</span>
                <span class="n">locator_type</span> <span class="o">=</span> <span class="n">key</span>
                <span class="n">locator_value</span> <span class="o">=</span> <span class="n">value</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">locator_type</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">locator_value</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Debe proporcionar un &#39;locator_type&#39; y un &#39;locator_value&#39; válidos&quot;</span><span class="p">)</span>

        <span class="n">by_mapping</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;xpath&#39;</span><span class="p">:</span> <span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span>
            <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="n">By</span><span class="o">.</span><span class="n">ID</span><span class="p">,</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">By</span><span class="o">.</span><span class="n">NAME</span><span class="p">,</span>
            <span class="s1">&#39;class_name&#39;</span><span class="p">:</span> <span class="n">By</span><span class="o">.</span><span class="n">CLASS_NAME</span><span class="p">,</span>
            <span class="s1">&#39;css_selector&#39;</span><span class="p">:</span> <span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span>
            <span class="s1">&#39;link_text&#39;</span><span class="p">:</span> <span class="n">By</span><span class="o">.</span><span class="n">LINK_TEXT</span><span class="p">,</span>
            <span class="s1">&#39;partial_link_text&#39;</span><span class="p">:</span> <span class="n">By</span><span class="o">.</span><span class="n">PARTIAL_LINK_TEXT</span><span class="p">,</span>
            <span class="s1">&#39;tag_name&#39;</span><span class="p">:</span> <span class="n">By</span><span class="o">.</span><span class="n">TAG_NAME</span>
        <span class="p">}</span>
        <span class="c1"># Obtener el número de archivos antes de la descarga</span>
        <span class="n">archivos_antes</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">download_dir</span><span class="p">))</span>

        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Esperando la presencia del elemento </span><span class="si">{</span><span class="n">locator_type</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">locator_value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">download_button</span> <span class="o">=</span> <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span>
            <span class="n">EC</span><span class="o">.</span><span class="n">element_to_be_clickable</span><span class="p">((</span><span class="n">by_mapping</span><span class="p">[</span><span class="n">locator_type</span><span class="p">],</span> <span class="n">locator_value</span><span class="p">))</span>
        <span class="p">)</span>
        <span class="n">download_button</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Botón de descarga clickeado, esperando </span><span class="si">{</span><span class="n">wait_time</span><span class="si">}</span><span class="s2"> segundos para la descarga&quot;</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>

        <span class="c1"># Esperar a que un archivo nuevo aparezca en el directorio</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
            <span class="n">archivos_despues</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">download_dir</span><span class="p">))</span>
            <span class="n">archivos_nuevos</span> <span class="o">=</span> <span class="n">archivos_despues</span> <span class="o">-</span> <span class="n">archivos_antes</span>  <span class="c1"># Detectar nuevos archivos</span>
            <span class="k">if</span> <span class="n">archivos_nuevos</span><span class="p">:</span>
                <span class="c1"># Obtener el archivo nuevo más reciente</span>
                <span class="n">latest_file</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">archivos_nuevos</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">f</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getctime</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">download_dir</span><span class="p">,</span> <span class="n">f</span><span class="p">)))</span>
                <span class="n">latest_file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">download_dir</span><span class="p">,</span> <span class="n">latest_file</span><span class="p">)</span>

                <span class="c1"># Renombrar el archivo descargado</span>
                <span class="n">base_name</span><span class="p">,</span> <span class="n">extension</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">archivo</span><span class="p">)</span>
                <span class="n">new_file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">download_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">base_name</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">opcion</span><span class="si">}{</span><span class="n">extension</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="n">os</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">latest_file_path</span><span class="p">,</span> <span class="n">new_file_path</span><span class="p">)</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Archivo renombrado a: </span><span class="si">{</span><span class="n">new_file_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">True</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Esperando que la descarga se complete...&quot;</span><span class="p">)</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;No se encontró el archivo descargado.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">except</span> <span class="p">(</span><span class="n">TimeoutException</span><span class="p">,</span> <span class="n">NoSuchElementException</span><span class="p">,</span> <span class="n">ElementNotInteractableException</span><span class="p">,</span> <span class="n">StaleElementReferenceException</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error al intentar descargar el archivo con </span><span class="si">{</span><span class="n">locator_type</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">locator_value</span><span class="si">}</span><span class="s2"> - Detalles: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
<h2 id="funcion-seleccionar_opcion_custom_dropdown">Función <code>seleccionar_opcion_custom_dropdown</code><a class="headerlink" href="#funcion-seleccionar_opcion_custom_dropdown" title="Permanent link">&para;</a></h2>
<h4 id="proposito_20"><strong>Propósito</strong><a class="headerlink" href="#proposito_20" title="Permanent link">&para;</a></h4>
<p>Selecciona una opción específica en un menú desplegable personalizado (custom dropdown) en una página web controlada por Selenium.</p>
<hr />
<h4 id="entradas_20"><strong>Entradas</strong><a class="headerlink" href="#entradas_20" title="Permanent link">&para;</a></h4>
<ul>
<li><strong><code>driver</code> (WebDriver):</strong> Instancia del controlador Selenium.</li>
<li><strong><code>kwargs</code> (dict):</strong> Argumentos clave para configurar la operación:</li>
<li><strong><code>xpath</code> (str):</strong> Localización del botón del menú desplegable.</li>
<li><strong><code>option</code> (str):</strong> Texto de la opción que se desea seleccionar.</li>
<li><strong><code>wait_time</code> (int, opcional):</strong> Tiempo en segundos para esperar después de desplegar el menú (por defecto: <code>2</code>).</li>
</ul>
<hr />
<h4 id="funcionamiento_18"><strong>Funcionamiento</strong><a class="headerlink" href="#funcionamiento_18" title="Permanent link">&para;</a></h4>
<ol>
<li>
<p><strong>Verificación de parámetros:</strong></p>
<ul>
<li>Verifica que se hayan proporcionado un <code>xpath</code> válido para el botón del dropdown y un <code>option</code> para seleccionar.</li>
</ul>
</li>
<li>
<p><strong>Desplegar el menú:</strong></p>
<ul>
<li>Localiza el botón del menú usando <code>xpath</code>.</li>
<li>Hace clic para desplegar el menú.</li>
</ul>
</li>
<li>
<p><strong>Seleccionar la opción:</strong></p>
<ul>
<li>Intenta localizar y seleccionar la opción utilizando texto exacto.</li>
<li>Si no encuentra la opción, intenta con una búsqueda flexible que utiliza <code>contains</code>.</li>
</ul>
</li>
<li>
<p><strong>Manejo de errores:</strong></p>
<ul>
<li>Captura excepciones relacionadas con tiempo de espera, elementos no encontrados o no interactuables, y registra el error en el log.</li>
</ul>
</li>
</ol>
<hr />
<h4 id="salida_19"><strong>Salida</strong><a class="headerlink" href="#salida_19" title="Permanent link">&para;</a></h4>
<ul>
<li>No retorna valores. Realiza la acción en el menú desplegable y registra el estado del proceso en el log.</li>
</ul>
<hr />
<h4 id="consideraciones_5"><strong>Consideraciones</strong><a class="headerlink" href="#consideraciones_5" title="Permanent link">&para;</a></h4>
<ul>
<li>Diseñada para trabajar con menús desplegables personalizados que contienen opciones identificadas por texto.</li>
<li>Incluye una lógica de respaldo para localizar opciones cuando no se encuentran con texto exacto.</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">seleccionar_opcion_custom_dropdown</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Seleccionando opción en un menú desplegable personalizado&quot;</span><span class="p">)</span>
        <span class="n">xpath_boton</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;xpath&#39;</span><span class="p">)</span>
        <span class="n">option_value</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;option&#39;</span><span class="p">)</span>
        <span class="n">wait_time</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;wait_time&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>  <span class="c1"># Manejar &#39;wait_time&#39; con valor por defecto</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">xpath_boton</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">option_value</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Debe proporcionar &#39;xpath&#39; y &#39;option&#39; válidos&quot;</span><span class="p">)</span>

        <span class="c1"># Hacer clic en el botón para desplegar el menú</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Haciendo clic en el menú desplegable con xpath: </span><span class="si">{</span><span class="n">xpath_boton</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">dropdown</span> <span class="o">=</span> <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span><span class="n">EC</span><span class="o">.</span><span class="n">element_to_be_clickable</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">xpath_boton</span><span class="p">)))</span>
        <span class="n">dropdown</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>  <span class="c1"># Pausa breve para que el menú se despliegue completamente</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Seleccionar la opción del menú desplegable</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Seleccionando la opción &#39;</span><span class="si">{</span><span class="n">option_value</span><span class="si">}</span><span class="s2">&#39; en el menú desplegable&quot;</span><span class="p">)</span>

            <span class="c1"># Intentar buscar la opción con texto exacto</span>
            <span class="n">opcion</span> <span class="o">=</span> <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span>
                <span class="n">EC</span><span class="o">.</span><span class="n">element_to_be_clickable</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;//ul[contains(@class, &#39;dropdown-menu&#39;)]//span[text()=&#39;</span><span class="si">{</span><span class="n">option_value</span><span class="si">}</span><span class="s2">&#39;]&quot;</span><span class="p">))</span>
            <span class="p">)</span>
            <span class="n">opcion</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Opción &#39;</span><span class="si">{</span><span class="n">option_value</span><span class="si">}</span><span class="s2">&#39; seleccionada correctamente.&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">TimeoutException</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No se encontró la opción &#39;</span><span class="si">{</span><span class="n">option_value</span><span class="si">}</span><span class="s2">&#39; con texto exacto. Intentando con búsqueda flexible...&quot;</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># Intentar con búsqueda más flexible usando `contains`</span>
                <span class="n">opcion</span> <span class="o">=</span> <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span>
                    <span class="n">EC</span><span class="o">.</span><span class="n">element_to_be_clickable</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;//ul[contains(@class, &#39;dropdown-menu&#39;)]//span[contains(normalize-space(text()), &#39;</span><span class="si">{</span><span class="n">option_value</span><span class="si">}</span><span class="s2">&#39;)]&quot;</span><span class="p">))</span>
                <span class="p">)</span>
                <span class="n">opcion</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Opción &#39;</span><span class="si">{</span><span class="n">option_value</span><span class="si">}</span><span class="s2">&#39; seleccionada correctamente usando búsqueda flexible.&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error al seleccionar la opción &#39;</span><span class="si">{</span><span class="n">option_value</span><span class="si">}</span><span class="s2">&#39;: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Opción &#39;</span><span class="si">{</span><span class="n">option_value</span><span class="si">}</span><span class="s2">&#39; seleccionada correctamente en el menú desplegable&quot;</span><span class="p">)</span>

    <span class="k">except</span> <span class="p">(</span><span class="n">TimeoutException</span><span class="p">,</span> <span class="n">NoSuchElementException</span><span class="p">,</span> <span class="n">ElementNotInteractableException</span><span class="p">,</span> <span class="n">StaleElementReferenceException</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error al seleccionar la opción en el menú desplegable personalizado: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="c1">#raise</span>
</code></pre></div>
<p><code>listar_archivos_descargados</code> lista y registra los nombres de los archivos presentes en el directorio de descargas especificado.</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">listar_archivos_descargados</span><span class="p">():</span>
    <span class="n">archivos</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">DOWNLOAD_DIR</span><span class="p">)</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Archivos en la carpeta &#39;</span><span class="si">{</span><span class="n">DOWNLOAD_DIR</span><span class="si">}</span><span class="s2">&#39;: </span><span class="si">{</span><span class="n">archivos</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">archivos</span>
</code></pre></div>
<h2 id="funcion-obtener_elementos_dropdown">Función <code>obtener_elementos_dropdown</code><a class="headerlink" href="#funcion-obtener_elementos_dropdown" title="Permanent link">&para;</a></h2>
<h4 id="proposito_21"><strong>Propósito</strong><a class="headerlink" href="#proposito_21" title="Permanent link">&para;</a></h4>
<p>Extrae las opciones disponibles en un menú desplegable (<code>dropdown</code>) en una página web controlada por Selenium.</p>
<hr />
<h4 id="entradas_21"><strong>Entradas</strong><a class="headerlink" href="#entradas_21" title="Permanent link">&para;</a></h4>
<ul>
<li><strong><code>driver</code> (WebDriver):</strong> Instancia del controlador Selenium.</li>
<li><strong><code>boton_xpath</code> (str):</strong> XPath del botón para abrir el menú desplegable.</li>
<li><strong><code>elementos_xpath</code> (str):</strong> XPath del contenedor que contiene las opciones del menú.</li>
<li><strong><code>nivel</code> (int):</strong> Nivel o jerarquía del dropdown para fines de registro y depuración.</li>
</ul>
<hr />
<h4 id="funcionamiento_19"><strong>Funcionamiento</strong><a class="headerlink" href="#funcionamiento_19" title="Permanent link">&para;</a></h4>
<ol>
<li>
<p><strong>Interacción con el botón del dropdown:</strong></p>
<ul>
<li>Espera hasta que el botón esté visible y clickeable.</li>
<li>Hace scroll para asegurar que el botón esté en la vista.</li>
<li>Usa JavaScript para forzar el clic en caso necesario.</li>
</ul>
</li>
<li>
<p><strong>Extracción de opciones:</strong></p>
<ul>
<li>Espera a que el contenedor de opciones esté visible.</li>
<li>Encuentra todos los elementos <code>&lt;li&gt;</code> dentro del contenedor <code>&lt;ul&gt;</code>.</li>
<li>Para cada elemento:</li>
<li>Obtiene el texto de la opción.</li>
<li>Filtra opciones vacías o con texto no deseado como "Seleccione".</li>
<li>Agrega el texto al resultado.</li>
</ul>
</li>
<li>
<p><strong>Registro:</strong></p>
<ul>
<li>Registra en el log el nivel del dropdown y las opciones extraídas.</li>
</ul>
</li>
<li>
<p><strong>Manejo de errores:</strong></p>
<ul>
<li>Captura excepciones por tiempo de espera o errores generales, las registra y devuelve una lista vacía.</li>
</ul>
</li>
</ol>
<hr />
<h4 id="salida_20"><strong>Salida</strong><a class="headerlink" href="#salida_20" title="Permanent link">&para;</a></h4>
<ul>
<li><strong><code>list</code>:</strong> Lista de textos de las opciones extraídas del menú desplegable.</li>
</ul>
<hr />
<h4 id="consideraciones_6"><strong>Consideraciones</strong><a class="headerlink" href="#consideraciones_6" title="Permanent link">&para;</a></h4>
<ul>
<li>Excluye opciones con texto vacío o "Seleccione".</li>
<li>Diseñada para manejar menús desplegables con opciones representadas como elementos <code>&lt;li&gt;</code>.</li>
<li>El parámetro <code>nivel</code> permite rastrear jerarquías de dropdowns en procesos complejos.</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="nd">@log_step_decorator</span><span class="p">(</span><span class="s2">&quot;Obtener elementos dropdown&quot;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">obtener_elementos_dropdown</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="n">boton_xpath</span><span class="p">,</span> <span class="n">elementos_xpath</span><span class="p">,</span> <span class="n">nivel</span><span class="p">):</span>

    <span class="n">opciones</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[Nivel </span><span class="si">{</span><span class="n">nivel</span><span class="si">}</span><span class="s2">] Intentando abrir dropdown en: </span><span class="si">{</span><span class="n">boton_xpath</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Esperar hasta que el botón esté habilitado y visible en la pantalla</span>
        <span class="n">boton_dropdown</span> <span class="o">=</span> <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">15</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span>
            <span class="n">EC</span><span class="o">.</span><span class="n">element_to_be_clickable</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">boton_xpath</span><span class="p">))</span>
        <span class="p">)</span>

        <span class="c1"># Intentar hacer scroll para que el botón sea visible</span>
        <span class="n">driver</span><span class="o">.</span><span class="n">execute_script</span><span class="p">(</span><span class="s2">&quot;arguments[0].scrollIntoView();&quot;</span><span class="p">,</span> <span class="n">boton_dropdown</span><span class="p">)</span>

        <span class="c1"># Usar JavaScript para forzar el clic si es necesario</span>
        <span class="n">driver</span><span class="o">.</span><span class="n">execute_script</span><span class="p">(</span><span class="s2">&quot;arguments[0].click();&quot;</span><span class="p">,</span> <span class="n">boton_dropdown</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># Pausa breve para permitir la expansión completa del dropdown</span>

        <span class="c1"># Esperar a que el contenedor de opciones del dropdown esté visible</span>
        <span class="n">elementos_ul</span> <span class="o">=</span> <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">15</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span>
            <span class="n">EC</span><span class="o">.</span><span class="n">visibility_of_element_located</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">elementos_xpath</span><span class="p">))</span>
        <span class="p">)</span>

        <span class="c1"># Obtener todos los elementos &lt;li&gt; visibles dentro de `ul`</span>
        <span class="n">elementos_li</span> <span class="o">=</span> <span class="n">elementos_ul</span><span class="o">.</span><span class="n">find_elements</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="s2">&quot;./li&quot;</span><span class="p">)</span>

        <span class="c1"># Extraer y almacenar el texto y XPath de cada opción en el dropdown</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">elemento</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">elementos_li</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># Obtener el texto de la opción</span>
                <span class="n">texto_opcion</span> <span class="o">=</span> <span class="n">elemento</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="s2">&quot;.//span[@class=&#39;text&#39;]&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

                <span class="k">if</span> <span class="n">texto_opcion</span> <span class="ow">and</span> <span class="n">texto_opcion</span> <span class="o">!=</span> <span class="s2">&quot;Seleccione&quot;</span><span class="p">:</span>  <span class="c1"># Excluir texto vacío y &quot;Seleccione&quot;</span>
                    <span class="c1"># Construir un XPath único para el elemento basado en su posición (index)</span>
                    <span class="n">xpath_opcion</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">elementos_xpath</span><span class="si">}</span><span class="s2">/li[</span><span class="si">{</span><span class="n">index</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">]/a&quot;</span>  <span class="c1"># Ejemplo de XPath con índice</span>

                    <span class="c1"># Agregar el texto y el XPath al resultado</span>
                    <span class="n">opciones</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">texto_opcion</span><span class="p">)</span>                    
                    <span class="c1"># _opciones.append({&quot;text&quot;: texto_opcion,&quot;xpath&quot;: xpath_opcion})</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">inner_e</span><span class="p">:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[Nivel </span><span class="si">{</span><span class="n">nivel</span><span class="si">}</span><span class="s2">] No se pudo obtener el texto de una opción: </span><span class="si">{</span><span class="n">inner_e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[Nivel </span><span class="si">{</span><span class="n">nivel</span><span class="si">}</span><span class="s2">] Opciones obtenidas: </span><span class="si">{</span><span class="n">opciones</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">opciones</span>

    <span class="k">except</span> <span class="n">TimeoutException</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[Nivel </span><span class="si">{</span><span class="n">nivel</span><span class="si">}</span><span class="s2">] El dropdown no se pudo abrir debido a un Timeout.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[]</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[Nivel </span><span class="si">{</span><span class="n">nivel</span><span class="si">}</span><span class="s2">] Error al obtener elementos del dropdown: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[]</span>
</code></pre></div>
<h2 id="funcion-eliminar_archivos_anteriores">Función <code>eliminar_archivos_anteriores</code><a class="headerlink" href="#funcion-eliminar_archivos_anteriores" title="Permanent link">&para;</a></h2>
<h4 id="proposito_22"><strong>Propósito</strong><a class="headerlink" href="#proposito_22" title="Permanent link">&para;</a></h4>
<p>Elimina todos los archivos en un directorio de descargas que coincidan con un nombre base especificado, incluyendo variantes como <code>'Nombre'</code>, <code>'Nombre (1)'</code>, <code>'Nombre (2)'</code>, etc.</p>
<hr />
<h4 id="entradas_22"><strong>Entradas</strong><a class="headerlink" href="#entradas_22" title="Permanent link">&para;</a></h4>
<ul>
<li><strong><code>nombre_archivo</code> (str):</strong> Nombre base del archivo cuyos duplicados o variantes deben ser eliminados.</li>
<li><strong><code>download_dir</code> (str):</strong> Ruta del directorio donde se buscarán los archivos a eliminar.</li>
</ul>
<hr />
<h4 id="funcionamiento_20"><strong>Funcionamiento</strong><a class="headerlink" href="#funcionamiento_20" title="Permanent link">&para;</a></h4>
<ol>
<li>
<p><strong>Construcción del patrón de coincidencia:</strong></p>
<ul>
<li>Extrae el nombre base del archivo sin extensión.</li>
<li>Crea un patrón de expresión regular que coincida con el nombre base seguido de cualquier texto adicional (como <code>' (1)'</code>) y cualquier extensión.</li>
</ul>
</li>
<li>
<p><strong>Búsqueda y eliminación de archivos:</strong></p>
<ul>
<li>Itera sobre los archivos en el directorio especificado.</li>
<li>Si un archivo coincide con el patrón, lo elimina y registra la acción en el log.</li>
</ul>
</li>
</ol>
<hr />
<h4 id="salida_21"><strong>Salida</strong><a class="headerlink" href="#salida_21" title="Permanent link">&para;</a></h4>
<ul>
<li>No retorna valores. Realiza acciones directamente en el sistema de archivos y registra los archivos eliminados en el log.</li>
</ul>
<hr />
<h4 id="consideraciones_7"><strong>Consideraciones</strong><a class="headerlink" href="#consideraciones_7" title="Permanent link">&para;</a></h4>
<ul>
<li>Diseñada para gestionar directorios de descargas en flujos automatizados, asegurando que no queden residuos de ejecuciones anteriores.</li>
<li>Verifica patrones de archivos con extensiones genéricas (<code>.txt</code>, <code>.xlsx</code>, etc.). Si se espera un tipo específico, asegúrese de que el nombre y patrón sean precisos.</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">eliminar_archivos_anteriores</span><span class="p">(</span><span class="n">nombre_archivo</span><span class="p">,</span> <span class="n">download_dir</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Elimina todos los archivos en el directorio de descargas que coincidan con el nombre</span>
<span class="sd">    especificado o patrones como &#39;Nombre&#39;, &#39;Nombre (1)&#39;, &#39;Nombre (2)&#39;, etc.</span>

<span class="sd">    Args:</span>
<span class="sd">        nombre_archivo (str): El nombre base del archivo a eliminar.</span>
<span class="sd">        download_dir (str): El directorio donde se buscarán los archivos.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">nombre_base</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">nombre_archivo</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># Remueve la extensión del archivo</span>
    <span class="n">patron</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">rf</span><span class="s2">&quot;^</span><span class="si">{</span><span class="n">re</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="n">nombre_base</span><span class="p">)</span><span class="si">}</span><span class="s2">.*\.[a-zA-Z0-9]+$&quot;</span><span class="p">)</span>  <span class="c1"># Coincidir con cualquier extensión de archivo</span>

    <span class="k">for</span> <span class="n">archivo</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">download_dir</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">patron</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">archivo</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">download_dir</span><span class="p">,</span> <span class="n">archivo</span><span class="p">))</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Archivo eliminado: </span><span class="si">{</span><span class="n">archivo</span><span class="si">}</span><span class="s2"> en </span><span class="si">{</span><span class="n">download_dir</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
<p><code>limpiar_carpeta</code> elimina todos los archivos con extensiones <code>.csv</code>, <code>.xls</code> y <code>.xlsx</code> del directorio de descargas especificado (<code>download_dir</code>). Utiliza un decorador para registrar el inicio y finalización del proceso, además de registrar cada archivo eliminado en el log.</p>
<div class="highlight"><pre><span></span><code><span class="nd">@log_step_decorator</span><span class="p">(</span><span class="s2">&quot;Limpiar carpeta de descargas&quot;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">limpiar_carpeta</span><span class="p">(</span><span class="n">download_dir</span><span class="p">):</span>
    <span class="c1">#Eliminar todos los archivos (scv,xls,xlsx) de la carpeta </span>
    <span class="k">for</span> <span class="n">archivo</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">download_dir</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">archivo</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.csv&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">archivo</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.xls&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">archivo</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.xlsx&quot;</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">download_dir</span><span class="p">,</span> <span class="n">archivo</span><span class="p">))</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Archivo eliminado: </span><span class="si">{</span><span class="n">archivo</span><span class="si">}</span><span class="s2"> en </span><span class="si">{</span><span class="n">download_dir</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>    
</code></pre></div>
<p><code>verificar_y_hacer_clic</code> localiza un elemento en la página mediante un XPath proporcionado, realiza un clic en él y envía un texto seguido de la tecla Enter. Si el elemento no se encuentra, captura la excepción y continúa sin interrupciones. Retorna <code>True</code> si la acción fue exitosa; de lo contrario, no retorna valor.</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">verificar_y_hacer_clic</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="n">xpath</span><span class="p">,</span> <span class="n">wait_time</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Verifica si un elemento con el XPath especificado existe.</span>
<span class="sd">    Si existe, hace clic en él.</span>

<span class="sd">    :param driver: instancia del controlador de Selenium.</span>
<span class="sd">    :param xpath: cadena XPath del elemento a verificar y hacer clic.</span>
<span class="sd">    :param wait_time: tiempo opcional para esperar después del clic.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">elemento</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">xpath</span><span class="p">)</span>
        <span class="n">elemento</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
        <span class="n">elemento</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="s2">&quot;texto para enviar&quot;</span> <span class="o">+</span> <span class="n">Keys</span><span class="o">.</span><span class="n">ENTER</span><span class="p">)</span>        
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Elemento encontrado y clic realizado en el XPath: </span><span class="si">{</span><span class="n">xpath</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">wait_time</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">except</span> <span class="n">NoSuchElementException</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Elemento no encontrado en el XPath: </span><span class="si">{</span><span class="n">xpath</span><span class="si">}</span><span class="s2">, continuando.&quot;</span><span class="p">)</span>
</code></pre></div>
<h2 id="funcion-pre_procesamiento">Función <code>pre_procesamiento</code><a class="headerlink" href="#funcion-pre_procesamiento" title="Permanent link">&para;</a></h2>
<h4 id="proposito_23"><strong>Propósito</strong><a class="headerlink" href="#proposito_23" title="Permanent link">&para;</a></h4>
<p>Automatiza la selección de opciones en un menú desplegable, filtra opciones no deseadas y gestiona las descargas asociadas.</p>
<hr />
<h4 id="entradas_23"><strong>Entradas</strong><a class="headerlink" href="#entradas_23" title="Permanent link">&para;</a></h4>
<ul>
<li><strong><code>driver</code> (WebDriver):</strong> Controlador Selenium utilizado para interactuar con la página.</li>
<li><strong><code>download_dir</code> (str):</strong> Ruta al directorio donde se guardan las descargas.</li>
<li><strong><code>id_descargar</code> (str):</strong> ID del botón que inicia la descarga.</li>
<li><strong><code>nombre_archivo</code> (str):</strong> Nombre base para los archivos descargados.</li>
<li><strong><code>nombre_archivo_completo</code> (str):</strong> Nombre completo esperado del archivo descargado.</li>
<li><strong><code>xpath_boton</code> (str):</strong> XPath del botón para desplegar el menú.</li>
<li><strong><code>xpath_contenedor_opciones</code> (str):</strong> XPath del contenedor que contiene las opciones del menú.</li>
<li><strong><code>tipo</code> (str):</strong> Tipo de descarga:</li>
<li><strong><code>modal</code></strong>: Descargas que requieren interacción con un modal.</li>
<li><strong><code>directa</code></strong>: Descargas iniciadas directamente desde el menú desplegable.</li>
<li><strong><code>excluir_opciones</code> (list):</strong> Lista de opciones que no deben ser procesadas.</li>
</ul>
<hr />
<h4 id="funcionamiento_21"><strong>Funcionamiento</strong><a class="headerlink" href="#funcionamiento_21" title="Permanent link">&para;</a></h4>
<ol>
<li>
<p><strong>Obtención de opciones:</strong></p>
<ul>
<li>Utiliza la función <code>obtener_elementos_dropdown</code> para extraer todas las opciones visibles en el menú desplegable.</li>
</ul>
</li>
<li>
<p><strong>Filtrado de opciones:</strong></p>
<ul>
<li>Excluye las opciones especificadas en <code>excluir_opciones</code>.</li>
</ul>
</li>
<li>
<p><strong>Registro:</strong></p>
<ul>
<li>Registra las opciones finales que serán procesadas en el log para facilitar la depuración.</li>
</ul>
</li>
<li>
<p><strong>Procesamiento de cada opción:</strong></p>
<ul>
<li>Itera sobre las opciones filtradas y llama a la función <code>procesar_opciones_descarga</code>:</li>
<li>Gestiona la interacción con el menú desplegable.</li>
<li>Inicia las descargas según el tipo especificado (<code>modal</code> o <code>directa</code>).</li>
<li>Asegura el manejo adecuado de archivos en el directorio de descargas.</li>
</ul>
</li>
</ol>
<hr />
<h4 id="salida_22"><strong>Salida</strong><a class="headerlink" href="#salida_22" title="Permanent link">&para;</a></h4>
<ul>
<li>No retorna valores. Realiza las acciones de selección, exclusión y descarga automáticamente.</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">pre_procesamiento</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> 
                <span class="n">download_dir</span><span class="p">,</span>
                <span class="n">id_descargar</span><span class="p">,</span>
                <span class="n">nombre_archivo</span><span class="p">,</span>
                <span class="n">nombre_archivo_completo</span><span class="p">,</span>
                <span class="n">xpath_boton</span><span class="p">,</span>
                <span class="n">xpath_contenedor_opciones</span><span class="p">,</span>
                <span class="n">tipo</span><span class="p">,</span>
                <span class="n">excluir_opciones</span><span class="p">):</span>

    <span class="n">opciones</span> <span class="o">=</span> <span class="n">obtener_elementos_dropdown</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="n">xpath_boton</span><span class="p">,</span> <span class="n">xpath_contenedor_opciones</span><span class="p">,</span> <span class="n">nivel</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">opciones</span> <span class="o">=</span> <span class="p">[</span><span class="n">opcion</span> <span class="k">for</span> <span class="n">opcion</span> <span class="ow">in</span> <span class="n">opciones</span> <span class="k">if</span> <span class="n">opcion</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">excluir_opciones</span><span class="p">]</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Opciones a seleccionar: </span><span class="si">{</span><span class="n">opciones</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">procesar_opciones_descarga</span><span class="p">(</span>
        <span class="n">driver</span><span class="o">=</span><span class="n">driver</span><span class="p">,</span>
        <span class="n">opciones</span><span class="o">=</span><span class="n">opciones</span><span class="p">,</span>
        <span class="n">xpath_boton</span><span class="o">=</span><span class="n">xpath_boton</span><span class="p">,</span>
        <span class="n">id_descargar</span><span class="o">=</span><span class="n">id_descargar</span><span class="p">,</span>
        <span class="n">nombre_archivo</span><span class="o">=</span><span class="n">nombre_archivo</span><span class="p">,</span>
        <span class="n">nombre_archivo_completo</span><span class="o">=</span><span class="n">nombre_archivo_completo</span><span class="p">,</span>
        <span class="n">download_dir</span><span class="o">=</span><span class="n">download_dir</span><span class="p">,</span>
        <span class="n">wait_time</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
        <span class="n">tipo</span><span class="o">=</span><span class="n">tipo</span><span class="p">,</span>
        <span class="n">xpath_omitir</span><span class="o">=</span><span class="s1">&#39;/html/body/div[10]&#39;</span>
    <span class="p">)</span>
</code></pre></div>
<h2 id="funcion-pre_procesamiento_periodo">Función <code>pre_procesamiento_periodo</code><a class="headerlink" href="#funcion-pre_procesamiento_periodo" title="Permanent link">&para;</a></h2>
<h4 id="proposito_24"><strong>Propósito</strong><a class="headerlink" href="#proposito_24" title="Permanent link">&para;</a></h4>
<p>Automatiza la selección de períodos específicos desde un menú desplegable, filtra los períodos disponibles en función de un conjunto de años, y gestiona las descargas asociadas.</p>
<hr />
<h4 id="entradas_24"><strong>Entradas</strong><a class="headerlink" href="#entradas_24" title="Permanent link">&para;</a></h4>
<ul>
<li><strong><code>driver</code> (WebDriver):</strong> Controlador Selenium para manejar la interacción con la página.</li>
<li><strong><code>download_dir</code> (str):</strong> Directorio donde se guardarán las descargas.</li>
<li><strong><code>id_descargar</code> (str):</strong> ID del botón de descarga.</li>
<li><strong><code>nombre_archivo</code> (str):</strong> Nombre base del archivo descargado.</li>
<li><strong><code>nombre_archivo_completo</code> (str):</strong> Nombre completo esperado del archivo descargado.</li>
<li><strong><code>xpath_boton</code> (str):</strong> XPath del botón para desplegar el menú de períodos.</li>
<li><strong><code>xpath_contenedor_opciones</code> (str):</strong> XPath del contenedor de opciones del menú desplegable.</li>
<li><strong><code>tipo</code> (str):</strong> Tipo de descarga:</li>
<li><strong><code>modal</code></strong>: Descargas que requieren interacción con un modal.</li>
<li><strong><code>directa</code></strong>: Descargas iniciadas directamente desde el menú desplegable.</li>
<li><strong><code>items_opciones</code> (list):</strong> Lista de años a generar como períodos para consulta (e.g., <code>[2019, 2020]</code>).</li>
</ul>
<hr />
<h4 id="funcionamiento_22"><strong>Funcionamiento</strong><a class="headerlink" href="#funcionamiento_22" title="Permanent link">&para;</a></h4>
<ol>
<li>
<p><strong>Obtención de opciones del dropdown:</strong></p>
<ul>
<li>Llama a <code>obtener_elementos_dropdown</code> para extraer todas las opciones disponibles en el menú desplegable.</li>
</ul>
</li>
<li>
<p><strong>Generación de períodos de consulta:</strong></p>
<ul>
<li>Genera una lista de períodos en formato de cadena (<code>"2019"</code>, <code>"2020"</code>) a partir de los años en <code>items_opciones</code>.</li>
<li>Guarda los períodos generados en un diccionario para registro y depuración.</li>
</ul>
</li>
<li>
<p><strong>Filtrado de períodos:</strong></p>
<ul>
<li>Filtra las opciones del dropdown, reteniendo únicamente aquellas que comiencen con los períodos generados.</li>
</ul>
</li>
<li>
<p><strong>Registro de opciones:</strong></p>
<ul>
<li>Guarda las opciones filtradas en un diccionario y las registra en el log.</li>
</ul>
</li>
<li>
<p><strong>Procesamiento de opciones:</strong></p>
<ul>
<li>Llama a <code>procesar_opciones_descarga</code> para gestionar la interacción con el dropdown y realizar las descargas para cada período filtrado.</li>
</ul>
</li>
</ol>
<hr />
<h4 id="salida_23"><strong>Salida</strong><a class="headerlink" href="#salida_23" title="Permanent link">&para;</a></h4>
<ul>
<li>No retorna valores. Realiza las acciones de selección, filtrado y descarga automáticamente.</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">pre_procesamiento_periodo</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> 
                <span class="n">download_dir</span><span class="p">,</span>
                <span class="n">id_descargar</span><span class="p">,</span>
                <span class="n">nombre_archivo</span><span class="p">,</span>
                <span class="n">nombre_archivo_completo</span><span class="p">,</span>
                <span class="n">xpath_boton</span><span class="p">,</span>
                <span class="n">xpath_contenedor_opciones</span><span class="p">,</span>
                <span class="n">tipo</span><span class="p">,</span>
                <span class="n">items_opciones</span><span class="p">):</span>

    <span class="n">opciones</span> <span class="o">=</span> <span class="n">obtener_elementos_dropdown</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="n">xpath_boton</span><span class="p">,</span> <span class="n">xpath_contenedor_opciones</span><span class="p">,</span> <span class="n">nivel</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># Obtener los periodos disponibles en el dropdown</span>
    <span class="n">_periodos</span> <span class="o">=</span> <span class="n">opciones</span>

    <span class="c1"># Generar lista de periodos de consulta (2019, 2020)</span>
    <span class="n">consulta</span> <span class="o">=</span> <span class="n">items_opciones</span>
    <span class="n">periodos_generados</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">year</span> <span class="ow">in</span> <span class="n">consulta</span><span class="p">]</span>
    <span class="n">guardar_diccionario</span><span class="p">(</span><span class="n">periodos_generados</span><span class="p">,</span> <span class="s1">&#39;periodos_generados&#39;</span><span class="p">)</span>
    <span class="c1"># Filtrar solo los períodos que comiencen con los valores generados</span>
    <span class="n">opciones</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">periodo</span> <span class="k">for</span> <span class="n">periodo</span> <span class="ow">in</span> <span class="n">_periodos</span> 
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">periodo</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">generado</span><span class="p">)</span> <span class="k">for</span> <span class="n">generado</span> <span class="ow">in</span> <span class="n">periodos_generados</span><span class="p">)</span>
    <span class="p">]</span>
    <span class="n">guardar_diccionario</span><span class="p">(</span><span class="n">opciones</span><span class="p">,</span> <span class="s1">&#39;opciones&#39;</span><span class="p">)</span>    
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Opciones a seleccionar: </span><span class="si">{</span><span class="n">opciones</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">procesar_opciones_descarga</span><span class="p">(</span>
        <span class="n">driver</span><span class="o">=</span><span class="n">driver</span><span class="p">,</span>
        <span class="n">opciones</span><span class="o">=</span><span class="n">opciones</span><span class="p">,</span>
        <span class="n">xpath_boton</span><span class="o">=</span><span class="n">xpath_boton</span><span class="p">,</span>
        <span class="n">id_descargar</span><span class="o">=</span><span class="n">id_descargar</span><span class="p">,</span>
        <span class="n">nombre_archivo</span><span class="o">=</span><span class="n">nombre_archivo</span><span class="p">,</span>
        <span class="n">nombre_archivo_completo</span><span class="o">=</span><span class="n">nombre_archivo_completo</span><span class="p">,</span>
        <span class="n">download_dir</span><span class="o">=</span><span class="n">download_dir</span><span class="p">,</span>
        <span class="n">wait_time</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
        <span class="n">tipo</span><span class="o">=</span><span class="n">tipo</span><span class="p">,</span>
        <span class="n">xpath_omitir</span><span class="o">=</span><span class="s1">&#39;/html/body/div[10]&#39;</span>
    <span class="p">)</span>
</code></pre></div>
<h2 id="funcion-get_data_range">Función <code>get_data_range</code><a class="headerlink" href="#funcion-get_data_range" title="Permanent link">&para;</a></h2>
<h4 id="proposito_25"><strong>Propósito</strong><a class="headerlink" href="#proposito_25" title="Permanent link">&para;</a></h4>
<p>Obtiene un rango de datos de una hoja de un archivo Excel y devuelve los valores contenidos en ese rango.</p>
<hr />
<h4 id="entradas_25"><strong>Entradas</strong><a class="headerlink" href="#entradas_25" title="Permanent link">&para;</a></h4>
<ul>
<li><strong><code>file_path</code> (str):</strong> Ruta del archivo Excel a procesar.</li>
<li><strong><code>sheet_index</code> (int):</strong> Índice de la hoja en el archivo Excel de donde se extraerán los datos.</li>
</ul>
<hr />
<h4 id="funcionamiento_23"><strong>Funcionamiento</strong><a class="headerlink" href="#funcionamiento_23" title="Permanent link">&para;</a></h4>
<ol>
<li>
<p><strong>Carga del archivo:</strong></p>
<ul>
<li>Abre el archivo Excel en modo de solo lectura (<code>data_only=True</code>).</li>
</ul>
</li>
<li>
<p><strong>Validación del índice de la hoja:</strong></p>
<ul>
<li>Verifica que el índice proporcionado esté dentro del rango válido de hojas disponibles.</li>
<li>Lanza un <code>IndexError</code> si el índice no es válido.</li>
</ul>
</li>
<li>
<p><strong>Detección del rango de datos:</strong></p>
<ul>
<li>Itera sobre las celdas de la hoja para identificar los límites mínimos y máximos (filas y columnas) donde existen valores no vacíos.</li>
</ul>
</li>
<li>
<p><strong>Extracción de datos:</strong></p>
<ul>
<li>Con los límites detectados (<code>min_row</code>, <code>min_col</code>, <code>max_row</code>, <code>max_col</code>), se genera un rango.</li>
<li>Crea un iterador con los valores dentro del rango utilizando <code>sheet.iter_rows</code> con <code>values_only=True</code>.</li>
</ul>
</li>
</ol>
<hr />
<h4 id="salida_24"><strong>Salida</strong><a class="headerlink" href="#salida_24" title="Permanent link">&para;</a></h4>
<ul>
<li><strong><code>data</code> (iterable):</strong> Valores contenidos en el rango detectado de la hoja Excel.</li>
</ul>
<hr />
<h4 id="ejemplo-de-rango-detectado"><strong>Ejemplo de rango detectado</strong><a class="headerlink" href="#ejemplo-de-rango-detectado" title="Permanent link">&para;</a></h4>
<p>Si el rango de datos encontrado es:
- Desde la fila 2, columna 1
- Hasta la fila 10, columna 5</p>
<p>El rango corresponde a las celdas <code>A2:E10</code> en el archivo Excel.</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_data_range</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">sheet_index</span><span class="p">):</span>
    <span class="c1"># Cargar el archivo de Excel</span>
    <span class="n">workbook</span> <span class="o">=</span> <span class="n">load_workbook</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">data_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Verificar si el índice de la hoja es válido</span>
    <span class="k">if</span> <span class="n">sheet_index</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">sheet_index</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">workbook</span><span class="o">.</span><span class="n">sheetnames</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Índice de hoja inválido. Hay </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">workbook</span><span class="o">.</span><span class="n">sheetnames</span><span class="p">)</span><span class="si">}</span><span class="s2"> hojas disponibles.&quot;</span><span class="p">)</span>

    <span class="c1"># Obtener la hoja por índice</span>
    <span class="n">sheet_name</span> <span class="o">=</span> <span class="n">workbook</span><span class="o">.</span><span class="n">sheetnames</span><span class="p">[</span><span class="n">sheet_index</span><span class="p">]</span>
    <span class="n">sheet</span> <span class="o">=</span> <span class="n">workbook</span><span class="p">[</span><span class="n">sheet_name</span><span class="p">]</span>

    <span class="c1"># Variables para rastrear los límites del rango</span>
    <span class="n">min_row</span><span class="p">,</span> <span class="n">min_col</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
    <span class="n">max_row</span><span class="p">,</span> <span class="n">max_col</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>

    <span class="c1"># Recorrer las celdas para encontrar el rango de datos</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">sheet</span><span class="o">.</span><span class="n">iter_rows</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">cell</span> <span class="ow">in</span> <span class="n">row</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">cell</span><span class="o">.</span><span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">min_row</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">cell</span><span class="o">.</span><span class="n">row</span> <span class="o">&lt;</span> <span class="n">min_row</span><span class="p">:</span>
                    <span class="n">min_row</span> <span class="o">=</span> <span class="n">cell</span><span class="o">.</span><span class="n">row</span>
                <span class="k">if</span> <span class="n">max_row</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">cell</span><span class="o">.</span><span class="n">row</span> <span class="o">&gt;</span> <span class="n">max_row</span><span class="p">:</span>
                    <span class="n">max_row</span> <span class="o">=</span> <span class="n">cell</span><span class="o">.</span><span class="n">row</span>
                <span class="k">if</span> <span class="n">min_col</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">cell</span><span class="o">.</span><span class="n">column</span> <span class="o">&lt;</span> <span class="n">min_col</span><span class="p">:</span>
                    <span class="n">min_col</span> <span class="o">=</span> <span class="n">cell</span><span class="o">.</span><span class="n">column</span>
                <span class="k">if</span> <span class="n">max_col</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">cell</span><span class="o">.</span><span class="n">column</span> <span class="o">&gt;</span> <span class="n">max_col</span><span class="p">:</span>
                    <span class="n">max_col</span> <span class="o">=</span> <span class="n">cell</span><span class="o">.</span><span class="n">column</span>

    <span class="c1"># return min_row, min_col, max_row, max_col</span>
    <span class="n">sheet_index</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># Índice de la hoja (empezando en 0)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Rango de datos: Desde la fila </span><span class="si">{</span><span class="n">min_row</span><span class="si">}</span><span class="s2">, columna </span><span class="si">{</span><span class="n">min_col</span><span class="si">}</span><span class="s2"> hasta la fila </span><span class="si">{</span><span class="n">max_row</span><span class="si">}</span><span class="s2">, columna </span><span class="si">{</span><span class="n">max_col</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="c1"># Crear un DataFrame con el rango de datos obtenido</span>
    <span class="n">workbook</span> <span class="o">=</span> <span class="n">load_workbook</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">data_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">sheet</span> <span class="o">=</span> <span class="n">workbook</span><span class="p">[</span><span class="n">workbook</span><span class="o">.</span><span class="n">sheetnames</span><span class="p">[</span><span class="n">sheet_index</span><span class="p">]]</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">sheet</span><span class="o">.</span><span class="n">iter_rows</span><span class="p">(</span><span class="n">min_row</span><span class="o">=</span><span class="n">min_row</span><span class="p">,</span> <span class="n">max_row</span><span class="o">=</span><span class="n">max_row</span><span class="p">,</span> <span class="n">min_col</span><span class="o">=</span><span class="n">min_col</span><span class="p">,</span> <span class="n">max_col</span><span class="o">=</span><span class="n">max_col</span><span class="p">,</span> <span class="n">values_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">data</span>
</code></pre></div>
<p><code>guardar_diccionario</code> Guarda los valores de un diccionario o lista en un archivo CSV, creando una columna llamada Item para almacenar los datos.</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">guardar_diccionario</span><span class="p">(</span><span class="n">diccionario</span><span class="p">,</span> <span class="n">nombre_archivo</span><span class="p">):</span>
    <span class="c1"># Almacenar periodos en un Archivo, en modo de pruebas</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">diccionario</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Item&#39;</span><span class="p">])</span>
    <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">nombre_archivo</span><span class="si">}</span><span class="s1">.csv&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div>
<h2 id="funcion-crea_dataframes">Función <code>crea_dataframes</code><a class="headerlink" href="#funcion-crea_dataframes" title="Permanent link">&para;</a></h2>
<h4 id="proposito_26"><strong>Propósito</strong><a class="headerlink" href="#proposito_26" title="Permanent link">&para;</a></h4>
<p>Procesa una lista de archivos Excel desde una carpeta, cargándolos en pandas DataFrames, y aplica renombramientos específicos de columnas para cada archivo.</p>
<hr />
<h4 id="entradas_26"><strong>Entradas</strong><a class="headerlink" href="#entradas_26" title="Permanent link">&para;</a></h4>
<ul>
<li><strong><code>files</code> (list):</strong> Lista de nombres de archivos Excel a procesar.</li>
<li><strong><code>upload_folder</code> (str):</strong> Ruta de la carpeta donde se encuentran los archivos Excel.</li>
</ul>
<hr />
<h4 id="funcionamiento_24"><strong>Funcionamiento</strong><a class="headerlink" href="#funcionamiento_24" title="Permanent link">&para;</a></h4>
<ol>
<li>
<p><strong>Carga de archivos Excel:</strong></p>
<ul>
<li>Itera sobre los nombres de los archivos en <code>files</code>.</li>
<li>Carga cada archivo Excel desde la carpeta especificada (<code>upload_folder</code>) en un DataFrame y lo almacena en el diccionario <code>data_frames</code>, donde la clave es el nombre del archivo.</li>
</ul>
</li>
<li>
<p><strong>Renombramiento de columnas:</strong></p>
<ul>
<li>Aplica renombramientos específicos para las columnas de cada archivo:</li>
<li>Estandariza los nombres de columnas relevantes como <code>TIPO_DOCUMENTO</code>, <code>DOCUMENTO</code>, <code>FECHA</code>, y otros campos según la estructura particular de cada archivo.</li>
<li>Se realiza un mapeo detallado de las columnas para cada archivo en <code>files[0]</code>, <code>files[1]</code>, <code>files[2]</code> y <code>files[3]</code>.</li>
</ul>
</li>
<li>
<p><strong>Salida:</strong></p>
<ul>
<li>Devuelve un diccionario <code>data_frames</code> donde:</li>
<li>Las claves son los nombres de los archivos.</li>
<li>Los valores son los DataFrames procesados.</li>
</ul>
</li>
</ol>
<hr />
<h4 id="salida_25"><strong>Salida</strong><a class="headerlink" href="#salida_25" title="Permanent link">&para;</a></h4>
<ul>
<li><strong><code>data_frames</code> (dict):</strong> Diccionario con los DataFrames procesados y renombrados.</li>
</ul>
<hr />
<h4 id="ejemplo-de-estructura-de-salida"><strong>Ejemplo de estructura de salida</strong><a class="headerlink" href="#ejemplo-de-estructura-de-salida" title="Permanent link">&para;</a></h4>
<p>Si <code>files</code> contiene:
<div class="highlight"><pre><span></span><code><span class="p">[</span><span class="s1">&#39;archivo1.xlsx&#39;</span><span class="p">,</span> <span class="s1">&#39;archivo2.xlsx&#39;</span><span class="p">]</span>
</code></pre></div>
El diccionario <code>data_frames</code> tendrá:
<div class="highlight"><pre><span></span><code><span class="p">{</span>
    <span class="s1">&#39;archivo1.xlsx&#39;</span><span class="p">:</span> <span class="n">DataFrame</span> <span class="n">con</span> <span class="n">columnas</span> <span class="n">renombradas</span><span class="p">,</span>
    <span class="s1">&#39;archivo2.xlsx&#39;</span><span class="p">:</span> <span class="n">DataFrame</span> <span class="n">con</span> <span class="n">columnas</span> <span class="n">renombradas</span>
<span class="p">}</span>
</code></pre></div></p>
<div class="highlight"><pre><span></span><code><span class="c1">################################################################################################################################</span>
<span class="nd">@log_step_decorator</span><span class="p">(</span><span class="s2">&quot;Procesar dataframes&quot;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">crea_dataframes</span><span class="p">(</span><span class="n">files</span><span class="p">,</span> <span class="n">upload_folder</span><span class="p">):</span>
    <span class="n">data_frames</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
        <span class="n">data_frames</span><span class="p">[</span><span class="n">file</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span> <span class="n">upload_folder</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">file</span> <span class="p">)</span>
        <span class="c1">#columnsTotal = columnsTotal + data_frames[file].columns.tolist()</span>



    <span class="n">data_frames</span><span class="p">[</span><span class="n">files</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">data_frames</span><span class="p">[</span><span class="n">files</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;TIPO DE IDENTIFICACION&#39;</span><span class="p">:</span> <span class="s1">&#39;TIPO_DOCUMENTO&#39;</span><span class="p">,</span>
                                                                <span class="s1">&#39;IDENTIFICACION&#39;</span><span class="p">:</span> <span class="s1">&#39;DOCUMENTO&#39;</span><span class="p">,</span>
                                                                <span class="s1">&#39;FECHA DEL PRODUCTO O SERVICIO PRESTADO&#39;</span><span class="p">:</span> <span class="s1">&#39;FECHA&#39;</span><span class="p">,</span>
                                                                <span class="s1">&#39;GRUPO ETNICO A QUE PERTENECE EL BENEFICIARIO (A)&#39;</span><span class="p">:</span><span class="s1">&#39;GRUPO ETNICO BENEFICIARIO&#39;</span><span class="p">})</span>
    <span class="n">data_frames</span><span class="p">[</span><span class="n">files</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">data_frames</span><span class="p">[</span><span class="n">files</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;TIPO DE IDENTIFICACION&#39;</span><span class="p">:</span> <span class="s1">&#39;TIPO_DOCUMENTO&#39;</span><span class="p">,</span>
                                                                <span class="s1">&#39;IDENTIFICACION&#39;</span><span class="p">:</span> <span class="s1">&#39;DOCUMENTO&#39;</span><span class="p">,</span>
                                                                <span class="s1">&#39;FECHA DEL PRODUCTO O SERVICIO PRESTADO&#39;</span><span class="p">:</span> <span class="s1">&#39;FECHA&#39;</span><span class="p">,</span>
                                                                <span class="s1">&#39;GRUPO ETNICO A QUE PERTENECE EL BENEFICIARIO (A)&#39;</span><span class="p">:</span><span class="s1">&#39;GRUPO ETNICO BENEFICIARIO&#39;</span><span class="p">,</span>
                                                                <span class="s1">&#39;TELEFONO CELULAR&#39;</span><span class="p">:</span><span class="s1">&#39;TELEFONO&#39;</span><span class="p">})</span>
    <span class="n">data_frames</span><span class="p">[</span><span class="n">files</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span> <span class="o">=</span> <span class="n">data_frames</span><span class="p">[</span><span class="n">files</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;TIPO DE IDENTIFICACION DEL BENEFICIARIO&#39;</span><span class="p">:</span> <span class="s1">&#39;TIPO_DOCUMENTO&#39;</span><span class="p">,</span>
                                                                <span class="s1">&#39;IDENTIFICACION DEL BENEFICIARIO&#39;</span><span class="p">:</span> <span class="s1">&#39;DOCUMENTO&#39;</span><span class="p">,</span>
                                                                <span class="s1">&#39;FECHA DEL PRODUCTO O SERVICIO PRESTADO&#39;</span><span class="p">:</span> <span class="s1">&#39;FECHA&#39;</span><span class="p">,</span>
                                                                <span class="s1">&#39;GRUPO ETNICO A QUE PERTENECE EL NINIO O NINIA BENEFICIARIO (A)&#39;</span><span class="p">:</span><span class="s1">&#39;GRUPO ETNICO BENEFICIARIO&#39;</span><span class="p">,</span>
                                                                <span class="s1">&#39;PRIMER NOMBRE DEL BENEFICIARIO&#39;</span><span class="p">:</span><span class="s1">&#39;PRIMER NOMBRE&#39;</span><span class="p">,</span>
                                                                <span class="s1">&#39;PRIMER APELLIDO DEL BENEFICIARIO&#39;</span><span class="p">:</span><span class="s1">&#39;PRIMER APELLIDO&#39;</span><span class="p">,</span>
                                                                <span class="s1">&#39;SEGUNDO NOMBRE DEL BENEFICIARIO&#39;</span><span class="p">:</span><span class="s1">&#39;SEGUNDO NOMBRE&#39;</span><span class="p">,</span>
                                                                <span class="s1">&#39;SEGUNDO APELLIDO DEL BENEFICIARIO&#39;</span><span class="p">:</span><span class="s1">&#39;SEGUNDO APELLIDO&#39;</span><span class="p">,</span>
                                                                <span class="s1">&#39;PRIMER NOMBRE PADRE/MADRE  RESPONSABLE DEL BENEFICIARIO&#39;</span><span class="p">:</span><span class="s1">&#39;PRIMER NOMBRE DEL ACUDIENTE&#39;</span><span class="p">,</span> 
                                                                <span class="s1">&#39;SEGUNDO NOMBRE PADRE/MADRE  RESPONSABLE DEL BENEFICIARIO&#39;</span><span class="p">:</span><span class="s1">&#39;SEGUNDO NOMBRE DEL ACUDIENTE&#39;</span><span class="p">,</span>
                                                                <span class="s1">&#39;PRIMER APELLIDO PADRE/MADRE  RESPONSABLE DEL BENEFICIARIO&#39;</span><span class="p">:</span><span class="s1">&#39;PRIMER APELLIDO DEL ACUDIENTE&#39;</span><span class="p">,</span>
                                                                <span class="s1">&#39;SEGUNDO APELLIDO PADRE/MADRE  RESPONSABLE DEL BENEFICIARIO&#39;</span><span class="p">:</span><span class="s1">&#39;SEGUNDO APELLIDO DEL ACUDIENTE&#39;</span><span class="p">,</span>
                                                                <span class="s1">&#39;EDAD DEL BENEFICIARIO&#39;</span><span class="p">:</span><span class="s1">&#39;EDAD&#39;</span><span class="p">,</span>
                                                                <span class="s1">&#39;TELEFONO</span><span class="se">\xa0</span><span class="s1">DEL ESTUDIANTE&#39;</span><span class="p">:</span><span class="s1">&#39;TELEFONO&#39;</span><span class="p">,</span>
                                                                <span class="s1">&#39;UBICACION DEL</span><span class="se">\xa0</span><span class="s1"> ESTABLECIMIENTO EDUCATIVO DEL ESTUDIANTE&#39;</span><span class="p">:</span><span class="s1">&#39;UBICACION DEL ESTABLECIMIENTO EDUCATIVO DEL ESTUDIANTE&#39;</span><span class="p">})</span>
    <span class="n">data_frames</span><span class="p">[</span><span class="n">files</span><span class="p">[</span><span class="mi">3</span><span class="p">]]</span> <span class="o">=</span> <span class="n">data_frames</span><span class="p">[</span><span class="n">files</span><span class="p">[</span><span class="mi">3</span><span class="p">]]</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;TIPO DE IDENTIFICACION DEL BENEFICIARIO&#39;</span><span class="p">:</span> <span class="s1">&#39;TIPO_DOCUMENTO&#39;</span><span class="p">,</span>
                                                                <span class="s1">&#39;NUMERODEIDENTIFICACION&#39;</span><span class="p">:</span> <span class="s1">&#39;DOCUMENTO&#39;</span><span class="p">,</span>
                                                                <span class="s1">&#39;FECHA DE VINCULACION A PAIN&#39;</span><span class="p">:</span> <span class="s1">&#39;FECHA&#39;</span><span class="p">,</span>
                                                                <span class="s1">&#39;GRUPO ETNICO A QUE PERTENECE EL NINIO O NINIA BENEFICIARIO (A)&#39;</span><span class="p">:</span><span class="s1">&#39;GRUPO ETNICO BENEFICIARIO&#39;</span><span class="p">,</span>
                                                                <span class="s1">&#39;FECHA DE NACIMIENTO(DD/MM/AAAA)&#39;</span><span class="p">:</span><span class="s1">&#39;FECHA NACIMIENTO&#39;</span><span class="p">,</span>
                                                                <span class="s1">&#39;SEGUNDO</span><span class="se">\xa0</span><span class="s1">APELLIDO DEL ACUDIENTE&#39;</span><span class="p">:</span><span class="s1">&#39;SEGUNDO APELLIDO DEL ACUDIENTE&#39;</span><span class="p">,</span>
                                                                <span class="s1">&#39;SEGUNDO</span><span class="se">\xa0</span><span class="s1">NOMBRE DEL ACUDIENTE&#39;</span><span class="p">:</span><span class="s1">&#39;SEGUNDO NOMBRE DEL ACUDIENTE&#39;</span><span class="p">,</span>
                                                                <span class="s1">&#39;UBICACION DEL</span><span class="se">\xa0</span><span class="s1"> ESTABLECIMIENTO EDUCATIVO DEL BENEFICIARIO&#39;</span><span class="p">:</span><span class="s1">&#39;UBICACION DEL ESTABLECIMIENTO EDUCATIVO DEL BENEFICIARIO&#39;</span><span class="p">})</span>
    <span class="k">return</span> <span class="n">data_frames</span>
</code></pre></div>
<p><code>normalize</code> elimina las tildes de un texto, reemplazándolas por sus versiones sin acento, tanto en minúsculas como en mayúsculas.</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">normalize</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="n">replacements</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">(</span><span class="s2">&quot;á&quot;</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;é&quot;</span><span class="p">,</span> <span class="s2">&quot;e&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;í&quot;</span><span class="p">,</span> <span class="s2">&quot;i&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;ó&quot;</span><span class="p">,</span> <span class="s2">&quot;o&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;ú&quot;</span><span class="p">,</span> <span class="s2">&quot;u&quot;</span><span class="p">),</span>
    <span class="p">)</span>
    <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">replacements</span><span class="p">:</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span> <span class="n">b</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>
    <span class="k">return</span> <span class="n">s</span>
</code></pre></div>
<h2 id="funcion-presave">Función <code>PreSave</code><a class="headerlink" href="#funcion-presave" title="Permanent link">&para;</a></h2>
<h4 id="proposito_27"><strong>Propósito</strong><a class="headerlink" href="#proposito_27" title="Permanent link">&para;</a></h4>
<p>Realiza un preprocesamiento de columnas en un DataFrame, limpiando y normalizando valores textuales, y opcionalmente eliminando signos de puntuación específicos.</p>
<hr />
<h4 id="entradas_27"><strong>Entradas</strong><a class="headerlink" href="#entradas_27" title="Permanent link">&para;</a></h4>
<ul>
<li><strong><code>df</code> (DataFrame):</strong> DataFrame original que se desea procesar.</li>
<li><strong><code>columnList</code> (list):</strong> Lista de columnas del DataFrame que serán procesadas.</li>
<li><strong><code>signs</code> (bool, opcional):</strong> Si es <code>True</code>, elimina signos de puntuación como <code>¡</code>, <code>!</code>, <code>?</code>, <code>¿</code> de las columnas. Por defecto: <code>False</code>.</li>
</ul>
<hr />
<h4 id="funcionamiento_25"><strong>Funcionamiento</strong><a class="headerlink" href="#funcionamiento_25" title="Permanent link">&para;</a></h4>
<ol>
<li>
<p><strong>Copiar el DataFrame:</strong></p>
<ul>
<li>Crea una copia del DataFrame original para evitar modificaciones en el objeto original.</li>
</ul>
</li>
<li>
<p><strong>Limpieza y normalización:</strong></p>
<ul>
<li><strong>Reemplazos específicos:</strong><ul>
<li>Convierte <code>\xf1</code> a <code>ni</code> (e.g., "ñ" a "ni").</li>
<li>Convierte <code>\xD1</code> a <code>NI</code> (e.g., "Ñ" a "NI").</li>
<li>Sustituye caracteres no rompibles (<code>\u00A0</code>) por espacios.</li>
</ul>
</li>
<li><strong>Eliminación de espacios:</strong><ul>
<li>Reemplaza espacios dobles por simples.</li>
<li>Elimina espacios al inicio y final de las cadenas.</li>
</ul>
</li>
<li><strong>Normalización de texto:</strong><ul>
<li>Convierte los valores a cadenas en mayúsculas.</li>
<li>Aplica la función <code>normalize</code> para eliminar tildes.</li>
<li>Reemplaza comas por espacios.</li>
</ul>
</li>
<li><strong>Gestión de valores nulos:</strong><ul>
<li>Sustituye valores <code>"NAN"</code> por <code>np.nan</code>.</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>Eliminación de signos (opcional):</strong></p>
<ul>
<li>Si <code>signs=True</code>, elimina signos de puntuación (<code>¡</code>, <code>!</code>, <code>?</code>, <code>¿</code>) utilizando expresiones regulares.</li>
</ul>
</li>
<li>
<p><strong>Salida:</strong></p>
<ul>
<li>Devuelve el DataFrame procesado.</li>
</ul>
</li>
</ol>
<hr />
<h4 id="salida_26"><strong>Salida</strong><a class="headerlink" href="#salida_26" title="Permanent link">&para;</a></h4>
<ul>
<li><strong><code>DataFrame</code>:</strong> DataFrame con las columnas especificadas procesadas y normalizadas.</li>
</ul>
<hr />
<h4 id="ejemplo-de-uso"><strong>Ejemplo de uso</strong><a class="headerlink" href="#ejemplo-de-uso" title="Permanent link">&para;</a></h4>
<p>Si la entrada es:
<div class="highlight"><pre><span></span><code><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;col1&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;¡Hola, mundo!&#39;</span><span class="p">,</span> <span class="s1">&#39;¿Qué tal?&#39;</span><span class="p">]})</span>
<span class="n">PreSave</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;col1&#39;</span><span class="p">],</span> <span class="n">signs</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div></p>
<p>La salida será:
<div class="highlight"><pre><span></span><code>      <span class="n">col1</span>
<span class="mi">0</span>    <span class="n">HOLA</span> <span class="n">MUNDO</span>
<span class="mi">1</span>    <span class="n">QUE</span> <span class="n">TAL</span>
</code></pre></div></p>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">PreSave</span><span class="p">(</span><span class="n">df</span> <span class="p">,</span> <span class="n">columnList</span><span class="p">,</span> <span class="n">signs</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
    <span class="c1">#datfra[columnList] = datfra[columnList].apply(lambda x: x.astype(str).str.decode(&#39;utf-8&#39;).replace(u&#39;\xf1&#39;, &#39;ni&#39;))</span>
    <span class="c1">#datfra[columnList] = datfra[columnList].apply(lambda x: x.astype(str).str.decode(&#39;utf-8&#39;).replace(u&#39;\xD1&#39;, &#39;NI&#39;))</span>

    <span class="n">datfra</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">datfra</span><span class="p">[</span><span class="n">columnList</span><span class="p">]</span> <span class="o">=</span> <span class="n">datfra</span><span class="p">[</span><span class="n">columnList</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\xf1</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;ni&#39;</span><span class="p">))</span>
    <span class="n">datfra</span><span class="p">[</span><span class="n">columnList</span><span class="p">]</span> <span class="o">=</span> <span class="n">datfra</span><span class="p">[</span><span class="n">columnList</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\xD1</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;NI&#39;</span><span class="p">))</span>
    <span class="n">datfra</span><span class="p">[</span><span class="n">columnList</span><span class="p">]</span> <span class="o">=</span> <span class="n">datfra</span><span class="p">[</span><span class="n">columnList</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\u00A0</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">))</span>
    <span class="n">datfra</span><span class="p">[</span><span class="n">columnList</span><span class="p">]</span> <span class="o">=</span> <span class="n">datfra</span><span class="p">[</span><span class="n">columnList</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;  &#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">))</span>
    <span class="n">datfra</span><span class="p">[</span><span class="n">columnList</span><span class="p">]</span> <span class="o">=</span> <span class="n">datfra</span><span class="p">[</span><span class="n">columnList</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
    <span class="n">datfra</span><span class="p">[</span><span class="n">columnList</span><span class="p">]</span> <span class="o">=</span> <span class="n">datfra</span><span class="p">[</span><span class="n">columnList</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
    <span class="n">datfra</span><span class="p">[</span><span class="n">columnList</span><span class="p">]</span> <span class="o">=</span> <span class="n">datfra</span><span class="p">[</span><span class="n">columnList</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">normalize</span><span class="p">)</span>
    <span class="n">datfra</span><span class="p">[</span><span class="n">columnList</span><span class="p">]</span> <span class="o">=</span> <span class="n">datfra</span><span class="p">[</span><span class="n">columnList</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>
    <span class="n">datfra</span><span class="p">[</span><span class="n">columnList</span><span class="p">]</span> <span class="o">=</span> <span class="n">datfra</span><span class="p">[</span><span class="n">columnList</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">))</span>
    <span class="n">datfra</span><span class="p">[</span><span class="n">columnList</span><span class="p">]</span> <span class="o">=</span> <span class="n">datfra</span><span class="p">[</span><span class="n">columnList</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;NAN&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">signs</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">columnList</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">datfra</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">datfra</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;[¡!?¿]&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Not Signs fixed for &#39;</span><span class="o">+</span> <span class="n">col</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">datfra</span>
</code></pre></div>
<h2 id="funciones-sorted_answer-y-fix_table_answers">Funciones <code>Sorted_Answer</code> y <code>Fix_Table_Answers</code><a class="headerlink" href="#funciones-sorted_answer-y-fix_table_answers" title="Permanent link">&para;</a></h2>
<hr />
<h4 id="funcion-sorted_answer"><strong>Función <code>Sorted_Answer</code></strong><a class="headerlink" href="#funcion-sorted_answer" title="Permanent link">&para;</a></h4>
<p><strong>Propósito:</strong>
Ordena alfabéticamente las respuestas separadas por punto y coma (<code>;</code>) dentro de una cadena. Elimina valores vacíos si existen.</p>
<hr />
<p><strong>Entradas:</strong></p>
<ul>
<li><strong><code>x</code> (str o NaN):</strong> Cadena de texto con respuestas separadas por punto y coma o un valor nulo.</li>
</ul>
<hr />
<p><strong>Funcionamiento:</strong></p>
<ol>
<li>Verifica si la entrada es nula (<code>NaN</code>). Si es así, retorna la entrada sin cambios.</li>
<li>Divide la cadena en una lista utilizando <code>split(';')</code>.</li>
<li>Si hay más de una respuesta:<ul>
<li>Ordena alfabéticamente la lista.</li>
<li>Elimina entradas vacías si están presentes.</li>
<li>Reconstruye la cadena uniendo los valores con <code>;</code>.</li>
</ul>
</li>
<li>Retorna la cadena ordenada o la entrada original si no se cumplen las condiciones.</li>
</ol>
<hr />
<p><strong>Salida:</strong></p>
<ul>
<li><strong><code>str</code> o <code>NaN</code>:</strong> Cadena con las respuestas ordenadas alfabéticamente o valor original si no hay cambios.</li>
</ul>
<h4 id="funcion-fix_table_answers"><strong>Función <code>Fix_Table_Answers</code></strong><a class="headerlink" href="#funcion-fix_table_answers" title="Permanent link">&para;</a></h4>
<p><strong>Propósito:</strong></p>
<p>Aplica la función <code>Sorted_Answer</code> a una columna específica de un DataFrame, actualizando la columna con las respuestas ordenadas.</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">Sorted_Answer</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">isnull</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">x</span>
    <span class="n">p</span> <span class="o">=</span>  <span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">)</span> 
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">p</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
        <span class="n">p</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">p</span> <span class="o">=</span> <span class="s1">&#39;;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">p</span>
    <span class="k">return</span> <span class="n">x</span>


<span class="k">def</span><span class="w"> </span><span class="nf">Fix_Table_Answers</span><span class="p">(</span> <span class="n">table</span> <span class="p">,</span> <span class="n">column_name</span> <span class="p">):</span>
    <span class="n">table</span><span class="p">[</span><span class="s1">&#39;RESPUESTA_LIST&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span><span class="n">column_name</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">Sorted_Answer</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="p">)</span>
    <span class="n">table</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span> <span class="n">column_name</span> <span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">table</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;RESPUESTA_LIST&#39;</span><span class="p">:</span> <span class="n">column_name</span><span class="p">})</span>

    <span class="k">return</span> <span class="n">table</span>
</code></pre></div>
<h2 id="funcion-fix_id_type_caract">Función <code>Fix_Id_Type_Caract</code><a class="headerlink" href="#funcion-fix_id_type_caract" title="Permanent link">&para;</a></h2>
<h4 id="proposito_28"><strong>Propósito</strong><a class="headerlink" href="#proposito_28" title="Permanent link">&para;</a></h4>
<p>Estandariza y transforma diferentes representaciones de tipos de identificación en códigos abreviados predefinidos.</p>
<hr />
<h4 id="entradas_28"><strong>Entradas</strong><a class="headerlink" href="#entradas_28" title="Permanent link">&para;</a></h4>
<ul>
<li><strong><code>id_type</code> (str):</strong> Cadena de texto que representa un tipo de identificación, como "CEDULA DE CIUDADANIA" o "TARJETA DE IDENTIDAD".</li>
</ul>
<hr />
<h4 id="funcionamiento_26"><strong>Funcionamiento</strong><a class="headerlink" href="#funcionamiento_26" title="Permanent link">&para;</a></h4>
<ol>
<li>Utiliza una estructura <code>match-case</code> para comparar el valor de <code>id_type</code> con diferentes representaciones conocidas.</li>
<li>Devuelve el código abreviado correspondiente:<ul>
<li><strong><code>CC</code></strong>: Cédula de ciudadanía.</li>
<li><strong><code>TI</code></strong>: Tarjeta de identidad.</li>
<li><strong><code>RC</code></strong>: Registro civil.</li>
<li><strong><code>PE</code></strong>: Permiso especial de permanencia.</li>
<li><strong><code>PPT</code></strong>: Permiso especial de permanencia temporal.</li>
<li><strong><code>PA</code></strong>: Pasaporte.</li>
<li><strong><code>CE</code></strong>: Identificación extranjera.</li>
<li><strong><code>NI</code></strong>: NIT.</li>
<li><strong><code>NA</code></strong>: No aplica o no reconocido.</li>
</ul>
</li>
<li>Si no encuentra una coincidencia, devuelve el valor por defecto <code>NA</code>.</li>
</ol>
<hr />
<h4 id="salida_27"><strong>Salida</strong><a class="headerlink" href="#salida_27" title="Permanent link">&para;</a></h4>
<ul>
<li><strong><code>str</code>:</strong> Código abreviado del tipo de identificación.</li>
</ul>
<hr />
<h4 id="ejemplo-de-uso_1"><strong>Ejemplo de uso</strong><a class="headerlink" href="#ejemplo-de-uso_1" title="Permanent link">&para;</a></h4>
<p>Entrada:
<div class="highlight"><pre><span></span><code><span class="n">Fix_Id_Type_Caract</span><span class="p">(</span><span class="s1">&#39;CEDULA DE CIUDADANIA&#39;</span><span class="p">)</span>
</code></pre></div></p>
<p>Salida:
<div class="highlight"><pre><span></span><code><span class="s1">&#39;CC&#39;</span>
</code></pre></div></p>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">Fix_Id_Type_Caract</span><span class="p">(</span><span class="n">id_type</span><span class="p">):</span>
    <span class="k">match</span> <span class="n">id_type</span><span class="p">:</span>
        <span class="k">case</span> <span class="s1">&#39;1.CEDULA DE CIUDADANIA&#39;</span><span class="p">:</span>
             <span class="k">return</span> <span class="s1">&#39;CC&#39;</span>
        <span class="k">case</span> <span class="s1">&#39;2.TARJETA DE IDENTIDAD&#39;</span><span class="p">:</span>
             <span class="k">return</span> <span class="s1">&#39;TI&#39;</span>
        <span class="k">case</span> <span class="s1">&#39;3.REGISTRO CIVIL&#39;</span><span class="p">:</span>
             <span class="k">return</span> <span class="s1">&#39;RC&#39;</span>
        <span class="k">case</span> <span class="s1">&#39;1. CEDULA&#39;</span><span class="p">:</span>
             <span class="k">return</span> <span class="s1">&#39;CC&#39;</span>
        <span class="k">case</span> <span class="s1">&#39;TARJETA DE IDENTIDAD&#39;</span><span class="p">:</span>
             <span class="k">return</span> <span class="s1">&#39;TI&#39;</span>
        <span class="k">case</span> <span class="s1">&#39;CEDULA DE CIUDADANIA&#39;</span><span class="p">:</span>
             <span class="k">return</span> <span class="s1">&#39;CC&#39;</span>
        <span class="k">case</span> <span class="s1">&#39;REGISTRO CIVIL&#39;</span><span class="p">:</span>
             <span class="k">return</span> <span class="s1">&#39;RC&#39;</span>
        <span class="k">case</span> <span class="s1">&#39;2. TARJETA DE IDENTIDAD&#39;</span><span class="p">:</span>
             <span class="k">return</span> <span class="s1">&#39;TI&#39;</span>
        <span class="k">case</span> <span class="s1">&#39;3. REGISTRO CIVIL&#39;</span><span class="p">:</span>
             <span class="k">return</span> <span class="s1">&#39;RC&#39;</span>
        <span class="k">case</span> <span class="s1">&#39;9. PERMISO ESPECIAL DE PERMANENCIA (P.E.P)&#39;</span><span class="p">:</span>
             <span class="k">return</span> <span class="s1">&#39;PE&#39;</span>
        <span class="k">case</span> <span class="s1">&#39;15. PERMISO ESPECIAL DE PERMANENCIA TEMPORAL&#39;</span><span class="p">:</span>
             <span class="k">return</span> <span class="s1">&#39;PPT&#39;</span>
        <span class="k">case</span> <span class="s1">&#39;11.</span><span class="se">\xa0</span><span class="s1"> IDENTIFICACION DADA POR LA SECRETARIA DE EDUCACION&#39;</span><span class="p">:</span>
             <span class="k">return</span> <span class="s1">&#39;NA&#39;</span>
        <span class="k">case</span> <span class="s1">&#39;14. ID EXTRANJEROS DIFERENTE A LA CEDULA DE EXTRANJERIA (SOLO PARA FONINIEZ)&#39;</span><span class="p">:</span>
             <span class="k">return</span> <span class="s1">&#39;C1X&#39;</span>
        <span class="k">case</span> <span class="s1">&#39;6. PASAPORTE&#39;</span><span class="p">:</span>
             <span class="k">return</span> <span class="s1">&#39;PA&#39;</span>
        <span class="k">case</span> <span class="s1">&#39;5. NUIP&#39;</span><span class="p">:</span>
             <span class="k">return</span> <span class="s1">&#39;NA&#39;</span>
        <span class="k">case</span> <span class="s1">&#39;CERTIFICADO DE NACIMIENTO&#39;</span><span class="p">:</span>
             <span class="k">return</span> <span class="s1">&#39;RC&#39;</span>
        <span class="k">case</span> <span class="s1">&#39;ID EXTRANJERO&#39;</span><span class="p">:</span>
             <span class="k">return</span> <span class="s1">&#39;CE&#39;</span>   
        <span class="k">case</span> <span class="s1">&#39;NIT&#39;</span><span class="p">:</span>
             <span class="k">return</span> <span class="s1">&#39;NI&#39;</span> 
        <span class="k">case</span> <span class="s1">&#39;NONE&#39;</span><span class="p">:</span>
             <span class="k">return</span> <span class="s1">&#39;NA&#39;</span>         
        <span class="k">case</span><span class="w"> </span><span class="k">_</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;NA&#39;</span>

    <span class="k">return</span> <span class="s1">&#39;NA&#39;</span>
</code></pre></div>
<hr />
<p><code>Fix_Id_Type</code> aplica la transformación de tipos de identificación en una columna específica de una tabla si el nombre de la tabla es <code>"CARACTERIZACION"</code>.</p>
<p><code>Truncate_Column</code> trunca el contenido de las columnas especificadas a un máximo de 255 caracteres. Por otro lado, <code>Fix_Datetime</code> convierte valores tipo <code>NaT</code> a un valor predeterminado (<code>2009-01-01 00:00:00</code>) y agrega la hora inicial a fechas válidas. </p>
<p>Finalmente, <code>Fix_DatetimeFinal</code> normaliza una columna de fechas en un DataFrame, convirtiéndolas a formato <code>datetime</code>, estableciendo la hora como 00:00:00, y manejando errores de conversión de forma segura.</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">Fix_Id_Type</span><span class="p">(</span> <span class="n">table</span> <span class="p">,</span> <span class="n">typeIdColumn</span> <span class="p">,</span> <span class="n">tableName</span> <span class="p">):</span>
    <span class="k">if</span> <span class="n">tableName</span> <span class="o">==</span> <span class="s1">&#39;CARACTERIZACION&#39;</span><span class="p">:</span>
        <span class="n">table</span><span class="p">[</span><span class="n">typeIdColumn</span><span class="p">]</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span><span class="n">typeIdColumn</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span> <span class="n">Fix_Id_Type_Caract</span> <span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">Truncate_Column</span><span class="p">(</span> <span class="n">table</span> <span class="p">,</span> <span class="n">columnsToTruncate</span> <span class="p">):</span>
    <span class="n">table</span><span class="p">[</span><span class="n">columnsToTruncate</span><span class="p">]</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span><span class="n">columnsToTruncate</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">str</span><span class="p">[:</span><span class="mi">255</span><span class="p">])</span>


<span class="k">def</span><span class="w"> </span><span class="nf">Fix_Datetime</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="s1">&#39;NaT&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="s1">&#39;2009-01-01 00:00:00&#39;</span>    
    <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="s1">&#39; 00:00:00&#39;</span>

<span class="k">def</span><span class="w"> </span><span class="nf">Fix_DatetimeFinal</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">columnName</span><span class="p">):</span>
    <span class="n">table</span><span class="p">[</span><span class="n">columnName</span><span class="p">]</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span><span class="n">columnName</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
    <span class="n">table</span><span class="p">[</span><span class="n">columnName</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">table</span><span class="p">[</span><span class="n">columnName</span><span class="p">],</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">,</span><span class="n">dayfirst</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">table</span><span class="p">[</span><span class="n">columnName</span><span class="p">]</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span><span class="n">columnName</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">hour</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">minute</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">second</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
    <span class="n">table</span><span class="p">[</span><span class="n">columnName</span><span class="p">]</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span><span class="n">columnName</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
    <span class="n">table</span><span class="p">[</span><span class="n">columnName</span><span class="p">]</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span><span class="n">columnName</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">Fix_Datetime</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>   <span class="p">)</span>
</code></pre></div>
<h2 id="funcion-fix_questions">Función <code>Fix_Questions</code><a class="headerlink" href="#funcion-fix_questions" title="Permanent link">&para;</a></h2>
<h4 id="proposito_29"><strong>Propósito</strong><a class="headerlink" href="#proposito_29" title="Permanent link">&para;</a></h4>
<p>Transforma y organiza un DataFrame de respuestas de encuestas, estructurándolo para análisis, incluyendo la identificación de preguntas relacionadas con NPS (Net Promoter Score).</p>
<hr />
<h4 id="entradas_29"><strong>Entradas</strong><a class="headerlink" href="#entradas_29" title="Permanent link">&para;</a></h4>
<ul>
<li><strong><code>data</code> (DataFrame):</strong> DataFrame original con datos de encuestas.</li>
<li><strong><code>servicio</code> (str):</strong> Nombre del servicio asociado a las encuestas.</li>
<li><strong><code>nps</code> (dict):</strong> Diccionario que mapea servicios a preguntas relacionadas con NPS.</li>
<li><strong><code>filename</code> (str):</strong> Nombre del archivo relacionado para fines de registro.</li>
</ul>
<h4 id="funcionamiento_27"><strong>Funcionamiento</strong><a class="headerlink" href="#funcionamiento_27" title="Permanent link">&para;</a></h4>
<ol>
<li>
<p><strong>Renombramiento de columnas:</strong></p>
<ul>
<li>Cambia el nombre de las columnas <code>fecha</code> a <code>FECHA_ENCUESTA</code> y <code>identificacion</code> a <code>DOCUMENTO</code>.</li>
</ul>
</li>
<li>
<p><strong>Identificación de preguntas:</strong></p>
<ul>
<li>Busca columnas cuyo nombre comience con <code>"etapa3"</code>, que representan preguntas con calificación.</li>
</ul>
</li>
<li>
<p><strong>Filtrado de columnas relevantes:</strong></p>
<ul>
<li>Redefine el DataFrame para incluir solo las columnas: <code>FECHA_ENCUESTA</code>, <code>DOCUMENTO</code>, y las preguntas identificadas.</li>
</ul>
</li>
<li>
<p><strong>Transformación de datos:</strong></p>
<ul>
<li>Transforma el DataFrame a un formato largo utilizando <code>melt</code>:<ul>
<li><strong><code>id_vars</code></strong>: Columnas constantes (<code>FECHA_ENCUESTA</code> y <code>DOCUMENTO</code>).</li>
<li><strong><code>var_name</code></strong>: Nombre de las columnas de preguntas (<code>PREGUNTA</code>).</li>
<li><strong><code>value_name</code></strong>: Valores asociados a las preguntas (<code>CALIFICACION</code>).</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>Adición de columnas constantes:</strong></p>
<ul>
<li>Agrega columnas adicionales:<ul>
<li><strong><code>SERVICIO</code></strong>: Nombre del servicio.</li>
<li><strong><code>TIPO_DOCUMENTO</code></strong>: Fijado como <code>'CC'</code>.</li>
<li><strong><code>NPS</code></strong>: Inicializado como <code>'NO'</code>.</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>Identificación de preguntas NPS:</strong></p>
<ul>
<li>Actualiza la columna <code>NPS</code> a <code>'SI'</code> para las preguntas que coinciden con el servicio especificado en el diccionario <code>nps</code>.</li>
</ul>
</li>
<li>
<p><strong>Salida del DataFrame:</strong></p>
<ul>
<li>Registra el nombre del servicio y archivo procesado.</li>
<li>Devuelve el DataFrame transformado.</li>
</ul>
</li>
<li>
<p><strong>Manejo de errores:</strong></p>
<ul>
<li>En caso de error, registra el servicio y archivo no procesado.</li>
</ul>
</li>
</ol>
<hr />
<h4 id="salida_28"><strong>Salida</strong><a class="headerlink" href="#salida_28" title="Permanent link">&para;</a></h4>
<ul>
<li><strong><code>DataFrame</code>:</strong> DataFrame transformado en formato largo con las siguientes columnas:</li>
<li><strong><code>FECHA_ENCUESTA</code></strong></li>
<li><strong><code>DOCUMENTO</code></strong></li>
<li><strong><code>PREGUNTA</code></strong></li>
<li><strong><code>CALIFICACION</code></strong></li>
<li><strong><code>SERVICIO</code></strong></li>
<li><strong><code>TIPO_DOCUMENTO</code></strong></li>
<li><strong><code>NPS</code></strong></li>
</ul>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">Fix_Questions</span><span class="p">(</span> <span class="n">data</span> <span class="p">,</span> <span class="n">servicio</span> <span class="p">,</span> <span class="n">nps</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">data</span>  
        <span class="c1">#Modificaciones a columnas</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;fecha&#39;</span><span class="p">:</span> <span class="s1">&#39;FECHA_ENCUESTA&#39;</span><span class="p">,</span>
                                <span class="s1">&#39;identificacion&#39;</span><span class="p">:</span><span class="s1">&#39;DOCUMENTO&#39;</span>
                            <span class="p">})</span>

        <span class="c1">#Buscar preguntas con nota</span>
        <span class="n">dfColumns</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">columnsWithObs</span> <span class="o">=</span> <span class="p">[</span><span class="n">val</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">dfColumns</span> <span class="k">if</span> <span class="n">val</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;etapa3&quot;</span><span class="p">)</span> <span class="p">]</span>

        <span class="c1">#Redefinir columna</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s1">&#39;FECHA_ENCUESTA&#39;</span><span class="p">,</span><span class="s1">&#39;DOCUMENTO&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">columnsWithObs</span><span class="p">]</span>

        <span class="c1">#Modificaciones y transpocision </span>
        <span class="n">df_unp</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span> <span class="n">id_vars</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;FECHA_ENCUESTA&#39;</span><span class="p">,</span><span class="s1">&#39;DOCUMENTO&#39;</span><span class="p">]</span> <span class="p">,</span> <span class="n">var_name</span><span class="o">=</span><span class="s2">&quot;PREGUNTA&quot;</span><span class="p">,</span> <span class="n">value_name</span><span class="o">=</span><span class="s2">&quot;CALIFICACION&quot;</span><span class="p">)</span>
        <span class="n">df_unp</span><span class="p">[</span><span class="s1">&#39;SERVICIO&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">servicio</span>
        <span class="n">df_unp</span><span class="p">[</span><span class="s1">&#39;TIPO_DOCUMENTO&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;CC&#39;</span>
        <span class="n">df_unp</span><span class="p">[</span><span class="s1">&#39;NPS&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;NO&#39;</span>


        <span class="n">df_unp</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_unp</span><span class="p">[</span><span class="s2">&quot;PREGUNTA&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">nps</span><span class="p">[</span><span class="n">servicio</span><span class="p">],</span> <span class="s2">&quot;NPS&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;SI&#39;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Agregado: &#39;</span> <span class="o">+</span>  <span class="n">servicio</span> <span class="o">+</span> <span class="n">filename</span> <span class="p">)</span>
        <span class="k">return</span> <span class="n">df_unp</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Sin formato: &#39;</span> <span class="o">+</span>  <span class="n">servicio</span> <span class="o">+</span> <span class="n">filename</span> <span class="p">)</span>
</code></pre></div>
<h2 id="funcion-charge_excel_fixed">Función <code>Charge_Excel_Fixed</code><a class="headerlink" href="#funcion-charge_excel_fixed" title="Permanent link">&para;</a></h2>
<h4 id="proposito_30"><strong>Propósito</strong><a class="headerlink" href="#proposito_30" title="Permanent link">&para;</a></h4>
<p>Carga un archivo Excel utilizando <code>xlwings</code>, procesa los datos de la primera hoja, y los guarda en un DataFrame después de limpiar filas y columnas vacías.</p>
<hr />
<h4 id="entradas_30"><strong>Entradas</strong><a class="headerlink" href="#entradas_30" title="Permanent link">&para;</a></h4>
<ul>
<li><strong><code>ruta</code> (str):</strong> Ruta del archivo Excel a cargar.</li>
<li><strong><code>dfs</code> (dict):</strong> Diccionario donde se almacenará el DataFrame procesado, con el nombre del archivo como clave.</li>
<li><strong><code>file</code> (str):</strong> Nombre del archivo para usarlo como clave en el diccionario <code>dfs</code>.</li>
</ul>
<hr />
<h4 id="funcionamiento_28"><strong>Funcionamiento</strong><a class="headerlink" href="#funcionamiento_28" title="Permanent link">&para;</a></h4>
<ol>
<li>
<p><strong>Carga del archivo Excel:</strong></p>
<ul>
<li>Utiliza <code>xlwings</code> para abrir el archivo Excel y seleccionar la primera hoja (<code>sheet[0]</code>).</li>
</ul>
</li>
<li>
<p><strong>Lectura de datos:</strong></p>
<ul>
<li>Lee todos los datos de la hoja utilizando <code>sheet.used_range.value</code>.</li>
</ul>
</li>
<li>
<p><strong>Creación del DataFrame:</strong></p>
<ul>
<li>Convierte los datos leídos en un DataFrame de pandas.</li>
</ul>
</li>
<li>
<p><strong>Limpieza de datos:</strong></p>
<ul>
<li>Elimina filas y columnas que estén completamente vacías utilizando <code>dropna()</code>.</li>
<li>Resetea el índice del DataFrame con <code>reset_index(drop=True)</code>.</li>
</ul>
</li>
<li>
<p><strong>Ajustes adicionales:</strong></p>
<ul>
<li>Elimina las primeras dos filas (<code>df.drop([0, 1])</code>).</li>
<li>Asigna la primera fila como los nombres de las columnas (<code>df.columns = df.iloc[0]</code>).</li>
<li>Elimina la primera fila después de asignarla como encabezado.</li>
</ul>
</li>
<li>
<p><strong>Guardar el DataFrame:</strong></p>
<ul>
<li>Guarda el DataFrame limpio en el diccionario <code>dfs</code> con el nombre del archivo como clave.</li>
</ul>
</li>
</ol>
<hr />
<h4 id="salida_29"><strong>Salida</strong><a class="headerlink" href="#salida_29" title="Permanent link">&para;</a></h4>
<ul>
<li>No retorna valores. El DataFrame limpio se almacena en el diccionario <code>dfs</code> bajo la clave <code>file</code>.</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">Charge_Excel_Fixed</span><span class="p">(</span> <span class="n">ruta</span> <span class="p">,</span> <span class="n">dfs</span> <span class="p">,</span> <span class="n">file</span> <span class="p">):</span>
    <span class="c1"># Cargar el archivo Excel utilizando xlwings</span>
    <span class="n">wb</span> <span class="o">=</span> <span class="n">xw</span><span class="o">.</span><span class="n">Book</span><span class="p">(</span><span class="n">ruta</span><span class="p">)</span>
    <span class="n">sheet</span> <span class="o">=</span> <span class="n">wb</span><span class="o">.</span><span class="n">sheets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># Seleccionar la primera hoja</span>

    <span class="c1"># Leer todos los datos de la hoja</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">sheet</span><span class="o">.</span><span class="n">used_range</span><span class="o">.</span><span class="n">value</span>

    <span class="c1"># Crear un DataFrame a partir de los datos leídos</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="c1"># Eliminar filas completamente en blanco</span>
    <span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Eliminar columnas completamente en blanco</span>
    <span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">wb</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="n">df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>

    <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  

    <span class="n">dfs</span><span class="p">[</span><span class="n">file</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span>
</code></pre></div>
<h2 id="funciones-combine_and_store_unparametro-y-combine_and_store">Funciones <code>Combine_and_store_unparametro</code> y <code>Combine_and_store</code><a class="headerlink" href="#funciones-combine_and_store_unparametro-y-combine_and_store" title="Permanent link">&para;</a></h2>
<h4 id="proposito_31"><strong>Propósito</strong><a class="headerlink" href="#proposito_31" title="Permanent link">&para;</a></h4>
<p>Las funciones combinan múltiples archivos de una carpeta en un solo DataFrame, y opcionalmente, guardan el DataFrame combinado en un archivo Excel en una carpeta de destino especificada.</p>
<hr />
<h4 id="entradas_31"><strong>Entradas</strong><a class="headerlink" href="#entradas_31" title="Permanent link">&para;</a></h4>
<ul>
<li><strong><code>folder_url</code> (str):</strong> URL de la carpeta que contiene los archivos a combinar.</li>
<li><strong><code>download_folder</code> (str, opcional):</strong> Ruta del directorio donde se guardará el archivo Excel combinado. Si es <code>None</code>, el DataFrame no se guarda.</li>
<li><strong><code>names_file</code> (str, opcional):</strong> Nombre del archivo donde se guardará el DataFrame combinado (solo si <code>download_folder</code> no es <code>None</code>).</li>
</ul>
<hr />
<h4 id="funcionamiento_29"><strong>Funcionamiento</strong><a class="headerlink" href="#funcionamiento_29" title="Permanent link">&para;</a></h4>
<ol>
<li>
<p><strong>Carga y procesamiento de archivos:</strong></p>
<ul>
<li>Ambas funciones utilizan <code>process_files_from_folder</code> para procesar los archivos dentro de <code>folder_url</code>, almacenando los DataFrames en la lista <code>dfs</code>.</li>
</ul>
</li>
<li>
<p><strong>Combinación de DataFrames:</strong></p>
<ul>
<li>Si se encontraron archivos, los DataFrames en <code>dfs</code> se combinan utilizando <code>pd.concat(dfs, ignore_index=True)</code>.</li>
<li>El DataFrame combinado se registra en el log mostrando las primeras filas con <code>df_combined.head()</code>.</li>
</ul>
</li>
<li>
<p><strong>Guardado del DataFrame combinado (si aplica):</strong></p>
<ul>
<li>Si se proporciona <code>download_folder</code>, se verifica si la carpeta existe. Si no, se crea utilizando <code>os.makedirs()</code>.</li>
<li>Luego, guarda el DataFrame combinado en un archivo Excel dentro de <code>download_folder</code> con el nombre especificado en <code>names_file</code>.</li>
<li>Registra la ruta donde se guarda el archivo en el log.</li>
</ul>
</li>
<li>
<p><strong>Salida:</strong></p>
<ul>
<li>Si <code>download_folder</code> es <code>None</code>, devuelve el DataFrame combinado.</li>
<li>Si <code>download_folder</code> se especifica, guarda el archivo y no retorna nada.</li>
</ul>
</li>
</ol>
<hr />
<h4 id="salida_30"><strong>Salida</strong><a class="headerlink" href="#salida_30" title="Permanent link">&para;</a></h4>
<ul>
<li><strong><code>DataFrame</code>:</strong> Si <code>download_folder</code> es <code>None</code>, retorna el DataFrame combinado.</li>
<li><strong><code>None</code>:</strong> Si se guarda el archivo Excel, no retorna ningún valor.</li>
</ul>
<hr />
<div class="highlight"><pre><span></span><code><span class="c1"># Funcion para almacenar los DataFrames &lt;-------------------------------------------</span>
<span class="k">def</span><span class="w"> </span><span class="nf">Combine_and_store_unparametro</span><span class="p">(</span><span class="n">folder_url</span><span class="p">,</span><span class="n">download_folder</span> <span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">names_file</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">dfs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">process_files_from_folder</span><span class="p">(</span><span class="n">folder_url</span><span class="p">,</span> <span class="n">dfs</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">dfs</span><span class="p">:</span>
        <span class="n">df_combined</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">dfs</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Contenido combinado: </span><span class="se">\n</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">df_combined</span><span class="o">.</span><span class="n">head</span><span class="p">()))</span>        
        <span class="k">return</span> <span class="n">df_combined</span>

<span class="k">def</span><span class="w"> </span><span class="nf">Combine_and_store</span><span class="p">(</span><span class="n">folder_url</span><span class="p">,</span>  <span class="n">download_folder</span> <span class="o">=</span><span class="kc">None</span> <span class="p">,</span> <span class="n">names_file</span> <span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">dfs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">process_files_from_folder</span><span class="p">(</span><span class="n">folder_url</span><span class="p">,</span> <span class="n">dfs</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">dfs</span><span class="p">:</span>
        <span class="n">df_combined</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">dfs</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Contenido combinado: </span><span class="se">\n</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">df_combined</span><span class="o">.</span><span class="n">head</span><span class="p">()))</span>

        <span class="c1"># si download_folder no es None</span>
        <span class="k">if</span> <span class="n">download_folder</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>            
            <span class="c1"># Verificar si la carpeta de destino existe, si no, crearla</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">download_folder</span><span class="p">):</span>
                <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">download_folder</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="c1"># Guardar el DataFrame combinado en un archivo Excel</span>
            <span class="n">output_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">download_folder</span><span class="p">,</span> <span class="n">names_file</span><span class="p">)</span>
            <span class="n">df_combined</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="n">output_path</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Archivo guardado en </span><span class="si">{</span><span class="n">output_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">df_combined</span>
</code></pre></div>
<h2 id="funcion-conection_to_c4c">Función <code>conection_to_C4C</code><a class="headerlink" href="#funcion-conection_to_c4c" title="Permanent link">&para;</a></h2>
<h4 id="proposito_32"><strong>Propósito</strong><a class="headerlink" href="#proposito_32" title="Permanent link">&para;</a></h4>
<p>Automatiza el proceso de inicio de sesión en la página de C4C utilizando Selenium, ingresando las credenciales proporcionadas y haciendo clic en el botón de inicio de sesión.</p>
<hr />
<h4 id="entradas_32"><strong>Entradas</strong><a class="headerlink" href="#entradas_32" title="Permanent link">&para;</a></h4>
<ul>
<li><strong><code>driver</code> (webdriver.Chrome):</strong> Instancia de Selenium WebDriver utilizada para interactuar con la página web.</li>
</ul>
<hr />
<h4 id="funcionamiento_30"><strong>Funcionamiento</strong><a class="headerlink" href="#funcionamiento_30" title="Permanent link">&para;</a></h4>
<ol>
<li>
<p><strong>Obtención de credenciales:</strong></p>
<ul>
<li>Recupera el nombre de usuario y la contraseña para el inicio de sesión en C4C mediante la función <code>credenciales("C4C")</code>.</li>
</ul>
</li>
<li>
<p><strong>Localización de los elementos de inicio de sesión:</strong></p>
<ul>
<li>Utiliza <code>WebDriverWait</code> para esperar hasta que los elementos necesarios para el inicio de sesión (campos de usuario y contraseña, y el botón de login) sean visibles y clickeables.</li>
<li>Los elementos son localizados por sus identificadores (<code>USERNAME_FIELD-inner</code>, <code>PASSWORD_FIELD-inner</code>) y el botón de inicio de sesión por su XPath.</li>
</ul>
</li>
<li>
<p><strong>Ingreso de credenciales:</strong></p>
<ul>
<li>Escribe el nombre de usuario y la contraseña en los campos correspondientes.</li>
</ul>
</li>
<li>
<p><strong>Envío del formulario de inicio de sesión:</strong></p>
<ul>
<li>Hace clic en el botón de inicio de sesión para completar el proceso de login.</li>
</ul>
</li>
<li>
<p><strong>Registro:</strong></p>
<ul>
<li>Si el inicio de sesión es exitoso, registra un mensaje en el log indicando que el login fue exitoso.</li>
</ul>
</li>
</ol>
<hr />
<h4 id="salida_31"><strong>Salida</strong><a class="headerlink" href="#salida_31" title="Permanent link">&para;</a></h4>
<ul>
<li>No retorna valores. Realiza el inicio de sesión y registra el resultado en el log.</li>
</ul>
<hr />
<h4 id="excepciones_1"><strong>Excepciones</strong><a class="headerlink" href="#excepciones_1" title="Permanent link">&para;</a></h4>
<ul>
<li><strong><code>TimeoutException</code>:</strong> Si alguno de los elementos de la página (campo de usuario, campo de contraseña o botón de inicio de sesión) no se encuentra dentro del tiempo especificado.</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">conection_to_C4C</span><span class="p">(</span><span class="n">driver</span><span class="p">):</span>
    <span class="n">username</span><span class="p">,</span> <span class="n">password</span> <span class="o">=</span> <span class="n">credenciales</span><span class="p">(</span><span class="s2">&quot;C4C&quot;</span><span class="p">)</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Logs in to the C4C website using the provided credentials.</span>

<span class="sd">    Args:</span>
<span class="sd">        driver (webdriver.Chrome): The Selenium WebDriver instance.</span>
<span class="sd">        username (str): The username for C4C login.</span>
<span class="sd">        password (str): The password for C4C login.</span>

<span class="sd">    Raises:</span>
<span class="sd">        TimeoutException: If the login elements are not found within the timeout window.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Find login elements</span>
    <span class="n">username_field</span> <span class="o">=</span> <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span>
        <span class="n">EC</span><span class="o">.</span><span class="n">presence_of_element_located</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">ID</span><span class="p">,</span> <span class="s2">&quot;USERNAME_FIELD-inner&quot;</span><span class="p">))</span>
    <span class="p">)</span>
    <span class="n">password_field</span> <span class="o">=</span> <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span>
        <span class="n">EC</span><span class="o">.</span><span class="n">presence_of_element_located</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">ID</span><span class="p">,</span> <span class="s2">&quot;PASSWORD_FIELD-inner&quot;</span><span class="p">))</span>
    <span class="p">)</span>
    <span class="n">login_button</span> <span class="o">=</span> <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">15</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span>
            <span class="n">EC</span><span class="o">.</span><span class="n">element_to_be_clickable</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="s2">&quot;//button[@type=&#39;submit&#39;]&quot;</span><span class="p">))</span>
    <span class="p">)</span>

    <span class="c1"># Enter credentials and submit</span>
    <span class="n">username_field</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">username</span><span class="p">)</span>
    <span class="n">password_field</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">password</span><span class="p">)</span>
    <span class="n">login_button</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>

    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Login Successful&quot;</span><span class="p">)</span>
</code></pre></div>
<h2 id="funcion-download_file_between_dates">Función <code>download_file_between_dates</code><a class="headerlink" href="#funcion-download_file_between_dates" title="Permanent link">&para;</a></h2>
<h4 id="proposito_33"><strong>Propósito</strong><a class="headerlink" href="#proposito_33" title="Permanent link">&para;</a></h4>
<p>Automatiza el proceso de descargar un archivo de C4C entre dos fechas especificadas, interactuando con los campos de fecha y las opciones del formulario.</p>
<hr />
<h4 id="entradas_33"><strong>Entradas</strong><a class="headerlink" href="#entradas_33" title="Permanent link">&para;</a></h4>
<ul>
<li><strong><code>initial_date</code> (str):</strong> Fecha de inicio en formato de texto (ej. <code>'01/01/2022'</code>).</li>
<li><strong><code>final_date</code> (str):</strong> Fecha de finalización en formato de texto (ej. <code>'12/31/2022'</code>).</li>
<li><strong><code>driver</code> (webdriver.Chrome):</strong> Instancia de Selenium WebDriver utilizada para interactuar con la página de C4C.</li>
<li><strong><code>_dict</code> (dict):</strong> Diccionario que mapea nombres de campos de fecha y otras opciones a sus localizadores correspondientes (por ejemplo, <code>{'initial_date': 'field_id', 'final_date': 'field_id', 'option_1': 'option_xpath'}</code>).</li>
</ul>
<hr />
<h4 id="funcionamiento_31"><strong>Funcionamiento</strong><a class="headerlink" href="#funcionamiento_31" title="Permanent link">&para;</a></h4>
<ol>
<li>
<p><strong>Conexión a C4C:</strong></p>
<ul>
<li>Llama a la función <code>conection_to_C4C(driver)</code> para iniciar sesión en C4C utilizando las credenciales.</li>
</ul>
</li>
<li>
<p><strong>Interacción con el formulario:</strong></p>
<ul>
<li>Itera sobre las claves del diccionario <code>_dict</code>.</li>
<li>Si la clave no es <code>'initial_date'</code> ni <code>'final_date'</code>, hace clic en el elemento correspondiente usando la función <code>click_and_wait(driver, _dict[option])</code>.</li>
<li>Si la clave es <code>'initial_date'</code>, ingresa la fecha de inicio en el campo correspondiente.</li>
<li>Si la clave es <code>'final_date'</code>, ingresa la fecha de finalización en el campo correspondiente.</li>
</ul>
</li>
<li>
<p><strong>Esperas:</strong></p>
<ul>
<li>Se utiliza un <code>time.sleep(4)</code> después de llenar las fechas para asegurarse de que los campos se actualicen correctamente.</li>
<li>Se espera 40 segundos (<code>time.sleep(40)</code>) para dar tiempo a que la descarga se complete.</li>
</ul>
</li>
<li>
<p><strong>Cierre del WebDriver:</strong></p>
<ul>
<li>Después de completar la acción, cierra el WebDriver con <code>driver.quit()</code>.</li>
</ul>
</li>
</ol>
<hr />
<h4 id="salida_32"><strong>Salida</strong><a class="headerlink" href="#salida_32" title="Permanent link">&para;</a></h4>
<ul>
<li>No retorna valores. Realiza la descarga del archivo y cierra la sesión del WebDriver.</li>
</ul>
<hr />
<h4 id="excepciones_2"><strong>Excepciones</strong><a class="headerlink" href="#excepciones_2" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>Posibles excepciones de Selenium</strong>: Si los elementos no son encontrados, la función podría lanzar errores relacionados con la localización de elementos o interacción con los campos.</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">download_file_between_dates</span><span class="p">(</span><span class="n">initial_date</span><span class="p">,</span> <span class="n">final_date</span><span class="p">,</span> <span class="n">driver</span><span class="p">,</span><span class="n">_dict</span><span class="p">):</span>
    <span class="c1"># Conexión a C4C</span>
    <span class="n">conection_to_C4C</span><span class="p">(</span><span class="n">driver</span><span class="p">)</span>
    <span class="c1"># Iterar sobre las opciones en el diccionario</span>
    <span class="k">for</span> <span class="n">option</span> <span class="ow">in</span> <span class="n">_dict</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">option</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;initial_date&quot;</span><span class="p">,</span> <span class="s2">&quot;final_date&quot;</span><span class="p">):</span>
            <span class="n">click_and_wait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="n">_dict</span><span class="p">[</span><span class="n">option</span><span class="p">])</span>
        <span class="k">elif</span> <span class="n">option</span> <span class="o">==</span> <span class="s2">&quot;initial_date&quot;</span><span class="p">:</span>
            <span class="n">date_input</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">ID</span><span class="p">,</span> <span class="n">_dict</span><span class="p">[</span><span class="n">option</span><span class="p">])</span>
            <span class="n">date_input</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">initial_date</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">option</span> <span class="o">==</span> <span class="s2">&quot;final_date&quot;</span><span class="p">:</span>
            <span class="n">date_input</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">ID</span><span class="p">,</span> <span class="n">_dict</span><span class="p">[</span><span class="n">option</span><span class="p">])</span>
            <span class="n">date_input</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">final_date</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>

    <span class="c1"># Tiempo de espera adicional para asegurarse de que la descarga se complete</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">40</span><span class="p">)</span>  

    <span class="c1"># Cerrar el WebDriver</span>
    <span class="n">driver</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
</code></pre></div>
<h2 id="funcion-click_and_wait">Función <code>click_and_wait</code><a class="headerlink" href="#funcion-click_and_wait" title="Permanent link">&para;</a></h2>
<h4 id="proposito_34"><strong>Propósito</strong><a class="headerlink" href="#proposito_34" title="Permanent link">&para;</a></h4>
<p>Hace clic en un elemento localizado mediante XPath y espera a que la página se cargue o el elemento esté listo para interactuar.</p>
<hr />
<h4 id="entradas_34"><strong>Entradas</strong><a class="headerlink" href="#entradas_34" title="Permanent link">&para;</a></h4>
<ul>
<li><strong><code>driver</code> (WebDriver):</strong> Instancia de Selenium WebDriver utilizada para interactuar con la página.</li>
<li><strong><code>xpath</code> (str):</strong> Expresión XPath que localiza el elemento en el DOM.</li>
<li><strong><code>timeout</code> (int, opcional):</strong> Tiempo máximo en segundos para esperar a que el elemento sea clickeable. El valor predeterminado es <code>30</code> segundos.</li>
</ul>
<hr />
<h4 id="funcionamiento_32"><strong>Funcionamiento</strong><a class="headerlink" href="#funcionamiento_32" title="Permanent link">&para;</a></h4>
<ol>
<li>
<p><strong>Esperar hasta que el elemento esté clickeable:</strong></p>
<ul>
<li>Utiliza <code>WebDriverWait</code> para esperar hasta que el elemento identificado por el XPath proporcionado esté listo para ser clickeado.</li>
</ul>
</li>
<li>
<p><strong>Clic en el elemento:</strong></p>
<ul>
<li>Una vez que el elemento es clickeable, se realiza el clic en él.</li>
</ul>
</li>
</ol>
<hr />
<h4 id="salida_33"><strong>Salida</strong><a class="headerlink" href="#salida_33" title="Permanent link">&para;</a></h4>
<ul>
<li>No retorna valores. Realiza el clic en el elemento especificado y espera a que se cargue.</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">click_and_wait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="n">xpath</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">30</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Clicks on an element identified by xpath and waits for the page to load.</span>

<span class="sd">    Args:</span>
<span class="sd">        driver: The WebDriver instance.</span>
<span class="sd">        xpath: The xpath expression to locate the element.</span>
<span class="sd">        timeout: The maximum wait time in seconds (default: 20).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">link_to_click</span> <span class="o">=</span> <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="n">timeout</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span>
        <span class="n">EC</span><span class="o">.</span><span class="n">element_to_be_clickable</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">xpath</span><span class="p">))</span>
    <span class="p">)</span>
    <span class="n">link_to_click</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
</code></pre></div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation"], "search": "../../../assets/javascripts/workers/search.f8cc74c7.min.js", "tags": null, "translations": {"clipboard.copied": "Copiado al portapapeles", "clipboard.copy": "Copiar al portapapeles", "search.result.more.one": "1 m\u00e1s en esta p\u00e1gina", "search.result.more.other": "# m\u00e1s en esta p\u00e1gina", "search.result.none": "No se encontraron documentos", "search.result.one": "1 documento encontrado", "search.result.other": "# documentos encontrados", "search.result.placeholder": "Teclee para comenzar b\u00fasqueda", "search.result.term.missing": "Falta", "select.version": "Seleccionar versi\u00f3n"}, "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.c8b220af.min.js"></script>
      
        <script src="../../../assets/mkdocs_pagetree_plugin.js"></script>
      
        <script src="../../../js/init_mermaid.js"></script>
      
    
  </body>
</html>